{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/tomotoes/source/css/style.less","path":"css/style.less","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/dist/APlayer.min.css","path":"dist/APlayer.min.css","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/dist/APlayer.min.css.map","path":"dist/APlayer.min.css.map","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/dist/music.js","path":"dist/music.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/dist/APlayer.min.js","path":"dist/APlayer.min.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/default.cur","path":"img/default.cur","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/cc.png","path":"img/cc.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/avatar.jpg","path":"img/avatar.jpg","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/desktop.ini","path":"img/desktop.ini","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/pointer.cur","path":"img/pointer.cur","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/img-err.png","path":"img/img-err.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/favicon.ico","path":"img/favicon.ico","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/img-loading.png","path":"img/img-loading.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/wechat.png","path":"img/wechat.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/yuanbao.png","path":"img/yuanbao.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/main.min.js","path":"js/main.min.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/script.min.js","path":"js/script.min.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/ym.js","path":"js/ym.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/img/dog.png","path":"img/dog.png","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/jquery.min.js","path":"js/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/js/jquery.js","path":"js/jquery.js","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/dist/APlayer.min.js.map","path":"dist/APlayer.min.js.map","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.eot","path":"css/fonts/roboto/Roboto-Bold.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.woff2","path":"css/fonts/roboto/Roboto-Bold.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.eot","path":"css/fonts/roboto/Roboto-Light.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.woff","path":"css/fonts/roboto/Roboto-Light.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.eot","path":"css/fonts/roboto/Roboto-Medium.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.woff2","path":"css/fonts/roboto/Roboto-Light.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.woff","path":"css/fonts/roboto/Roboto-Medium.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.eot","path":"css/fonts/roboto/Roboto-Regular.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.woff2","path":"css/fonts/roboto/Roboto-Regular.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.woff2","path":"css/fonts/roboto/Roboto-Medium.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.eot","path":"css/fonts/roboto/Roboto-Thin.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.woff","path":"css/fonts/roboto/Roboto-Thin.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.woff2","path":"css/fonts/roboto/Roboto-Thin.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.woff2","path":"css/fonts/fontawesome/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.woff","path":"css/fonts/fontawesome/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.woff","path":"css/fonts/roboto/Roboto-Bold.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.ttf","path":"css/fonts/roboto/Roboto-Light.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.woff","path":"css/fonts/roboto/Roboto-Regular.woff","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.eot","path":"css/fonts/fontawesome/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/FontAwesome.otf","path":"css/fonts/fontawesome/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.ttf","path":"css/fonts/roboto/Roboto-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.ttf","path":"css/fonts/fontawesome/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.ttf","path":"css/fonts/roboto/Roboto-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.ttf","path":"css/fonts/roboto/Roboto-Thin.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.ttf","path":"css/fonts/roboto/Roboto-Medium.ttf","modified":1,"renderable":1},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.svg","path":"css/fonts/fontawesome/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/tomotoes/CONTRIBUTING.md","hash":"06f37d19d9daa9f1b94dacd0c48ba1781ae7a9e6","modified":1612406285494},{"_id":"themes/tomotoes/.editorconfig","hash":"6098d799d623f7cfed089899f03126f6bb9179a4","modified":1612406285492},{"_id":"themes/tomotoes/README.md","hash":"508daf95d8314b06e1de0e1ee17c9ee23c356d89","modified":1612406285494},{"_id":"themes/tomotoes/CODE_OF_CONDUCT.md","hash":"daaa6c51e5c67818f2d5c304e9eb6982da52cec8","modified":1612406285493},{"_id":"themes/tomotoes/LICENSE","hash":"24944bf7920108f5a4790e6071c32e9102760c37","modified":1612406285494},{"_id":"themes/tomotoes/package.json","hash":"9ffa2ecbc0b4825cdce926207f782a4d9f9804b1","modified":1612406285515},{"_id":"themes/tomotoes/_config.yml","hash":"95e0286c7e078c9e908dcab39aa40fc4af6d6a3e","modified":1614605158336},{"_id":"themes/tomotoes/package-lock.json","hash":"fb86d87490d2b5dc74306fe6b8c92bd5228664ff","modified":1612406285515},{"_id":"source/_posts/BDD框架behave学习.md","hash":"9cbd8f1a21bd0616546389fe08cf286ca75bdb87","modified":1612406285398},{"_id":"source/_posts/dubbo-test.md","hash":"7fd297d2f620c70e1c0baf5fd5c43efc05a027e8","modified":1612406285399},{"_id":"source/_posts/article.md","hash":"7240e294be4d36c091551ea4eb09dd3b6e127b66","modified":1612406285399},{"_id":"source/_posts/jmeter分布式压测及问题记录.md","hash":"37a58046e820433603879d43a12c840901376369","modified":1612406285400},{"_id":"source/_posts/python-socket-模拟收发HTTP请求.md","hash":"3bee75c3de7f4a68865d425a12ba6ebce8f5c2ca","modified":1612406285401},{"_id":"source/_posts/jmeterconfig.md","hash":"f0f95f596e920f6b21ee69f8bccdc94defa54d42","modified":1612931718228},{"_id":"source/_posts/ym.md","hash":"110afe939d98af9533335a6bb9ba4f47c182e0f6","modified":1612406285402},{"_id":"source/_posts/《最后的演讲》观后感.md","hash":"e392ca2d59627c8184aa0f5ab25f659f76fc85c4","modified":1612406285403},{"_id":"source/_posts/基于OpenCover进行代码覆盖率测试.md","hash":"0031b2caec2de000e5a29209bd8684da7a97d67c","modified":1612406285403},{"_id":"source/_posts/《凤凰项目》笔记.md","hash":"c3ebe69996949df05fb6c276a90e6fb7300e59a3","modified":1612406285402},{"_id":"source/tags/index.md","hash":"0bbad00fac3fbd8379ee1856456a076a0d35a108","modified":1612406285405},{"_id":"source/recent/index.md","hash":"22834176ca0df41542423b1d0a97c7f08d765f9f","modified":1614235478364},{"_id":"source/_posts/猎豹行动笔记.md","hash":"81034ff2925dee9751bfa191b7166f0007603ebb","modified":1612666794506},{"_id":"source/about/index.md","hash":"27e2d8e8921fdfb30f5d721fe781738a227004e2","modified":1612406285405},{"_id":"source/categories/index.md","hash":"9d5ba463f7fbe7fdba443ba91843c3f6cb3f140e","modified":1612406285405},{"_id":"themes/tomotoes/languages/es-ES.yml","hash":"b8b330fdc997463db838f6cfdb40108f6a746b27","modified":1612406285496},{"_id":"themes/tomotoes/languages/en.yml","hash":"2d6206dd762bb8ec2b4177dbb37d91e291126151","modified":1612406285495},{"_id":"themes/tomotoes/languages/ja.yml","hash":"215b56fcede2a1e660943ca2d41319e98a680ab6","modified":1612406285496},{"_id":"themes/tomotoes/languages/zh-CN.yml","hash":"50daaab6d04c34611c2fefae6fd2a31294fe5456","modified":1612406285497},{"_id":"themes/tomotoes/languages/nl-NL.yml","hash":"b722f7b096879f8f45e8bdf26345722d6da8ff21","modified":1612406285496},{"_id":"themes/tomotoes/languages/zh-TW.yml","hash":"6a9e820be66eb12ae746f2527e0dc1adf927c685","modified":1612406285497},{"_id":"themes/tomotoes/layout/card.ejs","hash":"e89e55fb104459563db7374e54aa47d0b2376a76","modified":1614510248737},{"_id":"themes/tomotoes/layout/categories.ejs","hash":"9084ecdd9dd950afa0c3149d2be05611bc7c78f5","modified":1612406285511},{"_id":"themes/tomotoes/layout/archive.ejs","hash":"afcdf68a33cae8ff689293d8edd635dbb97340e8","modified":1612406285510},{"_id":"themes/tomotoes/layout/category.ejs","hash":"7ea26a8a935886963eda82f41c7bd5270cf780d9","modified":1612406285511},{"_id":"themes/tomotoes/layout/index.ejs","hash":"823c041eff373f95c8384f25a390ac4e6a20b835","modified":1612406285512},{"_id":"themes/tomotoes/layout/layout.ejs","hash":"6c4415a5d86f4271db79808dca28b902f4b8a381","modified":1612406285512},{"_id":"themes/tomotoes/layout/page.ejs","hash":"bc2f6ba4885a2b613fc5b22a781d938b191e114f","modified":1612406285513},{"_id":"themes/tomotoes/layout/post.ejs","hash":"4d4b8f219ce7949a5f2f52ce3a1ab2ae3c0eedb2","modified":1612406285513},{"_id":"themes/tomotoes/layout/tag.ejs","hash":"36786a3de7f6cad58209603f7d84ba23addea174","modified":1612406285514},{"_id":"themes/tomotoes/layout/tags.ejs","hash":"5b26a347bd21690c05e63c1bd5ab8f5ea2f24e67","modified":1612406285514},{"_id":"themes/tomotoes/scripts/plugins.js","hash":"78e99be38a6f7adf6499f38fed6f005fd3e09a26","modified":1614231829970},{"_id":"themes/tomotoes/layout/recent.ejs","hash":"7f608f621ca4febeac4a3bbcbce67243e5a82a63","modified":1614645841225},{"_id":"themes/tomotoes/scripts/ym.js","hash":"526edb542b39a7b07a2e31c79e952045a013b206","modified":1614240734155},{"_id":"themes/tomotoes/.github/ISSUE_TEMPLATE/bug_report.md","hash":"83d211c67c12e8c1f6e9f796cfd0cecbf5160e15","modified":1612406285492},{"_id":"themes/tomotoes/.github/ISSUE_TEMPLATE/custom.md","hash":"84208538d48505ee8e49812cb336eb9882e08dc7","modified":1612406285493},{"_id":"themes/tomotoes/.github/ISSUE_TEMPLATE/feature_request.md","hash":"f6867a2f0417fe89a0f2008730ee19dd38422021","modified":1612406285493},{"_id":"themes/tomotoes/layout/_partial/footer.ejs","hash":"67eee9b03fe8aacc7f95039a96c93ebc973fc0db","modified":1612406285498},{"_id":"themes/tomotoes/layout/_partial/after-footer.ejs","hash":"211e5f8b428384d2f98eb245d2bf0cae07b4ccc1","modified":1612406285498},{"_id":"themes/tomotoes/layout/_partial/archive.ejs","hash":"a066db76d2970f38786e427b389dcc5750ef54b0","modified":1612406285498},{"_id":"themes/tomotoes/layout/_partial/index-item.ejs","hash":"ac01759c4d2cf9d614f529f53abfdc855bf36fb6","modified":1612406285500},{"_id":"themes/tomotoes/layout/_partial/common.ejs","hash":"eff60e06567db5664a2f18463850116137363b11","modified":1614511375306},{"_id":"themes/tomotoes/layout/_partial/menu.ejs","hash":"dbbec5c18bc781c74735ca18a1929ecdb98ed223","modified":1612406285500},{"_id":"themes/tomotoes/layout/_partial/header.ejs","hash":"be810cb75fae0d31f68a2de534b9d85d03fa43b2","modified":1614250137570},{"_id":"themes/tomotoes/layout/_partial/loading.ejs","hash":"fd88a2c7e11f758531663cfb72f4bcaf54d5a747","modified":1612406285500},{"_id":"themes/tomotoes/layout/_partial/head.ejs","hash":"2c8271c029be3d6abaea1965cb883bc53645edd5","modified":1614607001954},{"_id":"themes/tomotoes/layout/_partial/paginator.ejs","hash":"dc27242927890f130a64400596b9b7ad5fca8972","modified":1612406285501},{"_id":"themes/tomotoes/layout/_partial/switch.ejs","hash":"1e296f63b5d99f85dcfedbee91ad6fb28ced9ea5","modified":1612406285510},{"_id":"themes/tomotoes/layout/_partial/post.ejs","hash":"0044ab24d1aa26f5ce3b26e0686da5cf3551d73f","modified":1612406285505},{"_id":"themes/tomotoes/layout/_partial/search.ejs","hash":"55a1c6429fcf66cba22c865b565e85b9306e5760","modified":1612406285509},{"_id":"themes/tomotoes/layout/_partial/tags-bar.ejs","hash":"ae14ee5e49372af508f351c36873160741c1b9ce","modified":1612406285510},{"_id":"themes/tomotoes/layout/_partial/script.ejs","hash":"049fc1a0491b59fcc7fe8526ca2033d93dda6e3b","modified":1614510064770},{"_id":"themes/tomotoes/source/css/style.less","hash":"77f177e64528cef6b76bdc20262422109915bc7f","modified":1614438506192},{"_id":"themes/tomotoes/source/dist/APlayer.min.css","hash":"5c8b5f47736827aaeb5206e78429253de75ab8b3","modified":1612406285535},{"_id":"themes/tomotoes/source/dist/APlayer.min.css.map","hash":"c59d2bc9472922cf6ef9a99e052dbee6cc7e6b36","modified":1612406285535},{"_id":"themes/tomotoes/source/dist/music.js","hash":"2b48f58204deebae45eb3bb81fdc2754c41fd97f","modified":1612406285536},{"_id":"themes/tomotoes/source/dist/APlayer.min.js","hash":"4b78c95ed53557e4bad614b629b2e7fb2ee69c31","modified":1612406285535},{"_id":"themes/tomotoes/source/img/default.cur","hash":"3381d41a9dcbb4c4e69559723481f85e2b8cf99e","modified":1612406285536},{"_id":"themes/tomotoes/source/img/cc.png","hash":"ebce75a62b40976a72d43f0bd937d859ac24d87c","modified":1612406285536},{"_id":"themes/tomotoes/source/img/avatar.jpg","hash":"32c6e1b06b37c5c1ab13e95578ed1100abe5c440","modified":1612406285536},{"_id":"themes/tomotoes/source/img/desktop.ini","hash":"fa32d8fdd3aae31b03f5f36df14be6fb307eca60","modified":1612406285536},{"_id":"themes/tomotoes/source/img/pointer.cur","hash":"3adb643f97571f547021fb57b2d9d768a252d546","modified":1612406285537},{"_id":"themes/tomotoes/source/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1612406285537},{"_id":"themes/tomotoes/source/img/favicon.ico","hash":"848593b6cb46a400c48ae2b81f3eaad270a26855","modified":1612406285537},{"_id":"themes/tomotoes/source/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1612406285537},{"_id":"themes/tomotoes/source/img/wechat.png","hash":"40e61c097e4eaddff95a27d7a4980fbbf596d43e","modified":1612406285537},{"_id":"themes/tomotoes/source/img/yuanbao.png","hash":"dceaa1d0de24af3c52b7efb00aa6d5760c7c9bdc","modified":1612406285537},{"_id":"themes/tomotoes/source/js/main.min.js","hash":"98dacac5f2ca3d2a8b0637a40dd3e56f5d0fc350","modified":1614645851021},{"_id":"themes/tomotoes/source/js/script.min.js","hash":"8a724bbbd9e50b659878437cc7a7711c65e7a453","modified":1614501742042},{"_id":"themes/tomotoes/source/js/main.js","hash":"df317d87d051d717a12abe751da60e3a2ca93235","modified":1614589080818},{"_id":"themes/tomotoes/source/js/script.js","hash":"37cce9f25e448295d6ce8840ac5c911f2609bb48","modified":1614501726593},{"_id":"themes/tomotoes/source/js/ym.js","hash":"5a70a1905d281c07eb983e356bfb8a2a612e2e28","modified":1614439027071},{"_id":"themes/tomotoes/source/img/dog.png","hash":"ef30d046fa20b3e9b01d6531e5e435dc4c9076a1","modified":1612406285537},{"_id":"themes/tomotoes/source/js/jquery.min.js","hash":"2c5a2df970b0f3e004aa0e7c8564726b3f388af9","modified":1612406285538},{"_id":"themes/tomotoes/source/js/jquery.js","hash":"1055018c28ab41087ef9ccefe411606893dabea2","modified":1612406285538},{"_id":"themes/tomotoes/layout/_partial/plugins/disqus.ejs","hash":"4a0c01e4195f685f9825fcd016d01249dbdd52ca","modified":1612406285501},{"_id":"themes/tomotoes/layout/_partial/plugins/baidu.ejs","hash":"c25cf074bb1d1ac30c0ff13480c029a866e61137","modified":1612406285501},{"_id":"themes/tomotoes/layout/_partial/plugins/gitalk.ejs","hash":"e12689917bb11d24a9e226ff22466fc5d12342a4","modified":1612406285501},{"_id":"themes/tomotoes/layout/_partial/plugins/gitment.ejs","hash":"5723d507eca4390e8e5d18c0770e7953b8c22f5a","modified":1612406285502},{"_id":"themes/tomotoes/layout/_partial/plugins/google-analytics.ejs","hash":"a947f4076b54b48d4df5baf2d5b3c39b632c7576","modified":1612406285502},{"_id":"themes/tomotoes/layout/_partial/plugins/mathjax.ejs","hash":"ea603a057196de53bd6afab1fddb93d11f27eb81","modified":1612406285503},{"_id":"themes/tomotoes/layout/_partial/plugins/page-visit.ejs","hash":"1222bc7c9922aec07bb280b1b2d253ccb7acc71e","modified":1612406285503},{"_id":"themes/tomotoes/layout/_partial/plugins/site-visit.ejs","hash":"ba647a1362957be481298b2a0f8e172758382dcb","modified":1612406285503},{"_id":"themes/tomotoes/layout/_partial/plugins/tajs.ejs","hash":"97b48fe10be1c71d4ff25ccec3bd92d97466c9c5","modified":1612406285504},{"_id":"themes/tomotoes/layout/_partial/plugins/uyan.ejs","hash":"e370bd04ea5cf1c83e0c20516aff7ba3ca8b2d0b","modified":1612406285504},{"_id":"themes/tomotoes/layout/_partial/plugins/valine.ejs","hash":"bd3ead19cdd0da1f7906bc25fd307efce7725d3e","modified":1612406285504},{"_id":"themes/tomotoes/layout/_partial/post/category.ejs","hash":"61750d41d8b5e838fbaa4011d6a1af5baf45591b","modified":1612406285505},{"_id":"themes/tomotoes/layout/_partial/post/comment.ejs","hash":"545e7050df3dd9b597e2cc418bb0b1474ac48d88","modified":1612406285505},{"_id":"themes/tomotoes/layout/_partial/post/copyright.ejs","hash":"bf70db059408704ce69bc999da59009b73f701a1","modified":1612406285505},{"_id":"themes/tomotoes/layout/_partial/post/date.ejs","hash":"ea85b46e12d3b9c3612eef7aa76289a663fbc096","modified":1612406285506},{"_id":"themes/tomotoes/layout/_partial/post/head-meta.ejs","hash":"b0c680ce5b8aaf461a6731b1ff1287bd140c168a","modified":1612406285506},{"_id":"themes/tomotoes/layout/_partial/post/nav.ejs","hash":"e97a44b971bf0e69bf596d8022938fa975795081","modified":1612406285506},{"_id":"themes/tomotoes/layout/_partial/post/reward-btn.ejs","hash":"c954f13d5472946991ce2bca5d110935bcd63020","modified":1612406285506},{"_id":"themes/tomotoes/layout/_partial/post/reward.ejs","hash":"b887d91fddea2388a5c8a8b5fd1d4023dde9aa9a","modified":1612406285507},{"_id":"themes/tomotoes/layout/_partial/post/share-fab.ejs","hash":"93482ad7d1e01b966f5ee1c5d12b88564e02b349","modified":1612406285507},{"_id":"themes/tomotoes/layout/_partial/post/share.ejs","hash":"f2013ae3da4f5ec5cd3ad4184ce28971acab0ecf","modified":1612406285507},{"_id":"themes/tomotoes/layout/_partial/post/tag.ejs","hash":"b3dc38652c4a018a37418136478dcd522fc49f79","modified":1612406285508},{"_id":"themes/tomotoes/layout/_partial/post/title.ejs","hash":"e308f5202e62e90ae678c5bff865f07ee204f423","modified":1612406285508},{"_id":"themes/tomotoes/layout/_partial/post/toc.ejs","hash":"d146530e081ec2fc0593a6bb250bd6569427a072","modified":1612406285508},{"_id":"themes/tomotoes/layout/_partial/post/updated.ejs","hash":"25b9e923e9a60187755f713f2e5b4828e1fa97b3","modified":1612406285509},{"_id":"themes/tomotoes/source/css/_partial/archives.less","hash":"21bf1a29e25b0495fbb72522ca1e062fcdc68fef","modified":1612406285516},{"_id":"themes/tomotoes/source/css/_partial/article.less","hash":"b09b3e7f8b87c742e4bee1352d0777b0182bea29","modified":1612406285517},{"_id":"themes/tomotoes/source/css/_partial/cursor.less","hash":"3e98a1d67c05bc2bdb9e52387ae7b28cedc41e4c","modified":1612406285517},{"_id":"themes/tomotoes/source/css/_partial/footer.less","hash":"3eb7f193b0589351cbaeacc71e5a248c3456de43","modified":1612406285518},{"_id":"themes/tomotoes/source/css/_partial/gotop.less","hash":"6438192123b1538381c990522cfbc76fa1ba2cfd","modified":1612406285519},{"_id":"themes/tomotoes/source/css/_partial/header.less","hash":"6a88a76d7b67b7b01084d02b26e9f81a3d368db7","modified":1612406285519},{"_id":"themes/tomotoes/source/css/_partial/highlight.less","hash":"29b686313ea0166dcd33e9c985903fe158bc11a4","modified":1612406285520},{"_id":"themes/tomotoes/source/css/_partial/layout.less","hash":"6f4554055222adc029f0518d03fe1f97cf414968","modified":1614444903132},{"_id":"themes/tomotoes/source/css/_partial/lightbox.less","hash":"b058a0ca88a5f0f7d207a2b182b172addfa1e5d8","modified":1612406285520},{"_id":"themes/tomotoes/source/css/_partial/loading.less","hash":"ccc9cd3ae59c051cb38d32ddbbb85c3355ce4a74","modified":1612406285521},{"_id":"themes/tomotoes/source/css/_partial/menu.less","hash":"2becafb0d6531e49f1c615f3028ae064d004b59a","modified":1614346177561},{"_id":"themes/tomotoes/source/css/_partial/page.less","hash":"05df8c336e63cebf7bf8b15bd4df9499dfb061df","modified":1612406285521},{"_id":"themes/tomotoes/source/css/_partial/postlist.less","hash":"9e2990a802255eed3475097f6daac9324fa7c62b","modified":1612406285522},{"_id":"themes/tomotoes/source/css/_partial/recent.less","hash":"e46f6ec7cb98a9b3565746ae5b914d38ba3eb220","modified":1614445883627},{"_id":"themes/tomotoes/source/css/_partial/reward.less","hash":"6fd843bf90042fa33c08848f4233a87259aad22c","modified":1612406285522},{"_id":"themes/tomotoes/source/css/_partial/roboto.less","hash":"2e0469ed8161d5672d903ca1a8027cd65fe007f1","modified":1612406285522},{"_id":"themes/tomotoes/source/css/_partial/search.less","hash":"5173bb54f3f12471ae14222d8e7c872e15ea718b","modified":1612406285523},{"_id":"themes/tomotoes/source/css/_partial/share.less","hash":"ea2f4fbb4315332076b457caaaeebf87e8772fa6","modified":1612406285523},{"_id":"themes/tomotoes/source/css/_partial/tags.less","hash":"399a47a897af986c2c3ab9ad2f7e65b1f92347ba","modified":1612406285523},{"_id":"themes/tomotoes/source/css/_partial/variable.less","hash":"f6af7ab9a152f23ca326e7f0ead0a9bb0c1419f6","modified":1612406285524},{"_id":"themes/tomotoes/source/css/_partial/waves.less","hash":"f54f963e3c2db0aeac2443e28bc322dae1db4c91","modified":1612406285524},{"_id":"themes/tomotoes/source/css/_partial/fontawesome.less","hash":"a6bb897a8022077f5488317667542b457ef66e16","modified":1612406285518},{"_id":"themes/tomotoes/source/dist/APlayer.min.js.map","hash":"31a19da0f0cb6b00ec212eafa847f31af86788df","modified":1612406285536},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1612406285527},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1612406285528},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1612406285529},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1612406285530},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1612406285530},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1612406285530},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1612406285531},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1612406285532},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1612406285533},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1612406285531},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1612406285533},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1612406285534},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1612406285534},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1612406285527},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1612406285527},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1612406285528},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1612406285529},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1612406285533},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1612406285525},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1612406285524},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1612406285528},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1612406285526},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1612406285532},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1612406285534},{"_id":"themes/tomotoes/source/css/fonts/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1612406285531},{"_id":"themes/tomotoes/source/css/fonts/fontawesome/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1612406285526},{"_id":"public/baidusitemap.xml","hash":"50a3e2bdd743d63707d435f4d5f864da301c5837","modified":1614645933719},{"_id":"public/atom.xml","hash":"0c86e9e1a58750e720f8583dc7421f082f4001d4","modified":1614645933719},{"_id":"public/content.json","hash":"8736f73331a9eaa800960294c8e787e0ca9cac78","modified":1614645933719},{"_id":"public/sitemap.xml","hash":"e54ca7438f983506b3b26029c2744a03a9663f92","modified":1614645933719},{"_id":"public/categories/index.html","hash":"a2e352da44fbf4c440e6bdc666bf0963e420348b","modified":1614645933719},{"_id":"public/archives/page/2/index.html","hash":"1052c1fd9128bc661d3b10850af59f32e92f4370","modified":1614645933719},{"_id":"public/archives/2020/page/2/index.html","hash":"32ccdb6a896ca87935a6c8211915a83ed920a5c1","modified":1614645933719},{"_id":"public/archives/2020/03/index.html","hash":"2b5805d84801a1ff791aa8c05069c35c52222097","modified":1614645933719},{"_id":"public/archives/2020/12/index.html","hash":"92d95c5d463a97bd158274974e721ae22f3cfb65","modified":1614645933719},{"_id":"public/categories/接口测试/index.html","hash":"decc616d9d778e9d520ac3810123f42781152e27","modified":1614645933719},{"_id":"public/page/2/index.html","hash":"0b0c1c8ec8306110a6b82b0e922e2d6632c5d9cf","modified":1614645933719},{"_id":"public/categories/网络/index.html","hash":"63523bdeb6551c7e0222a77e271aaed2467e0b1f","modified":1614645933719},{"_id":"public/categories/性能测试/index.html","hash":"87f605484155a350e2ed0ea6abec57f41deda088","modified":1614645933719},{"_id":"public/categories/观后感/index.html","hash":"0116533ab752810a52b9c82793480e5cc8468dde","modified":1614645933719},{"_id":"public/tags/接口测试/index.html","hash":"59a345bfb703582413afd52f94bbc0b9da83777f","modified":1614645933719},{"_id":"public/tags/性能测试/index.html","hash":"ae0d1fbd837b52bb9ff58cb15cd92c6ff5e7b38f","modified":1614645933719},{"_id":"public/tags/协议/index.html","hash":"eeb9894556627e4d41282741b652d95d22718d78","modified":1614645933719},{"_id":"public/tags/python/index.html","hash":"32a651dc02675800366769e2f139d4f3b4198315","modified":1614645933719},{"_id":"public/tags/socket/index.html","hash":"2056be0953849a1085d5e89f23b79339119bb96c","modified":1614645933719},{"_id":"public/tags/观后感/index.html","hash":"20542ae601ac13314d480c61b548229a29407abb","modified":1614645933719},{"_id":"public/tags/覆盖率测试/index.html","hash":"4c34566144b973e9593d255aacccc3c2873b7878","modified":1614645933719},{"_id":"public/tags/DevOps/index.html","hash":"46f7108ee1aa68a618754155f464eff853d9cd3b","modified":1614645933719},{"_id":"public/tags/index.html","hash":"dd95f939ab921e2edcc7e14d527b89ef49850a5d","modified":1614645933719},{"_id":"public/recent/index.html","hash":"10cd98e93cca8bc6bdc9419376698ff76b3a04d3","modified":1614645933719},{"_id":"public/about/index.html","hash":"77ae942085d2a095395dd7eb9e5ed42f1a7f902d","modified":1614645933719},{"_id":"public/posts/e6f54ca7/index.html","hash":"afd0e52a76fe81539cae0d2e6f8cc6108f1b0dee","modified":1614645933719},{"_id":"public/posts/8920367b/index.html","hash":"b06827ead8681ba2302d694b087a11079c752b39","modified":1614645933719},{"_id":"public/posts/6178cbe6/index.html","hash":"70edee1e4fc51c1d02f0bfde48db8e5da1e60a69","modified":1614645933719},{"_id":"public/posts/5e8f1732/index.html","hash":"cd488cbbd2d38adfbdc2298f100951f4b7bf68ad","modified":1614645933719},{"_id":"public/posts/d698d359/index.html","hash":"ccbb4474a022f1af1b57fedac67617d3119a3800","modified":1614645933719},{"_id":"public/posts/1936ef26/index.html","hash":"b565f9c4f813cc9ff688166cf1906e7b7278547b","modified":1614645933719},{"_id":"public/posts/270d5148/index.html","hash":"85254c9aab7b079f013ea6499aff854ffa8f7000","modified":1614645933719},{"_id":"public/posts/b8d58d05/index.html","hash":"54ba0ee90ecf57ac7b1bfdd37ffa2ad15b5e2b12","modified":1614645933719},{"_id":"public/posts/f0c13426/index.html","hash":"98044884dbea26bec9502392080ef9d9aedd334b","modified":1614645933719},{"_id":"public/posts/81c88605/index.html","hash":"d7fb70c8cbfd93a34c1bda347573288cf9979d85","modified":1614645933719},{"_id":"public/posts/8c27cda5/index.html","hash":"2d34f3db16f63adc4f979e3e4e925a27aa027b1a","modified":1614645933719},{"_id":"public/archives/index.html","hash":"0d5486be0e6febdac4a6091a15c78fbc14f0cbf1","modified":1614645933719},{"_id":"public/archives/2020/index.html","hash":"04c06ecc2ddba72f3956f8433a58e1ff20cfc18a","modified":1614645933719},{"_id":"public/archives/2020/04/index.html","hash":"be8c8f7ee2112ad03f8c8553e4507fa5c0a52abb","modified":1614645933719},{"_id":"public/index.html","hash":"5ff660d949533ab44eac8fc03ea1437aff2624fa","modified":1614645933719},{"_id":"public/categories/读书笔记/index.html","hash":"c535913e837b6eb9311aebd46879ba259d97d464","modified":1614645933719},{"_id":"public/tags/测试/index.html","hash":"61574e96421f0c1318a8a07ec4330a09af16cfd8","modified":1614645933719},{"_id":"public/tags/读书笔记/index.html","hash":"b0c44a3dd3dd41f276748274fddcee0f40c777a4","modified":1614645933719},{"_id":"public/tags/敏捷/index.html","hash":"c0107e646a7312f8d926b5255a301965ce366e37","modified":1614645933719},{"_id":"public/img/cc.png","hash":"ebce75a62b40976a72d43f0bd937d859ac24d87c","modified":1614645933719},{"_id":"public/img/default.cur","hash":"3381d41a9dcbb4c4e69559723481f85e2b8cf99e","modified":1614645933719},{"_id":"public/img/desktop.ini","hash":"fa32d8fdd3aae31b03f5f36df14be6fb307eca60","modified":1614645933719},{"_id":"public/img/pointer.cur","hash":"3adb643f97571f547021fb57b2d9d768a252d546","modified":1614645933719},{"_id":"public/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1614645933719},{"_id":"public/img/favicon.ico","hash":"848593b6cb46a400c48ae2b81f3eaad270a26855","modified":1614645933719},{"_id":"public/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1614645933719},{"_id":"public/img/wechat.png","hash":"40e61c097e4eaddff95a27d7a4980fbbf596d43e","modified":1614645933719},{"_id":"public/img/yuanbao.png","hash":"dceaa1d0de24af3c52b7efb00aa6d5760c7c9bdc","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1614645933719},{"_id":"public/assets/css/APlayer.min.css","hash":"07372a2ba507388d0fed166d761b1c2c2a659dce","modified":1614645933719},{"_id":"public/assets/js/Meting.min.js","hash":"a0585220b918d78649a7893279e1ec4fb5abe835","modified":1614645933719},{"_id":"public/assets/js/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1614645933719},{"_id":"public/dist/APlayer.min.css.map","hash":"c59d2bc9472922cf6ef9a99e052dbee6cc7e6b36","modified":1614645933719},{"_id":"public/img/avatar.jpg","hash":"32c6e1b06b37c5c1ab13e95578ed1100abe5c440","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1614645933719},{"_id":"public/img/dog.png","hash":"ef30d046fa20b3e9b01d6531e5e435dc4c9076a1","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1614645933719},{"_id":"public/dist/music.js","hash":"2b48f58204deebae45eb3bb81fdc2754c41fd97f","modified":1614645933719},{"_id":"public/dist/APlayer.min.css","hash":"5c8b5f47736827aaeb5206e78429253de75ab8b3","modified":1614645933719},{"_id":"public/js/main.min.js","hash":"98dacac5f2ca3d2a8b0637a40dd3e56f5d0fc350","modified":1614645933719},{"_id":"public/js/script.min.js","hash":"8a724bbbd9e50b659878437cc7a7711c65e7a453","modified":1614645933719},{"_id":"public/js/ym.js","hash":"5a70a1905d281c07eb983e356bfb8a2a612e2e28","modified":1614645933719},{"_id":"public/dist/APlayer.min.js","hash":"4b78c95ed53557e4bad614b629b2e7fb2ee69c31","modified":1614645933719},{"_id":"public/js/main.js","hash":"9955a14613d06d29ec2ec6a6b8673197d924a6af","modified":1614645933719},{"_id":"public/js/script.js","hash":"c9813f9426d3c0160476cd2af30a2d99e806b86c","modified":1614645933719},{"_id":"public/js/jquery.js","hash":"1055018c28ab41087ef9ccefe411606893dabea2","modified":1614645933719},{"_id":"public/js/jquery.min.js","hash":"2c5a2df970b0f3e004aa0e7c8564726b3f388af9","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1614645933719},{"_id":"public/css/fonts/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1614645933719},{"_id":"public/dist/APlayer.min.js.map","hash":"31a19da0f0cb6b00ec212eafa847f31af86788df","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1614645933719},{"_id":"public/css/style.css","hash":"2b63efbb61ca7cfcbf06e07d8d138e2389627b49","modified":1614645933719},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1614645933719}],"Category":[{"name":"接口测试","_id":"cklrai11m0002unrafoch4jzv"},{"name":"网络","_id":"cklrai127000junra47pyhkbt"},{"name":"性能测试","_id":"cklrai12a000punraeup41tqq"},{"name":"观后感","_id":"cklrai12c000wunraasfggp6l"},{"name":"读书笔记","_id":"cklrai12d000zunra8d2t5tx8"}],"Data":[],"Page":[{"title":"tags","date":"2020-04-03T07:31:09.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2020-04-03 15:31:09\ntype: \"tags\"\nlayout: tags\n---\n","updated":"2021-02-04T02:38:05.405Z","path":"tags/index.html","comments":1,"_id":"cklrai1210009unra8we0gwlh","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","site":{"data":{}},"excerpt":"","more":""},{"title":"最近的一些想法","layout":"recent","abbrlink":"ea7d9d50","date":"2021-02-24T06:22:48.000Z","_content":"","source":"recent/index.md","raw":"---\ntitle: 最近的一些想法\nlayout: recent\nabbrlink: ea7d9d50\ndate: 2021-02-24 14:22:48\n---","updated":"2021-02-25T06:44:38.364Z","path":"recent/index.html","comments":1,"_id":"cklrai123000bunra2cr64vpf","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","site":{"data":{}},"excerpt":"","more":""},{"title":"敏兒好学","date":"2020-04-03T06:22:48.000Z","layout":"about","_content":"yummy","source":"about/index.md","raw":"---\ntitle: 敏兒好学\ndate: 2020-04-03 14:22:48\nlayout: about\n---\nyummy","updated":"2021-02-04T02:38:05.405Z","path":"about/index.html","comments":1,"_id":"cklrai124000eunra6krgg4bg","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>yummy</p>\n","site":{"data":{}},"excerpt":"","more":"<p>yummy</p>\n"},{"title":"categories","date":"2020-04-03T23:12:30.000Z","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2020-04-04 07:12:30\nlayout: categories\n---\n","updated":"2021-02-04T02:38:05.405Z","path":"categories/index.html","comments":1,"_id":"cklrai126000iunra11bm8rc0","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"通过behave学习BDD","abbrlink":"e6f54ca7","date":"2020-12-30T13:04:57.000Z","_content":"## 前言\n最近觉得学习一个东西最好的方式就是使用它, 把抽象的东西变得具体而实际(ps:这好像刚好也是行为驱动开发存在的原因😄), 所以, 直接从pyhon的BDD工具behave着手, 感受BDD的逻辑和好处.\n## 实例化需求的定义:\n> 维基百科: *Specification by example (SBE) is a collaborative approach to defining requirements and business-oriented functional tests for software products based on capturing and illustrating requirements using realistic examples instead of abstract statements. It is applied in the context of agile software development methods, in particular behavior-driven development.*\n<!-- more -->\n* 实例化需求就是使用具体的例子来澄清需求和基于业务功能测试的一种协作方式. 实践方式通常为敏捷开发的行为驱动开发.\n\n## 行为驱动开发的定义\n>On the “Agile specifications, BDD and Testing eXchange” in November 2009 in London, Dan North gave the following definition of BDD:\n\n>BDD is a second-generation, outside–in, pull-based, multiple-stakeholder, multiple-scale, high-automation, agile methodology. It describes a cycle of interactions with well-defined outputs, resulting in the delivery of working, tested software that matters.\n* 行为驱动开发就是使用一种通用的语言来描述验收条件的一些操作及被测程序对应的响应行为, 并由此自动验证代码的一种开发方法.\n\n* 其中的通用语言一般使用Gherkin语言, 它基于领域驱动设计, 重点在于描述需求背景和目的, 让代码实现始终为需求服务.\n而自动化验证则是为了提供及时的反馈和回归测试.\n\n## behave基本使用\n* python中常用的驱动框架有lettuce和behave, 但是lettuce不兼容python3.\n而Django也有对应的插件behave-django, 以下操作都是基于behave-django来实现的.\n### 步骤\n* 安装behave-django\n```bash\npip install behave-django\n```\n* settings.py文件中添加该插件\n```bash\nINSTALLED_APPS += ['behave_django']\n```\n* 1) 项目的根目录创建features目录\n2) .feature文件中就是用Gerkin语言写的各个行为场景\n3) environment.py会在执行用例前, 执行里面的代码, 一般全局的前置条件和后置条件的逻辑在这个文件中定义.\n4) 目录下再创建steps目录, steps下就是各种需求例子的实现逻辑代码. \n![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm72on9jlcj306b04jdgi.jpg)\n### .feature文件的内容格式. \n* 其中双引号引起来的内容会被提取作为变量的值\n* 格式为 As-a /I want to/So that 的内容不会被执行, 重点在于使用者和需求的背景\n* Given/When/Then 分别描述用例的前置条件、操作和检查点\n```Gerkin\nFeature: My blog\n  As a vister\n  I want to be able to see the header in the page\n  So that I know it is the right page\n  Scenario: I access my blog\n    Given I access the url \"/blog/\"\n    Then I see the header M.Y\n```\n### environment.py中的内容\n```python\nfrom selenium import webdriver\n\n# context为一个全局对象, behave运行的时候会给这个对象绑定很多属性, \n# 包括before_all(), before_feature(), …, after_all()等回调函数\n# 因此我们也可以\b给context绑定自定义属性, 如下, 就绑定了browser属性, 其引用指向创建的webdriver实例\ndef before_all(context):\n    # 谷歌浏览器配置对象\n    opt = webdriver.ChromeOptions()\n    # 解决“chrome正受到自动测试软件的控制”信息栏显示\n    opt.add_experimental_option(\"useAutomationExtension\", False)\n    opt.add_experimental_option(\"excludeSwitches\", ['enable-automation'])\n    context.browser = webdriver.Chrome(options=opt, executable_path=\"./chromedriver\")\n    context.browser.base_url = \"https://yummyisminer.xyz\"\n```\n### my_step.py中的内容. 主要是对feature文件中的given和then的实现\n\n```python\nfrom behave import given, then\nfrom commons.some_decorator import wait\n\n# \"{url}\" 就是对应feature中的\"/blog/\", 用花括号变量名来标识为变量, 而这里的url作为变量引用/blog/这个值\n@given(u'I access the url \"{url}\"')\ndef step_impl(context, url):\n    context.browser.get(context.browser.base_url+url)\n\n\n@then(u'I see the header {tex}')\n@wait\ndef step_impl(context, tex):\n    context.test.assertIn(\n        tex,\n        context.browser.find_element_by_css_selector(\"h1\").text\n    )\n```\n### my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.\n```python\nimport time\n\nfrom selenium.common.exceptions import WebDriverException\n\nMAX_WAIT = 10\ndef wait(fun):\n    def wrapped_fun(*args, **kwargs):\n        start_time = time.time()\n        while True:\n            try:\n                return fun(*args, **kwargs)\n            except(AssertionError, WebDriverException) as e:\n                if time.time() - start_time > MAX_WAIT:\n                    raise e\n                time.sleep(0.5)\n    return wrapped_fun\n```\n###  执行场景用例\n```bash\npython manage.py behave\n```\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm734noye0j30hc09vadc.jpg)\n\n## 启发\n* 暂时的理解: BDD主要就是用来澄清需求, 使业务、开发、测试三方对需求的理解都一致, 所以应该一般require文件部分的内容由业务人员编写, 用来限定验收条件, 然后大家针对这些验收条件进行评审, 发现模糊的描述, 确认各种“如果xxx, 就xxx”的情况, 接着测试人员可以基于require文件编写对应的操作和验证实现方法, 每开发一个功能, 都需要跑通这些验收用例, 提前并持续不断的提供反馈, 降低后期返工的概率.\n* 后续如果我要给自动化测试扩展BDD功能的话, 首先因为BDD主要就是用来写一些基于业务逻辑的验收用例, 那用例就应该跟自动化测试框架分离, 也就是BDD的逻辑是单独写在一个项目.\n\n* 所以, 就需要把自动化测试框架打包成可安装模块.\n然后实现了BDD项目中, 在用例实例方法里导入自动化测试框架这个模块, 然后调用相关的逻辑方法完成操作和验证.\n\n### 项目打包的大致步骤\n1. 创建一个目录, __init__.py文件, 自动化框架项目拷贝到该目录下, 并创建setup.py, 如下配置\n```python\nimport setuptools\n\n\nsetuptools.setup(\n    name=\"autotestwithstub\",\n    version=\"1.0.1\",\n    # 添加非py的数据文件\n    # 列表中的每一个元组的第一个元素为数据文件将存储到的目录(相对于当前解释器安装的根目录)， 第二个元素为要添加的文件路径\n    data_files=[('lib/Configs', ['autotestwithstub/Configs/MyApp.ini','autotestwithstub/Configs/logging_conf.ini'])],\n    # 将目录下找到的包(也就是有__init__.py文件的目录)都安装\n    packages=setuptools.find_packages(),\n    include_package_data=True,\n    author=\"ym\",\n    author_email=\"xx@qq.com\",\n    url=\"https://yummyisminer.xyz\",\n    description=\"a autotest framework with stub web server\",\n)\n```\n2. 开始打包, 执行命令之后会在项目下创建dist目录, dist目录下就会有对应的tar.gz和whl格式的安装包\n```bash\npython3 setup.py sdist bdist_wheel\n```\n3. 在当前使用的python解释器安装目录下, 安装刚刚生成的模块\n```bash\npip install dist/autotestwithstub-1.0.1-py3-none-any.whl\n```\n4. 新项目中导入之前项目下的包, 调用对应的逻辑\n\n<a href=\"https://packaging.python.org/tutorials/packaging-projects/\">参考资料</a>\n\n","source":"_posts/BDD框架behave学习.md","raw":"---\ntitle: 通过behave学习BDD\nabbrlink: e6f54ca7\ndate: 2020-12-30 21:04:57\ntags:\n---\n## 前言\n最近觉得学习一个东西最好的方式就是使用它, 把抽象的东西变得具体而实际(ps:这好像刚好也是行为驱动开发存在的原因😄), 所以, 直接从pyhon的BDD工具behave着手, 感受BDD的逻辑和好处.\n## 实例化需求的定义:\n> 维基百科: *Specification by example (SBE) is a collaborative approach to defining requirements and business-oriented functional tests for software products based on capturing and illustrating requirements using realistic examples instead of abstract statements. It is applied in the context of agile software development methods, in particular behavior-driven development.*\n<!-- more -->\n* 实例化需求就是使用具体的例子来澄清需求和基于业务功能测试的一种协作方式. 实践方式通常为敏捷开发的行为驱动开发.\n\n## 行为驱动开发的定义\n>On the “Agile specifications, BDD and Testing eXchange” in November 2009 in London, Dan North gave the following definition of BDD:\n\n>BDD is a second-generation, outside–in, pull-based, multiple-stakeholder, multiple-scale, high-automation, agile methodology. It describes a cycle of interactions with well-defined outputs, resulting in the delivery of working, tested software that matters.\n* 行为驱动开发就是使用一种通用的语言来描述验收条件的一些操作及被测程序对应的响应行为, 并由此自动验证代码的一种开发方法.\n\n* 其中的通用语言一般使用Gherkin语言, 它基于领域驱动设计, 重点在于描述需求背景和目的, 让代码实现始终为需求服务.\n而自动化验证则是为了提供及时的反馈和回归测试.\n\n## behave基本使用\n* python中常用的驱动框架有lettuce和behave, 但是lettuce不兼容python3.\n而Django也有对应的插件behave-django, 以下操作都是基于behave-django来实现的.\n### 步骤\n* 安装behave-django\n```bash\npip install behave-django\n```\n* settings.py文件中添加该插件\n```bash\nINSTALLED_APPS += ['behave_django']\n```\n* 1) 项目的根目录创建features目录\n2) .feature文件中就是用Gerkin语言写的各个行为场景\n3) environment.py会在执行用例前, 执行里面的代码, 一般全局的前置条件和后置条件的逻辑在这个文件中定义.\n4) 目录下再创建steps目录, steps下就是各种需求例子的实现逻辑代码. \n![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm72on9jlcj306b04jdgi.jpg)\n### .feature文件的内容格式. \n* 其中双引号引起来的内容会被提取作为变量的值\n* 格式为 As-a /I want to/So that 的内容不会被执行, 重点在于使用者和需求的背景\n* Given/When/Then 分别描述用例的前置条件、操作和检查点\n```Gerkin\nFeature: My blog\n  As a vister\n  I want to be able to see the header in the page\n  So that I know it is the right page\n  Scenario: I access my blog\n    Given I access the url \"/blog/\"\n    Then I see the header M.Y\n```\n### environment.py中的内容\n```python\nfrom selenium import webdriver\n\n# context为一个全局对象, behave运行的时候会给这个对象绑定很多属性, \n# 包括before_all(), before_feature(), …, after_all()等回调函数\n# 因此我们也可以\b给context绑定自定义属性, 如下, 就绑定了browser属性, 其引用指向创建的webdriver实例\ndef before_all(context):\n    # 谷歌浏览器配置对象\n    opt = webdriver.ChromeOptions()\n    # 解决“chrome正受到自动测试软件的控制”信息栏显示\n    opt.add_experimental_option(\"useAutomationExtension\", False)\n    opt.add_experimental_option(\"excludeSwitches\", ['enable-automation'])\n    context.browser = webdriver.Chrome(options=opt, executable_path=\"./chromedriver\")\n    context.browser.base_url = \"https://yummyisminer.xyz\"\n```\n### my_step.py中的内容. 主要是对feature文件中的given和then的实现\n\n```python\nfrom behave import given, then\nfrom commons.some_decorator import wait\n\n# \"{url}\" 就是对应feature中的\"/blog/\", 用花括号变量名来标识为变量, 而这里的url作为变量引用/blog/这个值\n@given(u'I access the url \"{url}\"')\ndef step_impl(context, url):\n    context.browser.get(context.browser.base_url+url)\n\n\n@then(u'I see the header {tex}')\n@wait\ndef step_impl(context, tex):\n    context.test.assertIn(\n        tex,\n        context.browser.find_element_by_css_selector(\"h1\").text\n    )\n```\n### my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.\n```python\nimport time\n\nfrom selenium.common.exceptions import WebDriverException\n\nMAX_WAIT = 10\ndef wait(fun):\n    def wrapped_fun(*args, **kwargs):\n        start_time = time.time()\n        while True:\n            try:\n                return fun(*args, **kwargs)\n            except(AssertionError, WebDriverException) as e:\n                if time.time() - start_time > MAX_WAIT:\n                    raise e\n                time.sleep(0.5)\n    return wrapped_fun\n```\n###  执行场景用例\n```bash\npython manage.py behave\n```\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm734noye0j30hc09vadc.jpg)\n\n## 启发\n* 暂时的理解: BDD主要就是用来澄清需求, 使业务、开发、测试三方对需求的理解都一致, 所以应该一般require文件部分的内容由业务人员编写, 用来限定验收条件, 然后大家针对这些验收条件进行评审, 发现模糊的描述, 确认各种“如果xxx, 就xxx”的情况, 接着测试人员可以基于require文件编写对应的操作和验证实现方法, 每开发一个功能, 都需要跑通这些验收用例, 提前并持续不断的提供反馈, 降低后期返工的概率.\n* 后续如果我要给自动化测试扩展BDD功能的话, 首先因为BDD主要就是用来写一些基于业务逻辑的验收用例, 那用例就应该跟自动化测试框架分离, 也就是BDD的逻辑是单独写在一个项目.\n\n* 所以, 就需要把自动化测试框架打包成可安装模块.\n然后实现了BDD项目中, 在用例实例方法里导入自动化测试框架这个模块, 然后调用相关的逻辑方法完成操作和验证.\n\n### 项目打包的大致步骤\n1. 创建一个目录, __init__.py文件, 自动化框架项目拷贝到该目录下, 并创建setup.py, 如下配置\n```python\nimport setuptools\n\n\nsetuptools.setup(\n    name=\"autotestwithstub\",\n    version=\"1.0.1\",\n    # 添加非py的数据文件\n    # 列表中的每一个元组的第一个元素为数据文件将存储到的目录(相对于当前解释器安装的根目录)， 第二个元素为要添加的文件路径\n    data_files=[('lib/Configs', ['autotestwithstub/Configs/MyApp.ini','autotestwithstub/Configs/logging_conf.ini'])],\n    # 将目录下找到的包(也就是有__init__.py文件的目录)都安装\n    packages=setuptools.find_packages(),\n    include_package_data=True,\n    author=\"ym\",\n    author_email=\"xx@qq.com\",\n    url=\"https://yummyisminer.xyz\",\n    description=\"a autotest framework with stub web server\",\n)\n```\n2. 开始打包, 执行命令之后会在项目下创建dist目录, dist目录下就会有对应的tar.gz和whl格式的安装包\n```bash\npython3 setup.py sdist bdist_wheel\n```\n3. 在当前使用的python解释器安装目录下, 安装刚刚生成的模块\n```bash\npip install dist/autotestwithstub-1.0.1-py3-none-any.whl\n```\n4. 新项目中导入之前项目下的包, 调用对应的逻辑\n\n<a href=\"https://packaging.python.org/tutorials/packaging-projects/\">参考资料</a>\n\n","slug":"BDD框架behave学习","published":1,"updated":"2021-02-04T02:38:05.398Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai11h0000unra7yga377v","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近觉得学习一个东西最好的方式就是使用它, 把抽象的东西变得具体而实际(ps:这好像刚好也是行为驱动开发存在的原因😄), 所以, 直接从pyhon的BDD工具behave着手, 感受BDD的逻辑和好处.</p>\n<h2 id=\"实例化需求的定义\"><a href=\"#实例化需求的定义\" class=\"headerlink\" title=\"实例化需求的定义:\"></a>实例化需求的定义:</h2><blockquote>\n<p>维基百科: <em>Specification by example (SBE) is a collaborative approach to defining requirements and business-oriented functional tests for software products based on capturing and illustrating requirements using realistic examples instead of abstract statements. It is applied in the context of agile software development methods, in particular behavior-driven development.</em></p>\n</blockquote>\n<a id=\"more\"></a>\n<ul>\n<li>实例化需求就是使用具体的例子来澄清需求和基于业务功能测试的一种协作方式. 实践方式通常为敏捷开发的行为驱动开发.</li>\n</ul>\n<h2 id=\"行为驱动开发的定义\"><a href=\"#行为驱动开发的定义\" class=\"headerlink\" title=\"行为驱动开发的定义\"></a>行为驱动开发的定义</h2><blockquote>\n<p>On the “Agile specifications, BDD and Testing eXchange” in November 2009 in London, Dan North gave the following definition of BDD:</p>\n</blockquote>\n<blockquote>\n<p>BDD is a second-generation, outside–in, pull-based, multiple-stakeholder, multiple-scale, high-automation, agile methodology. It describes a cycle of interactions with well-defined outputs, resulting in the delivery of working, tested software that matters.</p>\n</blockquote>\n<ul>\n<li><p>行为驱动开发就是使用一种通用的语言来描述验收条件的一些操作及被测程序对应的响应行为, 并由此自动验证代码的一种开发方法.</p>\n</li>\n<li><p>其中的通用语言一般使用Gherkin语言, 它基于领域驱动设计, 重点在于描述需求背景和目的, 让代码实现始终为需求服务.<br>而自动化验证则是为了提供及时的反馈和回归测试.</p>\n</li>\n</ul>\n<h2 id=\"behave基本使用\"><a href=\"#behave基本使用\" class=\"headerlink\" title=\"behave基本使用\"></a>behave基本使用</h2><ul>\n<li>python中常用的驱动框架有lettuce和behave, 但是lettuce不兼容python3.<br>而Django也有对应的插件behave-django, 以下操作都是基于behave-django来实现的.<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3></li>\n<li>安装behave-django<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install behave-django</span><br></pre></td></tr></tbody></table></figure></li>\n<li>settings.py文件中添加该插件<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS += [<span class=\"string\">'behave_django'</span>]</span><br></pre></td></tr></tbody></table></figure></li>\n<li>1) 项目的根目录创建features目录<br>2) .feature文件中就是用Gerkin语言写的各个行为场景<br>3) environment.py会在执行用例前, 执行里面的代码, 一般全局的前置条件和后置条件的逻辑在这个文件中定义.<br>4) 目录下再创建steps目录, steps下就是各种需求例子的实现逻辑代码. <figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm72on9jlcj306b04jdgi.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<h3 id=\"feature文件的内容格式\"><a href=\"#feature文件的内容格式\" class=\"headerlink\" title=\".feature文件的内容格式.\"></a>.feature文件的内容格式.</h3></li>\n<li>其中双引号引起来的内容会被提取作为变量的值</li>\n<li>格式为 As-a /I want to/So that 的内容不会被执行, 重点在于使用者和需求的背景</li>\n<li>Given/When/Then 分别描述用例的前置条件、操作和检查点<figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature: My blog</span><br><span class=\"line\">  As a vister</span><br><span class=\"line\">  I want to be able to see the header in the page</span><br><span class=\"line\">  So that I know it is the right page</span><br><span class=\"line\">  Scenario: I access my blog</span><br><span class=\"line\">    Given I access the url \"/blog/\"</span><br><span class=\"line\">    Then I see the header M.Y</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"environment-py中的内容\"><a href=\"#environment-py中的内容\" class=\"headerlink\" title=\"environment.py中的内容\"></a>environment.py中的内容</h3><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># context为一个全局对象, behave运行的时候会给这个对象绑定很多属性, </span></span><br><span class=\"line\"><span class=\"comment\"># 包括before_all(), before_feature(), …, after_all()等回调函数</span></span><br><span class=\"line\"><span class=\"comment\"># 因此我们也可以\b给context绑定自定义属性, 如下, 就绑定了browser属性, 其引用指向创建的webdriver实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_all</span><span class=\"params\">(context)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># 谷歌浏览器配置对象</span></span><br><span class=\"line\">    opt = webdriver.ChromeOptions()</span><br><span class=\"line\">    <span class=\"comment\"># 解决“chrome正受到自动测试软件的控制”信息栏显示</span></span><br><span class=\"line\">    opt.add_experimental_option(<span class=\"string\">\"useAutomationExtension\"</span>, <span class=\"literal\">False</span>)</span><br><span class=\"line\">    opt.add_experimental_option(<span class=\"string\">\"excludeSwitches\"</span>, [<span class=\"string\">'enable-automation'</span>])</span><br><span class=\"line\">    context.browser = webdriver.Chrome(options=opt, executable_path=<span class=\"string\">\"./chromedriver\"</span>)</span><br><span class=\"line\">    context.browser.base_url = <span class=\"string\">\"https://yummyisminer.xyz\"</span></span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"my-step-py中的内容-主要是对feature文件中的given和then的实现\"><a href=\"#my-step-py中的内容-主要是对feature文件中的given和then的实现\" class=\"headerlink\" title=\"my_step.py中的内容. 主要是对feature文件中的given和then的实现\"></a>my_step.py中的内容. 主要是对feature文件中的given和then的实现</h3></li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> behave <span class=\"keyword\">import</span> given, then</span><br><span class=\"line\"><span class=\"keyword\">from</span> commons.some_decorator <span class=\"keyword\">import</span> wait</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \"{url}\" 就是对应feature中的\"/blog/\", 用花括号变量名来标识为变量, 而这里的url作为变量引用/blog/这个值</span></span><br><span class=\"line\"><span class=\"meta\">@given(u'I access the url \"{url}\"')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_impl</span><span class=\"params\">(context, url)</span>:</span></span><br><span class=\"line\">    context.browser.get(context.browser.base_url+url)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@then(u'I see the header {tex}')</span></span><br><span class=\"line\"><span class=\"meta\">@wait</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_impl</span><span class=\"params\">(context, tex)</span>:</span></span><br><span class=\"line\">    context.test.assertIn(</span><br><span class=\"line\">        tex,</span><br><span class=\"line\">        context.browser.find_element_by_css_selector(<span class=\"string\">\"h1\"</span>).text</span><br><span class=\"line\">    )</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"my-step-py文件中有用到wait这个装饰器-主要逻辑就是10s内-每隔0-5s重新执行一遍被装饰的函数\"><a href=\"#my-step-py文件中有用到wait这个装饰器-主要逻辑就是10s内-每隔0-5s重新执行一遍被装饰的函数\" class=\"headerlink\" title=\"my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.\"></a>my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.</h3><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.common.exceptions <span class=\"keyword\">import</span> WebDriverException</span><br><span class=\"line\"></span><br><span class=\"line\">MAX_WAIT = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wait</span><span class=\"params\">(fun)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapped_fun</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">        start_time = time.time()</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> fun(*args, **kwargs)</span><br><span class=\"line\">            <span class=\"keyword\">except</span>(AssertionError, WebDriverException) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> time.time() - start_time &gt; MAX_WAIT:</span><br><span class=\"line\">                    <span class=\"keyword\">raise</span> e</span><br><span class=\"line\">                time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> wrapped_fun</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"执行场景用例\"><a href=\"#执行场景用例\" class=\"headerlink\" title=\"执行场景用例\"></a>执行场景用例</h3><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py behave</span><br></pre></td></tr></tbody></table></figure>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm734noye0j30hc09vadc.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"启发\"><a href=\"#启发\" class=\"headerlink\" title=\"启发\"></a>启发</h2><ul>\n<li><p>暂时的理解: BDD主要就是用来澄清需求, 使业务、开发、测试三方对需求的理解都一致, 所以应该一般require文件部分的内容由业务人员编写, 用来限定验收条件, 然后大家针对这些验收条件进行评审, 发现模糊的描述, 确认各种“如果xxx, 就xxx”的情况, 接着测试人员可以基于require文件编写对应的操作和验证实现方法, 每开发一个功能, 都需要跑通这些验收用例, 提前并持续不断的提供反馈, 降低后期返工的概率.</p>\n</li>\n<li><p>后续如果我要给自动化测试扩展BDD功能的话, 首先因为BDD主要就是用来写一些基于业务逻辑的验收用例, 那用例就应该跟自动化测试框架分离, 也就是BDD的逻辑是单独写在一个项目.</p>\n</li>\n<li><p>所以, 就需要把自动化测试框架打包成可安装模块.<br>然后实现了BDD项目中, 在用例实例方法里导入自动化测试框架这个模块, 然后调用相关的逻辑方法完成操作和验证.</p>\n</li>\n</ul>\n<h3 id=\"项目打包的大致步骤\"><a href=\"#项目打包的大致步骤\" class=\"headerlink\" title=\"项目打包的大致步骤\"></a>项目打包的大致步骤</h3><ol>\n<li>创建一个目录, <strong>init</strong>.py文件, 自动化框架项目拷贝到该目录下, 并创建setup.py, 如下配置<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> setuptools</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">setuptools.setup(</span><br><span class=\"line\">    name=<span class=\"string\">\"autotestwithstub\"</span>,</span><br><span class=\"line\">    version=<span class=\"string\">\"1.0.1\"</span>,</span><br><span class=\"line\">    <span class=\"comment\"># 添加非py的数据文件</span></span><br><span class=\"line\">    <span class=\"comment\"># 列表中的每一个元组的第一个元素为数据文件将存储到的目录(相对于当前解释器安装的根目录)， 第二个元素为要添加的文件路径</span></span><br><span class=\"line\">    data_files=[(<span class=\"string\">'lib/Configs'</span>, [<span class=\"string\">'autotestwithstub/Configs/MyApp.ini'</span>,<span class=\"string\">'autotestwithstub/Configs/logging_conf.ini'</span>])],</span><br><span class=\"line\">    <span class=\"comment\"># 将目录下找到的包(也就是有__init__.py文件的目录)都安装</span></span><br><span class=\"line\">    packages=setuptools.find_packages(),</span><br><span class=\"line\">    include_package_data=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    author=<span class=\"string\">\"ym\"</span>,</span><br><span class=\"line\">    author_email=<span class=\"string\">\"xx@qq.com\"</span>,</span><br><span class=\"line\">    url=<span class=\"string\">\"https://yummyisminer.xyz\"</span>,</span><br><span class=\"line\">    description=<span class=\"string\">\"a autotest framework with stub web server\"</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></tbody></table></figure></li>\n<li>开始打包, 执行命令之后会在项目下创建dist目录, dist目录下就会有对应的tar.gz和whl格式的安装包<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 setup.py sdist bdist_wheel</span><br></pre></td></tr></tbody></table></figure></li>\n<li>在当前使用的python解释器安装目录下, 安装刚刚生成的模块<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install dist/autotestwithstub-1.0.1-py3-none-any.whl</span><br></pre></td></tr></tbody></table></figure></li>\n<li>新项目中导入之前项目下的包, 调用对应的逻辑</li>\n</ol>\n<p><a href=\"https://packaging.python.org/tutorials/packaging-projects/\" target=\"_blank\" rel=\"noopener\">参考资料</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近觉得学习一个东西最好的方式就是使用它, 把抽象的东西变得具体而实际(ps:这好像刚好也是行为驱动开发存在的原因😄), 所以, 直接从pyhon的BDD工具behave着手, 感受BDD的逻辑和好处.</p>\n<h2 id=\"实例化需求的定义\"><a href=\"#实例化需求的定义\" class=\"headerlink\" title=\"实例化需求的定义:\"></a>实例化需求的定义:</h2><blockquote>\n<p>维基百科: <em>Specification by example (SBE) is a collaborative approach to defining requirements and business-oriented functional tests for software products based on capturing and illustrating requirements using realistic examples instead of abstract statements. It is applied in the context of agile software development methods, in particular behavior-driven development.</em></p>\n</blockquote>","more":"<ul>\n<li>实例化需求就是使用具体的例子来澄清需求和基于业务功能测试的一种协作方式. 实践方式通常为敏捷开发的行为驱动开发.</li>\n</ul>\n<h2 id=\"行为驱动开发的定义\"><a href=\"#行为驱动开发的定义\" class=\"headerlink\" title=\"行为驱动开发的定义\"></a>行为驱动开发的定义</h2><blockquote>\n<p>On the “Agile specifications, BDD and Testing eXchange” in November 2009 in London, Dan North gave the following definition of BDD:</p>\n</blockquote>\n<blockquote>\n<p>BDD is a second-generation, outside–in, pull-based, multiple-stakeholder, multiple-scale, high-automation, agile methodology. It describes a cycle of interactions with well-defined outputs, resulting in the delivery of working, tested software that matters.</p>\n</blockquote>\n<ul>\n<li><p>行为驱动开发就是使用一种通用的语言来描述验收条件的一些操作及被测程序对应的响应行为, 并由此自动验证代码的一种开发方法.</p>\n</li>\n<li><p>其中的通用语言一般使用Gherkin语言, 它基于领域驱动设计, 重点在于描述需求背景和目的, 让代码实现始终为需求服务.<br>而自动化验证则是为了提供及时的反馈和回归测试.</p>\n</li>\n</ul>\n<h2 id=\"behave基本使用\"><a href=\"#behave基本使用\" class=\"headerlink\" title=\"behave基本使用\"></a>behave基本使用</h2><ul>\n<li>python中常用的驱动框架有lettuce和behave, 但是lettuce不兼容python3.<br>而Django也有对应的插件behave-django, 以下操作都是基于behave-django来实现的.<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3></li>\n<li>安装behave-django<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install behave-django</span><br></pre></td></tr></table></figure></li>\n<li>settings.py文件中添加该插件<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS += [<span class=\"string\">'behave_django'</span>]</span><br></pre></td></tr></table></figure></li>\n<li>1) 项目的根目录创建features目录<br>2) .feature文件中就是用Gerkin语言写的各个行为场景<br>3) environment.py会在执行用例前, 执行里面的代码, 一般全局的前置条件和后置条件的逻辑在这个文件中定义.<br>4) 目录下再创建steps目录, steps下就是各种需求例子的实现逻辑代码. <figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm72on9jlcj306b04jdgi.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<h3 id=\"feature文件的内容格式\"><a href=\"#feature文件的内容格式\" class=\"headerlink\" title=\".feature文件的内容格式.\"></a>.feature文件的内容格式.</h3></li>\n<li>其中双引号引起来的内容会被提取作为变量的值</li>\n<li>格式为 As-a /I want to/So that 的内容不会被执行, 重点在于使用者和需求的背景</li>\n<li>Given/When/Then 分别描述用例的前置条件、操作和检查点<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature: My blog</span><br><span class=\"line\">  As a vister</span><br><span class=\"line\">  I want to be able to see the header in the page</span><br><span class=\"line\">  So that I know it is the right page</span><br><span class=\"line\">  Scenario: I access my blog</span><br><span class=\"line\">    Given I access the url &quot;&#x2F;blog&#x2F;&quot;</span><br><span class=\"line\">    Then I see the header M.Y</span><br></pre></td></tr></table></figure>\n<h3 id=\"environment-py中的内容\"><a href=\"#environment-py中的内容\" class=\"headerlink\" title=\"environment.py中的内容\"></a>environment.py中的内容</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># context为一个全局对象, behave运行的时候会给这个对象绑定很多属性, </span></span><br><span class=\"line\"><span class=\"comment\"># 包括before_all(), before_feature(), …, after_all()等回调函数</span></span><br><span class=\"line\"><span class=\"comment\"># 因此我们也可以\b给context绑定自定义属性, 如下, 就绑定了browser属性, 其引用指向创建的webdriver实例</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_all</span><span class=\"params\">(context)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># 谷歌浏览器配置对象</span></span><br><span class=\"line\">    opt = webdriver.ChromeOptions()</span><br><span class=\"line\">    <span class=\"comment\"># 解决“chrome正受到自动测试软件的控制”信息栏显示</span></span><br><span class=\"line\">    opt.add_experimental_option(<span class=\"string\">\"useAutomationExtension\"</span>, <span class=\"literal\">False</span>)</span><br><span class=\"line\">    opt.add_experimental_option(<span class=\"string\">\"excludeSwitches\"</span>, [<span class=\"string\">'enable-automation'</span>])</span><br><span class=\"line\">    context.browser = webdriver.Chrome(options=opt, executable_path=<span class=\"string\">\"./chromedriver\"</span>)</span><br><span class=\"line\">    context.browser.base_url = <span class=\"string\">\"https://yummyisminer.xyz\"</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"my-step-py中的内容-主要是对feature文件中的given和then的实现\"><a href=\"#my-step-py中的内容-主要是对feature文件中的given和then的实现\" class=\"headerlink\" title=\"my_step.py中的内容. 主要是对feature文件中的given和then的实现\"></a>my_step.py中的内容. 主要是对feature文件中的given和then的实现</h3></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> behave <span class=\"keyword\">import</span> given, then</span><br><span class=\"line\"><span class=\"keyword\">from</span> commons.some_decorator <span class=\"keyword\">import</span> wait</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># \"&#123;url&#125;\" 就是对应feature中的\"/blog/\", 用花括号变量名来标识为变量, 而这里的url作为变量引用/blog/这个值</span></span><br><span class=\"line\"><span class=\"meta\">@given(u'I access the url \"&#123;url&#125;\"')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_impl</span><span class=\"params\">(context, url)</span>:</span></span><br><span class=\"line\">    context.browser.get(context.browser.base_url+url)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@then(u'I see the header &#123;tex&#125;')</span></span><br><span class=\"line\"><span class=\"meta\">@wait</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_impl</span><span class=\"params\">(context, tex)</span>:</span></span><br><span class=\"line\">    context.test.assertIn(</span><br><span class=\"line\">        tex,</span><br><span class=\"line\">        context.browser.find_element_by_css_selector(<span class=\"string\">\"h1\"</span>).text</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n<h3 id=\"my-step-py文件中有用到wait这个装饰器-主要逻辑就是10s内-每隔0-5s重新执行一遍被装饰的函数\"><a href=\"#my-step-py文件中有用到wait这个装饰器-主要逻辑就是10s内-每隔0-5s重新执行一遍被装饰的函数\" class=\"headerlink\" title=\"my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.\"></a>my_step.py文件中有用到wait这个装饰器, 主要逻辑就是10s内, 每隔0.5s重新执行一遍被装饰的函数.</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.common.exceptions <span class=\"keyword\">import</span> WebDriverException</span><br><span class=\"line\"></span><br><span class=\"line\">MAX_WAIT = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wait</span><span class=\"params\">(fun)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapped_fun</span><span class=\"params\">(*args, **kwargs)</span>:</span></span><br><span class=\"line\">        start_time = time.time()</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> fun(*args, **kwargs)</span><br><span class=\"line\">            <span class=\"keyword\">except</span>(AssertionError, WebDriverException) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> time.time() - start_time &gt; MAX_WAIT:</span><br><span class=\"line\">                    <span class=\"keyword\">raise</span> e</span><br><span class=\"line\">                time.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> wrapped_fun</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行场景用例\"><a href=\"#执行场景用例\" class=\"headerlink\" title=\"执行场景用例\"></a>执行场景用例</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py behave</span><br></pre></td></tr></table></figure>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm734noye0j30hc09vadc.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"启发\"><a href=\"#启发\" class=\"headerlink\" title=\"启发\"></a>启发</h2><ul>\n<li><p>暂时的理解: BDD主要就是用来澄清需求, 使业务、开发、测试三方对需求的理解都一致, 所以应该一般require文件部分的内容由业务人员编写, 用来限定验收条件, 然后大家针对这些验收条件进行评审, 发现模糊的描述, 确认各种“如果xxx, 就xxx”的情况, 接着测试人员可以基于require文件编写对应的操作和验证实现方法, 每开发一个功能, 都需要跑通这些验收用例, 提前并持续不断的提供反馈, 降低后期返工的概率.</p>\n</li>\n<li><p>后续如果我要给自动化测试扩展BDD功能的话, 首先因为BDD主要就是用来写一些基于业务逻辑的验收用例, 那用例就应该跟自动化测试框架分离, 也就是BDD的逻辑是单独写在一个项目.</p>\n</li>\n<li><p>所以, 就需要把自动化测试框架打包成可安装模块.<br>然后实现了BDD项目中, 在用例实例方法里导入自动化测试框架这个模块, 然后调用相关的逻辑方法完成操作和验证.</p>\n</li>\n</ul>\n<h3 id=\"项目打包的大致步骤\"><a href=\"#项目打包的大致步骤\" class=\"headerlink\" title=\"项目打包的大致步骤\"></a>项目打包的大致步骤</h3><ol>\n<li>创建一个目录, <strong>init</strong>.py文件, 自动化框架项目拷贝到该目录下, 并创建setup.py, 如下配置<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> setuptools</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">setuptools.setup(</span><br><span class=\"line\">    name=<span class=\"string\">\"autotestwithstub\"</span>,</span><br><span class=\"line\">    version=<span class=\"string\">\"1.0.1\"</span>,</span><br><span class=\"line\">    <span class=\"comment\"># 添加非py的数据文件</span></span><br><span class=\"line\">    <span class=\"comment\"># 列表中的每一个元组的第一个元素为数据文件将存储到的目录(相对于当前解释器安装的根目录)， 第二个元素为要添加的文件路径</span></span><br><span class=\"line\">    data_files=[(<span class=\"string\">'lib/Configs'</span>, [<span class=\"string\">'autotestwithstub/Configs/MyApp.ini'</span>,<span class=\"string\">'autotestwithstub/Configs/logging_conf.ini'</span>])],</span><br><span class=\"line\">    <span class=\"comment\"># 将目录下找到的包(也就是有__init__.py文件的目录)都安装</span></span><br><span class=\"line\">    packages=setuptools.find_packages(),</span><br><span class=\"line\">    include_package_data=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    author=<span class=\"string\">\"ym\"</span>,</span><br><span class=\"line\">    author_email=<span class=\"string\">\"xx@qq.com\"</span>,</span><br><span class=\"line\">    url=<span class=\"string\">\"https://yummyisminer.xyz\"</span>,</span><br><span class=\"line\">    description=<span class=\"string\">\"a autotest framework with stub web server\"</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></li>\n<li>开始打包, 执行命令之后会在项目下创建dist目录, dist目录下就会有对应的tar.gz和whl格式的安装包<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 setup.py sdist bdist_wheel</span><br></pre></td></tr></table></figure></li>\n<li>在当前使用的python解释器安装目录下, 安装刚刚生成的模块<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install dist/autotestwithstub-1.0.1-py3-none-any.whl</span><br></pre></td></tr></table></figure></li>\n<li>新项目中导入之前项目下的包, 调用对应的逻辑</li>\n</ol>\n<p><a href=\"https://packaging.python.org/tutorials/packaging-projects/\" target=\"_blank\" rel=\"noopener\">参考资料</a></p>"},{"title":"Dubbo接口测试","abbrlink":"81c88605","date":"2020-04-03T05:30:40.000Z","_content":"<!-- ![](https://cdn.pixabay.com/photo/2019/03/22/08/40/night-4072727__480.jpg) -->\n# 接上文,了解Dubbo接口后,如何测试dubbo接口：\n## **Python版解决方案:**\n### 1. **hessian+http的方式调用(python-hessian库):**\n<!-- more -->\n* (1) dubbo项目中，增加hessian方式序列化，及相关依赖。下图为xml配置方式示例。\n    * <a href=\"https://dubbo.apache.org/zh-cn/docs/user/references/protocol/hessian.html\">官方配置hessian协议及依赖例子</a>\n    * <a href=\"https://dubbo.apache.org/zh-cn/docs/user/demos/multi-protocols.html\">官方配置多协议例子</a>![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboopoouuj30po0h5dif.jpg)\n\n* (2) 获取接口地址（可在管理台查看）、方法及方法的入参。\n* (3) 安装 python-hessian               \n    ```bash \n    python -m pip install python-hessian\n    ```\n* (4) 编写Python脚本调用接口; <a href=\"https://github.com/theatlantic/python-hessian/blob/master/README.rst\">pyhessian官方调用例子</a>\n    ```python\n    # coding=utf-8\n    import pytest\n    from pyhessian.client import HessianProxy\n\n    class TestDubbo(object):\n        url = \"http://169.254.210.145:1234/\"\n        interface = \"com.xxx.user.service.UserService\"\n        full_url = url + interface\n        # full_url = \"http://169.254.210.145:8888/com.xxx.user.service.FileService\"\n        def testsayHelloWithSpec(self):\n            params = u\"什么我调用成功了吗\"\n            # 创建连接对象\n            service = HessianProxy(self.full_url)\n            # 重载方法__call()__里发送二进制数据进行请求，调用方法\n            res = service.sayHello(params)\n            assert \"什么我调用成功了吗\" in res\n            print(res)\n\n        # @pytest.mark.skip()\n        def testsayHelloWithInt(self):\n            params = 123\n            service = HessianProxy(self.full_url)\n            res = service.sayHello(params)\n            assert 123 in res\n            print(res)\n\n    if __name__ == \"__main__\":\n        pytest.main([\"-q\",\"TestDubbo.py\"])\n    ```\n\n### 2. **使用dubbo-client**\n* dubbo项目中，provicer.xml 增加 jsonrpc 协议\n* <a href=\"https://github.com/dubbo/dubbo-client-py\">官方地址</a>\n<a href=\"https://www.twblogs.net/a/5d4061a4bd9eee51fbf993e7/zh-cn\">其他参考示例</a>\n    ```python\n    config = ApplicationConfig('test_rpclib')\n    service_interface = 'com.ofpay.demo.api.UserProvider'\n\n    # Contains a connection to zookeeper, which needs caching.\n    registry = ZookeeperRegistry('192.168.59.103:2181', config)\n    user_provider = DubboClient(service_interface, registry, version='1.0')\n    \n    for i in range(1000):\n        try:\n            print user_provider.getUser('A003')\n            print user_provider.queryUser(\n                {u'age': 18, u'time': 1428463514153, u'sex': u'MAN', u'id': u'A003', u'name': u'zhangsan'})\n            print user_provider.queryAll()\n            print user_provider.isLimit('MAN', 'Joe')\n            print user_provider('getUser', 'A005')\n        except DubboClientError, client_error:\n            print client_error\n        time.sleep(5)\n    ```\n\n## **java:**\n### 1. **XML配置文件方式:**\n* 拿到服务的jar包或maven依赖\n* 在resources下创建consumer.xml,配置好注册中心地址,接口名全称(有包名限定),每个接口有其唯一的标识reference id\n* 调用测试方法中,使用springframework提供的方法加载consumer.xml配置文件,得到context对象,调用start方法启动\n* 调用context对象的getBean方法,传入接口标识作为实参,获取接口的具体实现对象,这步会进行远程过程调用\n* 通过获取的对象调用其提供的方法\n    ```java\n    import com.xxx.user.service.UserService;\n    import org.junit.BeforeClass;\n    import org.junit.Test;\n    import org.springframework.context.support.ClassPathXmlApplicationContext;\n    import static org.hamcrest.CoreMatchers.containsString;\n    import static org.junit.Assert.assertThat;\n    public class ConsumerTest {\n        static ClassPathXmlApplicationContext context;\n        static UserService userService;\n        @BeforeClass\n        public static void beforeClass(){\n             if(context==null) {\n                 // 默认从类路径中加载配置文件\n                 context = new ClassPathXmlApplicationContext(\"consumer.xml\");\n                 System.out.println(\"load\");\n                 // 在Spring中还提供了Lifecycle接口，Lifecycle中包含start/stop方法，实现此接口后Spring保证在启动的时候调用其start方法开始生命周期,主要用于控制异步处理过程\n                context.start();\n    //            System.out.println(\"start\");\n             }\n    　　　　　　 // 创建接口实例（定义接口的引用变量，再引用实现了该接口的实例）\n            userService=(UserService) context.getBean(\"userService\");\n    \n         }\n        @Test\n        public void consumerTestCase1(){\n    　　　　　　 // 调用方法\n             String hello = userService.sayHello(\"world\");\n             assertThat(hello,containsString(\"world\");\n             System.out.println(hello);\n         }\n     }\n    ```\n\n### 2. **API方式的泛化调用:**\n* 不需要获取被测接口的jar包或依赖\n* <a href=\"http://dubbo.apache.org/zh-cn/blog/dubbo-generic-invoke.html\">官方示例1</a> <br/> <a href=\"http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html\">官方示例2</a>\n* 创建连接实例:\n    * 使用 org.apache.dubbo.config.ApplicationConfig 配置消费者应用名\n    * 使用 org.apache.dubbo.config.ReferenceConfig; 创建reference配置实例,设置接口全类名,声明泛化调用,配置消费者\n    * 使用org.apache.dubbo.config.RegistryConfig; 配置注册中心地址\n    * 调用reference配置实例的get方法,获取GenericService类型的连接实例\n* 调用服务提供的方法:\n    * 调用org.apache.dubbo.rpc.service.GenericService 这个接口名为 $invoke方法，它接受三个参数，分别为方法名、方法参数类型数组和参数值数组；\n        * 对于方法参数类型数组:\n            * 如果是基本类型，如 int 或 long，可以使用 int.class.getName()获取其类型；\n            * 如果是基本类型数组，如 int[]，则可以使用 int[].class.getName()；\n            * 如果是 POJO，则直接使用全类名，如 com.alibaba.dubbo.samples.generic.api.Params。\n        * 参数值数组:\n            * 如果是POJO,则转成Map,再将转换后的Map作为参数传入\n```java\n    @Test\n    public void test2(){\n        ApplicationConfig application = new ApplicationConfig();\n        application.setName(\"api-generic-consumer\");\n\n        // 使用RegistryConfig,动态配置注册中心地址\n        RegistryConfig registry = new RegistryConfig();\n        registry.setAddress(\"zookeeper://127.0.0.1:2181\");\n        application.setRegistry(registry);\n\n        ReferenceConfig<GenericService> reference = new ReferenceConfig<GenericService>();\n        // 弱类型接口名\n        reference.setInterface(\"com.ymxdclass.user.service.UserService\");\n        // 声明为泛化接口\n        reference.setGeneric(true);\n\n        reference.setApplication(application);\n\n        // 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口引用\n        GenericService genericService = reference.get();\n\n        String name = (String) genericService.$invoke(\"sayHello\", new String[]{String.class.getName()}, new Object[]{\"who am i\"});\n        System.out.println(name);\n    }\n```","source":"_posts/dubbo-test.md","raw":"---\ntitle: Dubbo接口测试\ntags: \n- 测试\n- 接口测试\ncategories: 接口测试\nabbrlink: 81c88605\ndate: 2020-04-03 13:30:40\n---\n<!-- ![](https://cdn.pixabay.com/photo/2019/03/22/08/40/night-4072727__480.jpg) -->\n# 接上文,了解Dubbo接口后,如何测试dubbo接口：\n## **Python版解决方案:**\n### 1. **hessian+http的方式调用(python-hessian库):**\n<!-- more -->\n* (1) dubbo项目中，增加hessian方式序列化，及相关依赖。下图为xml配置方式示例。\n    * <a href=\"https://dubbo.apache.org/zh-cn/docs/user/references/protocol/hessian.html\">官方配置hessian协议及依赖例子</a>\n    * <a href=\"https://dubbo.apache.org/zh-cn/docs/user/demos/multi-protocols.html\">官方配置多协议例子</a>![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboopoouuj30po0h5dif.jpg)\n\n* (2) 获取接口地址（可在管理台查看）、方法及方法的入参。\n* (3) 安装 python-hessian               \n    ```bash \n    python -m pip install python-hessian\n    ```\n* (4) 编写Python脚本调用接口; <a href=\"https://github.com/theatlantic/python-hessian/blob/master/README.rst\">pyhessian官方调用例子</a>\n    ```python\n    # coding=utf-8\n    import pytest\n    from pyhessian.client import HessianProxy\n\n    class TestDubbo(object):\n        url = \"http://169.254.210.145:1234/\"\n        interface = \"com.xxx.user.service.UserService\"\n        full_url = url + interface\n        # full_url = \"http://169.254.210.145:8888/com.xxx.user.service.FileService\"\n        def testsayHelloWithSpec(self):\n            params = u\"什么我调用成功了吗\"\n            # 创建连接对象\n            service = HessianProxy(self.full_url)\n            # 重载方法__call()__里发送二进制数据进行请求，调用方法\n            res = service.sayHello(params)\n            assert \"什么我调用成功了吗\" in res\n            print(res)\n\n        # @pytest.mark.skip()\n        def testsayHelloWithInt(self):\n            params = 123\n            service = HessianProxy(self.full_url)\n            res = service.sayHello(params)\n            assert 123 in res\n            print(res)\n\n    if __name__ == \"__main__\":\n        pytest.main([\"-q\",\"TestDubbo.py\"])\n    ```\n\n### 2. **使用dubbo-client**\n* dubbo项目中，provicer.xml 增加 jsonrpc 协议\n* <a href=\"https://github.com/dubbo/dubbo-client-py\">官方地址</a>\n<a href=\"https://www.twblogs.net/a/5d4061a4bd9eee51fbf993e7/zh-cn\">其他参考示例</a>\n    ```python\n    config = ApplicationConfig('test_rpclib')\n    service_interface = 'com.ofpay.demo.api.UserProvider'\n\n    # Contains a connection to zookeeper, which needs caching.\n    registry = ZookeeperRegistry('192.168.59.103:2181', config)\n    user_provider = DubboClient(service_interface, registry, version='1.0')\n    \n    for i in range(1000):\n        try:\n            print user_provider.getUser('A003')\n            print user_provider.queryUser(\n                {u'age': 18, u'time': 1428463514153, u'sex': u'MAN', u'id': u'A003', u'name': u'zhangsan'})\n            print user_provider.queryAll()\n            print user_provider.isLimit('MAN', 'Joe')\n            print user_provider('getUser', 'A005')\n        except DubboClientError, client_error:\n            print client_error\n        time.sleep(5)\n    ```\n\n## **java:**\n### 1. **XML配置文件方式:**\n* 拿到服务的jar包或maven依赖\n* 在resources下创建consumer.xml,配置好注册中心地址,接口名全称(有包名限定),每个接口有其唯一的标识reference id\n* 调用测试方法中,使用springframework提供的方法加载consumer.xml配置文件,得到context对象,调用start方法启动\n* 调用context对象的getBean方法,传入接口标识作为实参,获取接口的具体实现对象,这步会进行远程过程调用\n* 通过获取的对象调用其提供的方法\n    ```java\n    import com.xxx.user.service.UserService;\n    import org.junit.BeforeClass;\n    import org.junit.Test;\n    import org.springframework.context.support.ClassPathXmlApplicationContext;\n    import static org.hamcrest.CoreMatchers.containsString;\n    import static org.junit.Assert.assertThat;\n    public class ConsumerTest {\n        static ClassPathXmlApplicationContext context;\n        static UserService userService;\n        @BeforeClass\n        public static void beforeClass(){\n             if(context==null) {\n                 // 默认从类路径中加载配置文件\n                 context = new ClassPathXmlApplicationContext(\"consumer.xml\");\n                 System.out.println(\"load\");\n                 // 在Spring中还提供了Lifecycle接口，Lifecycle中包含start/stop方法，实现此接口后Spring保证在启动的时候调用其start方法开始生命周期,主要用于控制异步处理过程\n                context.start();\n    //            System.out.println(\"start\");\n             }\n    　　　　　　 // 创建接口实例（定义接口的引用变量，再引用实现了该接口的实例）\n            userService=(UserService) context.getBean(\"userService\");\n    \n         }\n        @Test\n        public void consumerTestCase1(){\n    　　　　　　 // 调用方法\n             String hello = userService.sayHello(\"world\");\n             assertThat(hello,containsString(\"world\");\n             System.out.println(hello);\n         }\n     }\n    ```\n\n### 2. **API方式的泛化调用:**\n* 不需要获取被测接口的jar包或依赖\n* <a href=\"http://dubbo.apache.org/zh-cn/blog/dubbo-generic-invoke.html\">官方示例1</a> <br/> <a href=\"http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html\">官方示例2</a>\n* 创建连接实例:\n    * 使用 org.apache.dubbo.config.ApplicationConfig 配置消费者应用名\n    * 使用 org.apache.dubbo.config.ReferenceConfig; 创建reference配置实例,设置接口全类名,声明泛化调用,配置消费者\n    * 使用org.apache.dubbo.config.RegistryConfig; 配置注册中心地址\n    * 调用reference配置实例的get方法,获取GenericService类型的连接实例\n* 调用服务提供的方法:\n    * 调用org.apache.dubbo.rpc.service.GenericService 这个接口名为 $invoke方法，它接受三个参数，分别为方法名、方法参数类型数组和参数值数组；\n        * 对于方法参数类型数组:\n            * 如果是基本类型，如 int 或 long，可以使用 int.class.getName()获取其类型；\n            * 如果是基本类型数组，如 int[]，则可以使用 int[].class.getName()；\n            * 如果是 POJO，则直接使用全类名，如 com.alibaba.dubbo.samples.generic.api.Params。\n        * 参数值数组:\n            * 如果是POJO,则转成Map,再将转换后的Map作为参数传入\n```java\n    @Test\n    public void test2(){\n        ApplicationConfig application = new ApplicationConfig();\n        application.setName(\"api-generic-consumer\");\n\n        // 使用RegistryConfig,动态配置注册中心地址\n        RegistryConfig registry = new RegistryConfig();\n        registry.setAddress(\"zookeeper://127.0.0.1:2181\");\n        application.setRegistry(registry);\n\n        ReferenceConfig<GenericService> reference = new ReferenceConfig<GenericService>();\n        // 弱类型接口名\n        reference.setInterface(\"com.ymxdclass.user.service.UserService\");\n        // 声明为泛化接口\n        reference.setGeneric(true);\n\n        reference.setApplication(application);\n\n        // 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口引用\n        GenericService genericService = reference.get();\n\n        String name = (String) genericService.$invoke(\"sayHello\", new String[]{String.class.getName()}, new Object[]{\"who am i\"});\n        System.out.println(name);\n    }\n```","slug":"dubbo-test","published":1,"updated":"2021-02-04T02:38:05.399Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai11l0001unrad5jq5wj0","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"接上文-了解Dubbo接口后-如何测试dubbo接口：\"><a href=\"#接上文-了解Dubbo接口后-如何测试dubbo接口：\" class=\"headerlink\" title=\"接上文,了解Dubbo接口后,如何测试dubbo接口：\"></a>接上文,了解Dubbo接口后,如何测试dubbo接口：</h1><h2 id=\"Python版解决方案\"><a href=\"#Python版解决方案\" class=\"headerlink\" title=\"Python版解决方案:\"></a><strong>Python版解决方案:</strong></h2><h3 id=\"1-hessian-http的方式调用-python-hessian库\"><a href=\"#1-hessian-http的方式调用-python-hessian库\" class=\"headerlink\" title=\"1. hessian+http的方式调用(python-hessian库):\"></a>1. <strong>hessian+http的方式调用(python-hessian库):</strong></h3><a id=\"more\"></a>\n<ul>\n<li><p>(1) dubbo项目中，增加hessian方式序列化，及相关依赖。下图为xml配置方式示例。</p>\n<ul>\n<li><a href=\"https://dubbo.apache.org/zh-cn/docs/user/references/protocol/hessian.html\" target=\"_blank\" rel=\"noopener\">官方配置hessian协议及依赖例子</a></li>\n<li><a href=\"https://dubbo.apache.org/zh-cn/docs/user/demos/multi-protocols.html\" target=\"_blank\" rel=\"noopener\">官方配置多协议例子</a><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboopoouuj30po0h5dif.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li><p>(2) 获取接口地址（可在管理台查看）、方法及方法的入参。</p>\n</li>\n<li><p>(3) 安装 python-hessian               </p>\n  <figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -m pip install python-hessian</span><br></pre></td></tr></tbody></table></figure></li>\n<li><p>(4) 编写Python脚本调用接口; <a href=\"https://github.com/theatlantic/python-hessian/blob/master/README.rst\" target=\"_blank\" rel=\"noopener\">pyhessian官方调用例子</a></p>\n  <figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pytest</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyhessian.client <span class=\"keyword\">import</span> HessianProxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDubbo</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">\"http://169.254.210.145:1234/\"</span></span><br><span class=\"line\">    interface = <span class=\"string\">\"com.xxx.user.service.UserService\"</span></span><br><span class=\"line\">    full_url = url + interface</span><br><span class=\"line\">    <span class=\"comment\"># full_url = \"http://169.254.210.145:8888/com.xxx.user.service.FileService\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testsayHelloWithSpec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        params = <span class=\"string\">u\"什么我调用成功了吗\"</span></span><br><span class=\"line\">        <span class=\"comment\"># 创建连接对象</span></span><br><span class=\"line\">        service = HessianProxy(self.full_url)</span><br><span class=\"line\">        <span class=\"comment\"># 重载方法__call()__里发送二进制数据进行请求，调用方法</span></span><br><span class=\"line\">        res = service.sayHello(params)</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> <span class=\"string\">\"什么我调用成功了吗\"</span> <span class=\"keyword\">in</span> res</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># @pytest.mark.skip()</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testsayHelloWithInt</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        params = <span class=\"number\">123</span></span><br><span class=\"line\">        service = HessianProxy(self.full_url)</span><br><span class=\"line\">        res = service.sayHello(params)</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> <span class=\"number\">123</span> <span class=\"keyword\">in</span> res</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    pytest.main([<span class=\"string\">\"-q\"</span>,<span class=\"string\">\"TestDubbo.py\"</span>])</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-使用dubbo-client\"><a href=\"#2-使用dubbo-client\" class=\"headerlink\" title=\"2. 使用dubbo-client\"></a>2. <strong>使用dubbo-client</strong></h3><ul>\n<li>dubbo项目中，provicer.xml 增加 jsonrpc 协议</li>\n<li><a href=\"https://github.com/dubbo/dubbo-client-py\" target=\"_blank\" rel=\"noopener\">官方地址</a><br><a href=\"https://www.twblogs.net/a/5d4061a4bd9eee51fbf993e7/zh-cn\" target=\"_blank\" rel=\"noopener\">其他参考示例</a>  <figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config = ApplicationConfig(<span class=\"string\">'test_rpclib'</span>)</span><br><span class=\"line\">service_interface = <span class=\"string\">'com.ofpay.demo.api.UserProvider'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Contains a connection to zookeeper, which needs caching.</span></span><br><span class=\"line\">registry = ZookeeperRegistry(<span class=\"string\">'192.168.59.103:2181'</span>, config)</span><br><span class=\"line\">user_provider = DubboClient(service_interface, registry, version=<span class=\"string\">'1.0'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1000</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.getUser(<span class=\"string\">'A003'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.queryUser(</span><br><span class=\"line\">            {<span class=\"string\">u'age'</span>: <span class=\"number\">18</span>, <span class=\"string\">u'time'</span>: <span class=\"number\">1428463514153</span>, <span class=\"string\">u'sex'</span>: <span class=\"string\">u'MAN'</span>, <span class=\"string\">u'id'</span>: <span class=\"string\">u'A003'</span>, <span class=\"string\">u'name'</span>: <span class=\"string\">u'zhangsan'</span>})</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.queryAll()</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.isLimit(<span class=\"string\">'MAN'</span>, <span class=\"string\">'Joe'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider(<span class=\"string\">'getUser'</span>, <span class=\"string\">'A005'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> DubboClientError, client_error:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> client_error</span><br><span class=\"line\">    time.sleep(<span class=\"number\">5</span>)</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<h2 id=\"java\"><a href=\"#java\" class=\"headerlink\" title=\"java:\"></a><strong>java:</strong></h2><h3 id=\"1-XML配置文件方式\"><a href=\"#1-XML配置文件方式\" class=\"headerlink\" title=\"1. XML配置文件方式:\"></a>1. <strong>XML配置文件方式:</strong></h3><ul>\n<li>拿到服务的jar包或maven依赖</li>\n<li>在resources下创建consumer.xml,配置好注册中心地址,接口名全称(有包名限定),每个接口有其唯一的标识reference id</li>\n<li>调用测试方法中,使用springframework提供的方法加载consumer.xml配置文件,得到context对象,调用start方法启动</li>\n<li>调用context对象的getBean方法,传入接口标识作为实参,获取接口的具体实现对象,这步会进行远程过程调用</li>\n<li>通过获取的对象调用其提供的方法  <figure class=\"highlight java\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.xxx.user.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.BeforeClass;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.hamcrest.CoreMatchers.containsString;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertThat;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTest</span> </span>{</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ClassPathXmlApplicationContext context;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> UserService userService;</span><br><span class=\"line\">    <span class=\"meta\">@BeforeClass</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeClass</span><span class=\"params\">()</span></span>{</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(context==<span class=\"keyword\">null</span>) {</span><br><span class=\"line\">             <span class=\"comment\">// 默认从类路径中加载配置文件</span></span><br><span class=\"line\">             context = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"consumer.xml\"</span>);</span><br><span class=\"line\">             System.out.println(<span class=\"string\">\"load\"</span>);</span><br><span class=\"line\">             <span class=\"comment\">// 在Spring中还提供了Lifecycle接口，Lifecycle中包含start/stop方法，实现此接口后Spring保证在启动的时候调用其start方法开始生命周期,主要用于控制异步处理过程</span></span><br><span class=\"line\">            context.start();</span><br><span class=\"line\"><span class=\"comment\">//            System.out.println(\"start\");</span></span><br><span class=\"line\">         }</span><br><span class=\"line\">　　　　　　 <span class=\"comment\">// 创建接口实例（定义接口的引用变量，再引用实现了该接口的实例）</span></span><br><span class=\"line\">        userService=(UserService) context.getBean(<span class=\"string\">\"userService\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">     }</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">consumerTestCase1</span><span class=\"params\">()</span></span>{</span><br><span class=\"line\">　　　　　　 <span class=\"comment\">// 调用方法</span></span><br><span class=\"line\">         String hello = userService.sayHello(<span class=\"string\">\"world\"</span>);</span><br><span class=\"line\">         assertThat(hello,containsString(<span class=\"string\">\"world\"</span>);</span><br><span class=\"line\">         System.out.println(hello);</span><br><span class=\"line\">     }</span><br><span class=\"line\"> }</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-API方式的泛化调用\"><a href=\"#2-API方式的泛化调用\" class=\"headerlink\" title=\"2. API方式的泛化调用:\"></a>2. <strong>API方式的泛化调用:</strong></h3><ul>\n<li>不需要获取被测接口的jar包或依赖</li>\n<li><a href=\"http://dubbo.apache.org/zh-cn/blog/dubbo-generic-invoke.html\" target=\"_blank\" rel=\"noopener\">官方示例1</a> <br> <a href=\"http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html\" target=\"_blank\" rel=\"noopener\">官方示例2</a></li>\n<li>创建连接实例:<ul>\n<li>使用 org.apache.dubbo.config.ApplicationConfig 配置消费者应用名</li>\n<li>使用 org.apache.dubbo.config.ReferenceConfig; 创建reference配置实例,设置接口全类名,声明泛化调用,配置消费者</li>\n<li>使用org.apache.dubbo.config.RegistryConfig; 配置注册中心地址</li>\n<li>调用reference配置实例的get方法,获取GenericService类型的连接实例</li>\n</ul>\n</li>\n<li>调用服务提供的方法:<ul>\n<li>调用org.apache.dubbo.rpc.service.GenericService 这个接口名为 $invoke方法，它接受三个参数，分别为方法名、方法参数类型数组和参数值数组；<ul>\n<li>对于方法参数类型数组:<ul>\n<li>如果是基本类型，如 int 或 long，可以使用 int.class.getName()获取其类型；</li>\n<li>如果是基本类型数组，如 int[]，则可以使用 int[].class.getName()；</li>\n<li>如果是 POJO，则直接使用全类名，如 com.alibaba.dubbo.samples.generic.api.Params。</li>\n</ul>\n</li>\n<li>参数值数组:<ul>\n<li>如果是POJO,则转成Map,再将转换后的Map作为参数传入<figure class=\"highlight java\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span></span>{</span><br><span class=\"line\">    ApplicationConfig application = <span class=\"keyword\">new</span> ApplicationConfig();</span><br><span class=\"line\">    application.setName(<span class=\"string\">\"api-generic-consumer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用RegistryConfig,动态配置注册中心地址</span></span><br><span class=\"line\">    RegistryConfig registry = <span class=\"keyword\">new</span> RegistryConfig();</span><br><span class=\"line\">    registry.setAddress(<span class=\"string\">\"zookeeper://127.0.0.1:2181\"</span>);</span><br><span class=\"line\">    application.setRegistry(registry);</span><br><span class=\"line\"></span><br><span class=\"line\">    ReferenceConfig&lt;GenericService&gt; reference = <span class=\"keyword\">new</span> ReferenceConfig&lt;GenericService&gt;();</span><br><span class=\"line\">    <span class=\"comment\">// 弱类型接口名</span></span><br><span class=\"line\">    reference.setInterface(<span class=\"string\">\"com.ymxdclass.user.service.UserService\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 声明为泛化接口</span></span><br><span class=\"line\">    reference.setGeneric(<span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    reference.setApplication(application);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口引用</span></span><br><span class=\"line\">    GenericService genericService = reference.get();</span><br><span class=\"line\"></span><br><span class=\"line\">    String name = (String) genericService.$invoke(\"sayHello\", new String[]{String.class.getName()}, new Object[]{\"who am i\"});</span><br><span class=\"line\">    System.out.println(name);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"接上文-了解Dubbo接口后-如何测试dubbo接口：\"><a href=\"#接上文-了解Dubbo接口后-如何测试dubbo接口：\" class=\"headerlink\" title=\"接上文,了解Dubbo接口后,如何测试dubbo接口：\"></a>接上文,了解Dubbo接口后,如何测试dubbo接口：</h1><h2 id=\"Python版解决方案\"><a href=\"#Python版解决方案\" class=\"headerlink\" title=\"Python版解决方案:\"></a><strong>Python版解决方案:</strong></h2><h3 id=\"1-hessian-http的方式调用-python-hessian库\"><a href=\"#1-hessian-http的方式调用-python-hessian库\" class=\"headerlink\" title=\"1. hessian+http的方式调用(python-hessian库):\"></a>1. <strong>hessian+http的方式调用(python-hessian库):</strong></h3>","more":"<ul>\n<li><p>(1) dubbo项目中，增加hessian方式序列化，及相关依赖。下图为xml配置方式示例。</p>\n<ul>\n<li><a href=\"https://dubbo.apache.org/zh-cn/docs/user/references/protocol/hessian.html\" target=\"_blank\" rel=\"noopener\">官方配置hessian协议及依赖例子</a></li>\n<li><a href=\"https://dubbo.apache.org/zh-cn/docs/user/demos/multi-protocols.html\" target=\"_blank\" rel=\"noopener\">官方配置多协议例子</a><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboopoouuj30po0h5dif.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li><p>(2) 获取接口地址（可在管理台查看）、方法及方法的入参。</p>\n</li>\n<li><p>(3) 安装 python-hessian               </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -m pip install python-hessian</span><br></pre></td></tr></table></figure></li>\n<li><p>(4) 编写Python脚本调用接口; <a href=\"https://github.com/theatlantic/python-hessian/blob/master/README.rst\" target=\"_blank\" rel=\"noopener\">pyhessian官方调用例子</a></p>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> pytest</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyhessian.client <span class=\"keyword\">import</span> HessianProxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDubbo</span><span class=\"params\">(object)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">\"http://169.254.210.145:1234/\"</span></span><br><span class=\"line\">    interface = <span class=\"string\">\"com.xxx.user.service.UserService\"</span></span><br><span class=\"line\">    full_url = url + interface</span><br><span class=\"line\">    <span class=\"comment\"># full_url = \"http://169.254.210.145:8888/com.xxx.user.service.FileService\"</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testsayHelloWithSpec</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        params = <span class=\"string\">u\"什么我调用成功了吗\"</span></span><br><span class=\"line\">        <span class=\"comment\"># 创建连接对象</span></span><br><span class=\"line\">        service = HessianProxy(self.full_url)</span><br><span class=\"line\">        <span class=\"comment\"># 重载方法__call()__里发送二进制数据进行请求，调用方法</span></span><br><span class=\"line\">        res = service.sayHello(params)</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> <span class=\"string\">\"什么我调用成功了吗\"</span> <span class=\"keyword\">in</span> res</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># @pytest.mark.skip()</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testsayHelloWithInt</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        params = <span class=\"number\">123</span></span><br><span class=\"line\">        service = HessianProxy(self.full_url)</span><br><span class=\"line\">        res = service.sayHello(params)</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> <span class=\"number\">123</span> <span class=\"keyword\">in</span> res</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    pytest.main([<span class=\"string\">\"-q\"</span>,<span class=\"string\">\"TestDubbo.py\"</span>])</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-使用dubbo-client\"><a href=\"#2-使用dubbo-client\" class=\"headerlink\" title=\"2. 使用dubbo-client\"></a>2. <strong>使用dubbo-client</strong></h3><ul>\n<li>dubbo项目中，provicer.xml 增加 jsonrpc 协议</li>\n<li><a href=\"https://github.com/dubbo/dubbo-client-py\" target=\"_blank\" rel=\"noopener\">官方地址</a><br><a href=\"https://www.twblogs.net/a/5d4061a4bd9eee51fbf993e7/zh-cn\" target=\"_blank\" rel=\"noopener\">其他参考示例</a>  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config = ApplicationConfig(<span class=\"string\">'test_rpclib'</span>)</span><br><span class=\"line\">service_interface = <span class=\"string\">'com.ofpay.demo.api.UserProvider'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Contains a connection to zookeeper, which needs caching.</span></span><br><span class=\"line\">registry = ZookeeperRegistry(<span class=\"string\">'192.168.59.103:2181'</span>, config)</span><br><span class=\"line\">user_provider = DubboClient(service_interface, registry, version=<span class=\"string\">'1.0'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">1000</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.getUser(<span class=\"string\">'A003'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.queryUser(</span><br><span class=\"line\">            &#123;<span class=\"string\">u'age'</span>: <span class=\"number\">18</span>, <span class=\"string\">u'time'</span>: <span class=\"number\">1428463514153</span>, <span class=\"string\">u'sex'</span>: <span class=\"string\">u'MAN'</span>, <span class=\"string\">u'id'</span>: <span class=\"string\">u'A003'</span>, <span class=\"string\">u'name'</span>: <span class=\"string\">u'zhangsan'</span>&#125;)</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.queryAll()</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider.isLimit(<span class=\"string\">'MAN'</span>, <span class=\"string\">'Joe'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">print</span> user_provider(<span class=\"string\">'getUser'</span>, <span class=\"string\">'A005'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> DubboClientError, client_error:</span><br><span class=\"line\">        <span class=\"keyword\">print</span> client_error</span><br><span class=\"line\">    time.sleep(<span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"java\"><a href=\"#java\" class=\"headerlink\" title=\"java:\"></a><strong>java:</strong></h2><h3 id=\"1-XML配置文件方式\"><a href=\"#1-XML配置文件方式\" class=\"headerlink\" title=\"1. XML配置文件方式:\"></a>1. <strong>XML配置文件方式:</strong></h3><ul>\n<li>拿到服务的jar包或maven依赖</li>\n<li>在resources下创建consumer.xml,配置好注册中心地址,接口名全称(有包名限定),每个接口有其唯一的标识reference id</li>\n<li>调用测试方法中,使用springframework提供的方法加载consumer.xml配置文件,得到context对象,调用start方法启动</li>\n<li>调用context对象的getBean方法,传入接口标识作为实参,获取接口的具体实现对象,这步会进行远程过程调用</li>\n<li>通过获取的对象调用其提供的方法  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.xxx.user.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.BeforeClass;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.hamcrest.CoreMatchers.containsString;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertThat;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ClassPathXmlApplicationContext context;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> UserService userService;</span><br><span class=\"line\">    <span class=\"meta\">@BeforeClass</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeClass</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(context==<span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">             <span class=\"comment\">// 默认从类路径中加载配置文件</span></span><br><span class=\"line\">             context = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"consumer.xml\"</span>);</span><br><span class=\"line\">             System.out.println(<span class=\"string\">\"load\"</span>);</span><br><span class=\"line\">             <span class=\"comment\">// 在Spring中还提供了Lifecycle接口，Lifecycle中包含start/stop方法，实现此接口后Spring保证在启动的时候调用其start方法开始生命周期,主要用于控制异步处理过程</span></span><br><span class=\"line\">            context.start();</span><br><span class=\"line\"><span class=\"comment\">//            System.out.println(\"start\");</span></span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">　　　　　　 <span class=\"comment\">// 创建接口实例（定义接口的引用变量，再引用实现了该接口的实例）</span></span><br><span class=\"line\">        userService=(UserService) context.getBean(<span class=\"string\">\"userService\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">consumerTestCase1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">　　　　　　 <span class=\"comment\">// 调用方法</span></span><br><span class=\"line\">         String hello = userService.sayHello(<span class=\"string\">\"world\"</span>);</span><br><span class=\"line\">         assertThat(hello,containsString(<span class=\"string\">\"world\"</span>);</span><br><span class=\"line\">         System.out.println(hello);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-API方式的泛化调用\"><a href=\"#2-API方式的泛化调用\" class=\"headerlink\" title=\"2. API方式的泛化调用:\"></a>2. <strong>API方式的泛化调用:</strong></h3><ul>\n<li>不需要获取被测接口的jar包或依赖</li>\n<li><a href=\"http://dubbo.apache.org/zh-cn/blog/dubbo-generic-invoke.html\" target=\"_blank\" rel=\"noopener\">官方示例1</a> <br/> <a href=\"http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html\" target=\"_blank\" rel=\"noopener\">官方示例2</a></li>\n<li>创建连接实例:<ul>\n<li>使用 org.apache.dubbo.config.ApplicationConfig 配置消费者应用名</li>\n<li>使用 org.apache.dubbo.config.ReferenceConfig; 创建reference配置实例,设置接口全类名,声明泛化调用,配置消费者</li>\n<li>使用org.apache.dubbo.config.RegistryConfig; 配置注册中心地址</li>\n<li>调用reference配置实例的get方法,获取GenericService类型的连接实例</li>\n</ul>\n</li>\n<li>调用服务提供的方法:<ul>\n<li>调用org.apache.dubbo.rpc.service.GenericService 这个接口名为 $invoke方法，它接受三个参数，分别为方法名、方法参数类型数组和参数值数组；<ul>\n<li>对于方法参数类型数组:<ul>\n<li>如果是基本类型，如 int 或 long，可以使用 int.class.getName()获取其类型；</li>\n<li>如果是基本类型数组，如 int[]，则可以使用 int[].class.getName()；</li>\n<li>如果是 POJO，则直接使用全类名，如 com.alibaba.dubbo.samples.generic.api.Params。</li>\n</ul>\n</li>\n<li>参数值数组:<ul>\n<li>如果是POJO,则转成Map,再将转换后的Map作为参数传入<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    ApplicationConfig application = <span class=\"keyword\">new</span> ApplicationConfig();</span><br><span class=\"line\">    application.setName(<span class=\"string\">\"api-generic-consumer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用RegistryConfig,动态配置注册中心地址</span></span><br><span class=\"line\">    RegistryConfig registry = <span class=\"keyword\">new</span> RegistryConfig();</span><br><span class=\"line\">    registry.setAddress(<span class=\"string\">\"zookeeper://127.0.0.1:2181\"</span>);</span><br><span class=\"line\">    application.setRegistry(registry);</span><br><span class=\"line\"></span><br><span class=\"line\">    ReferenceConfig&lt;GenericService&gt; reference = <span class=\"keyword\">new</span> ReferenceConfig&lt;GenericService&gt;();</span><br><span class=\"line\">    <span class=\"comment\">// 弱类型接口名</span></span><br><span class=\"line\">    reference.setInterface(<span class=\"string\">\"com.ymxdclass.user.service.UserService\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 声明为泛化接口</span></span><br><span class=\"line\">    reference.setGeneric(<span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    reference.setApplication(application);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口引用</span></span><br><span class=\"line\">    GenericService genericService = reference.get();</span><br><span class=\"line\"></span><br><span class=\"line\">    String name = (String) genericService.$invoke(\"sayHello\", new String[]&#123;String.class.getName()&#125;, new Object[]&#123;\"who am i\"&#125;);</span><br><span class=\"line\">    System.out.println(name);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"},{"title":"Dubbo接口框架相关概念","abbrlink":"f0c13426","date":"2020-04-12T03:11:30.000Z","_content":"# **关于dubbo**：\n## why:\n* 为了解决,随着互联网发展,而日益增长的业务复杂度,网站应用规模不断扩大,且常规的垂直应用架构也无法应付,而提出的解决方案.![](https://tva1.sinaimg.cn/large/00831rSTgy1gdbnrp2sl3j30jg05u3z5.jpg)\n<!-- more -->\n### 1. 架构发展角度:\n* 单一应用架构\n    * 网站流量很小时,将所有功能都部署在一个应用,节省部署节点和成本.此时,重点是简化增删改查工作量的数据访问框架ORM\n    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsa0v00j310w0cgn0z.jpg\" width=\"70%\">\n    (图源https://www.jianshu.com/p/92ca0bfbd52f)\n    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsx15sdj30su0yg46t.jpg\" width=\"60%\" height=\"10%\">\n    * 单体架构相关资料:\n        * 单体架构指应用代码都作为同一个进程,部署和运行在单一节点中.\n            * 单一节点服务器中,整体中的所有的模块都组装到单一的内存镜像中,作为一个进程运行在单一节点上.\n            * 其中,如果将应用程序部署到多个服务器（如在水平扩展上下文中），它仍然是一个整体。\n                \n                <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo2vsnw7j30g80jqtiq.jpg\" width=\"50%\">\n        * <a href=\"https://herbertograca.com/2017/07/31/monolithic-architecture/\">单体架构参考资料1</a> <a href=\"https://sunnycoding.cn/2018/07/28/monolithic-and-microservices-part1/\">单体架构参考资料2</a> <a href=\"https://microservices.io/patterns/monolithic.html\">单体架构参考资料3</a>\n* 垂直应用架构\n    * 访问量逐渐增大,单一应用增加机器(通过在负载均衡器后端运行多个拷贝，实现多个扩展)带来的加速度越来越小,于是需要将应用拆成互不相干的几个应用来提升效率,此时的重点是用于加速前端页面开发的Web框架(MVC).\n* 分布式服务架构\n    * 为了应对增长的业务量,一台机器的性能已经无法满足,需要多台机器才能应对大规模的应用场景,同时也为了提高整个系统架构的可用性,消除单点故障,而垂直或水平拆分业务系统为多个应用.\n    * 当垂直应用越来越多,应用之间需要交互,将核心业务抽取出来,作为独立的服务,逐渐形成稳定的服务中心,使前端应用能更快速的响应多变的市场需求.此时,重点是解决进程间通信问题和提高业务复用及整合的分布式服务框架RPC.\n* 流动计算架构\n    * 当服务越来越多,容量的评估,小服务资源的浪费等问题逐渐显现,此时需要增加一个调度中心基于访问实时管理集群容量,提高集群利用率.此时,重点是提高机器利用率的资源调度和治理中心SOA.\n\n### 2. 要解决的问题:\n* 在大规模服务化之前，应用可能只是通过 RMI 或 Hessian 等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过 F5 等硬件进行负载均衡。当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大。\n    * 需要服务调用方能自动感知到服务提供方的地址,而对服务提供方进行横向扩展的时候,服务调用方能自动感知到\n    * 因此需要一个服务注册中心，动态地注册和发现服务, 通过消费方获取服务提供方地址列表,实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。\n* 解决清晰描述错综复杂的服务依赖关系的问题\n* 服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？ 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，记录此时的访问量，再以此访问量乘以机器数反推总容量。\n![](https://tva1.sinaimg.cn/large/00831rSTgy1gdbo9udlymj30mk0cq7cq.jpg)\n\n## what:\n* 一个远程服务调用的分布式框架，调用协议通常包含传输协议和序列化协议。\n* Dubbo本身支持多种远程调用方式，例如Dubbo RPC（二进制序列化 + tcp协议）、http invoker（二进制序列化 + http协议）、hessian（二进制序列化 + http协议）、WebServices （文本序列化 + http协议）等。\n\n## 架构说明:\n* ![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboappmpdj30ci08cdho.jpg)\n* <a href=\"https://dubbo.apache.org/zh-cn/docs/user/preface/architecture.html\">官网介绍地址</a>\n### 1. 节点角色说明\n\n    |  节点   | 角色说明  |\n    |  ----  | ----  |\n    | Provider  | 暴露服务的服务提供方 |\n    | Consumer  | 调用远程服务的服务消费方 |\n    | Registry  | 服务注册与发现的注册中心 |\n    | Monitor  | 统计服务的调用次数和调用时间的监控中心 |\n    | Container  | 暴露服务的服务提供方 |\n    | Consumer  | 服务运行容器 |\n\n###  2. 调用关系说明\n    1. 服务容器负责启动，加载，运行服务提供者。\n    2. 服务提供者在启动时，向注册中心注册自己提供的服务。\n    3. 服务消费者在启动时，向注册中心订阅自己所需的服务。\n    4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。\n    5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。\n    6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。\n\n## 管理控制台的编译安装：\n* 新版管理控制台主要的作用：服务查询，服务治理(包括Dubbo2.7中新增的治理规则)以及服务测试、配置管理![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboh1ognhj30ti0b8aax.jpg)\n### 步骤:\n```bash\n# 克隆项目到本地，并编译安装和启动（如果是Windows下，则在powershell进行）\ngit clone https://github.com/apache/incubator-dubbo-ops.git\n\n# 切到项目根目录\ncd incubator-dubbo-admin-develop\n\n# 编译构建\nmvn clean package\n\n# 修改配置文件，指定注册中心地址\ndubbo-admin-server/src/main/resources/application-production.properties\n\n　# 主要的配置有：\n　　admin.config-center=zookeeper://127.0.0.1:2181\n　　admin.registry.address=zookeeper://127.0.0.1:2181　\n　　admin.metadata-report.address=zookeeper://127.0.0.1:2181\n\n# 启动服务\ncd dubbo-distribution/target\njava -jar dubbo-admin-0.1.jar\n# 或以下命令启动服务\nmvn --projects dubbo-admin-server spring-boot:run\n\n# 启动完成后，直接访问http://localhost:8080\n```\n* <a href=\"https://github.com/apache/dubbo-samples/tree/master/java\">官方示例地址</a>\n\n","source":"_posts/article.md","raw":"---\ntitle: Dubbo接口框架相关概念\ntags:\n- 测试\n- 接口测试\nabbrlink: f0c13426\ndate: 2020-04-12 11:11:30\n---\n# **关于dubbo**：\n## why:\n* 为了解决,随着互联网发展,而日益增长的业务复杂度,网站应用规模不断扩大,且常规的垂直应用架构也无法应付,而提出的解决方案.![](https://tva1.sinaimg.cn/large/00831rSTgy1gdbnrp2sl3j30jg05u3z5.jpg)\n<!-- more -->\n### 1. 架构发展角度:\n* 单一应用架构\n    * 网站流量很小时,将所有功能都部署在一个应用,节省部署节点和成本.此时,重点是简化增删改查工作量的数据访问框架ORM\n    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsa0v00j310w0cgn0z.jpg\" width=\"70%\">\n    (图源https://www.jianshu.com/p/92ca0bfbd52f)\n    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsx15sdj30su0yg46t.jpg\" width=\"60%\" height=\"10%\">\n    * 单体架构相关资料:\n        * 单体架构指应用代码都作为同一个进程,部署和运行在单一节点中.\n            * 单一节点服务器中,整体中的所有的模块都组装到单一的内存镜像中,作为一个进程运行在单一节点上.\n            * 其中,如果将应用程序部署到多个服务器（如在水平扩展上下文中），它仍然是一个整体。\n                \n                <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo2vsnw7j30g80jqtiq.jpg\" width=\"50%\">\n        * <a href=\"https://herbertograca.com/2017/07/31/monolithic-architecture/\">单体架构参考资料1</a> <a href=\"https://sunnycoding.cn/2018/07/28/monolithic-and-microservices-part1/\">单体架构参考资料2</a> <a href=\"https://microservices.io/patterns/monolithic.html\">单体架构参考资料3</a>\n* 垂直应用架构\n    * 访问量逐渐增大,单一应用增加机器(通过在负载均衡器后端运行多个拷贝，实现多个扩展)带来的加速度越来越小,于是需要将应用拆成互不相干的几个应用来提升效率,此时的重点是用于加速前端页面开发的Web框架(MVC).\n* 分布式服务架构\n    * 为了应对增长的业务量,一台机器的性能已经无法满足,需要多台机器才能应对大规模的应用场景,同时也为了提高整个系统架构的可用性,消除单点故障,而垂直或水平拆分业务系统为多个应用.\n    * 当垂直应用越来越多,应用之间需要交互,将核心业务抽取出来,作为独立的服务,逐渐形成稳定的服务中心,使前端应用能更快速的响应多变的市场需求.此时,重点是解决进程间通信问题和提高业务复用及整合的分布式服务框架RPC.\n* 流动计算架构\n    * 当服务越来越多,容量的评估,小服务资源的浪费等问题逐渐显现,此时需要增加一个调度中心基于访问实时管理集群容量,提高集群利用率.此时,重点是提高机器利用率的资源调度和治理中心SOA.\n\n### 2. 要解决的问题:\n* 在大规模服务化之前，应用可能只是通过 RMI 或 Hessian 等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过 F5 等硬件进行负载均衡。当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大。\n    * 需要服务调用方能自动感知到服务提供方的地址,而对服务提供方进行横向扩展的时候,服务调用方能自动感知到\n    * 因此需要一个服务注册中心，动态地注册和发现服务, 通过消费方获取服务提供方地址列表,实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。\n* 解决清晰描述错综复杂的服务依赖关系的问题\n* 服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？ 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，记录此时的访问量，再以此访问量乘以机器数反推总容量。\n![](https://tva1.sinaimg.cn/large/00831rSTgy1gdbo9udlymj30mk0cq7cq.jpg)\n\n## what:\n* 一个远程服务调用的分布式框架，调用协议通常包含传输协议和序列化协议。\n* Dubbo本身支持多种远程调用方式，例如Dubbo RPC（二进制序列化 + tcp协议）、http invoker（二进制序列化 + http协议）、hessian（二进制序列化 + http协议）、WebServices （文本序列化 + http协议）等。\n\n## 架构说明:\n* ![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboappmpdj30ci08cdho.jpg)\n* <a href=\"https://dubbo.apache.org/zh-cn/docs/user/preface/architecture.html\">官网介绍地址</a>\n### 1. 节点角色说明\n\n    |  节点   | 角色说明  |\n    |  ----  | ----  |\n    | Provider  | 暴露服务的服务提供方 |\n    | Consumer  | 调用远程服务的服务消费方 |\n    | Registry  | 服务注册与发现的注册中心 |\n    | Monitor  | 统计服务的调用次数和调用时间的监控中心 |\n    | Container  | 暴露服务的服务提供方 |\n    | Consumer  | 服务运行容器 |\n\n###  2. 调用关系说明\n    1. 服务容器负责启动，加载，运行服务提供者。\n    2. 服务提供者在启动时，向注册中心注册自己提供的服务。\n    3. 服务消费者在启动时，向注册中心订阅自己所需的服务。\n    4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。\n    5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。\n    6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。\n\n## 管理控制台的编译安装：\n* 新版管理控制台主要的作用：服务查询，服务治理(包括Dubbo2.7中新增的治理规则)以及服务测试、配置管理![](https://tva1.sinaimg.cn/large/00831rSTgy1gdboh1ognhj30ti0b8aax.jpg)\n### 步骤:\n```bash\n# 克隆项目到本地，并编译安装和启动（如果是Windows下，则在powershell进行）\ngit clone https://github.com/apache/incubator-dubbo-ops.git\n\n# 切到项目根目录\ncd incubator-dubbo-admin-develop\n\n# 编译构建\nmvn clean package\n\n# 修改配置文件，指定注册中心地址\ndubbo-admin-server/src/main/resources/application-production.properties\n\n　# 主要的配置有：\n　　admin.config-center=zookeeper://127.0.0.1:2181\n　　admin.registry.address=zookeeper://127.0.0.1:2181　\n　　admin.metadata-report.address=zookeeper://127.0.0.1:2181\n\n# 启动服务\ncd dubbo-distribution/target\njava -jar dubbo-admin-0.1.jar\n# 或以下命令启动服务\nmvn --projects dubbo-admin-server spring-boot:run\n\n# 启动完成后，直接访问http://localhost:8080\n```\n* <a href=\"https://github.com/apache/dubbo-samples/tree/master/java\">官方示例地址</a>\n\n","slug":"article","published":1,"updated":"2021-02-04T02:38:05.399Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai1210008unra1os2gs5y","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"关于dubbo：\"><a href=\"#关于dubbo：\" class=\"headerlink\" title=\"关于dubbo：\"></a><strong>关于dubbo</strong>：</h1><h2 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why:\"></a>why:</h2><ul>\n<li><p>为了解决,随着互联网发展,而日益增长的业务复杂度,网站应用规模不断扩大,且常规的垂直应用架构也无法应付,而提出的解决方案.</p><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnrp2sl3j30jg05u3z5.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure><p></p>\n<a id=\"more\"></a>\n<h3 id=\"1-架构发展角度\"><a href=\"#1-架构发展角度\" class=\"headerlink\" title=\"1. 架构发展角度:\"></a>1. 架构发展角度:</h3></li>\n<li><p>单一应用架构</p>\n<ul>\n<li><p>网站流量很小时,将所有功能都部署在一个应用,节省部署节点和成本.此时,重点是简化增删改查工作量的数据访问框架ORM</p>\n<img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsa0v00j310w0cgn0z.jpg\" width=\"70%\">\n(图源https://www.jianshu.com/p/92ca0bfbd52f)\n<img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsx15sdj30su0yg46t.jpg\" width=\"60%\" height=\"10%\"></li>\n<li><p>单体架构相关资料:</p>\n<ul>\n<li><p>单体架构指应用代码都作为同一个进程,部署和运行在单一节点中.</p>\n<ul>\n<li><p>单一节点服务器中,整体中的所有的模块都组装到单一的内存镜像中,作为一个进程运行在单一节点上.</p>\n</li>\n<li><p>其中,如果将应用程序部署到多个服务器（如在水平扩展上下文中），它仍然是一个整体。</p>\n  <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo2vsnw7j30g80jqtiq.jpg\" width=\"50%\"></li>\n</ul>\n</li>\n<li><p><a href=\"https://herbertograca.com/2017/07/31/monolithic-architecture/\" target=\"_blank\" rel=\"noopener\">单体架构参考资料1</a> <a href=\"https://sunnycoding.cn/2018/07/28/monolithic-and-microservices-part1/\" target=\"_blank\" rel=\"noopener\">单体架构参考资料2</a> <a href=\"https://microservices.io/patterns/monolithic.html\" target=\"_blank\" rel=\"noopener\">单体架构参考资料3</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>垂直应用架构</p>\n<ul>\n<li>访问量逐渐增大,单一应用增加机器(通过在负载均衡器后端运行多个拷贝，实现多个扩展)带来的加速度越来越小,于是需要将应用拆成互不相干的几个应用来提升效率,此时的重点是用于加速前端页面开发的Web框架(MVC).</li>\n</ul>\n</li>\n<li><p>分布式服务架构</p>\n<ul>\n<li>为了应对增长的业务量,一台机器的性能已经无法满足,需要多台机器才能应对大规模的应用场景,同时也为了提高整个系统架构的可用性,消除单点故障,而垂直或水平拆分业务系统为多个应用.</li>\n<li>当垂直应用越来越多,应用之间需要交互,将核心业务抽取出来,作为独立的服务,逐渐形成稳定的服务中心,使前端应用能更快速的响应多变的市场需求.此时,重点是解决进程间通信问题和提高业务复用及整合的分布式服务框架RPC.</li>\n</ul>\n</li>\n<li><p>流动计算架构</p>\n<ul>\n<li>当服务越来越多,容量的评估,小服务资源的浪费等问题逐渐显现,此时需要增加一个调度中心基于访问实时管理集群容量,提高集群利用率.此时,重点是提高机器利用率的资源调度和治理中心SOA.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-要解决的问题\"><a href=\"#2-要解决的问题\" class=\"headerlink\" title=\"2. 要解决的问题:\"></a>2. 要解决的问题:</h3><ul>\n<li>在大规模服务化之前，应用可能只是通过 RMI 或 Hessian 等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过 F5 等硬件进行负载均衡。当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大。<ul>\n<li>需要服务调用方能自动感知到服务提供方的地址,而对服务提供方进行横向扩展的时候,服务调用方能自动感知到</li>\n<li>因此需要一个服务注册中心，动态地注册和发现服务, 通过消费方获取服务提供方地址列表,实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。</li>\n</ul>\n</li>\n<li>解决清晰描述错综复杂的服务依赖关系的问题</li>\n<li>服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？ 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，记录此时的访问量，再以此访问量乘以机器数反推总容量。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo9udlymj30mk0cq7cq.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"what\"><a href=\"#what\" class=\"headerlink\" title=\"what:\"></a>what:</h2><ul>\n<li>一个远程服务调用的分布式框架，调用协议通常包含传输协议和序列化协议。</li>\n<li>Dubbo本身支持多种远程调用方式，例如Dubbo RPC（二进制序列化 + tcp协议）、http invoker（二进制序列化 + http协议）、hessian（二进制序列化 + http协议）、WebServices （文本序列化 + http协议）等。</li>\n</ul>\n<h2 id=\"架构说明\"><a href=\"#架构说明\" class=\"headerlink\" title=\"架构说明:\"></a>架构说明:</h2><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboappmpdj30ci08cdho.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><p><a href=\"https://dubbo.apache.org/zh-cn/docs/user/preface/architecture.html\" target=\"_blank\" rel=\"noopener\">官网介绍地址</a></p>\n<h3 id=\"1-节点角色说明\"><a href=\"#1-节点角色说明\" class=\"headerlink\" title=\"1. 节点角色说明\"></a>1. 节点角色说明</h3><table>\n<thead>\n<tr>\n<th>节点</th>\n<th>角色说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Provider</td>\n<td>暴露服务的服务提供方</td>\n</tr>\n<tr>\n<td>Consumer</td>\n<td>调用远程服务的服务消费方</td>\n</tr>\n<tr>\n<td>Registry</td>\n<td>服务注册与发现的注册中心</td>\n</tr>\n<tr>\n<td>Monitor</td>\n<td>统计服务的调用次数和调用时间的监控中心</td>\n</tr>\n<tr>\n<td>Container</td>\n<td>暴露服务的服务提供方</td>\n</tr>\n<tr>\n<td>Consumer</td>\n<td>服务运行容器</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h3 id=\"2-调用关系说明\"><a href=\"#2-调用关系说明\" class=\"headerlink\" title=\"2. 调用关系说明\"></a>2. 调用关系说明</h3><pre><code>1. 服务容器负责启动，加载，运行服务提供者。\n2. 服务提供者在启动时，向注册中心注册自己提供的服务。\n3. 服务消费者在启动时，向注册中心订阅自己所需的服务。\n4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。\n5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。\n6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</code></pre><h2 id=\"管理控制台的编译安装：\"><a href=\"#管理控制台的编译安装：\" class=\"headerlink\" title=\"管理控制台的编译安装：\"></a>管理控制台的编译安装：</h2><ul>\n<li>新版管理控制台主要的作用：服务查询，服务治理(包括Dubbo2.7中新增的治理规则)以及服务测试、配置管理<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboh1ognhj30ti0b8aax.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure><h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤:\"></a>步骤:</h3><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 克隆项目到本地，并编译安装和启动（如果是Windows下，则在powershell进行）</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/apache/incubator-dubbo-ops.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切到项目根目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> incubator-dubbo-admin-develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译构建</span></span><br><span class=\"line\">mvn clean package</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改配置文件，指定注册中心地址</span></span><br><span class=\"line\">dubbo-admin-server/src/main/resources/application-production.properties</span><br><span class=\"line\"></span><br><span class=\"line\">　<span class=\"comment\"># 主要的配置有：</span></span><br><span class=\"line\">　　admin.config-center=zookeeper://127.0.0.1:2181</span><br><span class=\"line\">　　admin.registry.address=zookeeper://127.0.0.1:2181　</span><br><span class=\"line\">　　admin.metadata-report.address=zookeeper://127.0.0.1:2181</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> dubbo-distribution/target</span><br><span class=\"line\">java -jar dubbo-admin-0.1.jar</span><br><span class=\"line\"><span class=\"comment\"># 或以下命令启动服务</span></span><br><span class=\"line\">mvn --projects dubbo-admin-server spring-boot:run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动完成后，直接访问http://localhost:8080</span></span><br></pre></td></tr></tbody></table></figure></li>\n<li><a href=\"https://github.com/apache/dubbo-samples/tree/master/java\" target=\"_blank\" rel=\"noopener\">官方示例地址</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"关于dubbo：\"><a href=\"#关于dubbo：\" class=\"headerlink\" title=\"关于dubbo：\"></a><strong>关于dubbo</strong>：</h1><h2 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why:\"></a>why:</h2><ul>\n<li><p>为了解决,随着互联网发展,而日益增长的业务复杂度,网站应用规模不断扩大,且常规的垂直应用架构也无法应付,而提出的解决方案.</p><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnrp2sl3j30jg05u3z5.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure><p></p></li></ul>","more":"<h3 id=\"1-架构发展角度\"><a href=\"#1-架构发展角度\" class=\"headerlink\" title=\"1. 架构发展角度:\"></a>1. 架构发展角度:</h3></li>\n<li><p>单一应用架构</p>\n<ul>\n<li><p>网站流量很小时,将所有功能都部署在一个应用,节省部署节点和成本.此时,重点是简化增删改查工作量的数据访问框架ORM</p>\n<img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsa0v00j310w0cgn0z.jpg\" width=\"70%\">\n(图源https://www.jianshu.com/p/92ca0bfbd52f)\n<img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbnsx15sdj30su0yg46t.jpg\" width=\"60%\" height=\"10%\"></li>\n<li><p>单体架构相关资料:</p>\n<ul>\n<li><p>单体架构指应用代码都作为同一个进程,部署和运行在单一节点中.</p>\n<ul>\n<li><p>单一节点服务器中,整体中的所有的模块都组装到单一的内存镜像中,作为一个进程运行在单一节点上.</p>\n</li>\n<li><p>其中,如果将应用程序部署到多个服务器（如在水平扩展上下文中），它仍然是一个整体。</p>\n  <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo2vsnw7j30g80jqtiq.jpg\" width=\"50%\"></li>\n</ul>\n</li>\n<li><p><a href=\"https://herbertograca.com/2017/07/31/monolithic-architecture/\" target=\"_blank\" rel=\"noopener\">单体架构参考资料1</a> <a href=\"https://sunnycoding.cn/2018/07/28/monolithic-and-microservices-part1/\" target=\"_blank\" rel=\"noopener\">单体架构参考资料2</a> <a href=\"https://microservices.io/patterns/monolithic.html\" target=\"_blank\" rel=\"noopener\">单体架构参考资料3</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>垂直应用架构</p>\n<ul>\n<li>访问量逐渐增大,单一应用增加机器(通过在负载均衡器后端运行多个拷贝，实现多个扩展)带来的加速度越来越小,于是需要将应用拆成互不相干的几个应用来提升效率,此时的重点是用于加速前端页面开发的Web框架(MVC).</li>\n</ul>\n</li>\n<li><p>分布式服务架构</p>\n<ul>\n<li>为了应对增长的业务量,一台机器的性能已经无法满足,需要多台机器才能应对大规模的应用场景,同时也为了提高整个系统架构的可用性,消除单点故障,而垂直或水平拆分业务系统为多个应用.</li>\n<li>当垂直应用越来越多,应用之间需要交互,将核心业务抽取出来,作为独立的服务,逐渐形成稳定的服务中心,使前端应用能更快速的响应多变的市场需求.此时,重点是解决进程间通信问题和提高业务复用及整合的分布式服务框架RPC.</li>\n</ul>\n</li>\n<li><p>流动计算架构</p>\n<ul>\n<li>当服务越来越多,容量的评估,小服务资源的浪费等问题逐渐显现,此时需要增加一个调度中心基于访问实时管理集群容量,提高集群利用率.此时,重点是提高机器利用率的资源调度和治理中心SOA.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-要解决的问题\"><a href=\"#2-要解决的问题\" class=\"headerlink\" title=\"2. 要解决的问题:\"></a>2. 要解决的问题:</h3><ul>\n<li>在大规模服务化之前，应用可能只是通过 RMI 或 Hessian 等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过 F5 等硬件进行负载均衡。当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大。<ul>\n<li>需要服务调用方能自动感知到服务提供方的地址,而对服务提供方进行横向扩展的时候,服务调用方能自动感知到</li>\n<li>因此需要一个服务注册中心，动态地注册和发现服务, 通过消费方获取服务提供方地址列表,实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。</li>\n</ul>\n</li>\n<li>解决清晰描述错综复杂的服务依赖关系的问题</li>\n<li>服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？ 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，记录此时的访问量，再以此访问量乘以机器数反推总容量。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdbo9udlymj30mk0cq7cq.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"what\"><a href=\"#what\" class=\"headerlink\" title=\"what:\"></a>what:</h2><ul>\n<li>一个远程服务调用的分布式框架，调用协议通常包含传输协议和序列化协议。</li>\n<li>Dubbo本身支持多种远程调用方式，例如Dubbo RPC（二进制序列化 + tcp协议）、http invoker（二进制序列化 + http协议）、hessian（二进制序列化 + http协议）、WebServices （文本序列化 + http协议）等。</li>\n</ul>\n<h2 id=\"架构说明\"><a href=\"#架构说明\" class=\"headerlink\" title=\"架构说明:\"></a>架构说明:</h2><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboappmpdj30ci08cdho.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><p><a href=\"https://dubbo.apache.org/zh-cn/docs/user/preface/architecture.html\" target=\"_blank\" rel=\"noopener\">官网介绍地址</a></p>\n<h3 id=\"1-节点角色说明\"><a href=\"#1-节点角色说明\" class=\"headerlink\" title=\"1. 节点角色说明\"></a>1. 节点角色说明</h3><table>\n<thead>\n<tr>\n<th>节点</th>\n<th>角色说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Provider</td>\n<td>暴露服务的服务提供方</td>\n</tr>\n<tr>\n<td>Consumer</td>\n<td>调用远程服务的服务消费方</td>\n</tr>\n<tr>\n<td>Registry</td>\n<td>服务注册与发现的注册中心</td>\n</tr>\n<tr>\n<td>Monitor</td>\n<td>统计服务的调用次数和调用时间的监控中心</td>\n</tr>\n<tr>\n<td>Container</td>\n<td>暴露服务的服务提供方</td>\n</tr>\n<tr>\n<td>Consumer</td>\n<td>服务运行容器</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h3 id=\"2-调用关系说明\"><a href=\"#2-调用关系说明\" class=\"headerlink\" title=\"2. 调用关系说明\"></a>2. 调用关系说明</h3><pre><code>1. 服务容器负责启动，加载，运行服务提供者。\n2. 服务提供者在启动时，向注册中心注册自己提供的服务。\n3. 服务消费者在启动时，向注册中心订阅自己所需的服务。\n4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。\n5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。\n6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</code></pre><h2 id=\"管理控制台的编译安装：\"><a href=\"#管理控制台的编译安装：\" class=\"headerlink\" title=\"管理控制台的编译安装：\"></a>管理控制台的编译安装：</h2><ul>\n<li>新版管理控制台主要的作用：服务查询，服务治理(包括Dubbo2.7中新增的治理规则)以及服务测试、配置管理<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/00831rSTgy1gdboh1ognhj30ti0b8aax.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure><h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤:\"></a>步骤:</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 克隆项目到本地，并编译安装和启动（如果是Windows下，则在powershell进行）</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/apache/incubator-dubbo-ops.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切到项目根目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> incubator-dubbo-admin-develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译构建</span></span><br><span class=\"line\">mvn clean package</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改配置文件，指定注册中心地址</span></span><br><span class=\"line\">dubbo-admin-server/src/main/resources/application-production.properties</span><br><span class=\"line\"></span><br><span class=\"line\">　<span class=\"comment\"># 主要的配置有：</span></span><br><span class=\"line\">　　admin.config-center=zookeeper://127.0.0.1:2181</span><br><span class=\"line\">　　admin.registry.address=zookeeper://127.0.0.1:2181　</span><br><span class=\"line\">　　admin.metadata-report.address=zookeeper://127.0.0.1:2181</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> dubbo-distribution/target</span><br><span class=\"line\">java -jar dubbo-admin-0.1.jar</span><br><span class=\"line\"><span class=\"comment\"># 或以下命令启动服务</span></span><br><span class=\"line\">mvn --projects dubbo-admin-server spring-boot:run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动完成后，直接访问http://localhost:8080</span></span><br></pre></td></tr></table></figure></li>\n<li><a href=\"https://github.com/apache/dubbo-samples/tree/master/java\" target=\"_blank\" rel=\"noopener\">官方示例地址</a></li>\n</ul>"},{"title":"jmeter分布式压测及问题记录","abbrlink":"270d5148","date":"2020-04-12T12:22:03.000Z","_content":"## 问题描述:\n* 需要使用jmeter模拟大并发的情况时，单台压测机不能满足需求，可进行分布式压测。\n* 简单来说就是，多台机器同时安装jmeter，选择一台机器作为调度机，其他作为压力机。进行相应的配置后，就可以用调度机操控压力机发起请求。\n<!-- more -->\n\n## 如何配置（以Windows为例）：\n* 1.压力机：\n    * 1）执行当前压力机下jmeter安装包bin目录下的jmeter-server的批处理文件，此时该机器上启动一个java进程，并随机分配端口，监听来自调度机的请求。\n    * 但是这里我们需要配置成固定端口方式，否则调度机远程启动压力机时，会报错。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr9ci02nnj307z043dfr.jpg)\n    * 配置固定端口：打开bin目录下的jmeter.properties文件，更改server_port、server.rmi.localport的端口为要配置的端口。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfakhypej30lx0d5gms.jpg)\n* 2.调度机：\n    * 打开jmeter安装包bin目录下的jmeter.properties文件，更改remote_hosts为，压力机ip及执行jmeter-server后启动的端口。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfazm678j30g708y3z2.jpg)\n* 开始测试：\n    * 1.调度机正常配置好要测试的地址、参数、监听器等后，选择远程启动，就可以用刚刚配置好的压力机，进行压测了。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbhswnnj30ju09m0tp.jpg)\n\n## 补充Linux上的配置：\n* 1、启动slave server 命令：jmeter-server -Djava.rmi.sver.hostname=192.168.0.64\n\n## 遇到的问题及解决：\n### 问题一：\n* jmeter4.0，启动slave报错 “java.io.FileNotFoundException: rmi_keystore.jks (没有那个文件或目录)”\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbvioh4j30j002p0su.jpg)\n* 解决：\n    * 方法一：slave的jmeter.properties中，设置“server.rmi.ssl.disable=true”\n        * 原因：jmeter4.0以上的版本，默认启用RMI连接的安全通信，需要创建密钥库。所以将SSL禁用即可。\n    * 方法二：手动生成秘钥和证书。执行create-rmi-keystore.bat（Windows适用）或create-rmi-keystore.sh（Linux适用）\n\n### 问题二：\n * 调度机远程调用slave时，连接超时。查看slave上的jmeter-server.log，发现是与调度机的虚拟机网卡连接超时。\n    * 解决：在调度机的jmeter.bat中修改配置指定客户端的网卡ip.\n    * 增加配置项：set rmi_host=-Djava.rmi.server.hostname=xxx.xxx.xxx.xxx\n    * 修改配置项：set ARGS=%DUMP% %HEAP% %NEW% %SURVIVOR% %TENURING% %PERM% %CLASS_UNLOAD% %DDRAW% %rmi_host%\n\n\n## 注意事项：\n1、master、slave的时间要同步，否则tps结果误差较大。\n\n* 同步时间的命令：\n```python\n# Windows下：\nw32tm /config /manualpeerlist:\"time.windows.com\" /syncfromflags:manu\nal /reliable:yes /update\n\n# Linux下：\nntpdate time.windows.com\n```\n<a href=\"http://www.fblinux.com/?p=339\">参考资料1</a>\n<a href=\"https://www.cnblogs.com/linbo3168/p/6042255.html\">参考资料2</a>\n<a href=\"https://jmeter.apache.org/usermanual/jmeter_distributed_testing_step_by_step.html\">参考资料3</a>\n<a href=\"https://stackoverflow.com/questions/50113061/jmeter-4-0-error-starting-remote-server?rq=1\">参考资料4</a>\n<a href=\"https://www.cnblogs.com/suntingme/p/5995721.html\">参考资料5</a>\n<a href=\"https://testerhome.com/topics/12474\">参考资料6</a>\n<a href=\"https://blog.csdn.net/dev666/article/details/79776450\">参考资料7</a>\n<a href=\"https://blog.51cto.com/ydhome/1862841?source=drt\">参考资料8</a>\n","source":"_posts/jmeter分布式压测及问题记录.md","raw":"---\ntitle: jmeter分布式压测及问题记录\ntags: \n- 测试 \n- 性能测试\nabbrlink: 270d5148\ndate: 2020-04-12 20:22:03\n---\n## 问题描述:\n* 需要使用jmeter模拟大并发的情况时，单台压测机不能满足需求，可进行分布式压测。\n* 简单来说就是，多台机器同时安装jmeter，选择一台机器作为调度机，其他作为压力机。进行相应的配置后，就可以用调度机操控压力机发起请求。\n<!-- more -->\n\n## 如何配置（以Windows为例）：\n* 1.压力机：\n    * 1）执行当前压力机下jmeter安装包bin目录下的jmeter-server的批处理文件，此时该机器上启动一个java进程，并随机分配端口，监听来自调度机的请求。\n    * 但是这里我们需要配置成固定端口方式，否则调度机远程启动压力机时，会报错。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr9ci02nnj307z043dfr.jpg)\n    * 配置固定端口：打开bin目录下的jmeter.properties文件，更改server_port、server.rmi.localport的端口为要配置的端口。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfakhypej30lx0d5gms.jpg)\n* 2.调度机：\n    * 打开jmeter安装包bin目录下的jmeter.properties文件，更改remote_hosts为，压力机ip及执行jmeter-server后启动的端口。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfazm678j30g708y3z2.jpg)\n* 开始测试：\n    * 1.调度机正常配置好要测试的地址、参数、监听器等后，选择远程启动，就可以用刚刚配置好的压力机，进行压测了。\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbhswnnj30ju09m0tp.jpg)\n\n## 补充Linux上的配置：\n* 1、启动slave server 命令：jmeter-server -Djava.rmi.sver.hostname=192.168.0.64\n\n## 遇到的问题及解决：\n### 问题一：\n* jmeter4.0，启动slave报错 “java.io.FileNotFoundException: rmi_keystore.jks (没有那个文件或目录)”\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbvioh4j30j002p0su.jpg)\n* 解决：\n    * 方法一：slave的jmeter.properties中，设置“server.rmi.ssl.disable=true”\n        * 原因：jmeter4.0以上的版本，默认启用RMI连接的安全通信，需要创建密钥库。所以将SSL禁用即可。\n    * 方法二：手动生成秘钥和证书。执行create-rmi-keystore.bat（Windows适用）或create-rmi-keystore.sh（Linux适用）\n\n### 问题二：\n * 调度机远程调用slave时，连接超时。查看slave上的jmeter-server.log，发现是与调度机的虚拟机网卡连接超时。\n    * 解决：在调度机的jmeter.bat中修改配置指定客户端的网卡ip.\n    * 增加配置项：set rmi_host=-Djava.rmi.server.hostname=xxx.xxx.xxx.xxx\n    * 修改配置项：set ARGS=%DUMP% %HEAP% %NEW% %SURVIVOR% %TENURING% %PERM% %CLASS_UNLOAD% %DDRAW% %rmi_host%\n\n\n## 注意事项：\n1、master、slave的时间要同步，否则tps结果误差较大。\n\n* 同步时间的命令：\n```python\n# Windows下：\nw32tm /config /manualpeerlist:\"time.windows.com\" /syncfromflags:manu\nal /reliable:yes /update\n\n# Linux下：\nntpdate time.windows.com\n```\n<a href=\"http://www.fblinux.com/?p=339\">参考资料1</a>\n<a href=\"https://www.cnblogs.com/linbo3168/p/6042255.html\">参考资料2</a>\n<a href=\"https://jmeter.apache.org/usermanual/jmeter_distributed_testing_step_by_step.html\">参考资料3</a>\n<a href=\"https://stackoverflow.com/questions/50113061/jmeter-4-0-error-starting-remote-server?rq=1\">参考资料4</a>\n<a href=\"https://www.cnblogs.com/suntingme/p/5995721.html\">参考资料5</a>\n<a href=\"https://testerhome.com/topics/12474\">参考资料6</a>\n<a href=\"https://blog.csdn.net/dev666/article/details/79776450\">参考资料7</a>\n<a href=\"https://blog.51cto.com/ydhome/1862841?source=drt\">参考资料8</a>\n","slug":"jmeter分布式压测及问题记录","published":1,"updated":"2021-02-04T02:38:05.400Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai122000aunra2nr8c8rh","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述:\"></a>问题描述:</h2><ul>\n<li>需要使用jmeter模拟大并发的情况时，单台压测机不能满足需求，可进行分布式压测。</li>\n<li>简单来说就是，多台机器同时安装jmeter，选择一台机器作为调度机，其他作为压力机。进行相应的配置后，就可以用调度机操控压力机发起请求。<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"如何配置（以Windows为例）：\"><a href=\"#如何配置（以Windows为例）：\" class=\"headerlink\" title=\"如何配置（以Windows为例）：\"></a>如何配置（以Windows为例）：</h2><ul>\n<li>1.压力机：<ul>\n<li>1）执行当前压力机下jmeter安装包bin目录下的jmeter-server的批处理文件，此时该机器上启动一个java进程，并随机分配端口，监听来自调度机的请求。</li>\n<li>但是这里我们需要配置成固定端口方式，否则调度机远程启动压力机时，会报错。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr9ci02nnj307z043dfr.jpg\" alt=\"\"></li>\n<li>配置固定端口：打开bin目录下的jmeter.properties文件，更改server_port、server.rmi.localport的端口为要配置的端口。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfakhypej30lx0d5gms.jpg\" alt=\"\"></li>\n</ul>\n</li>\n<li>2.调度机：<ul>\n<li>打开jmeter安装包bin目录下的jmeter.properties文件，更改remote_hosts为，压力机ip及执行jmeter-server后启动的端口。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfazm678j30g708y3z2.jpg\" alt=\"\"></li>\n</ul>\n</li>\n<li>开始测试：<ul>\n<li>1.调度机正常配置好要测试的地址、参数、监听器等后，选择远程启动，就可以用刚刚配置好的压力机，进行压测了。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbhswnnj30ju09m0tp.jpg\" alt=\"\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"补充Linux上的配置：\"><a href=\"#补充Linux上的配置：\" class=\"headerlink\" title=\"补充Linux上的配置：\"></a>补充Linux上的配置：</h2><ul>\n<li>1、启动slave server 命令：jmeter-server -Djava.rmi.sver.hostname=192.168.0.64</li>\n</ul>\n<h2 id=\"遇到的问题及解决：\"><a href=\"#遇到的问题及解决：\" class=\"headerlink\" title=\"遇到的问题及解决：\"></a>遇到的问题及解决：</h2><h3 id=\"问题一：\"><a href=\"#问题一：\" class=\"headerlink\" title=\"问题一：\"></a>问题一：</h3><ul>\n<li>jmeter4.0，启动slave报错 “java.io.FileNotFoundException: rmi_keystore.jks (没有那个文件或目录)”<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbvioh4j30j002p0su.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>解决：<ul>\n<li>方法一：slave的jmeter.properties中，设置“server.rmi.ssl.disable=true”<ul>\n<li>原因：jmeter4.0以上的版本，默认启用RMI连接的安全通信，需要创建密钥库。所以将SSL禁用即可。</li>\n</ul>\n</li>\n<li>方法二：手动生成秘钥和证书。执行create-rmi-keystore.bat（Windows适用）或create-rmi-keystore.sh（Linux适用）</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"问题二：\"><a href=\"#问题二：\" class=\"headerlink\" title=\"问题二：\"></a>问题二：</h3><ul>\n<li>调度机远程调用slave时，连接超时。查看slave上的jmeter-server.log，发现是与调度机的虚拟机网卡连接超时。<ul>\n<li>解决：在调度机的jmeter.bat中修改配置指定客户端的网卡ip.</li>\n<li>增加配置项：set rmi_host=-Djava.rmi.server.hostname=xxx.xxx.xxx.xxx</li>\n<li>修改配置项：set ARGS=%DUMP% %HEAP% %NEW% %SURVIVOR% %TENURING% %PERM% %CLASS_UNLOAD% %DDRAW% %rmi_host%</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"注意事项：\"><a href=\"#注意事项：\" class=\"headerlink\" title=\"注意事项：\"></a>注意事项：</h2><p>1、master、slave的时间要同步，否则tps结果误差较大。</p>\n<ul>\n<li>同步时间的命令：<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows下：</span></span><br><span class=\"line\">w32tm /config /manualpeerlist:<span class=\"string\">\"time.windows.com\"</span> /syncfromflags:manu</span><br><span class=\"line\">al /reliable:yes /update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux下：</span></span><br><span class=\"line\">ntpdate time.windows.com</span><br></pre></td></tr></tbody></table></figure>\n<a href=\"http://www.fblinux.com/?p=339\" target=\"_blank\" rel=\"noopener\">参考资料1</a><br><a href=\"https://www.cnblogs.com/linbo3168/p/6042255.html\" target=\"_blank\" rel=\"noopener\">参考资料2</a><br><a href=\"https://jmeter.apache.org/usermanual/jmeter_distributed_testing_step_by_step.html\" target=\"_blank\" rel=\"noopener\">参考资料3</a><br><a href=\"https://stackoverflow.com/questions/50113061/jmeter-4-0-error-starting-remote-server?rq=1\" target=\"_blank\" rel=\"noopener\">参考资料4</a><br><a href=\"https://www.cnblogs.com/suntingme/p/5995721.html\" target=\"_blank\" rel=\"noopener\">参考资料5</a><br><a href=\"https://testerhome.com/topics/12474\" target=\"_blank\" rel=\"noopener\">参考资料6</a><br><a href=\"https://blog.csdn.net/dev666/article/details/79776450\" target=\"_blank\" rel=\"noopener\">参考资料7</a><br><a href=\"https://blog.51cto.com/ydhome/1862841?source=drt\" target=\"_blank\" rel=\"noopener\">参考资料8</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述:\"></a>问题描述:</h2><ul>\n<li>需要使用jmeter模拟大并发的情况时，单台压测机不能满足需求，可进行分布式压测。</li>\n<li>简单来说就是，多台机器同时安装jmeter，选择一台机器作为调度机，其他作为压力机。进行相应的配置后，就可以用调度机操控压力机发起请求。</li></ul>","more":"</li>\n</ul>\n<h2 id=\"如何配置（以Windows为例）：\"><a href=\"#如何配置（以Windows为例）：\" class=\"headerlink\" title=\"如何配置（以Windows为例）：\"></a>如何配置（以Windows为例）：</h2><ul>\n<li>1.压力机：<ul>\n<li>1）执行当前压力机下jmeter安装包bin目录下的jmeter-server的批处理文件，此时该机器上启动一个java进程，并随机分配端口，监听来自调度机的请求。</li>\n<li>但是这里我们需要配置成固定端口方式，否则调度机远程启动压力机时，会报错。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr9ci02nnj307z043dfr.jpg\" alt=\"\"></li>\n<li>配置固定端口：打开bin目录下的jmeter.properties文件，更改server_port、server.rmi.localport的端口为要配置的端口。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfakhypej30lx0d5gms.jpg\" alt=\"\"></li>\n</ul>\n</li>\n<li>2.调度机：<ul>\n<li>打开jmeter安装包bin目录下的jmeter.properties文件，更改remote_hosts为，压力机ip及执行jmeter-server后启动的端口。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfazm678j30g708y3z2.jpg\" alt=\"\"></li>\n</ul>\n</li>\n<li>开始测试：<ul>\n<li>1.调度机正常配置好要测试的地址、参数、监听器等后，选择远程启动，就可以用刚刚配置好的压力机，进行压测了。<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbhswnnj30ju09m0tp.jpg\" alt=\"\"></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"补充Linux上的配置：\"><a href=\"#补充Linux上的配置：\" class=\"headerlink\" title=\"补充Linux上的配置：\"></a>补充Linux上的配置：</h2><ul>\n<li>1、启动slave server 命令：jmeter-server -Djava.rmi.sver.hostname=192.168.0.64</li>\n</ul>\n<h2 id=\"遇到的问题及解决：\"><a href=\"#遇到的问题及解决：\" class=\"headerlink\" title=\"遇到的问题及解决：\"></a>遇到的问题及解决：</h2><h3 id=\"问题一：\"><a href=\"#问题一：\" class=\"headerlink\" title=\"问题一：\"></a>问题一：</h3><ul>\n<li>jmeter4.0，启动slave报错 “java.io.FileNotFoundException: rmi_keystore.jks (没有那个文件或目录)”<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdrfbvioh4j30j002p0su.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>解决：<ul>\n<li>方法一：slave的jmeter.properties中，设置“server.rmi.ssl.disable=true”<ul>\n<li>原因：jmeter4.0以上的版本，默认启用RMI连接的安全通信，需要创建密钥库。所以将SSL禁用即可。</li>\n</ul>\n</li>\n<li>方法二：手动生成秘钥和证书。执行create-rmi-keystore.bat（Windows适用）或create-rmi-keystore.sh（Linux适用）</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"问题二：\"><a href=\"#问题二：\" class=\"headerlink\" title=\"问题二：\"></a>问题二：</h3><ul>\n<li>调度机远程调用slave时，连接超时。查看slave上的jmeter-server.log，发现是与调度机的虚拟机网卡连接超时。<ul>\n<li>解决：在调度机的jmeter.bat中修改配置指定客户端的网卡ip.</li>\n<li>增加配置项：set rmi_host=-Djava.rmi.server.hostname=xxx.xxx.xxx.xxx</li>\n<li>修改配置项：set ARGS=%DUMP% %HEAP% %NEW% %SURVIVOR% %TENURING% %PERM% %CLASS_UNLOAD% %DDRAW% %rmi_host%</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"注意事项：\"><a href=\"#注意事项：\" class=\"headerlink\" title=\"注意事项：\"></a>注意事项：</h2><p>1、master、slave的时间要同步，否则tps结果误差较大。</p>\n<ul>\n<li>同步时间的命令：<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows下：</span></span><br><span class=\"line\">w32tm /config /manualpeerlist:<span class=\"string\">\"time.windows.com\"</span> /syncfromflags:manu</span><br><span class=\"line\">al /reliable:yes /update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux下：</span></span><br><span class=\"line\">ntpdate time.windows.com</span><br></pre></td></tr></table></figure>\n<a href=\"http://www.fblinux.com/?p=339\" target=\"_blank\" rel=\"noopener\">参考资料1</a><br><a href=\"https://www.cnblogs.com/linbo3168/p/6042255.html\" target=\"_blank\" rel=\"noopener\">参考资料2</a><br><a href=\"https://jmeter.apache.org/usermanual/jmeter_distributed_testing_step_by_step.html\" target=\"_blank\" rel=\"noopener\">参考资料3</a><br><a href=\"https://stackoverflow.com/questions/50113061/jmeter-4-0-error-starting-remote-server?rq=1\" target=\"_blank\" rel=\"noopener\">参考资料4</a><br><a href=\"https://www.cnblogs.com/suntingme/p/5995721.html\" target=\"_blank\" rel=\"noopener\">参考资料5</a><br><a href=\"https://testerhome.com/topics/12474\" target=\"_blank\" rel=\"noopener\">参考资料6</a><br><a href=\"https://blog.csdn.net/dev666/article/details/79776450\" target=\"_blank\" rel=\"noopener\">参考资料7</a><br><a href=\"https://blog.51cto.com/ydhome/1862841?source=drt\" target=\"_blank\" rel=\"noopener\">参考资料8</a></li>\n</ul>"},{"title":"socket 模拟收发HTTP包","abbrlink":"6178cbe6","date":"2020-12-29T10:30:15.000Z","_content":"## 网络中数据发送的过程\n\n1. 应用层中, 服务端创建server_socket, 并通过bind的系统调用绑定端口, \n   再调用listen使server_socket变成被动socket, 然后调用accept在对应端口上阻塞并监听客户端的连接,\n2. 客户端也创建自己的client_socket, 通过connect系统调用, 发送syn包给服务端的server_socket, 数据先会到tcp发送缓冲中,\n   如果已经建立好连接, 则客户端的client_socket调用系统调用的write方法, 把数据写到tcp发送缓冲中, \n<!-- more -->\n3. 然后数据开始进入tcp/ip协议栈, 首先是tcp层组装数据包, 并得到引用这些数据的数据包描述符sk_buff, \n4. 然后sk_buff进入IP层, \n5. 再进入发送队列, \n6. 再进入网卡的环形缓冲区, \n7. 然后网卡驱动调用DMA引擎, 把数据从网卡通过网线发送出去\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm530l9s8uj313k0pqkge.jpg)\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm4zdvk5cnj30wo0gq7ha.jpg)\n\n## 网络中数据接收的过程\n1. 数据到达服务端的网络接口, 先是检查数据包中的目的Mac地址跟网卡的Mac地址是否匹配, \n2. 然后数据达到网卡队列, 再进入网卡的环形缓冲区, 并封装成sk_buff, \n3. 网卡调用DMA引擎发起中断, 通知CPU把数据从环形缓冲区取走, \n4. 然后这些数据就以sk_buff的形式进入IP层, tcp层, \n5. 在tcp层如果这个数据包是请求连接的syn包, 那么会先放到tcp的半连接队列, 等收到ack包的时候, 才放到tcp的全连接队列, \n6. 然后进入tcp接收缓冲, 再到达应用层\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm5jf4oadbj30pq0u614l.jpg)\n## python版服务端的简单实现\n```python\n# coding=utf-8\nimport socket\nimport threading\n\nGREAT = \"\"\"great\"\"\"\nCONTENT_LENGTH = \"\"\"Content-Length: 5\"\"\"\nSTATUS_CODE = \"200 OK\"\nSAMEORIGIN = \"\"\"X-Frame-Options: SAMEORIGIN\"\"\"\nCHARSET = \"\"\"Content-Type: text/plain; charset=utf-8\"\"\"\nBICRLF = \"\\r\\n\\r\\n\"\nCRLF = \"\\r\\n\"\n\n\ndef main():\n    # 创建服务端的套接字\n    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n\n    # 绑定端口\n    server_socket.bind((\"\", 3344))\n    # 服务端套接字在端口3344监听\n    # backlog 为等待(半)连接队列中的最大连接数\n    server_socket.listen(128)\n    while True:\n        # 接收客户端连接，并得到一个新的socket与客户端进行通信\n        client_socket, addr = server_socket.accept()\n        thread_1 = threading.Thread(target=send_datas, args=(client_socket,))\n        thread_1.start()\n\n\ndef send_datas(client_socket):\n    “”“\n    接收客户端连接后, 发送数据\n    ”“”\n    # 开启keep alive, 维持长连接\n    client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, 1)\n\n    # 如果一直没有收到数据, 则每隔8秒给客户端发送keep alive的tcp链路检测包\n    # define TCP_KEEPALIVE    0x10    /* idle time used when SO_KEEPALIVE is enabled */\n    # https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/netinet/tcp.h\n    client_socket.setsockopt(socket.IPPROTO_TCP, 0x10, 8)\n    # 接收数据，返回http格式的响应\n    while True:\n        # 接收数据的长度\n        len_recv = 6148\n        request = client_socket.recv(len_recv)\n        # recv接收到fin包之后，就马上响应ack了，而服务端的fin包需要close之后才会发\n        print(\"re   \" + request.decode(\"utf-8\"))\n        # 如果客户端那边调用close, 服务端接收到的数据长度为0, \n        if request:\n            content = input(\"what do u want to response?:: \")\n            # 返回http格式的数据，只要格式符合http的格式，那么浏览器就会认为是一个http响应，从而能解析\n            response = \"HTTP/1.1 {}{}{}{}{}\". \\\n                format(STATUS_CODE+CRLF,CHARSET+CRLF,SAMEORIGIN+CRLF,CONTENT_LENGTH+CRLF+CRLF,content)\n            # 发送数据，且编码跟服务器设置的一致\n            client_socket.send(response.encode(\"utf-8\"))\n\n        else:\n            # 没加内层while循环前， 没进入这里是因为关闭浏览器的时候，没有再次接收客户端发送来的数据\n            print(\"没数据了\")\n            # 客户端调用close后，服务端马上响应一个ack，且读通道也关闭\n            # 而服务端还有写通道未关闭，写通道也关闭后，就会给客户端发fin包\n            # 或者直接close也可以, 区别在于close不会马上释放连接\n            client_socket.shutdown(socket.SHUT_WR)\n            # client_socket.close()\n            break\n\n\nif __name__ == \"__main__\":\n    main_thread = threading.Thread(target=main)\n    main_thread.start()\n```\n\n## 客户端的实现\n```python\n\nimport socket\nimport threading\n\nCOOKUE = '''Cookie: Idea-38dabdcb=1a3e1891-7313-4a6c-8141-c158de42e97'''\nLANGUAGE = '''Accept-Language: zh-CN,zh;q=0.8'''\nUSER_AGENT = '''User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36'''\nACCEPT = '''Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'''\nCACHE_CONTROL_MAX_AGE = '''Cache-Control: max-age=0'''\nCONNECTION_KEEP_ALIVE = '''Connection: keep-alive'''\nHOST = '''Host: 192.168.0.101:8000'''\nPATH = '''/blog/'''\n# PATH = '''/blog/?date=yyy'''\nBICRLF = \"\\r\\n\\r\\n\"\nCRLF = \"\\r\\n\"\nCONTENT_LEN = \"Content-Length: \"\nsend_flag = True\n\ndef send_data(tcp_socket):\n    while send_flag:\n        len_msg = int(input(\"how many char do you wanna send? : \"))\n        # 等待输入，如果comm为close，客户端关闭连接\n        # content为要发送的内容，req_med为请求的方法，分别以空格分隔\n        comm, content, req_med = input(\"comm :\").split(\" \")\n        if req_med == \"p\":\n            req_med = \"POST\"\n        else:\n            req_med = \"GET\"\n        long_msg = content * len_msg  # .encode(\"utf-8\")\n        len_lmsg = str(len(long_msg))\n        # 要发送的数据\n        msg = (\"%s %s HTTP/1.1\" + CRLF + \"%s%s%s%s%s%s%s%s\") \\\n              % (req_med, PATH, HOST + CRLF + CONTENT_LEN + len_lmsg + CRLF, CONNECTION_KEEP_ALIVE + CRLF,\n                 CACHE_CONTROL_MAX_AGE + CRLF,\n                 ACCEPT + CRLF, USER_AGENT + CRLF, LANGUAGE + CRLF, COOKUE + BICRLF, long_msg)\n        msg = msg.encode(\"utf-8\")\n\n        if comm.find(\"close\") != -1:\n            tcp_socket.shutdown(socket.SHUT_RDWR)\n            # tcp_socket.close()\n        elif comm.find(\"pass\") != -1:\n            pass\n        elif send_flag == False:\n            return\n        else:\n            tcp_socket.send(msg)\n\n\ndef recv_data(tcp_socket=None, len_recv=None):\n    while True:\n        recv = tcp_socket.recv(len_recv)\n        if recv:\n            global send_flag\n            send_flag = True\n        else:\n            send_flag = False\n            tcp_socket.shutdown(socket.SHUT_WR)\n            return\n        print(recv)\n\n\ndef main():\n    while True:\n        # 创建socket, 该socket对应一个打开文件和一个文件描述符\n        # 入参1为指定协议族, 因为有的系统不一定有实现tcp/ip协议,\n        # 入参2为socket的类型, tcp就对应SOCK_STREAM, 因为建立连接后, 数据就像流一样在两端传输\n        tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        print(tcp_socket.fileno())\n\n        # 连接服务端\n        tcp_socket.connect((\"192.168.0.101\", 8000))\n        global send_flag\n        send_flag = True\n        # 接收数据的长度\n        len_recv = 6148\n        # 同步阻塞的recv操作， 改成用一个线程异步接收数据，实时检测服务端发来的fin包，收到就马上把send_flag改为false\n        thread = threading.Thread(target=recv_data, args=(tcp_socket, len_recv))\n        thread.start()\n        send_data(tcp_socket)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n## whireshark 抓包截图\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm4ysa57cpj31rg0igdpc.jpg)\n1. 如图, 客户端调用connect后, 发送请求与服务端建立连接的syn包, 包含一个客户端维护的序列号\n2. 服务端收到syn包后, 也回一个混合了syn和ack的数据包, 其中包含服务端维护的序列号, 而ack包是作为对客户端syn包的确认回应, 所以ack号则是客户端的序列号+1,\n3. 客户端收到服务端的syn+ack后, 再对该包确认回应而发送ack包, 此时序列号+1, ack号=服务端序列号+1,\n4. 三次握手后, 客户端和服务端之间建立一条流通道,\n5. 服务端的tcp接收缓冲区满了, 所以给客户端发送一个tcp window update的包,\n6. 然后客户端发送http协议格式的数据, \n7. 服务端接收到数据回一个ack的包,\n8. 由于距离tcp流通道的上一个数据包的时间已经满8秒了, 于是服务端给客户端发送keep-alive的tcp包, \n9. 客户端接收后马上回一个ack,\n10. 服务端继续发送http格式的响应,\n11. 客户端回ack\n...\n12. 最后, 客户端调用close后, 会给服务端发送fin包, 但由于上一个包是服务端发来的keep-alive ack包, 所以同时也会发送ack号为服务端发来的keep-alive ack包的序列号+1的ack,\n13. 服务端马上单独回一个ack, 发送fin包的前提是服务端也调用了close, 而close还需要关闭接收通道释放资源等, 耗时较长, 所以就先单独回一个ack,\n14. 服务端再发fin包, 而且为了防止客户端没收到前面的ack, 这个包里也包含一个ack,\n15. 最后客户度回一个ack, tcp连接通道完全断开\n\n","source":"_posts/python-socket-模拟收发HTTP请求.md","raw":"---\ntitle: socket 模拟收发HTTP包\ntags:\n  - 协议\n  - python\n  - socket\ncategories: 网络\nabbrlink: 6178cbe6\ndate: 2020-12-29 18:30:15\n---\n## 网络中数据发送的过程\n\n1. 应用层中, 服务端创建server_socket, 并通过bind的系统调用绑定端口, \n   再调用listen使server_socket变成被动socket, 然后调用accept在对应端口上阻塞并监听客户端的连接,\n2. 客户端也创建自己的client_socket, 通过connect系统调用, 发送syn包给服务端的server_socket, 数据先会到tcp发送缓冲中,\n   如果已经建立好连接, 则客户端的client_socket调用系统调用的write方法, 把数据写到tcp发送缓冲中, \n<!-- more -->\n3. 然后数据开始进入tcp/ip协议栈, 首先是tcp层组装数据包, 并得到引用这些数据的数据包描述符sk_buff, \n4. 然后sk_buff进入IP层, \n5. 再进入发送队列, \n6. 再进入网卡的环形缓冲区, \n7. 然后网卡驱动调用DMA引擎, 把数据从网卡通过网线发送出去\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm530l9s8uj313k0pqkge.jpg)\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm4zdvk5cnj30wo0gq7ha.jpg)\n\n## 网络中数据接收的过程\n1. 数据到达服务端的网络接口, 先是检查数据包中的目的Mac地址跟网卡的Mac地址是否匹配, \n2. 然后数据达到网卡队列, 再进入网卡的环形缓冲区, 并封装成sk_buff, \n3. 网卡调用DMA引擎发起中断, 通知CPU把数据从环形缓冲区取走, \n4. 然后这些数据就以sk_buff的形式进入IP层, tcp层, \n5. 在tcp层如果这个数据包是请求连接的syn包, 那么会先放到tcp的半连接队列, 等收到ack包的时候, 才放到tcp的全连接队列, \n6. 然后进入tcp接收缓冲, 再到达应用层\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm5jf4oadbj30pq0u614l.jpg)\n## python版服务端的简单实现\n```python\n# coding=utf-8\nimport socket\nimport threading\n\nGREAT = \"\"\"great\"\"\"\nCONTENT_LENGTH = \"\"\"Content-Length: 5\"\"\"\nSTATUS_CODE = \"200 OK\"\nSAMEORIGIN = \"\"\"X-Frame-Options: SAMEORIGIN\"\"\"\nCHARSET = \"\"\"Content-Type: text/plain; charset=utf-8\"\"\"\nBICRLF = \"\\r\\n\\r\\n\"\nCRLF = \"\\r\\n\"\n\n\ndef main():\n    # 创建服务端的套接字\n    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n\n    # 绑定端口\n    server_socket.bind((\"\", 3344))\n    # 服务端套接字在端口3344监听\n    # backlog 为等待(半)连接队列中的最大连接数\n    server_socket.listen(128)\n    while True:\n        # 接收客户端连接，并得到一个新的socket与客户端进行通信\n        client_socket, addr = server_socket.accept()\n        thread_1 = threading.Thread(target=send_datas, args=(client_socket,))\n        thread_1.start()\n\n\ndef send_datas(client_socket):\n    “”“\n    接收客户端连接后, 发送数据\n    ”“”\n    # 开启keep alive, 维持长连接\n    client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, 1)\n\n    # 如果一直没有收到数据, 则每隔8秒给客户端发送keep alive的tcp链路检测包\n    # define TCP_KEEPALIVE    0x10    /* idle time used when SO_KEEPALIVE is enabled */\n    # https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/netinet/tcp.h\n    client_socket.setsockopt(socket.IPPROTO_TCP, 0x10, 8)\n    # 接收数据，返回http格式的响应\n    while True:\n        # 接收数据的长度\n        len_recv = 6148\n        request = client_socket.recv(len_recv)\n        # recv接收到fin包之后，就马上响应ack了，而服务端的fin包需要close之后才会发\n        print(\"re   \" + request.decode(\"utf-8\"))\n        # 如果客户端那边调用close, 服务端接收到的数据长度为0, \n        if request:\n            content = input(\"what do u want to response?:: \")\n            # 返回http格式的数据，只要格式符合http的格式，那么浏览器就会认为是一个http响应，从而能解析\n            response = \"HTTP/1.1 {}{}{}{}{}\". \\\n                format(STATUS_CODE+CRLF,CHARSET+CRLF,SAMEORIGIN+CRLF,CONTENT_LENGTH+CRLF+CRLF,content)\n            # 发送数据，且编码跟服务器设置的一致\n            client_socket.send(response.encode(\"utf-8\"))\n\n        else:\n            # 没加内层while循环前， 没进入这里是因为关闭浏览器的时候，没有再次接收客户端发送来的数据\n            print(\"没数据了\")\n            # 客户端调用close后，服务端马上响应一个ack，且读通道也关闭\n            # 而服务端还有写通道未关闭，写通道也关闭后，就会给客户端发fin包\n            # 或者直接close也可以, 区别在于close不会马上释放连接\n            client_socket.shutdown(socket.SHUT_WR)\n            # client_socket.close()\n            break\n\n\nif __name__ == \"__main__\":\n    main_thread = threading.Thread(target=main)\n    main_thread.start()\n```\n\n## 客户端的实现\n```python\n\nimport socket\nimport threading\n\nCOOKUE = '''Cookie: Idea-38dabdcb=1a3e1891-7313-4a6c-8141-c158de42e97'''\nLANGUAGE = '''Accept-Language: zh-CN,zh;q=0.8'''\nUSER_AGENT = '''User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36'''\nACCEPT = '''Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'''\nCACHE_CONTROL_MAX_AGE = '''Cache-Control: max-age=0'''\nCONNECTION_KEEP_ALIVE = '''Connection: keep-alive'''\nHOST = '''Host: 192.168.0.101:8000'''\nPATH = '''/blog/'''\n# PATH = '''/blog/?date=yyy'''\nBICRLF = \"\\r\\n\\r\\n\"\nCRLF = \"\\r\\n\"\nCONTENT_LEN = \"Content-Length: \"\nsend_flag = True\n\ndef send_data(tcp_socket):\n    while send_flag:\n        len_msg = int(input(\"how many char do you wanna send? : \"))\n        # 等待输入，如果comm为close，客户端关闭连接\n        # content为要发送的内容，req_med为请求的方法，分别以空格分隔\n        comm, content, req_med = input(\"comm :\").split(\" \")\n        if req_med == \"p\":\n            req_med = \"POST\"\n        else:\n            req_med = \"GET\"\n        long_msg = content * len_msg  # .encode(\"utf-8\")\n        len_lmsg = str(len(long_msg))\n        # 要发送的数据\n        msg = (\"%s %s HTTP/1.1\" + CRLF + \"%s%s%s%s%s%s%s%s\") \\\n              % (req_med, PATH, HOST + CRLF + CONTENT_LEN + len_lmsg + CRLF, CONNECTION_KEEP_ALIVE + CRLF,\n                 CACHE_CONTROL_MAX_AGE + CRLF,\n                 ACCEPT + CRLF, USER_AGENT + CRLF, LANGUAGE + CRLF, COOKUE + BICRLF, long_msg)\n        msg = msg.encode(\"utf-8\")\n\n        if comm.find(\"close\") != -1:\n            tcp_socket.shutdown(socket.SHUT_RDWR)\n            # tcp_socket.close()\n        elif comm.find(\"pass\") != -1:\n            pass\n        elif send_flag == False:\n            return\n        else:\n            tcp_socket.send(msg)\n\n\ndef recv_data(tcp_socket=None, len_recv=None):\n    while True:\n        recv = tcp_socket.recv(len_recv)\n        if recv:\n            global send_flag\n            send_flag = True\n        else:\n            send_flag = False\n            tcp_socket.shutdown(socket.SHUT_WR)\n            return\n        print(recv)\n\n\ndef main():\n    while True:\n        # 创建socket, 该socket对应一个打开文件和一个文件描述符\n        # 入参1为指定协议族, 因为有的系统不一定有实现tcp/ip协议,\n        # 入参2为socket的类型, tcp就对应SOCK_STREAM, 因为建立连接后, 数据就像流一样在两端传输\n        tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        print(tcp_socket.fileno())\n\n        # 连接服务端\n        tcp_socket.connect((\"192.168.0.101\", 8000))\n        global send_flag\n        send_flag = True\n        # 接收数据的长度\n        len_recv = 6148\n        # 同步阻塞的recv操作， 改成用一个线程异步接收数据，实时检测服务端发来的fin包，收到就马上把send_flag改为false\n        thread = threading.Thread(target=recv_data, args=(tcp_socket, len_recv))\n        thread.start()\n        send_data(tcp_socket)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n## whireshark 抓包截图\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1gm4ysa57cpj31rg0igdpc.jpg)\n1. 如图, 客户端调用connect后, 发送请求与服务端建立连接的syn包, 包含一个客户端维护的序列号\n2. 服务端收到syn包后, 也回一个混合了syn和ack的数据包, 其中包含服务端维护的序列号, 而ack包是作为对客户端syn包的确认回应, 所以ack号则是客户端的序列号+1,\n3. 客户端收到服务端的syn+ack后, 再对该包确认回应而发送ack包, 此时序列号+1, ack号=服务端序列号+1,\n4. 三次握手后, 客户端和服务端之间建立一条流通道,\n5. 服务端的tcp接收缓冲区满了, 所以给客户端发送一个tcp window update的包,\n6. 然后客户端发送http协议格式的数据, \n7. 服务端接收到数据回一个ack的包,\n8. 由于距离tcp流通道的上一个数据包的时间已经满8秒了, 于是服务端给客户端发送keep-alive的tcp包, \n9. 客户端接收后马上回一个ack,\n10. 服务端继续发送http格式的响应,\n11. 客户端回ack\n...\n12. 最后, 客户端调用close后, 会给服务端发送fin包, 但由于上一个包是服务端发来的keep-alive ack包, 所以同时也会发送ack号为服务端发来的keep-alive ack包的序列号+1的ack,\n13. 服务端马上单独回一个ack, 发送fin包的前提是服务端也调用了close, 而close还需要关闭接收通道释放资源等, 耗时较长, 所以就先单独回一个ack,\n14. 服务端再发fin包, 而且为了防止客户端没收到前面的ack, 这个包里也包含一个ack,\n15. 最后客户度回一个ack, tcp连接通道完全断开\n\n","slug":"python-socket-模拟收发HTTP请求","published":1,"updated":"2021-02-04T02:38:05.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai124000dunra4uzdfljb","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"网络中数据发送的过程\"><a href=\"#网络中数据发送的过程\" class=\"headerlink\" title=\"网络中数据发送的过程\"></a>网络中数据发送的过程</h2><ol>\n<li>应用层中, 服务端创建server_socket, 并通过bind的系统调用绑定端口,<br>再调用listen使server_socket变成被动socket, 然后调用accept在对应端口上阻塞并监听客户端的连接,</li>\n<li>客户端也创建自己的client_socket, 通过connect系统调用, 发送syn包给服务端的server_socket, 数据先会到tcp发送缓冲中,<br>如果已经建立好连接, 则客户端的client_socket调用系统调用的write方法, 把数据写到tcp发送缓冲中, <a id=\"more\"></a></li>\n<li>然后数据开始进入tcp/ip协议栈, 首先是tcp层组装数据包, 并得到引用这些数据的数据包描述符sk_buff, </li>\n<li>然后sk_buff进入IP层, </li>\n<li>再进入发送队列, </li>\n<li>再进入网卡的环形缓冲区, </li>\n<li>然后网卡驱动调用DMA引擎, 把数据从网卡通过网线发送出去</li>\n</ol>\n<ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm530l9s8uj313k0pqkge.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm4zdvk5cnj30wo0gq7ha.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"网络中数据接收的过程\"><a href=\"#网络中数据接收的过程\" class=\"headerlink\" title=\"网络中数据接收的过程\"></a>网络中数据接收的过程</h2><ol>\n<li>数据到达服务端的网络接口, 先是检查数据包中的目的Mac地址跟网卡的Mac地址是否匹配, </li>\n<li>然后数据达到网卡队列, 再进入网卡的环形缓冲区, 并封装成sk_buff, </li>\n<li>网卡调用DMA引擎发起中断, 通知CPU把数据从环形缓冲区取走, </li>\n<li>然后这些数据就以sk_buff的形式进入IP层, tcp层, </li>\n<li>在tcp层如果这个数据包是请求连接的syn包, 那么会先放到tcp的半连接队列, 等收到ack包的时候, 才放到tcp的全连接队列, </li>\n<li>然后进入tcp接收缓冲, 再到达应用层</li>\n</ol>\n<ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm5jf4oadbj30pq0u614l.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<h2 id=\"python版服务端的简单实现\"><a href=\"#python版服务端的简单实现\" class=\"headerlink\" title=\"python版服务端的简单实现\"></a>python版服务端的简单实现</h2><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">GREAT = <span class=\"string\">\"\"\"great\"\"\"</span></span><br><span class=\"line\">CONTENT_LENGTH = <span class=\"string\">\"\"\"Content-Length: 5\"\"\"</span></span><br><span class=\"line\">STATUS_CODE = <span class=\"string\">\"200 OK\"</span></span><br><span class=\"line\">SAMEORIGIN = <span class=\"string\">\"\"\"X-Frame-Options: SAMEORIGIN\"\"\"</span></span><br><span class=\"line\">CHARSET = <span class=\"string\">\"\"\"Content-Type: text/plain; charset=utf-8\"\"\"</span></span><br><span class=\"line\">BICRLF = <span class=\"string\">\"\\r\\n\\r\\n\"</span></span><br><span class=\"line\">CRLF = <span class=\"string\">\"\\r\\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># 创建服务端的套接字</span></span><br><span class=\"line\">    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 绑定端口</span></span><br><span class=\"line\">    server_socket.bind((<span class=\"string\">\"\"</span>, <span class=\"number\">3344</span>))</span><br><span class=\"line\">    <span class=\"comment\"># 服务端套接字在端口3344监听</span></span><br><span class=\"line\">    <span class=\"comment\"># backlog 为等待(半)连接队列中的最大连接数</span></span><br><span class=\"line\">    server_socket.listen(<span class=\"number\">128</span>)</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 接收客户端连接，并得到一个新的socket与客户端进行通信</span></span><br><span class=\"line\">        client_socket, addr = server_socket.accept()</span><br><span class=\"line\">        thread_1 = threading.Thread(target=send_datas, args=(client_socket,))</span><br><span class=\"line\">        thread_1.start()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_datas</span><span class=\"params\">(client_socket)</span>:</span></span><br><span class=\"line\">    “”“</span><br><span class=\"line\">    接收客户端连接后, 发送数据</span><br><span class=\"line\">    ”“”</span><br><span class=\"line\">    <span class=\"comment\"># 开启keep alive, 维持长连接</span></span><br><span class=\"line\">    client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 如果一直没有收到数据, 则每隔8秒给客户端发送keep alive的tcp链路检测包</span></span><br><span class=\"line\">    <span class=\"comment\"># define TCP_KEEPALIVE    0x10    /* idle time used when SO_KEEPALIVE is enabled */</span></span><br><span class=\"line\">    <span class=\"comment\"># https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/netinet/tcp.h</span></span><br><span class=\"line\">    client_socket.setsockopt(socket.IPPROTO_TCP, <span class=\"number\">0x10</span>, <span class=\"number\">8</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 接收数据，返回http格式的响应</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 接收数据的长度</span></span><br><span class=\"line\">        len_recv = <span class=\"number\">6148</span></span><br><span class=\"line\">        request = client_socket.recv(len_recv)</span><br><span class=\"line\">        <span class=\"comment\"># recv接收到fin包之后，就马上响应ack了，而服务端的fin包需要close之后才会发</span></span><br><span class=\"line\">        print(<span class=\"string\">\"re   \"</span> + request.decode(<span class=\"string\">\"utf-8\"</span>))</span><br><span class=\"line\">        <span class=\"comment\"># 如果客户端那边调用close, 服务端接收到的数据长度为0, </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> request:</span><br><span class=\"line\">            content = input(<span class=\"string\">\"what do u want to response?:: \"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 返回http格式的数据，只要格式符合http的格式，那么浏览器就会认为是一个http响应，从而能解析</span></span><br><span class=\"line\">            response = <span class=\"string\">\"HTTP/1.1 {}{}{}{}{}\"</span>. \\</span><br><span class=\"line\">                format(STATUS_CODE+CRLF,CHARSET+CRLF,SAMEORIGIN+CRLF,CONTENT_LENGTH+CRLF+CRLF,content)</span><br><span class=\"line\">            <span class=\"comment\"># 发送数据，且编码跟服务器设置的一致</span></span><br><span class=\"line\">            client_socket.send(response.encode(<span class=\"string\">\"utf-8\"</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 没加内层while循环前， 没进入这里是因为关闭浏览器的时候，没有再次接收客户端发送来的数据</span></span><br><span class=\"line\">            print(<span class=\"string\">\"没数据了\"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 客户端调用close后，服务端马上响应一个ack，且读通道也关闭</span></span><br><span class=\"line\">            <span class=\"comment\"># 而服务端还有写通道未关闭，写通道也关闭后，就会给客户端发fin包</span></span><br><span class=\"line\">            <span class=\"comment\"># 或者直接close也可以, 区别在于close不会马上释放连接</span></span><br><span class=\"line\">            client_socket.shutdown(socket.SHUT_WR)</span><br><span class=\"line\">            <span class=\"comment\"># client_socket.close()</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    main_thread = threading.Thread(target=main)</span><br><span class=\"line\">    main_thread.start()</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<h2 id=\"客户端的实现\"><a href=\"#客户端的实现\" class=\"headerlink\" title=\"客户端的实现\"></a>客户端的实现</h2><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">COOKUE = <span class=\"string\">'''Cookie: Idea-38dabdcb=1a3e1891-7313-4a6c-8141-c158de42e97'''</span></span><br><span class=\"line\">LANGUAGE = <span class=\"string\">'''Accept-Language: zh-CN,zh;q=0.8'''</span></span><br><span class=\"line\">USER_AGENT = <span class=\"string\">'''User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36'''</span></span><br><span class=\"line\">ACCEPT = <span class=\"string\">'''Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'''</span></span><br><span class=\"line\">CACHE_CONTROL_MAX_AGE = <span class=\"string\">'''Cache-Control: max-age=0'''</span></span><br><span class=\"line\">CONNECTION_KEEP_ALIVE = <span class=\"string\">'''Connection: keep-alive'''</span></span><br><span class=\"line\">HOST = <span class=\"string\">'''Host: 192.168.0.101:8000'''</span></span><br><span class=\"line\">PATH = <span class=\"string\">'''/blog/'''</span></span><br><span class=\"line\"><span class=\"comment\"># PATH = '''/blog/?date=yyy'''</span></span><br><span class=\"line\">BICRLF = <span class=\"string\">\"\\r\\n\\r\\n\"</span></span><br><span class=\"line\">CRLF = <span class=\"string\">\"\\r\\n\"</span></span><br><span class=\"line\">CONTENT_LEN = <span class=\"string\">\"Content-Length: \"</span></span><br><span class=\"line\">send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_data</span><span class=\"params\">(tcp_socket)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> send_flag:</span><br><span class=\"line\">        len_msg = int(input(<span class=\"string\">\"how many char do you wanna send? : \"</span>))</span><br><span class=\"line\">        <span class=\"comment\"># 等待输入，如果comm为close，客户端关闭连接</span></span><br><span class=\"line\">        <span class=\"comment\"># content为要发送的内容，req_med为请求的方法，分别以空格分隔</span></span><br><span class=\"line\">        comm, content, req_med = input(<span class=\"string\">\"comm :\"</span>).split(<span class=\"string\">\" \"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> req_med == <span class=\"string\">\"p\"</span>:</span><br><span class=\"line\">            req_med = <span class=\"string\">\"POST\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            req_med = <span class=\"string\">\"GET\"</span></span><br><span class=\"line\">        long_msg = content * len_msg  <span class=\"comment\"># .encode(\"utf-8\")</span></span><br><span class=\"line\">        len_lmsg = str(len(long_msg))</span><br><span class=\"line\">        <span class=\"comment\"># 要发送的数据</span></span><br><span class=\"line\">        msg = (<span class=\"string\">\"%s %s HTTP/1.1\"</span> + CRLF + <span class=\"string\">\"%s%s%s%s%s%s%s%s\"</span>) \\</span><br><span class=\"line\">              % (req_med, PATH, HOST + CRLF + CONTENT_LEN + len_lmsg + CRLF, CONNECTION_KEEP_ALIVE + CRLF,</span><br><span class=\"line\">                 CACHE_CONTROL_MAX_AGE + CRLF,</span><br><span class=\"line\">                 ACCEPT + CRLF, USER_AGENT + CRLF, LANGUAGE + CRLF, COOKUE + BICRLF, long_msg)</span><br><span class=\"line\">        msg = msg.encode(<span class=\"string\">\"utf-8\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> comm.find(<span class=\"string\">\"close\"</span>) != <span class=\"number\">-1</span>:</span><br><span class=\"line\">            tcp_socket.shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">            <span class=\"comment\"># tcp_socket.close()</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> comm.find(<span class=\"string\">\"pass\"</span>) != <span class=\"number\">-1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> send_flag == <span class=\"literal\">False</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            tcp_socket.send(msg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">recv_data</span><span class=\"params\">(tcp_socket=None, len_recv=None)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        recv = tcp_socket.recv(len_recv)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> recv:</span><br><span class=\"line\">            <span class=\"keyword\">global</span> send_flag</span><br><span class=\"line\">            send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            send_flag = <span class=\"literal\">False</span></span><br><span class=\"line\">            tcp_socket.shutdown(socket.SHUT_WR)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        print(recv)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 创建socket, 该socket对应一个打开文件和一个文件描述符</span></span><br><span class=\"line\">        <span class=\"comment\"># 入参1为指定协议族, 因为有的系统不一定有实现tcp/ip协议,</span></span><br><span class=\"line\">        <span class=\"comment\"># 入参2为socket的类型, tcp就对应SOCK_STREAM, 因为建立连接后, 数据就像流一样在两端传输</span></span><br><span class=\"line\">        tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">        print(tcp_socket.fileno())</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 连接服务端</span></span><br><span class=\"line\">        tcp_socket.connect((<span class=\"string\">\"192.168.0.101\"</span>, <span class=\"number\">8000</span>))</span><br><span class=\"line\">        <span class=\"keyword\">global</span> send_flag</span><br><span class=\"line\">        send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 接收数据的长度</span></span><br><span class=\"line\">        len_recv = <span class=\"number\">6148</span></span><br><span class=\"line\">        <span class=\"comment\"># 同步阻塞的recv操作， 改成用一个线程异步接收数据，实时检测服务端发来的fin包，收到就马上把send_flag改为false</span></span><br><span class=\"line\">        thread = threading.Thread(target=recv_data, args=(tcp_socket, len_recv))</span><br><span class=\"line\">        thread.start()</span><br><span class=\"line\">        send_data(tcp_socket)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"whireshark-抓包截图\"><a href=\"#whireshark-抓包截图\" class=\"headerlink\" title=\"whireshark 抓包截图\"></a>whireshark 抓包截图</h2><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm4ysa57cpj31rg0igdpc.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n<ol>\n<li>如图, 客户端调用connect后, 发送请求与服务端建立连接的syn包, 包含一个客户端维护的序列号</li>\n<li>服务端收到syn包后, 也回一个混合了syn和ack的数据包, 其中包含服务端维护的序列号, 而ack包是作为对客户端syn包的确认回应, 所以ack号则是客户端的序列号+1,</li>\n<li>客户端收到服务端的syn+ack后, 再对该包确认回应而发送ack包, 此时序列号+1, ack号=服务端序列号+1,</li>\n<li>三次握手后, 客户端和服务端之间建立一条流通道,</li>\n<li>服务端的tcp接收缓冲区满了, 所以给客户端发送一个tcp window update的包,</li>\n<li>然后客户端发送http协议格式的数据, </li>\n<li>服务端接收到数据回一个ack的包,</li>\n<li>由于距离tcp流通道的上一个数据包的时间已经满8秒了, 于是服务端给客户端发送keep-alive的tcp包, </li>\n<li>客户端接收后马上回一个ack,</li>\n<li>服务端继续发送http格式的响应,</li>\n<li>客户端回ack<br>…</li>\n<li>最后, 客户端调用close后, 会给服务端发送fin包, 但由于上一个包是服务端发来的keep-alive ack包, 所以同时也会发送ack号为服务端发来的keep-alive ack包的序列号+1的ack,</li>\n<li>服务端马上单独回一个ack, 发送fin包的前提是服务端也调用了close, 而close还需要关闭接收通道释放资源等, 耗时较长, 所以就先单独回一个ack,</li>\n<li>服务端再发fin包, 而且为了防止客户端没收到前面的ack, 这个包里也包含一个ack,</li>\n<li>最后客户度回一个ack, tcp连接通道完全断开</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"网络中数据发送的过程\"><a href=\"#网络中数据发送的过程\" class=\"headerlink\" title=\"网络中数据发送的过程\"></a>网络中数据发送的过程</h2><ol>\n<li>应用层中, 服务端创建server_socket, 并通过bind的系统调用绑定端口,<br>再调用listen使server_socket变成被动socket, 然后调用accept在对应端口上阻塞并监听客户端的连接,</li>\n<li>客户端也创建自己的client_socket, 通过connect系统调用, 发送syn包给服务端的server_socket, 数据先会到tcp发送缓冲中,<br>如果已经建立好连接, 则客户端的client_socket调用系统调用的write方法, 把数据写到tcp发送缓冲中,</li></ol>","more":"</li>\n<li>然后数据开始进入tcp/ip协议栈, 首先是tcp层组装数据包, 并得到引用这些数据的数据包描述符sk_buff, </li>\n<li>然后sk_buff进入IP层, </li>\n<li>再进入发送队列, </li>\n<li>再进入网卡的环形缓冲区, </li>\n<li>然后网卡驱动调用DMA引擎, 把数据从网卡通过网线发送出去</li>\n</ol>\n<ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm530l9s8uj313k0pqkge.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm4zdvk5cnj30wo0gq7ha.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"网络中数据接收的过程\"><a href=\"#网络中数据接收的过程\" class=\"headerlink\" title=\"网络中数据接收的过程\"></a>网络中数据接收的过程</h2><ol>\n<li>数据到达服务端的网络接口, 先是检查数据包中的目的Mac地址跟网卡的Mac地址是否匹配, </li>\n<li>然后数据达到网卡队列, 再进入网卡的环形缓冲区, 并封装成sk_buff, </li>\n<li>网卡调用DMA引擎发起中断, 通知CPU把数据从环形缓冲区取走, </li>\n<li>然后这些数据就以sk_buff的形式进入IP层, tcp层, </li>\n<li>在tcp层如果这个数据包是请求连接的syn包, 那么会先放到tcp的半连接队列, 等收到ack包的时候, 才放到tcp的全连接队列, </li>\n<li>然后进入tcp接收缓冲, 再到达应用层</li>\n</ol>\n<ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm5jf4oadbj30pq0u614l.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<h2 id=\"python版服务端的简单实现\"><a href=\"#python版服务端的简单实现\" class=\"headerlink\" title=\"python版服务端的简单实现\"></a>python版服务端的简单实现</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">GREAT = <span class=\"string\">\"\"\"great\"\"\"</span></span><br><span class=\"line\">CONTENT_LENGTH = <span class=\"string\">\"\"\"Content-Length: 5\"\"\"</span></span><br><span class=\"line\">STATUS_CODE = <span class=\"string\">\"200 OK\"</span></span><br><span class=\"line\">SAMEORIGIN = <span class=\"string\">\"\"\"X-Frame-Options: SAMEORIGIN\"\"\"</span></span><br><span class=\"line\">CHARSET = <span class=\"string\">\"\"\"Content-Type: text/plain; charset=utf-8\"\"\"</span></span><br><span class=\"line\">BICRLF = <span class=\"string\">\"\\r\\n\\r\\n\"</span></span><br><span class=\"line\">CRLF = <span class=\"string\">\"\\r\\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># 创建服务端的套接字</span></span><br><span class=\"line\">    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 绑定端口</span></span><br><span class=\"line\">    server_socket.bind((<span class=\"string\">\"\"</span>, <span class=\"number\">3344</span>))</span><br><span class=\"line\">    <span class=\"comment\"># 服务端套接字在端口3344监听</span></span><br><span class=\"line\">    <span class=\"comment\"># backlog 为等待(半)连接队列中的最大连接数</span></span><br><span class=\"line\">    server_socket.listen(<span class=\"number\">128</span>)</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 接收客户端连接，并得到一个新的socket与客户端进行通信</span></span><br><span class=\"line\">        client_socket, addr = server_socket.accept()</span><br><span class=\"line\">        thread_1 = threading.Thread(target=send_datas, args=(client_socket,))</span><br><span class=\"line\">        thread_1.start()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_datas</span><span class=\"params\">(client_socket)</span>:</span></span><br><span class=\"line\">    “”“</span><br><span class=\"line\">    接收客户端连接后, 发送数据</span><br><span class=\"line\">    ”“”</span><br><span class=\"line\">    <span class=\"comment\"># 开启keep alive, 维持长连接</span></span><br><span class=\"line\">    client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 如果一直没有收到数据, 则每隔8秒给客户端发送keep alive的tcp链路检测包</span></span><br><span class=\"line\">    <span class=\"comment\"># define TCP_KEEPALIVE    0x10    /* idle time used when SO_KEEPALIVE is enabled */</span></span><br><span class=\"line\">    <span class=\"comment\"># https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/netinet/tcp.h</span></span><br><span class=\"line\">    client_socket.setsockopt(socket.IPPROTO_TCP, <span class=\"number\">0x10</span>, <span class=\"number\">8</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 接收数据，返回http格式的响应</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 接收数据的长度</span></span><br><span class=\"line\">        len_recv = <span class=\"number\">6148</span></span><br><span class=\"line\">        request = client_socket.recv(len_recv)</span><br><span class=\"line\">        <span class=\"comment\"># recv接收到fin包之后，就马上响应ack了，而服务端的fin包需要close之后才会发</span></span><br><span class=\"line\">        print(<span class=\"string\">\"re   \"</span> + request.decode(<span class=\"string\">\"utf-8\"</span>))</span><br><span class=\"line\">        <span class=\"comment\"># 如果客户端那边调用close, 服务端接收到的数据长度为0, </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> request:</span><br><span class=\"line\">            content = input(<span class=\"string\">\"what do u want to response?:: \"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 返回http格式的数据，只要格式符合http的格式，那么浏览器就会认为是一个http响应，从而能解析</span></span><br><span class=\"line\">            response = <span class=\"string\">\"HTTP/1.1 &#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;\"</span>. \\</span><br><span class=\"line\">                format(STATUS_CODE+CRLF,CHARSET+CRLF,SAMEORIGIN+CRLF,CONTENT_LENGTH+CRLF+CRLF,content)</span><br><span class=\"line\">            <span class=\"comment\"># 发送数据，且编码跟服务器设置的一致</span></span><br><span class=\"line\">            client_socket.send(response.encode(<span class=\"string\">\"utf-8\"</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 没加内层while循环前， 没进入这里是因为关闭浏览器的时候，没有再次接收客户端发送来的数据</span></span><br><span class=\"line\">            print(<span class=\"string\">\"没数据了\"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 客户端调用close后，服务端马上响应一个ack，且读通道也关闭</span></span><br><span class=\"line\">            <span class=\"comment\"># 而服务端还有写通道未关闭，写通道也关闭后，就会给客户端发fin包</span></span><br><span class=\"line\">            <span class=\"comment\"># 或者直接close也可以, 区别在于close不会马上释放连接</span></span><br><span class=\"line\">            client_socket.shutdown(socket.SHUT_WR)</span><br><span class=\"line\">            <span class=\"comment\"># client_socket.close()</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    main_thread = threading.Thread(target=main)</span><br><span class=\"line\">    main_thread.start()</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"客户端的实现\"><a href=\"#客户端的实现\" class=\"headerlink\" title=\"客户端的实现\"></a>客户端的实现</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">COOKUE = <span class=\"string\">'''Cookie: Idea-38dabdcb=1a3e1891-7313-4a6c-8141-c158de42e97'''</span></span><br><span class=\"line\">LANGUAGE = <span class=\"string\">'''Accept-Language: zh-CN,zh;q=0.8'''</span></span><br><span class=\"line\">USER_AGENT = <span class=\"string\">'''User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36'''</span></span><br><span class=\"line\">ACCEPT = <span class=\"string\">'''Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'''</span></span><br><span class=\"line\">CACHE_CONTROL_MAX_AGE = <span class=\"string\">'''Cache-Control: max-age=0'''</span></span><br><span class=\"line\">CONNECTION_KEEP_ALIVE = <span class=\"string\">'''Connection: keep-alive'''</span></span><br><span class=\"line\">HOST = <span class=\"string\">'''Host: 192.168.0.101:8000'''</span></span><br><span class=\"line\">PATH = <span class=\"string\">'''/blog/'''</span></span><br><span class=\"line\"><span class=\"comment\"># PATH = '''/blog/?date=yyy'''</span></span><br><span class=\"line\">BICRLF = <span class=\"string\">\"\\r\\n\\r\\n\"</span></span><br><span class=\"line\">CRLF = <span class=\"string\">\"\\r\\n\"</span></span><br><span class=\"line\">CONTENT_LEN = <span class=\"string\">\"Content-Length: \"</span></span><br><span class=\"line\">send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_data</span><span class=\"params\">(tcp_socket)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> send_flag:</span><br><span class=\"line\">        len_msg = int(input(<span class=\"string\">\"how many char do you wanna send? : \"</span>))</span><br><span class=\"line\">        <span class=\"comment\"># 等待输入，如果comm为close，客户端关闭连接</span></span><br><span class=\"line\">        <span class=\"comment\"># content为要发送的内容，req_med为请求的方法，分别以空格分隔</span></span><br><span class=\"line\">        comm, content, req_med = input(<span class=\"string\">\"comm :\"</span>).split(<span class=\"string\">\" \"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> req_med == <span class=\"string\">\"p\"</span>:</span><br><span class=\"line\">            req_med = <span class=\"string\">\"POST\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            req_med = <span class=\"string\">\"GET\"</span></span><br><span class=\"line\">        long_msg = content * len_msg  <span class=\"comment\"># .encode(\"utf-8\")</span></span><br><span class=\"line\">        len_lmsg = str(len(long_msg))</span><br><span class=\"line\">        <span class=\"comment\"># 要发送的数据</span></span><br><span class=\"line\">        msg = (<span class=\"string\">\"%s %s HTTP/1.1\"</span> + CRLF + <span class=\"string\">\"%s%s%s%s%s%s%s%s\"</span>) \\</span><br><span class=\"line\">              % (req_med, PATH, HOST + CRLF + CONTENT_LEN + len_lmsg + CRLF, CONNECTION_KEEP_ALIVE + CRLF,</span><br><span class=\"line\">                 CACHE_CONTROL_MAX_AGE + CRLF,</span><br><span class=\"line\">                 ACCEPT + CRLF, USER_AGENT + CRLF, LANGUAGE + CRLF, COOKUE + BICRLF, long_msg)</span><br><span class=\"line\">        msg = msg.encode(<span class=\"string\">\"utf-8\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> comm.find(<span class=\"string\">\"close\"</span>) != <span class=\"number\">-1</span>:</span><br><span class=\"line\">            tcp_socket.shutdown(socket.SHUT_RDWR)</span><br><span class=\"line\">            <span class=\"comment\"># tcp_socket.close()</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> comm.find(<span class=\"string\">\"pass\"</span>) != <span class=\"number\">-1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> send_flag == <span class=\"literal\">False</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            tcp_socket.send(msg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">recv_data</span><span class=\"params\">(tcp_socket=None, len_recv=None)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        recv = tcp_socket.recv(len_recv)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> recv:</span><br><span class=\"line\">            <span class=\"keyword\">global</span> send_flag</span><br><span class=\"line\">            send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            send_flag = <span class=\"literal\">False</span></span><br><span class=\"line\">            tcp_socket.shutdown(socket.SHUT_WR)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        print(recv)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 创建socket, 该socket对应一个打开文件和一个文件描述符</span></span><br><span class=\"line\">        <span class=\"comment\"># 入参1为指定协议族, 因为有的系统不一定有实现tcp/ip协议,</span></span><br><span class=\"line\">        <span class=\"comment\"># 入参2为socket的类型, tcp就对应SOCK_STREAM, 因为建立连接后, 数据就像流一样在两端传输</span></span><br><span class=\"line\">        tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class=\"line\">        print(tcp_socket.fileno())</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 连接服务端</span></span><br><span class=\"line\">        tcp_socket.connect((<span class=\"string\">\"192.168.0.101\"</span>, <span class=\"number\">8000</span>))</span><br><span class=\"line\">        <span class=\"keyword\">global</span> send_flag</span><br><span class=\"line\">        send_flag = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 接收数据的长度</span></span><br><span class=\"line\">        len_recv = <span class=\"number\">6148</span></span><br><span class=\"line\">        <span class=\"comment\"># 同步阻塞的recv操作， 改成用一个线程异步接收数据，实时检测服务端发来的fin包，收到就马上把send_flag改为false</span></span><br><span class=\"line\">        thread = threading.Thread(target=recv_data, args=(tcp_socket, len_recv))</span><br><span class=\"line\">        thread.start()</span><br><span class=\"line\">        send_data(tcp_socket)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"whireshark-抓包截图\"><a href=\"#whireshark-抓包截图\" class=\"headerlink\" title=\"whireshark 抓包截图\"></a>whireshark 抓包截图</h2><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1gm4ysa57cpj31rg0igdpc.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n<ol>\n<li>如图, 客户端调用connect后, 发送请求与服务端建立连接的syn包, 包含一个客户端维护的序列号</li>\n<li>服务端收到syn包后, 也回一个混合了syn和ack的数据包, 其中包含服务端维护的序列号, 而ack包是作为对客户端syn包的确认回应, 所以ack号则是客户端的序列号+1,</li>\n<li>客户端收到服务端的syn+ack后, 再对该包确认回应而发送ack包, 此时序列号+1, ack号=服务端序列号+1,</li>\n<li>三次握手后, 客户端和服务端之间建立一条流通道,</li>\n<li>服务端的tcp接收缓冲区满了, 所以给客户端发送一个tcp window update的包,</li>\n<li>然后客户端发送http协议格式的数据, </li>\n<li>服务端接收到数据回一个ack的包,</li>\n<li>由于距离tcp流通道的上一个数据包的时间已经满8秒了, 于是服务端给客户端发送keep-alive的tcp包, </li>\n<li>客户端接收后马上回一个ack,</li>\n<li>服务端继续发送http格式的响应,</li>\n<li>客户端回ack<br>…</li>\n<li>最后, 客户端调用close后, 会给服务端发送fin包, 但由于上一个包是服务端发来的keep-alive ack包, 所以同时也会发送ack号为服务端发来的keep-alive ack包的序列号+1的ack,</li>\n<li>服务端马上单独回一个ack, 发送fin包的前提是服务端也调用了close, 而close还需要关闭接收通道释放资源等, 耗时较长, 所以就先单独回一个ack,</li>\n<li>服务端再发fin包, 而且为了防止客户端没收到前面的ack, 这个包里也包含一个ack,</li>\n<li>最后客户度回一个ack, tcp连接通道完全断开</li>\n</ol>"},{"title":"ym","abbrlink":"8c27cda5","date":"2020-03-12T08:00:33.000Z","_content":"# 欢迎访问\n\n## 需要您重点注意的!\n<!-- more -->\n哈哈~\n\n\n","source":"_posts/ym.md","raw":"---\ntitle: ym\nabbrlink: 8c27cda5\ndate: 2020-03-12 16:00:33\ntags:\n---\n# 欢迎访问\n\n## 需要您重点注意的!\n<!-- more -->\n哈哈~\n\n\n","slug":"ym","published":1,"updated":"2021-02-04T02:38:05.402Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai125000hunra1ptgf5uw","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"欢迎访问\"><a href=\"#欢迎访问\" class=\"headerlink\" title=\"欢迎访问\"></a>欢迎访问</h1><h2 id=\"需要您重点注意的\"><a href=\"#需要您重点注意的\" class=\"headerlink\" title=\"需要您重点注意的!\"></a>需要您重点注意的!</h2><a id=\"more\"></a>\n<p>哈哈~</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"欢迎访问\"><a href=\"#欢迎访问\" class=\"headerlink\" title=\"欢迎访问\"></a>欢迎访问</h1><h2 id=\"需要您重点注意的\"><a href=\"#需要您重点注意的\" class=\"headerlink\" title=\"需要您重点注意的!\"></a>需要您重点注意的!</h2>","more":"<p>哈哈~</p>"},{"title":"jmeter请求参数化","abbrlink":"b8d58d05","date":"2020-04-12T10:08:43.000Z","_content":"## 问题一：\n### 使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\n* 可以采用读取csv文件进行参数化。\n    * 具体操作步骤：\n        * 1.选中线程组，右键的配置元件就可以看到【CSV 数据文件设置】\n        * 2.不重复的订单号有了，在【CSV 数据文件设置】的【变量名称选项】设置变量名，就可以通过${变量名}从配置文件中读取对应的数据。\n<!-- more -->\n        * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5ehxuwgj30l10cnwfn.jpg)\n        * 3.请求中替换相应的变量，使请求与变量及配置文件相互关联。\n        * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5esg3hmj30jp0cpgme.jpg)\n    * 补充：\n        * 1.也可以通过bean shell调用UUID的randomUUID()方法来实现参数化\n        * <a href=\"https://blog.csdn.net/lirong_s/article/details/79914532\">参考资料</a>\n\n## 问题二：\n### 下单请求，需要MD5加密，怎么解决？\n* jmeter第三方插件Custom JMeter Functions中有__MD5函数。\n    * 如果没有安装插件管理中心, 则先在jmeter 的lib/ext 目录下放插件管理中心 <a href=\"https://jmeter-plugins.org/get/\">plugins-manager.jar</a> 这个jar包, 然后重启JMeter, 就能使用该函数了\n    * 具体用法可以通过【选项】-【函数助手对话框】进行查看。\n    * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5f5f1zyj30ke0bwaat.jpg)\n* 用添加用户自定义变量的方法，添加加密所需要参数变量，再通过__V函数（用法：${__V(变量名)} ）获取加密所需要的值。\n* 如果加密字符串还包含变量名，直接在__MD5函数中填写对应的变量名即可![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fe6wqgj305j00swea.jpg)\n* 如果还需要对加密后字符串转换成大写，则可以用uppercase转换成大写。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fo654wj309v00o0sj.jpg)\n* 而该方法的实现其实就是继承了AbstractFunction这个抽象类, 然后重写4个方法. 后续如果需要自己添加额外的逻辑, 也可以按照这个方式去实现, 打成jar包后, 放到lib/ext目录下.\n```Java\npackage kg.apc.jmeter.functions;\n\nimport org.apache.jmeter.engine.util.CompoundVariable;\nimport org.apache.jmeter.functions.AbstractFunction;\nimport org.apache.jmeter.functions.InvalidVariableException;\nimport org.apache.jmeter.samplers.SampleResult;\nimport org.apache.jmeter.samplers.Sampler;\nimport org.apache.jmeter.threads.JMeterVariables;\nimport org.apache.jorphan.util.JOrphanUtils;\n\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Collection;\nimport java.util.LinkedList;\nimport java.util.List;\n\npublic class MD5 extends AbstractFunction {\n\n    private static final List<String> desc = new LinkedList<String>();\n    private static final String KEY = \"__MD5\";\n\n    static {\n        desc.add(\"String to calculate MD5 hash\");\n        desc.add(\"Name of variable in which to store the result (optional)\");\n    }\n\n    private Object[] values;\n\n    /**\n     * No-arg constructor.\n     */\n    public MD5() {\n    }\n\n    /**\n     * {@inheritDoc} \n     */\n    @Override\n    public synchronized String execute(SampleResult previousResult, Sampler currentSampler)\n            throws InvalidVariableException {\n        // 获取存放了当前线程的所有变量的一个容器对象\n        JMeterVariables vars = getVariables();\n        // 从数组中获取要加密的原始字符串, 强转为CompoundVariable类型后, 通过execute方法转成字符串\n        String str = ((CompoundVariable) values[0]).execute();\n        MessageDigest digest;\n        try {\n            digest = MessageDigest.getInstance(\"md5\");\n        } catch (NoSuchAlgorithmException ex) {\n            return \"Error creating digest: \" + ex;\n        }\n        digest.update(str.getBytes());\n        byte[] digestArray = digest.digest();\n\n        for (byte b: digestArray){\n            stringBuffer.append(String.format(\"%02x\",b));\n        }\n\n        String res = stringBuffer.toString();\n\n        if (vars != null && values.length > 1) {\n            // 把第二个参数(也就是要替换的变量名)作为键, 加密后的结果作为值, 存入到vars容器中\n            // 后续就可以通过${varName的值}来获取加密后的字符串\n            String varName = ((CompoundVariable) values[1]).execute().trim();\n            vars.put(varName, res);\n        }\n\n        return res;\n    }\n\n    /**\n     * {@inheritDoc} 解析参数, 并存到数组中, 此时参数的类型是CompoundVariable\n     */\n    @Override\n    public synchronized void setParameters(Collection<CompoundVariable> parameters) throws InvalidVariableException {\n        checkMinParameterCount(parameters, 1);\n        values = parameters.toArray();\n    }\n\n    /**\n     * {@inheritDoc} 函数助手中显示的方法名, 其中__是不显示的\n     */\n    @Override\n    public String getReferenceKey() {\n        return KEY;\n    }\n\n    /**\n     * {@inheritDoc} 参数描述\n     */\n    @Override\n    public List<String> getArgumentDesc() {\n        return desc;\n    }\n}\n```\n<a href=\"https://www.cnblogs.com/lixiaowei395659729/articles/7223110.html\">参考资料1</a>\n<a href=\"http://www.fblinux.com/?p=951\">参考资料2</a>\n","source":"_posts/jmeterconfig.md","raw":"---\ntitle: jmeter请求参数化\ntags: 性能测试\ncategories: 性能测试\nabbrlink: b8d58d05\ndate: 2020-04-12 18:08:43\n---\n## 问题一：\n### 使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\n* 可以采用读取csv文件进行参数化。\n    * 具体操作步骤：\n        * 1.选中线程组，右键的配置元件就可以看到【CSV 数据文件设置】\n        * 2.不重复的订单号有了，在【CSV 数据文件设置】的【变量名称选项】设置变量名，就可以通过${变量名}从配置文件中读取对应的数据。\n<!-- more -->\n        * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5ehxuwgj30l10cnwfn.jpg)\n        * 3.请求中替换相应的变量，使请求与变量及配置文件相互关联。\n        * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5esg3hmj30jp0cpgme.jpg)\n    * 补充：\n        * 1.也可以通过bean shell调用UUID的randomUUID()方法来实现参数化\n        * <a href=\"https://blog.csdn.net/lirong_s/article/details/79914532\">参考资料</a>\n\n## 问题二：\n### 下单请求，需要MD5加密，怎么解决？\n* jmeter第三方插件Custom JMeter Functions中有__MD5函数。\n    * 如果没有安装插件管理中心, 则先在jmeter 的lib/ext 目录下放插件管理中心 <a href=\"https://jmeter-plugins.org/get/\">plugins-manager.jar</a> 这个jar包, 然后重启JMeter, 就能使用该函数了\n    * 具体用法可以通过【选项】-【函数助手对话框】进行查看。\n    * ![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5f5f1zyj30ke0bwaat.jpg)\n* 用添加用户自定义变量的方法，添加加密所需要参数变量，再通过__V函数（用法：${__V(变量名)} ）获取加密所需要的值。\n* 如果加密字符串还包含变量名，直接在__MD5函数中填写对应的变量名即可![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fe6wqgj305j00swea.jpg)\n* 如果还需要对加密后字符串转换成大写，则可以用uppercase转换成大写。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fo654wj309v00o0sj.jpg)\n* 而该方法的实现其实就是继承了AbstractFunction这个抽象类, 然后重写4个方法. 后续如果需要自己添加额外的逻辑, 也可以按照这个方式去实现, 打成jar包后, 放到lib/ext目录下.\n```Java\npackage kg.apc.jmeter.functions;\n\nimport org.apache.jmeter.engine.util.CompoundVariable;\nimport org.apache.jmeter.functions.AbstractFunction;\nimport org.apache.jmeter.functions.InvalidVariableException;\nimport org.apache.jmeter.samplers.SampleResult;\nimport org.apache.jmeter.samplers.Sampler;\nimport org.apache.jmeter.threads.JMeterVariables;\nimport org.apache.jorphan.util.JOrphanUtils;\n\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.Collection;\nimport java.util.LinkedList;\nimport java.util.List;\n\npublic class MD5 extends AbstractFunction {\n\n    private static final List<String> desc = new LinkedList<String>();\n    private static final String KEY = \"__MD5\";\n\n    static {\n        desc.add(\"String to calculate MD5 hash\");\n        desc.add(\"Name of variable in which to store the result (optional)\");\n    }\n\n    private Object[] values;\n\n    /**\n     * No-arg constructor.\n     */\n    public MD5() {\n    }\n\n    /**\n     * {@inheritDoc} \n     */\n    @Override\n    public synchronized String execute(SampleResult previousResult, Sampler currentSampler)\n            throws InvalidVariableException {\n        // 获取存放了当前线程的所有变量的一个容器对象\n        JMeterVariables vars = getVariables();\n        // 从数组中获取要加密的原始字符串, 强转为CompoundVariable类型后, 通过execute方法转成字符串\n        String str = ((CompoundVariable) values[0]).execute();\n        MessageDigest digest;\n        try {\n            digest = MessageDigest.getInstance(\"md5\");\n        } catch (NoSuchAlgorithmException ex) {\n            return \"Error creating digest: \" + ex;\n        }\n        digest.update(str.getBytes());\n        byte[] digestArray = digest.digest();\n\n        for (byte b: digestArray){\n            stringBuffer.append(String.format(\"%02x\",b));\n        }\n\n        String res = stringBuffer.toString();\n\n        if (vars != null && values.length > 1) {\n            // 把第二个参数(也就是要替换的变量名)作为键, 加密后的结果作为值, 存入到vars容器中\n            // 后续就可以通过${varName的值}来获取加密后的字符串\n            String varName = ((CompoundVariable) values[1]).execute().trim();\n            vars.put(varName, res);\n        }\n\n        return res;\n    }\n\n    /**\n     * {@inheritDoc} 解析参数, 并存到数组中, 此时参数的类型是CompoundVariable\n     */\n    @Override\n    public synchronized void setParameters(Collection<CompoundVariable> parameters) throws InvalidVariableException {\n        checkMinParameterCount(parameters, 1);\n        values = parameters.toArray();\n    }\n\n    /**\n     * {@inheritDoc} 函数助手中显示的方法名, 其中__是不显示的\n     */\n    @Override\n    public String getReferenceKey() {\n        return KEY;\n    }\n\n    /**\n     * {@inheritDoc} 参数描述\n     */\n    @Override\n    public List<String> getArgumentDesc() {\n        return desc;\n    }\n}\n```\n<a href=\"https://www.cnblogs.com/lixiaowei395659729/articles/7223110.html\">参考资料1</a>\n<a href=\"http://www.fblinux.com/?p=951\">参考资料2</a>\n","slug":"jmeterconfig","published":1,"updated":"2021-02-10T04:35:18.228Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai127000kunra9x4nd7ck","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"问题一：\"><a href=\"#问题一：\" class=\"headerlink\" title=\"问题一：\"></a>问题一：</h2><h3 id=\"使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\"><a href=\"#使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\" class=\"headerlink\" title=\"使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\"></a>使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。</h3><ul>\n<li>可以采用读取csv文件进行参数化。<ul>\n<li>具体操作步骤：<ul>\n<li>1.选中线程组，右键的配置元件就可以看到【CSV 数据文件设置】</li>\n<li>2.不重复的订单号有了，在【CSV 数据文件设置】的【变量名称选项】设置变量名，就可以通过${变量名}从配置文件中读取对应的数据。<a id=\"more\"></a></li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5ehxuwgj30l10cnwfn.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>3.请求中替换相应的变量，使请求与变量及配置文件相互关联。</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5esg3hmj30jp0cpgme.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>补充：<ul>\n<li>1.也可以通过bean shell调用UUID的randomUUID()方法来实现参数化</li>\n<li><a href=\"https://blog.csdn.net/lirong_s/article/details/79914532\" target=\"_blank\" rel=\"noopener\">参考资料</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"问题二：\"><a href=\"#问题二：\" class=\"headerlink\" title=\"问题二：\"></a>问题二：</h2><h3 id=\"下单请求，需要MD5加密，怎么解决？\"><a href=\"#下单请求，需要MD5加密，怎么解决？\" class=\"headerlink\" title=\"下单请求，需要MD5加密，怎么解决？\"></a>下单请求，需要MD5加密，怎么解决？</h3><ul>\n<li>jmeter第三方插件Custom JMeter Functions中有__MD5函数。<ul>\n<li>如果没有安装插件管理中心, 则先在jmeter 的lib/ext 目录下放插件管理中心 <a href=\"https://jmeter-plugins.org/get/\" target=\"_blank\" rel=\"noopener\">plugins-manager.jar</a> 这个jar包, 然后重启JMeter, 就能使用该函数了</li>\n<li>具体用法可以通过【选项】-【函数助手对话框】进行查看。</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5f5f1zyj30ke0bwaat.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>用添加用户自定义变量的方法，添加加密所需要参数变量，再通过<strong>V函数（用法：${</strong>V(变量名)} ）获取加密所需要的值。</li>\n<li>如果加密字符串还包含变量名，直接在__MD5函数中填写对应的变量名即可<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fe6wqgj305j00swea.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>如果还需要对加密后字符串转换成大写，则可以用uppercase转换成大写。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fo654wj309v00o0sj.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>而该方法的实现其实就是继承了AbstractFunction这个抽象类, 然后重写4个方法. 后续如果需要自己添加额外的逻辑, 也可以按照这个方式去实现, 打成jar包后, 放到lib/ext目录下.<figure class=\"highlight java\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> kg.apc.jmeter.functions;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.engine.util.CompoundVariable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.functions.AbstractFunction;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.functions.InvalidVariableException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.samplers.SampleResult;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.samplers.Sampler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.threads.JMeterVariables;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jorphan.util.JOrphanUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.MessageDigest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.NoSuchAlgorithmException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MD5</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractFunction</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> List&lt;String&gt; desc = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String KEY = <span class=\"string\">\"__MD5\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> {</span><br><span class=\"line\">        desc.add(<span class=\"string\">\"String to calculate MD5 hash\"</span>);</span><br><span class=\"line\">        desc.add(<span class=\"string\">\"Name of variable in which to store the result (optional)\"</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object[] values;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * No-arg constructor.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MD5</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * {<span class=\"doctag\">@inheritDoc</span>} </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> String <span class=\"title\">execute</span><span class=\"params\">(SampleResult previousResult, Sampler currentSampler)</span></span></span><br><span class=\"line\"><span class=\"function\">            <span class=\"keyword\">throws</span> InvalidVariableException </span>{</span><br><span class=\"line\">        <span class=\"comment\">// 获取存放了当前线程的所有变量的一个容器对象</span></span><br><span class=\"line\">        JMeterVariables vars = getVariables();</span><br><span class=\"line\">        <span class=\"comment\">// 从数组中获取要加密的原始字符串, 强转为CompoundVariable类型后, 通过execute方法转成字符串</span></span><br><span class=\"line\">        String str = ((CompoundVariable) values[<span class=\"number\">0</span>]).execute();</span><br><span class=\"line\">        MessageDigest digest;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> {</span><br><span class=\"line\">            digest = MessageDigest.getInstance(<span class=\"string\">\"md5\"</span>);</span><br><span class=\"line\">        } <span class=\"keyword\">catch</span> (NoSuchAlgorithmException ex) {</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"Error creating digest: \"</span> + ex;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        digest.update(str.getBytes());</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] digestArray = digest.digest();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">byte</span> b: digestArray){</span><br><span class=\"line\">            stringBuffer.append(String.format(<span class=\"string\">\"%02x\"</span>,b));</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        String res = stringBuffer.toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (vars != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">1</span>) {</span><br><span class=\"line\">            <span class=\"comment\">// 把第二个参数(也就是要替换的变量名)作为键, 加密后的结果作为值, 存入到vars容器中</span></span><br><span class=\"line\">            <span class=\"comment\">// 后续就可以通过${varName的值}来获取加密后的字符串</span></span><br><span class=\"line\">            String varName = ((CompoundVariable) values[<span class=\"number\">1</span>]).execute().trim();</span><br><span class=\"line\">            vars.put(varName, res);</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * {<span class=\"doctag\">@inheritDoc</span>} 解析参数, 并存到数组中, 此时参数的类型是CompoundVariable</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">setParameters</span><span class=\"params\">(Collection&lt;CompoundVariable&gt; parameters)</span> <span class=\"keyword\">throws</span> InvalidVariableException </span>{</span><br><span class=\"line\">        checkMinParameterCount(parameters, <span class=\"number\">1</span>);</span><br><span class=\"line\">        values = parameters.toArray();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * {<span class=\"doctag\">@inheritDoc</span>} 函数助手中显示的方法名, 其中__是不显示的</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getReferenceKey</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> KEY;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * {<span class=\"doctag\">@inheritDoc</span>} 参数描述</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">getArgumentDesc</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">        <span class=\"keyword\">return</span> desc;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<a href=\"https://www.cnblogs.com/lixiaowei395659729/articles/7223110.html\" target=\"_blank\" rel=\"noopener\">参考资料1</a><br><a href=\"http://www.fblinux.com/?p=951\" target=\"_blank\" rel=\"noopener\">参考资料2</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"问题一：\"><a href=\"#问题一：\" class=\"headerlink\" title=\"问题一：\"></a>问题一：</h2><h3 id=\"使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\"><a href=\"#使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\" class=\"headerlink\" title=\"使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。\"></a>使用jmeter对下单进行压测的时候，订单号不允许重复，那怎么办呢。</h3><ul>\n<li>可以采用读取csv文件进行参数化。<ul>\n<li>具体操作步骤：<ul>\n<li>1.选中线程组，右键的配置元件就可以看到【CSV 数据文件设置】</li>\n<li>2.不重复的订单号有了，在【CSV 数据文件设置】的【变量名称选项】设置变量名，就可以通过${变量名}从配置文件中读取对应的数据。</li></ul></li></ul></li></ul>","more":"</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5ehxuwgj30l10cnwfn.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>3.请求中替换相应的变量，使请求与变量及配置文件相互关联。</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5esg3hmj30jp0cpgme.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>补充：<ul>\n<li>1.也可以通过bean shell调用UUID的randomUUID()方法来实现参数化</li>\n<li><a href=\"https://blog.csdn.net/lirong_s/article/details/79914532\" target=\"_blank\" rel=\"noopener\">参考资料</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"问题二：\"><a href=\"#问题二：\" class=\"headerlink\" title=\"问题二：\"></a>问题二：</h2><h3 id=\"下单请求，需要MD5加密，怎么解决？\"><a href=\"#下单请求，需要MD5加密，怎么解决？\" class=\"headerlink\" title=\"下单请求，需要MD5加密，怎么解决？\"></a>下单请求，需要MD5加密，怎么解决？</h3><ul>\n<li>jmeter第三方插件Custom JMeter Functions中有__MD5函数。<ul>\n<li>如果没有安装插件管理中心, 则先在jmeter 的lib/ext 目录下放插件管理中心 <a href=\"https://jmeter-plugins.org/get/\" target=\"_blank\" rel=\"noopener\">plugins-manager.jar</a> 这个jar包, 然后重启JMeter, 就能使用该函数了</li>\n<li>具体用法可以通过【选项】-【函数助手对话框】进行查看。</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5f5f1zyj30ke0bwaat.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>用添加用户自定义变量的方法，添加加密所需要参数变量，再通过<strong>V函数（用法：${</strong>V(变量名)} ）获取加密所需要的值。</li>\n<li>如果加密字符串还包含变量名，直接在__MD5函数中填写对应的变量名即可<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fe6wqgj305j00swea.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>如果还需要对加密后字符串转换成大写，则可以用uppercase转换成大写。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdr5fo654wj309v00o0sj.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>而该方法的实现其实就是继承了AbstractFunction这个抽象类, 然后重写4个方法. 后续如果需要自己添加额外的逻辑, 也可以按照这个方式去实现, 打成jar包后, 放到lib/ext目录下.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> kg.apc.jmeter.functions;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.engine.util.CompoundVariable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.functions.AbstractFunction;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.functions.InvalidVariableException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.samplers.SampleResult;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.samplers.Sampler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jmeter.threads.JMeterVariables;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.jorphan.util.JOrphanUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.MessageDigest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.NoSuchAlgorithmException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MD5</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractFunction</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> List&lt;String&gt; desc = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String KEY = <span class=\"string\">\"__MD5\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        desc.add(<span class=\"string\">\"String to calculate MD5 hash\"</span>);</span><br><span class=\"line\">        desc.add(<span class=\"string\">\"Name of variable in which to store the result (optional)\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object[] values;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * No-arg constructor.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MD5</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125; </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> String <span class=\"title\">execute</span><span class=\"params\">(SampleResult previousResult, Sampler currentSampler)</span></span></span><br><span class=\"line\"><span class=\"function\">            <span class=\"keyword\">throws</span> InvalidVariableException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取存放了当前线程的所有变量的一个容器对象</span></span><br><span class=\"line\">        JMeterVariables vars = getVariables();</span><br><span class=\"line\">        <span class=\"comment\">// 从数组中获取要加密的原始字符串, 强转为CompoundVariable类型后, 通过execute方法转成字符串</span></span><br><span class=\"line\">        String str = ((CompoundVariable) values[<span class=\"number\">0</span>]).execute();</span><br><span class=\"line\">        MessageDigest digest;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            digest = MessageDigest.getInstance(<span class=\"string\">\"md5\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchAlgorithmException ex) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"Error creating digest: \"</span> + ex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        digest.update(str.getBytes());</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] digestArray = digest.digest();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">byte</span> b: digestArray)&#123;</span><br><span class=\"line\">            stringBuffer.append(String.format(<span class=\"string\">\"%02x\"</span>,b));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        String res = stringBuffer.toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (vars != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 把第二个参数(也就是要替换的变量名)作为键, 加密后的结果作为值, 存入到vars容器中</span></span><br><span class=\"line\">            <span class=\"comment\">// 后续就可以通过$&#123;varName的值&#125;来获取加密后的字符串</span></span><br><span class=\"line\">            String varName = ((CompoundVariable) values[<span class=\"number\">1</span>]).execute().trim();</span><br><span class=\"line\">            vars.put(varName, res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125; 解析参数, 并存到数组中, 此时参数的类型是CompoundVariable</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">setParameters</span><span class=\"params\">(Collection&lt;CompoundVariable&gt; parameters)</span> <span class=\"keyword\">throws</span> InvalidVariableException </span>&#123;</span><br><span class=\"line\">        checkMinParameterCount(parameters, <span class=\"number\">1</span>);</span><br><span class=\"line\">        values = parameters.toArray();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125; 函数助手中显示的方法名, 其中__是不显示的</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getReferenceKey</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> KEY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@inheritDoc</span>&#125; 参数描述</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">getArgumentDesc</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> desc;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<a href=\"https://www.cnblogs.com/lixiaowei395659729/articles/7223110.html\" target=\"_blank\" rel=\"noopener\">参考资料1</a><br><a href=\"http://www.fblinux.com/?p=951\" target=\"_blank\" rel=\"noopener\">参考资料2</a></li>\n</ul>"},{"title":"“砖墙是为了挡住不够渴望的人”","abbrlink":"1936ef26","date":"2020-04-13T00:45:43.000Z","_content":"## 前言:\n前一段时间看了兰迪教授的《最后的一课》,当时他已经癌症晚期了,但是整个演讲过程都保持着饱满的精神, 他的幽默感染了在场的人, 时隔十几年, 我这条屏幕外的咸鱼也深受鼓舞.\n\n有句话贯穿了整个演讲, “Brick walls are there for a reason: they let us prove how badly we want things. ”\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdryhwb08sj30bp06bwhu.jpg)\n<!-- more -->\n## 印象最深刻的一点:\n他说的一个童年梦想, 就是能像宇航员一样自由漂浮, 体验失重的感觉. 后来他了解到航天局的一个项目, 让大学生提交在一种飞机上做试验的建议, 这是一种关于训练宇航员适应零重力的飞机, 于是他带着他的学生团队提交了一个虚拟现实的建议.他们也因此获得肯尼迪航天中心参加一次飞行的机会.\n\n但是也明文规定了不允许指导老师参与飞行. 于是他仔细阅读项目的所有相关文件, 发现学生可以带一名记者，然后他跟宇航局负责人保证说，他会把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者. 最后他以记者的身份跟着学生一起参与飞行体验活动了。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdryotdvqkj30cm0by79g.jpg)\n\n## 可吸收的经验:\n他的这个经历, 至少有5点值得我学习.\n\n1. 梦想不是随便说说而已, 得有实际的行动, 如果他不是一直关注宇航局的相关消息, 那就不会知道有那个体验项目了, 机会不是从天而降的, 就像中彩票的前提也是得先去买一张票.\n    \n2. 任何时候，都不要抱着不可能的想法，不要被负面情绪控制, 要用理性思维, 仔细推敲规则，总会找到漏洞，找到机会。被告知指导老师不能参与飞行, 他没有被负面情绪控制而放弃, 而是仔细阅读相关条例, 理性的分析解决方案.\n\n3. 做任何事的同时也要替别人着想. 他保证把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者, 这是对宇航局的宣传有益的, 所以能说服宇航局的负责人, 让他以网络记者的身份参与飞行.\n\n4. 学会取舍, 任何事都不能十全十美的, 如果总是既想要这样, 又想要那样, 最后什么都得不到. 兰迪教授为了能参与飞行, 就放弃了指导老师的身份, 选择了他认为更重要的事.\n\n5. “砖墙是为了挡住那些不够渴望的人”, 有点点挫折的时候, 不要只是想着我都这么努力了, 而是得捋清楚自己到底做了哪些事, 哪些对达成目标有用的, 哪些是无效的, 还有没有别的可行方案, 然后去尝试.\n\n他对体验漂浮的渴望, 让他做到了以上5点(当然不止这些),  最后实现了他童年的梦想.\n\n其实，我有时候也能做到第2点，不过看了他的分享后，我会意识到这是非常好的做法，然后强化这一习惯, 而其他几点就要开始培养了..","source":"_posts/《最后的演讲》观后感.md","raw":"---\ntitle: “砖墙是为了挡住不够渴望的人”\ntags:\n  - 观后感\ncategories: 观后感\nabbrlink: 1936ef26\ndate: 2020-04-13 08:45:43\n---\n## 前言:\n前一段时间看了兰迪教授的《最后的一课》,当时他已经癌症晚期了,但是整个演讲过程都保持着饱满的精神, 他的幽默感染了在场的人, 时隔十几年, 我这条屏幕外的咸鱼也深受鼓舞.\n\n有句话贯穿了整个演讲, “Brick walls are there for a reason: they let us prove how badly we want things. ”\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdryhwb08sj30bp06bwhu.jpg)\n<!-- more -->\n## 印象最深刻的一点:\n他说的一个童年梦想, 就是能像宇航员一样自由漂浮, 体验失重的感觉. 后来他了解到航天局的一个项目, 让大学生提交在一种飞机上做试验的建议, 这是一种关于训练宇航员适应零重力的飞机, 于是他带着他的学生团队提交了一个虚拟现实的建议.他们也因此获得肯尼迪航天中心参加一次飞行的机会.\n\n但是也明文规定了不允许指导老师参与飞行. 于是他仔细阅读项目的所有相关文件, 发现学生可以带一名记者，然后他跟宇航局负责人保证说，他会把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者. 最后他以记者的身份跟着学生一起参与飞行体验活动了。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdryotdvqkj30cm0by79g.jpg)\n\n## 可吸收的经验:\n他的这个经历, 至少有5点值得我学习.\n\n1. 梦想不是随便说说而已, 得有实际的行动, 如果他不是一直关注宇航局的相关消息, 那就不会知道有那个体验项目了, 机会不是从天而降的, 就像中彩票的前提也是得先去买一张票.\n    \n2. 任何时候，都不要抱着不可能的想法，不要被负面情绪控制, 要用理性思维, 仔细推敲规则，总会找到漏洞，找到机会。被告知指导老师不能参与飞行, 他没有被负面情绪控制而放弃, 而是仔细阅读相关条例, 理性的分析解决方案.\n\n3. 做任何事的同时也要替别人着想. 他保证把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者, 这是对宇航局的宣传有益的, 所以能说服宇航局的负责人, 让他以网络记者的身份参与飞行.\n\n4. 学会取舍, 任何事都不能十全十美的, 如果总是既想要这样, 又想要那样, 最后什么都得不到. 兰迪教授为了能参与飞行, 就放弃了指导老师的身份, 选择了他认为更重要的事.\n\n5. “砖墙是为了挡住那些不够渴望的人”, 有点点挫折的时候, 不要只是想着我都这么努力了, 而是得捋清楚自己到底做了哪些事, 哪些对达成目标有用的, 哪些是无效的, 还有没有别的可行方案, 然后去尝试.\n\n他对体验漂浮的渴望, 让他做到了以上5点(当然不止这些),  最后实现了他童年的梦想.\n\n其实，我有时候也能做到第2点，不过看了他的分享后，我会意识到这是非常好的做法，然后强化这一习惯, 而其他几点就要开始培养了..","slug":"《最后的演讲》观后感","published":1,"updated":"2021-02-04T02:38:05.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai128000lunraho0805vz","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言:\"></a>前言:</h2><p>前一段时间看了兰迪教授的《最后的一课》,当时他已经癌症晚期了,但是整个演讲过程都保持着饱满的精神, 他的幽默感染了在场的人, 时隔十几年, 我这条屏幕外的咸鱼也深受鼓舞.</p>\n<p>有句话贯穿了整个演讲, “Brick walls are there for a reason: they let us prove how badly we want things. ”</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdryhwb08sj30bp06bwhu.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<a id=\"more\"></a>\n<h2 id=\"印象最深刻的一点\"><a href=\"#印象最深刻的一点\" class=\"headerlink\" title=\"印象最深刻的一点:\"></a>印象最深刻的一点:</h2><p>他说的一个童年梦想, 就是能像宇航员一样自由漂浮, 体验失重的感觉. 后来他了解到航天局的一个项目, 让大学生提交在一种飞机上做试验的建议, 这是一种关于训练宇航员适应零重力的飞机, 于是他带着他的学生团队提交了一个虚拟现实的建议.他们也因此获得肯尼迪航天中心参加一次飞行的机会.</p>\n<p>但是也明文规定了不允许指导老师参与飞行. 于是他仔细阅读项目的所有相关文件, 发现学生可以带一名记者，然后他跟宇航局负责人保证说，他会把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者. 最后他以记者的身份跟着学生一起参与飞行体验活动了。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdryotdvqkj30cm0by79g.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"可吸收的经验\"><a href=\"#可吸收的经验\" class=\"headerlink\" title=\"可吸收的经验:\"></a>可吸收的经验:</h2><p>他的这个经历, 至少有5点值得我学习.</p>\n<ol>\n<li><p>梦想不是随便说说而已, 得有实际的行动, 如果他不是一直关注宇航局的相关消息, 那就不会知道有那个体验项目了, 机会不是从天而降的, 就像中彩票的前提也是得先去买一张票.</p>\n</li>\n<li><p>任何时候，都不要抱着不可能的想法，不要被负面情绪控制, 要用理性思维, 仔细推敲规则，总会找到漏洞，找到机会。被告知指导老师不能参与飞行, 他没有被负面情绪控制而放弃, 而是仔细阅读相关条例, 理性的分析解决方案.</p>\n</li>\n<li><p>做任何事的同时也要替别人着想. 他保证把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者, 这是对宇航局的宣传有益的, 所以能说服宇航局的负责人, 让他以网络记者的身份参与飞行.</p>\n</li>\n<li><p>学会取舍, 任何事都不能十全十美的, 如果总是既想要这样, 又想要那样, 最后什么都得不到. 兰迪教授为了能参与飞行, 就放弃了指导老师的身份, 选择了他认为更重要的事.</p>\n</li>\n<li><p>“砖墙是为了挡住那些不够渴望的人”, 有点点挫折的时候, 不要只是想着我都这么努力了, 而是得捋清楚自己到底做了哪些事, 哪些对达成目标有用的, 哪些是无效的, 还有没有别的可行方案, 然后去尝试.</p>\n</li>\n</ol>\n<p>他对体验漂浮的渴望, 让他做到了以上5点(当然不止这些),  最后实现了他童年的梦想.</p>\n<p>其实，我有时候也能做到第2点，不过看了他的分享后，我会意识到这是非常好的做法，然后强化这一习惯, 而其他几点就要开始培养了..</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言:\"></a>前言:</h2><p>前一段时间看了兰迪教授的《最后的一课》,当时他已经癌症晚期了,但是整个演讲过程都保持着饱满的精神, 他的幽默感染了在场的人, 时隔十几年, 我这条屏幕外的咸鱼也深受鼓舞.</p>\n<p>有句话贯穿了整个演讲, “Brick walls are there for a reason: they let us prove how badly we want things. ”</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdryhwb08sj30bp06bwhu.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>","more":"<h2 id=\"印象最深刻的一点\"><a href=\"#印象最深刻的一点\" class=\"headerlink\" title=\"印象最深刻的一点:\"></a>印象最深刻的一点:</h2><p>他说的一个童年梦想, 就是能像宇航员一样自由漂浮, 体验失重的感觉. 后来他了解到航天局的一个项目, 让大学生提交在一种飞机上做试验的建议, 这是一种关于训练宇航员适应零重力的飞机, 于是他带着他的学生团队提交了一个虚拟现实的建议.他们也因此获得肯尼迪航天中心参加一次飞行的机会.</p>\n<p>但是也明文规定了不允许指导老师参与飞行. 于是他仔细阅读项目的所有相关文件, 发现学生可以带一名记者，然后他跟宇航局负责人保证说，他会把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者. 最后他以记者的身份跟着学生一起参与飞行体验活动了。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdryotdvqkj30cm0by79g.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"可吸收的经验\"><a href=\"#可吸收的经验\" class=\"headerlink\" title=\"可吸收的经验:\"></a>可吸收的经验:</h2><p>他的这个经历, 至少有5点值得我学习.</p>\n<ol>\n<li><p>梦想不是随便说说而已, 得有实际的行动, 如果他不是一直关注宇航局的相关消息, 那就不会知道有那个体验项目了, 机会不是从天而降的, 就像中彩票的前提也是得先去买一张票.</p>\n</li>\n<li><p>任何时候，都不要抱着不可能的想法，不要被负面情绪控制, 要用理性思维, 仔细推敲规则，总会找到漏洞，找到机会。被告知指导老师不能参与飞行, 他没有被负面情绪控制而放弃, 而是仔细阅读相关条例, 理性的分析解决方案.</p>\n</li>\n<li><p>做任何事的同时也要替别人着想. 他保证把这次试验的消息发到各大新闻网站, 并把这次虚拟现实的照片寄给主流媒体的记者, 这是对宇航局的宣传有益的, 所以能说服宇航局的负责人, 让他以网络记者的身份参与飞行.</p>\n</li>\n<li><p>学会取舍, 任何事都不能十全十美的, 如果总是既想要这样, 又想要那样, 最后什么都得不到. 兰迪教授为了能参与飞行, 就放弃了指导老师的身份, 选择了他认为更重要的事.</p>\n</li>\n<li><p>“砖墙是为了挡住那些不够渴望的人”, 有点点挫折的时候, 不要只是想着我都这么努力了, 而是得捋清楚自己到底做了哪些事, 哪些对达成目标有用的, 哪些是无效的, 还有没有别的可行方案, 然后去尝试.</p>\n</li>\n</ol>\n<p>他对体验漂浮的渴望, 让他做到了以上5点(当然不止这些),  最后实现了他童年的梦想.</p>\n<p>其实，我有时候也能做到第2点，不过看了他的分享后，我会意识到这是非常好的做法，然后强化这一习惯, 而其他几点就要开始培养了..</p>"},{"title":"基于OpenCover的代码覆盖率测试","abbrlink":"8920367b","date":"2020-12-02T23:40:59.000Z","_content":"## 前言\n之前的工作中有用到OpenCover对项目中的Asp.Net站点、服务进行覆盖率测试, 现在重新整理下笔记.\n\n## OpenCover简介：\n* 一个用于.NET 2.0及以上应用程序的代码覆盖的开源命令行工具;\n<!-- more -->\n* 使用PDB文件提供序列信息，来确定dll文件中哪些代码行与源代码的每一行相关联，然后检测、插桩每个序列点以记录命中的行;\n    * 因此必须要有的是PDB文件以及可执行文件和程序集，应该在调试模式下构建测试中的应用程序。如果未找到PDB文件，则不会收集任何覆盖数据;\n* 使用COM（组件对象模型）开发，检测程序profiler部分则使用c++;\n* 使用mono.Cecil来分析分支或IL以确定在何处检测代码;\n\n### OpenCover提供的指标有：\n1. 声明范围, 即已涵盖的行数。\n2. 方法覆盖范围，即涵盖了哪些方法。\n3. 分支覆盖范围, 即采取了哪些分支, 这与圈复杂度有关\n\n## OpenCover主要命令参数：\n* -target： 应用程序可执行文件或服务名称的路径  \n我的理解：就是配置将被测程序运行起来的程序或服务。大多用的NUnit。本文例子用的是IIS Express\n* -filter： 应用于选择性地包括或排除coverage结果中的程序集和类的过滤器列表 \n * 默认选择所有的类和方法\n * 使用PartCover语法，(+|-)[Assembly-Filter]Type-Filter。\n * 例如，+[Open\\*]* 包括以Open开头的程序\n * -[\\*]Core.\\* 排除Core命名空间中的所有类型(跟程序集无关)。\n * 如果未提供过滤器，+[\\*]\\*则会自动应用默认包含所有的过滤器。\n* -output： 输出XML文件的路径，如果为空，则将在当前目录中创建results.xml\n* -register [：user] - 注册和取消注册代码覆盖率分析器\n* -targetargs： - 要传递给目标进程的参数（可指定被测程序的路径）\n* -targetdir： - 目标目录的路径或PDB文件的备用路径  \n如果-targetargs 已经指定了被测程序的路径，那么这里可作为查找PDB文件的依据。本文例子则作为查找PDB文件的路径\n<a href=\"https://github.com/OpenCover/opencover/wiki/Usage\">用法  </a><a href=\"https://github.com/opencover/opencover/blob/master/main/OpenCover.Documentation/Usage.pdf\">文档</a>\n<a href=\"http://www.cnblogs.com/binyao/category/477233.html\">参考1  </a><a href=\"http://www.cnblogs.com/tylerzhou/p/9076386.html\">参考2  </a><a href=\"http://blog.alantsai.net/posts/2017/01/devopsseries-opencover-intro\">参考3  </a><a href=\"https://www.codeproject.com/Articles/677691/Getting-code-coverage-from-your-NET-testing-using\">参考4</a>\n\n\n## 未使用OpenCover时，被测程序的正常运行流程：\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glabzct7wqj30ga03fmx3.jpg)\n\n## 使用OpenCover、ReportGenerator后，被测程序的运行流程：\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac00ut37j30hd06ldg3.jpg)\n* 1)命令行调用OpenCover.Console.exe\n* 2)OpenCover使用SentrySdk收集崩溃报告\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac1j082fj30jp0hxwfy.jpg)\n* 3)解析命令行中传入的参数（被测程序路径、要打印使用说明、是否启动服务、过滤信息等）\n* 4)处理过滤器信息，如果命令行中未传-filter参数，则默认匹配分析所有的类和方法——>创建性能计数器\n* 5)得到输出xml报告的全路径\n* 6)初始化封装了注入框架依赖的容器\n* 7)创建文件句柄，后续将覆盖率信息写入文件中。如果已经存在覆盖率xml文件，则合并\n* 8)启动覆盖率分析进程。注册分析器，调用OpenCover.Profiler.dll\n* 9)启动托管被测代码的程序(IIS Express)\n* 10)访问站点测试被测程序\n* 11)关闭IIS Express, 得到运行结果同时，也得到xml覆盖率结果\n* 12)ReportGenerator将xml转成HTML\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glacgqgvjyj316b0mcaig.jpg)\n\n## OpenCover和ReportGenerator的主要配置流程：\n### 以测试站点程序为例:\n* 1)配置好OpenCover、ReportGenerator、被测程序的路径、IIS Express config的路径\n* 2)执行配置好相关参数的CMD命令, 示例如下：\n```python\nH:\\白盒测试\\Debug\\Opencover\\OpenCover.Console.exe -target:\"C:\\Program Files (x86)\\IIS Express\\iisexpress.exe\" -targetdir:\"D:\\被测站点\\xxx.xxx.com\\bin\" -targetargs:\"/site:xxx_bh.xxx.com /config:\\\"C:\\Users\\ym\\Documents\\IISExpress\\config\\applicationhost.config\\\"\" -register:ym -output:\"H:\\白盒测试\\xml_ym\\xxx_bh.xxx.com\\xxx_bh.xxx.com.xml\"\n```\n* 3)此时IIS Express已经启动，访问在通过IIS Express配置的站点，开始测试。\n* 4)测试完成后，退出IIS Express，生成xml文件。\n* 5)使用ReportGenerator生成HTML文档，CMD命令示例如下：\n```python\nH:\\白盒测试\\Debug\\ReportGenerator\\ReportGenerator.exe -reports:H:\\白盒测试\\xml\\白盒测试.xml -targetdir:H:\\白盒测试\\xml\\html\n```\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glaci6hhr3j310r0fxwhk.jpg)\n\n## ReportGenerator概述：\n* ReportGenerator用于将OpenCover，PartCover，Visual Studio或NCover生成的XML报告转换为各种格式的友好可读报告。\n* 主要就是配置xml文件的路径和输出html的路径, 执行命令后, ReportGenerator就会解析传入的参数, 然后输出报告\n### 常用的命令行参数：\n* -reports： - 应该解析的覆盖率报告，分号分隔，允许使用通配符\n* -targetdir： - 应保存生成的报告的目录\n* -sourcedirs：[;] [;] - 包含相应源代码的目录，可选，分号分隔\n* -classfilters：<（+ | - ）filter> [; <（+ | - ）filter>] [; <（+ | - ）filter>] - 报表中应包含或排除的类列表，可选，可用通配符。\n* 如果是测试Windows服务的覆盖率：\n1）执行如下命令启动服务：\nG:\\Opencover所在路径\\OpenCover.Console.exe -service:byname -target:安装好的服务名 -register:ym -output:H:\\白盒测试保存路径\\xxx\\xxx.xml \n2）测试完毕后，正常关闭服务，则可收集覆盖数据。\n\n### 报告部分截图\n* 包含语句覆盖和分支覆盖情况。点击相应的页面，会进入对应程序，可看到具体覆盖到哪一行代码。\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac4ottr3j30s30hbaay.jpg)\n\n### 代码覆盖详情截图\n* 绿色表示完全覆盖，橙色表示该行代码还有分支未覆盖到，红色则未覆盖。\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac58dbfij30nf08qglt.jpg)\n\n<a href=\"https://github.com/OpenCover/opencover/wiki/Service-Support\">文档中的描述  </a><a href=\"https://www.cnblogs.com/tylerzhou/p/9076537.html\">参考资料1  </a><a href=\"https://www.cnblogs.com/SivilTaram/p/vs_opencover_unit_coverage.html\">参考资料2</a>\n\n## 关于IIS Express：\n* 一个兼具Visual Studio的ASP.NET开发服务器和Windows的IIS Web服务器功能的轻量级web服务器。\n<a href=\"https://stackify.com/what-is-iis-express/\">具体描述   </a><a href=\"https://blog.csdn.net/zhangjk1993/article/details/36671105\">配置</a>\n\n### 为什么用IIS Express：\n更轻便, 易于实现自动化. 而结合实际需求，虽然也可以直接往-target传参为IIS的启动程序来进行监控测试情况，但是IIS还部署了其他非测试站点，会相互影响。所以实际应用还是采用IIS Express，每个测试人员部署自己的IIS Express，而不会相互影响。\n### 启动完整的IIS的操作：\n1）在调试模式下运行被测程序并启动OpenCover（将代码构建到调试模式获取PDB文件）\n2）所有在站点下运行的应用程序都必须使用相同的应用程序池；否则，会报错\n3）在调试模式下启动被测程序前，需要停止intserver（启动被测程序的服务）\n\n### 原文描述：\n```python Running against IIS\nNormally I’d suggest running against IISEXPPRESS as I think it is easier to automate. However for those who really want to run against a full blown IIS then the following instructions (supplied by a user) will hopefully suffice.\n“The trick is to start OpenCover to run the w3wp.exe process in debug mode e.g.\nOpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe -targetargs:-debug \n-targetdir:C:\\Inetpub\\wwwwoot\\MyWebApp\\bin\\ -filter:+[*]* -register:user\nThere are some prerequisites though:\n1.All applications running under the site must make use of the same app pool; you'll get errors in the EventLog otherwise.\n2.inetserver needs to be stopped, before starting w3wp.exe in debug mode. You can use the following command:\nnet stop w3svc /y\nAfter testing/code coverage completion you can close the w3wp.exe process and start the inetserver again:\nnet start w3svc\nThis procedure was tested on a Win2008 machine with IIS7.5”\nYou can also run multiple OpenCover instances against separate IIS sites by using the –s option when running IIS to choose the siteid e.g.\nOpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe \n    -targetargs:\"-debug -s 1\" \n    -targetdir:%WebSite_Path% \n    -filter:+[*]* \n    -register:user \n    -output:%CoverageResult_Path%\nThen you can use ReportGenerator to merge the coverage results. \n```\n \n## 关于PDB文件：\n* PDB是Program Data Base 的缩写, 程序数据库（.pdb）文件（也称为符号文件）。\n* 它将项目源代码中的标识符和语句映射为已编译应用程序中的相应标识符和指令。这些映射文件将调试器链接到您的源代码，从而可以进行调试, 跟踪到特定的函数和代码行。\n* 它包含调试代码时所需的许多重要相关信息（在Visual Studio中），例如，在您希望调试器在Visual Studio中中断的位置插入断点。\n* 当加载一个模块(dll文件), debugger找到对应的pdb(Program Debug Database)文件. 文件中记录了模块的变量、方法、类、源代码行数等信息, 包含类型和符号化调试信息编译和链接项目的过程中收集的二进制文件。\n<a href=\"https://blogs.msdn.microsoft.com/vcblog/2016/02/08/whats-inside-a-pdb-file/\">参考1 </a><a href=\"https://tpodolak.com/blog/2017/10/12/net-core-calculating-code-coverage-opencover-windows/\">参考2  </a><a href=\"http://www.cnblogs.com/itech/archive/2011/08/15/2136522.html\">参考3  </a><a href=\"https://blog.csdn.net/feihe0755/article/details/54233714\">参考4</a>\n\n## FAQ:\n### 1）若提示\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glae8bzjk4j30hr02e0sn.jpg)\n* 原因有三：　\n（1）未走到相关代码\n（2）缺少对应的pdb文件\n（3）未正确注册Profiler，添加参数-register:账号名","source":"_posts/基于OpenCover进行代码覆盖率测试.md","raw":"---\ntitle: 基于OpenCover的代码覆盖率测试\nabbrlink: 8920367b\ndate: 2020-12-03 07:40:59\ntags:\n  - 覆盖率测试\n  - 测试\n---\n## 前言\n之前的工作中有用到OpenCover对项目中的Asp.Net站点、服务进行覆盖率测试, 现在重新整理下笔记.\n\n## OpenCover简介：\n* 一个用于.NET 2.0及以上应用程序的代码覆盖的开源命令行工具;\n<!-- more -->\n* 使用PDB文件提供序列信息，来确定dll文件中哪些代码行与源代码的每一行相关联，然后检测、插桩每个序列点以记录命中的行;\n    * 因此必须要有的是PDB文件以及可执行文件和程序集，应该在调试模式下构建测试中的应用程序。如果未找到PDB文件，则不会收集任何覆盖数据;\n* 使用COM（组件对象模型）开发，检测程序profiler部分则使用c++;\n* 使用mono.Cecil来分析分支或IL以确定在何处检测代码;\n\n### OpenCover提供的指标有：\n1. 声明范围, 即已涵盖的行数。\n2. 方法覆盖范围，即涵盖了哪些方法。\n3. 分支覆盖范围, 即采取了哪些分支, 这与圈复杂度有关\n\n## OpenCover主要命令参数：\n* -target： 应用程序可执行文件或服务名称的路径  \n我的理解：就是配置将被测程序运行起来的程序或服务。大多用的NUnit。本文例子用的是IIS Express\n* -filter： 应用于选择性地包括或排除coverage结果中的程序集和类的过滤器列表 \n * 默认选择所有的类和方法\n * 使用PartCover语法，(+|-)[Assembly-Filter]Type-Filter。\n * 例如，+[Open\\*]* 包括以Open开头的程序\n * -[\\*]Core.\\* 排除Core命名空间中的所有类型(跟程序集无关)。\n * 如果未提供过滤器，+[\\*]\\*则会自动应用默认包含所有的过滤器。\n* -output： 输出XML文件的路径，如果为空，则将在当前目录中创建results.xml\n* -register [：user] - 注册和取消注册代码覆盖率分析器\n* -targetargs： - 要传递给目标进程的参数（可指定被测程序的路径）\n* -targetdir： - 目标目录的路径或PDB文件的备用路径  \n如果-targetargs 已经指定了被测程序的路径，那么这里可作为查找PDB文件的依据。本文例子则作为查找PDB文件的路径\n<a href=\"https://github.com/OpenCover/opencover/wiki/Usage\">用法  </a><a href=\"https://github.com/opencover/opencover/blob/master/main/OpenCover.Documentation/Usage.pdf\">文档</a>\n<a href=\"http://www.cnblogs.com/binyao/category/477233.html\">参考1  </a><a href=\"http://www.cnblogs.com/tylerzhou/p/9076386.html\">参考2  </a><a href=\"http://blog.alantsai.net/posts/2017/01/devopsseries-opencover-intro\">参考3  </a><a href=\"https://www.codeproject.com/Articles/677691/Getting-code-coverage-from-your-NET-testing-using\">参考4</a>\n\n\n## 未使用OpenCover时，被测程序的正常运行流程：\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glabzct7wqj30ga03fmx3.jpg)\n\n## 使用OpenCover、ReportGenerator后，被测程序的运行流程：\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac00ut37j30hd06ldg3.jpg)\n* 1)命令行调用OpenCover.Console.exe\n* 2)OpenCover使用SentrySdk收集崩溃报告\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac1j082fj30jp0hxwfy.jpg)\n* 3)解析命令行中传入的参数（被测程序路径、要打印使用说明、是否启动服务、过滤信息等）\n* 4)处理过滤器信息，如果命令行中未传-filter参数，则默认匹配分析所有的类和方法——>创建性能计数器\n* 5)得到输出xml报告的全路径\n* 6)初始化封装了注入框架依赖的容器\n* 7)创建文件句柄，后续将覆盖率信息写入文件中。如果已经存在覆盖率xml文件，则合并\n* 8)启动覆盖率分析进程。注册分析器，调用OpenCover.Profiler.dll\n* 9)启动托管被测代码的程序(IIS Express)\n* 10)访问站点测试被测程序\n* 11)关闭IIS Express, 得到运行结果同时，也得到xml覆盖率结果\n* 12)ReportGenerator将xml转成HTML\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glacgqgvjyj316b0mcaig.jpg)\n\n## OpenCover和ReportGenerator的主要配置流程：\n### 以测试站点程序为例:\n* 1)配置好OpenCover、ReportGenerator、被测程序的路径、IIS Express config的路径\n* 2)执行配置好相关参数的CMD命令, 示例如下：\n```python\nH:\\白盒测试\\Debug\\Opencover\\OpenCover.Console.exe -target:\"C:\\Program Files (x86)\\IIS Express\\iisexpress.exe\" -targetdir:\"D:\\被测站点\\xxx.xxx.com\\bin\" -targetargs:\"/site:xxx_bh.xxx.com /config:\\\"C:\\Users\\ym\\Documents\\IISExpress\\config\\applicationhost.config\\\"\" -register:ym -output:\"H:\\白盒测试\\xml_ym\\xxx_bh.xxx.com\\xxx_bh.xxx.com.xml\"\n```\n* 3)此时IIS Express已经启动，访问在通过IIS Express配置的站点，开始测试。\n* 4)测试完成后，退出IIS Express，生成xml文件。\n* 5)使用ReportGenerator生成HTML文档，CMD命令示例如下：\n```python\nH:\\白盒测试\\Debug\\ReportGenerator\\ReportGenerator.exe -reports:H:\\白盒测试\\xml\\白盒测试.xml -targetdir:H:\\白盒测试\\xml\\html\n```\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glaci6hhr3j310r0fxwhk.jpg)\n\n## ReportGenerator概述：\n* ReportGenerator用于将OpenCover，PartCover，Visual Studio或NCover生成的XML报告转换为各种格式的友好可读报告。\n* 主要就是配置xml文件的路径和输出html的路径, 执行命令后, ReportGenerator就会解析传入的参数, 然后输出报告\n### 常用的命令行参数：\n* -reports： - 应该解析的覆盖率报告，分号分隔，允许使用通配符\n* -targetdir： - 应保存生成的报告的目录\n* -sourcedirs：[;] [;] - 包含相应源代码的目录，可选，分号分隔\n* -classfilters：<（+ | - ）filter> [; <（+ | - ）filter>] [; <（+ | - ）filter>] - 报表中应包含或排除的类列表，可选，可用通配符。\n* 如果是测试Windows服务的覆盖率：\n1）执行如下命令启动服务：\nG:\\Opencover所在路径\\OpenCover.Console.exe -service:byname -target:安装好的服务名 -register:ym -output:H:\\白盒测试保存路径\\xxx\\xxx.xml \n2）测试完毕后，正常关闭服务，则可收集覆盖数据。\n\n### 报告部分截图\n* 包含语句覆盖和分支覆盖情况。点击相应的页面，会进入对应程序，可看到具体覆盖到哪一行代码。\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac4ottr3j30s30hbaay.jpg)\n\n### 代码覆盖详情截图\n* 绿色表示完全覆盖，橙色表示该行代码还有分支未覆盖到，红色则未覆盖。\n![](https://tva1.sinaimg.cn/large/0081Kckwgy1glac58dbfij30nf08qglt.jpg)\n\n<a href=\"https://github.com/OpenCover/opencover/wiki/Service-Support\">文档中的描述  </a><a href=\"https://www.cnblogs.com/tylerzhou/p/9076537.html\">参考资料1  </a><a href=\"https://www.cnblogs.com/SivilTaram/p/vs_opencover_unit_coverage.html\">参考资料2</a>\n\n## 关于IIS Express：\n* 一个兼具Visual Studio的ASP.NET开发服务器和Windows的IIS Web服务器功能的轻量级web服务器。\n<a href=\"https://stackify.com/what-is-iis-express/\">具体描述   </a><a href=\"https://blog.csdn.net/zhangjk1993/article/details/36671105\">配置</a>\n\n### 为什么用IIS Express：\n更轻便, 易于实现自动化. 而结合实际需求，虽然也可以直接往-target传参为IIS的启动程序来进行监控测试情况，但是IIS还部署了其他非测试站点，会相互影响。所以实际应用还是采用IIS Express，每个测试人员部署自己的IIS Express，而不会相互影响。\n### 启动完整的IIS的操作：\n1）在调试模式下运行被测程序并启动OpenCover（将代码构建到调试模式获取PDB文件）\n2）所有在站点下运行的应用程序都必须使用相同的应用程序池；否则，会报错\n3）在调试模式下启动被测程序前，需要停止intserver（启动被测程序的服务）\n\n### 原文描述：\n```python Running against IIS\nNormally I’d suggest running against IISEXPPRESS as I think it is easier to automate. However for those who really want to run against a full blown IIS then the following instructions (supplied by a user) will hopefully suffice.\n“The trick is to start OpenCover to run the w3wp.exe process in debug mode e.g.\nOpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe -targetargs:-debug \n-targetdir:C:\\Inetpub\\wwwwoot\\MyWebApp\\bin\\ -filter:+[*]* -register:user\nThere are some prerequisites though:\n1.All applications running under the site must make use of the same app pool; you'll get errors in the EventLog otherwise.\n2.inetserver needs to be stopped, before starting w3wp.exe in debug mode. You can use the following command:\nnet stop w3svc /y\nAfter testing/code coverage completion you can close the w3wp.exe process and start the inetserver again:\nnet start w3svc\nThis procedure was tested on a Win2008 machine with IIS7.5”\nYou can also run multiple OpenCover instances against separate IIS sites by using the –s option when running IIS to choose the siteid e.g.\nOpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe \n    -targetargs:\"-debug -s 1\" \n    -targetdir:%WebSite_Path% \n    -filter:+[*]* \n    -register:user \n    -output:%CoverageResult_Path%\nThen you can use ReportGenerator to merge the coverage results. \n```\n \n## 关于PDB文件：\n* PDB是Program Data Base 的缩写, 程序数据库（.pdb）文件（也称为符号文件）。\n* 它将项目源代码中的标识符和语句映射为已编译应用程序中的相应标识符和指令。这些映射文件将调试器链接到您的源代码，从而可以进行调试, 跟踪到特定的函数和代码行。\n* 它包含调试代码时所需的许多重要相关信息（在Visual Studio中），例如，在您希望调试器在Visual Studio中中断的位置插入断点。\n* 当加载一个模块(dll文件), debugger找到对应的pdb(Program Debug Database)文件. 文件中记录了模块的变量、方法、类、源代码行数等信息, 包含类型和符号化调试信息编译和链接项目的过程中收集的二进制文件。\n<a href=\"https://blogs.msdn.microsoft.com/vcblog/2016/02/08/whats-inside-a-pdb-file/\">参考1 </a><a href=\"https://tpodolak.com/blog/2017/10/12/net-core-calculating-code-coverage-opencover-windows/\">参考2  </a><a href=\"http://www.cnblogs.com/itech/archive/2011/08/15/2136522.html\">参考3  </a><a href=\"https://blog.csdn.net/feihe0755/article/details/54233714\">参考4</a>\n\n## FAQ:\n### 1）若提示\n* ![](https://tva1.sinaimg.cn/large/0081Kckwgy1glae8bzjk4j30hr02e0sn.jpg)\n* 原因有三：　\n（1）未走到相关代码\n（2）缺少对应的pdb文件\n（3）未正确注册Profiler，添加参数-register:账号名","slug":"基于OpenCover进行代码覆盖率测试","published":1,"updated":"2021-02-04T02:38:05.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai129000ounrahsoqaokp","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>之前的工作中有用到OpenCover对项目中的Asp.Net站点、服务进行覆盖率测试, 现在重新整理下笔记.</p>\n<h2 id=\"OpenCover简介：\"><a href=\"#OpenCover简介：\" class=\"headerlink\" title=\"OpenCover简介：\"></a>OpenCover简介：</h2><ul>\n<li>一个用于.NET 2.0及以上应用程序的代码覆盖的开源命令行工具;<a id=\"more\"></a></li>\n<li>使用PDB文件提供序列信息，来确定dll文件中哪些代码行与源代码的每一行相关联，然后检测、插桩每个序列点以记录命中的行;<ul>\n<li>因此必须要有的是PDB文件以及可执行文件和程序集，应该在调试模式下构建测试中的应用程序。如果未找到PDB文件，则不会收集任何覆盖数据;</li>\n</ul>\n</li>\n<li>使用COM（组件对象模型）开发，检测程序profiler部分则使用c++;</li>\n<li>使用mono.Cecil来分析分支或IL以确定在何处检测代码;</li>\n</ul>\n<h3 id=\"OpenCover提供的指标有：\"><a href=\"#OpenCover提供的指标有：\" class=\"headerlink\" title=\"OpenCover提供的指标有：\"></a>OpenCover提供的指标有：</h3><ol>\n<li>声明范围, 即已涵盖的行数。</li>\n<li>方法覆盖范围，即涵盖了哪些方法。</li>\n<li>分支覆盖范围, 即采取了哪些分支, 这与圈复杂度有关</li>\n</ol>\n<h2 id=\"OpenCover主要命令参数：\"><a href=\"#OpenCover主要命令参数：\" class=\"headerlink\" title=\"OpenCover主要命令参数：\"></a>OpenCover主要命令参数：</h2><ul>\n<li>-target： 应用程序可执行文件或服务名称的路径<br>我的理解：就是配置将被测程序运行起来的程序或服务。大多用的NUnit。本文例子用的是IIS Express</li>\n<li>-filter： 应用于选择性地包括或排除coverage结果中的程序集和类的过滤器列表 <ul>\n<li>默认选择所有的类和方法</li>\n<li>使用PartCover语法，(+|-)[Assembly-Filter]Type-Filter。</li>\n<li>例如，+[Open*]* 包括以Open开头的程序</li>\n<li>-[*]Core.* 排除Core命名空间中的所有类型(跟程序集无关)。</li>\n<li>如果未提供过滤器，+[*]*则会自动应用默认包含所有的过滤器。</li>\n</ul>\n</li>\n<li>-output： 输出XML文件的路径，如果为空，则将在当前目录中创建results.xml</li>\n<li>-register [：user] - 注册和取消注册代码覆盖率分析器</li>\n<li>-targetargs： - 要传递给目标进程的参数（可指定被测程序的路径）</li>\n<li>-targetdir： - 目标目录的路径或PDB文件的备用路径<br>如果-targetargs 已经指定了被测程序的路径，那么这里可作为查找PDB文件的依据。本文例子则作为查找PDB文件的路径<br><a href=\"https://github.com/OpenCover/opencover/wiki/Usage\" target=\"_blank\" rel=\"noopener\">用法  </a><a href=\"https://github.com/opencover/opencover/blob/master/main/OpenCover.Documentation/Usage.pdf\" target=\"_blank\" rel=\"noopener\">文档</a><br><a href=\"http://www.cnblogs.com/binyao/category/477233.html\" target=\"_blank\" rel=\"noopener\">参考1  </a><a href=\"http://www.cnblogs.com/tylerzhou/p/9076386.html\" target=\"_blank\" rel=\"noopener\">参考2  </a><a href=\"http://blog.alantsai.net/posts/2017/01/devopsseries-opencover-intro\" target=\"_blank\" rel=\"noopener\">参考3  </a><a href=\"https://www.codeproject.com/Articles/677691/Getting-code-coverage-from-your-NET-testing-using\" target=\"_blank\" rel=\"noopener\">参考4</a></li>\n</ul>\n<h2 id=\"未使用OpenCover时，被测程序的正常运行流程：\"><a href=\"#未使用OpenCover时，被测程序的正常运行流程：\" class=\"headerlink\" title=\"未使用OpenCover时，被测程序的正常运行流程：\"></a>未使用OpenCover时，被测程序的正常运行流程：</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glabzct7wqj30ga03fmx3.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"使用OpenCover、ReportGenerator后，被测程序的运行流程：\"><a href=\"#使用OpenCover、ReportGenerator后，被测程序的运行流程：\" class=\"headerlink\" title=\"使用OpenCover、ReportGenerator后，被测程序的运行流程：\"></a>使用OpenCover、ReportGenerator后，被测程序的运行流程：</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac00ut37j30hd06ldg3.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<ul>\n<li>1)命令行调用OpenCover.Console.exe</li>\n<li>2)OpenCover使用SentrySdk收集崩溃报告<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac1j082fj30jp0hxwfy.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>3)解析命令行中传入的参数（被测程序路径、要打印使用说明、是否启动服务、过滤信息等）</li>\n<li>4)处理过滤器信息，如果命令行中未传-filter参数，则默认匹配分析所有的类和方法——&gt;创建性能计数器</li>\n<li>5)得到输出xml报告的全路径</li>\n<li>6)初始化封装了注入框架依赖的容器</li>\n<li>7)创建文件句柄，后续将覆盖率信息写入文件中。如果已经存在覆盖率xml文件，则合并</li>\n<li>8)启动覆盖率分析进程。注册分析器，调用OpenCover.Profiler.dll</li>\n<li>9)启动托管被测代码的程序(IIS Express)</li>\n<li>10)访问站点测试被测程序</li>\n<li>11)关闭IIS Express, 得到运行结果同时，也得到xml覆盖率结果</li>\n<li>12)ReportGenerator将xml转成HTML</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glacgqgvjyj316b0mcaig.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"OpenCover和ReportGenerator的主要配置流程：\"><a href=\"#OpenCover和ReportGenerator的主要配置流程：\" class=\"headerlink\" title=\"OpenCover和ReportGenerator的主要配置流程：\"></a>OpenCover和ReportGenerator的主要配置流程：</h2><h3 id=\"以测试站点程序为例\"><a href=\"#以测试站点程序为例\" class=\"headerlink\" title=\"以测试站点程序为例:\"></a>以测试站点程序为例:</h3><ul>\n<li>1)配置好OpenCover、ReportGenerator、被测程序的路径、IIS Express config的路径</li>\n<li>2)执行配置好相关参数的CMD命令, 示例如下：<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">H:\\白盒测试\\Debug\\Opencover\\OpenCover.Console.exe -target:<span class=\"string\">\"C:\\Program Files (x86)\\IIS Express\\iisexpress.exe\"</span> -targetdir:<span class=\"string\">\"D:\\被测站点\\xxx.xxx.com\\bin\"</span> -targetargs:<span class=\"string\">\"/site:xxx_bh.xxx.com /config:\\\"C:\\Users\\ym\\Documents\\IISExpress\\config\\applicationhost.config\\\"\"</span> -register:ym -output:<span class=\"string\">\"H:\\白盒测试\\xml_ym\\xxx_bh.xxx.com\\xxx_bh.xxx.com.xml\"</span></span><br></pre></td></tr></tbody></table></figure></li>\n<li>3)此时IIS Express已经启动，访问在通过IIS Express配置的站点，开始测试。</li>\n<li>4)测试完成后，退出IIS Express，生成xml文件。</li>\n<li>5)使用ReportGenerator生成HTML文档，CMD命令示例如下：<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">H:\\白盒测试\\Debug\\ReportGenerator\\ReportGenerator.exe -reports:H:\\白盒测试\\xml\\白盒测试.xml -targetdir:H:\\白盒测试\\xml\\html</span><br></pre></td></tr></tbody></table></figure></li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glaci6hhr3j310r0fxwhk.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"ReportGenerator概述：\"><a href=\"#ReportGenerator概述：\" class=\"headerlink\" title=\"ReportGenerator概述：\"></a>ReportGenerator概述：</h2><ul>\n<li>ReportGenerator用于将OpenCover，PartCover，Visual Studio或NCover生成的XML报告转换为各种格式的友好可读报告。</li>\n<li>主要就是配置xml文件的路径和输出html的路径, 执行命令后, ReportGenerator就会解析传入的参数, 然后输出报告<h3 id=\"常用的命令行参数：\"><a href=\"#常用的命令行参数：\" class=\"headerlink\" title=\"常用的命令行参数：\"></a>常用的命令行参数：</h3></li>\n<li>-reports： - 应该解析的覆盖率报告，分号分隔，允许使用通配符</li>\n<li>-targetdir： - 应保存生成的报告的目录</li>\n<li>-sourcedirs：[;] [;] - 包含相应源代码的目录，可选，分号分隔</li>\n<li>-classfilters：&lt;（+ | - ）filter&gt; [; &lt;（+ | - ）filter&gt;] [; &lt;（+ | - ）filter&gt;] - 报表中应包含或排除的类列表，可选，可用通配符。</li>\n<li>如果是测试Windows服务的覆盖率：<br>1）执行如下命令启动服务：<br>G:\\Opencover所在路径\\OpenCover.Console.exe -service:byname -target:安装好的服务名 -register:ym -output:H:\\白盒测试保存路径\\xxx\\xxx.xml<br>2）测试完毕后，正常关闭服务，则可收集覆盖数据。</li>\n</ul>\n<h3 id=\"报告部分截图\"><a href=\"#报告部分截图\" class=\"headerlink\" title=\"报告部分截图\"></a>报告部分截图</h3><ul>\n<li>包含语句覆盖和分支覆盖情况。点击相应的页面，会进入对应程序，可看到具体覆盖到哪一行代码。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac4ottr3j30s30hbaay.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h3 id=\"代码覆盖详情截图\"><a href=\"#代码覆盖详情截图\" class=\"headerlink\" title=\"代码覆盖详情截图\"></a>代码覆盖详情截图</h3><ul>\n<li>绿色表示完全覆盖，橙色表示该行代码还有分支未覆盖到，红色则未覆盖。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac58dbfij30nf08qglt.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<p><a href=\"https://github.com/OpenCover/opencover/wiki/Service-Support\" target=\"_blank\" rel=\"noopener\">文档中的描述  </a><a href=\"https://www.cnblogs.com/tylerzhou/p/9076537.html\" target=\"_blank\" rel=\"noopener\">参考资料1  </a><a href=\"https://www.cnblogs.com/SivilTaram/p/vs_opencover_unit_coverage.html\" target=\"_blank\" rel=\"noopener\">参考资料2</a></p>\n<h2 id=\"关于IIS-Express：\"><a href=\"#关于IIS-Express：\" class=\"headerlink\" title=\"关于IIS Express：\"></a>关于IIS Express：</h2><ul>\n<li>一个兼具Visual Studio的ASP.NET开发服务器和Windows的IIS Web服务器功能的轻量级web服务器。<br><a href=\"https://stackify.com/what-is-iis-express/\" target=\"_blank\" rel=\"noopener\">具体描述   </a><a href=\"https://blog.csdn.net/zhangjk1993/article/details/36671105\" target=\"_blank\" rel=\"noopener\">配置</a></li>\n</ul>\n<h3 id=\"为什么用IIS-Express：\"><a href=\"#为什么用IIS-Express：\" class=\"headerlink\" title=\"为什么用IIS Express：\"></a>为什么用IIS Express：</h3><p>更轻便, 易于实现自动化. 而结合实际需求，虽然也可以直接往-target传参为IIS的启动程序来进行监控测试情况，但是IIS还部署了其他非测试站点，会相互影响。所以实际应用还是采用IIS Express，每个测试人员部署自己的IIS Express，而不会相互影响。</p>\n<h3 id=\"启动完整的IIS的操作：\"><a href=\"#启动完整的IIS的操作：\" class=\"headerlink\" title=\"启动完整的IIS的操作：\"></a>启动完整的IIS的操作：</h3><p>1）在调试模式下运行被测程序并启动OpenCover（将代码构建到调试模式获取PDB文件）<br>2）所有在站点下运行的应用程序都必须使用相同的应用程序池；否则，会报错<br>3）在调试模式下启动被测程序前，需要停止intserver（启动被测程序的服务）</p>\n<h3 id=\"原文描述：\"><a href=\"#原文描述：\" class=\"headerlink\" title=\"原文描述：\"></a>原文描述：</h3><figure class=\"highlight python\"><figcaption><span>Running against IIS</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Normally I’d suggest running against IISEXPPRESS <span class=\"keyword\">as</span> I think it <span class=\"keyword\">is</span> easier to automate. However <span class=\"keyword\">for</span> those who really want to run against a full blown IIS then the following instructions (supplied by a user) will hopefully suffice.</span><br><span class=\"line\">“The trick <span class=\"keyword\">is</span> to start OpenCover to run the w3wp.exe process <span class=\"keyword\">in</span> debug mode e.g.</span><br><span class=\"line\">OpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe -targetargs:-debug </span><br><span class=\"line\">-targetdir:C:\\Inetpub\\wwwwoot\\MyWebApp\\bin\\ -filter:+[*]* -register:user</span><br><span class=\"line\">There are some prerequisites though:</span><br><span class=\"line\"><span class=\"number\">1.</span>All applications running under the site must make use of the same app pool; yo<span class=\"string\">u'll get errors in the EventLog otherwise.</span></span><br><span class=\"line\"><span class=\"string\">2.inetserver needs to be stopped, before starting w3wp.exe in debug mode. You can use the following command:</span></span><br><span class=\"line\"><span class=\"string\">net stop w3svc /y</span></span><br><span class=\"line\"><span class=\"string\">After testing/code coverage completion you can close the w3wp.exe process and start the inetserver again:</span></span><br><span class=\"line\"><span class=\"string\">net start w3svc</span></span><br><span class=\"line\"><span class=\"string\">This procedure was tested on a Win2008 machine with IIS7.5”</span></span><br><span class=\"line\"><span class=\"string\">You can also run multiple OpenCover instances against separate IIS sites by using the –s option when running IIS to choose the siteid e.g.</span></span><br><span class=\"line\"><span class=\"string\">OpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe </span></span><br><span class=\"line\"><span class=\"string\">    -targetargs:\"-debug -s 1\" </span></span><br><span class=\"line\"><span class=\"string\">    -targetdir:%WebSite_Path% </span></span><br><span class=\"line\"><span class=\"string\">    -filter:+[*]* </span></span><br><span class=\"line\"><span class=\"string\">    -register:user </span></span><br><span class=\"line\"><span class=\"string\">    -output:%CoverageResult_Path%</span></span><br><span class=\"line\"><span class=\"string\">Then you can use ReportGenerator to merge the coverage results.</span></span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"关于PDB文件：\"><a href=\"#关于PDB文件：\" class=\"headerlink\" title=\"关于PDB文件：\"></a>关于PDB文件：</h2><ul>\n<li>PDB是Program Data Base 的缩写, 程序数据库（.pdb）文件（也称为符号文件）。</li>\n<li>它将项目源代码中的标识符和语句映射为已编译应用程序中的相应标识符和指令。这些映射文件将调试器链接到您的源代码，从而可以进行调试, 跟踪到特定的函数和代码行。</li>\n<li>它包含调试代码时所需的许多重要相关信息（在Visual Studio中），例如，在您希望调试器在Visual Studio中中断的位置插入断点。</li>\n<li>当加载一个模块(dll文件), debugger找到对应的pdb(Program Debug Database)文件. 文件中记录了模块的变量、方法、类、源代码行数等信息, 包含类型和符号化调试信息编译和链接项目的过程中收集的二进制文件。<br><a href=\"https://blogs.msdn.microsoft.com/vcblog/2016/02/08/whats-inside-a-pdb-file/\" target=\"_blank\" rel=\"noopener\">参考1 </a><a href=\"https://tpodolak.com/blog/2017/10/12/net-core-calculating-code-coverage-opencover-windows/\" target=\"_blank\" rel=\"noopener\">参考2  </a><a href=\"http://www.cnblogs.com/itech/archive/2011/08/15/2136522.html\" target=\"_blank\" rel=\"noopener\">参考3  </a><a href=\"https://blog.csdn.net/feihe0755/article/details/54233714\" target=\"_blank\" rel=\"noopener\">参考4</a></li>\n</ul>\n<h2 id=\"FAQ\"><a href=\"#FAQ\" class=\"headerlink\" title=\"FAQ:\"></a>FAQ:</h2><h3 id=\"1）若提示\"><a href=\"#1）若提示\" class=\"headerlink\" title=\"1）若提示\"></a>1）若提示</h3><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glae8bzjk4j30hr02e0sn.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>原因有三：　<br>（1）未走到相关代码<br>（2）缺少对应的pdb文件<br>（3）未正确注册Profiler，添加参数-register:账号名</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>之前的工作中有用到OpenCover对项目中的Asp.Net站点、服务进行覆盖率测试, 现在重新整理下笔记.</p>\n<h2 id=\"OpenCover简介：\"><a href=\"#OpenCover简介：\" class=\"headerlink\" title=\"OpenCover简介：\"></a>OpenCover简介：</h2><ul>\n<li>一个用于.NET 2.0及以上应用程序的代码覆盖的开源命令行工具;</li></ul>","more":"</li>\n<li>使用PDB文件提供序列信息，来确定dll文件中哪些代码行与源代码的每一行相关联，然后检测、插桩每个序列点以记录命中的行;<ul>\n<li>因此必须要有的是PDB文件以及可执行文件和程序集，应该在调试模式下构建测试中的应用程序。如果未找到PDB文件，则不会收集任何覆盖数据;</li>\n</ul>\n</li>\n<li>使用COM（组件对象模型）开发，检测程序profiler部分则使用c++;</li>\n<li>使用mono.Cecil来分析分支或IL以确定在何处检测代码;</li>\n</ul>\n<h3 id=\"OpenCover提供的指标有：\"><a href=\"#OpenCover提供的指标有：\" class=\"headerlink\" title=\"OpenCover提供的指标有：\"></a>OpenCover提供的指标有：</h3><ol>\n<li>声明范围, 即已涵盖的行数。</li>\n<li>方法覆盖范围，即涵盖了哪些方法。</li>\n<li>分支覆盖范围, 即采取了哪些分支, 这与圈复杂度有关</li>\n</ol>\n<h2 id=\"OpenCover主要命令参数：\"><a href=\"#OpenCover主要命令参数：\" class=\"headerlink\" title=\"OpenCover主要命令参数：\"></a>OpenCover主要命令参数：</h2><ul>\n<li>-target： 应用程序可执行文件或服务名称的路径<br>我的理解：就是配置将被测程序运行起来的程序或服务。大多用的NUnit。本文例子用的是IIS Express</li>\n<li>-filter： 应用于选择性地包括或排除coverage结果中的程序集和类的过滤器列表 <ul>\n<li>默认选择所有的类和方法</li>\n<li>使用PartCover语法，(+|-)[Assembly-Filter]Type-Filter。</li>\n<li>例如，+[Open*]* 包括以Open开头的程序</li>\n<li>-[*]Core.* 排除Core命名空间中的所有类型(跟程序集无关)。</li>\n<li>如果未提供过滤器，+[*]*则会自动应用默认包含所有的过滤器。</li>\n</ul>\n</li>\n<li>-output： 输出XML文件的路径，如果为空，则将在当前目录中创建results.xml</li>\n<li>-register [：user] - 注册和取消注册代码覆盖率分析器</li>\n<li>-targetargs： - 要传递给目标进程的参数（可指定被测程序的路径）</li>\n<li>-targetdir： - 目标目录的路径或PDB文件的备用路径<br>如果-targetargs 已经指定了被测程序的路径，那么这里可作为查找PDB文件的依据。本文例子则作为查找PDB文件的路径<br><a href=\"https://github.com/OpenCover/opencover/wiki/Usage\" target=\"_blank\" rel=\"noopener\">用法  </a><a href=\"https://github.com/opencover/opencover/blob/master/main/OpenCover.Documentation/Usage.pdf\" target=\"_blank\" rel=\"noopener\">文档</a><br><a href=\"http://www.cnblogs.com/binyao/category/477233.html\" target=\"_blank\" rel=\"noopener\">参考1  </a><a href=\"http://www.cnblogs.com/tylerzhou/p/9076386.html\" target=\"_blank\" rel=\"noopener\">参考2  </a><a href=\"http://blog.alantsai.net/posts/2017/01/devopsseries-opencover-intro\" target=\"_blank\" rel=\"noopener\">参考3  </a><a href=\"https://www.codeproject.com/Articles/677691/Getting-code-coverage-from-your-NET-testing-using\" target=\"_blank\" rel=\"noopener\">参考4</a></li>\n</ul>\n<h2 id=\"未使用OpenCover时，被测程序的正常运行流程：\"><a href=\"#未使用OpenCover时，被测程序的正常运行流程：\" class=\"headerlink\" title=\"未使用OpenCover时，被测程序的正常运行流程：\"></a>未使用OpenCover时，被测程序的正常运行流程：</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glabzct7wqj30ga03fmx3.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n<h2 id=\"使用OpenCover、ReportGenerator后，被测程序的运行流程：\"><a href=\"#使用OpenCover、ReportGenerator后，被测程序的运行流程：\" class=\"headerlink\" title=\"使用OpenCover、ReportGenerator后，被测程序的运行流程：\"></a>使用OpenCover、ReportGenerator后，被测程序的运行流程：</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac00ut37j30hd06ldg3.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n<ul>\n<li>1)命令行调用OpenCover.Console.exe</li>\n<li>2)OpenCover使用SentrySdk收集崩溃报告<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac1j082fj30jp0hxwfy.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>3)解析命令行中传入的参数（被测程序路径、要打印使用说明、是否启动服务、过滤信息等）</li>\n<li>4)处理过滤器信息，如果命令行中未传-filter参数，则默认匹配分析所有的类和方法——&gt;创建性能计数器</li>\n<li>5)得到输出xml报告的全路径</li>\n<li>6)初始化封装了注入框架依赖的容器</li>\n<li>7)创建文件句柄，后续将覆盖率信息写入文件中。如果已经存在覆盖率xml文件，则合并</li>\n<li>8)启动覆盖率分析进程。注册分析器，调用OpenCover.Profiler.dll</li>\n<li>9)启动托管被测代码的程序(IIS Express)</li>\n<li>10)访问站点测试被测程序</li>\n<li>11)关闭IIS Express, 得到运行结果同时，也得到xml覆盖率结果</li>\n<li>12)ReportGenerator将xml转成HTML</li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glacgqgvjyj316b0mcaig.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"OpenCover和ReportGenerator的主要配置流程：\"><a href=\"#OpenCover和ReportGenerator的主要配置流程：\" class=\"headerlink\" title=\"OpenCover和ReportGenerator的主要配置流程：\"></a>OpenCover和ReportGenerator的主要配置流程：</h2><h3 id=\"以测试站点程序为例\"><a href=\"#以测试站点程序为例\" class=\"headerlink\" title=\"以测试站点程序为例:\"></a>以测试站点程序为例:</h3><ul>\n<li>1)配置好OpenCover、ReportGenerator、被测程序的路径、IIS Express config的路径</li>\n<li>2)执行配置好相关参数的CMD命令, 示例如下：<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">H:\\白盒测试\\Debug\\Opencover\\OpenCover.Console.exe -target:<span class=\"string\">\"C:\\Program Files (x86)\\IIS Express\\iisexpress.exe\"</span> -targetdir:<span class=\"string\">\"D:\\被测站点\\xxx.xxx.com\\bin\"</span> -targetargs:<span class=\"string\">\"/site:xxx_bh.xxx.com /config:\\\"C:\\Users\\ym\\Documents\\IISExpress\\config\\applicationhost.config\\\"\"</span> -register:ym -output:<span class=\"string\">\"H:\\白盒测试\\xml_ym\\xxx_bh.xxx.com\\xxx_bh.xxx.com.xml\"</span></span><br></pre></td></tr></table></figure></li>\n<li>3)此时IIS Express已经启动，访问在通过IIS Express配置的站点，开始测试。</li>\n<li>4)测试完成后，退出IIS Express，生成xml文件。</li>\n<li>5)使用ReportGenerator生成HTML文档，CMD命令示例如下：<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">H:\\白盒测试\\Debug\\ReportGenerator\\ReportGenerator.exe -reports:H:\\白盒测试\\xml\\白盒测试.xml -targetdir:H:\\白盒测试\\xml\\html</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glaci6hhr3j310r0fxwhk.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h2 id=\"ReportGenerator概述：\"><a href=\"#ReportGenerator概述：\" class=\"headerlink\" title=\"ReportGenerator概述：\"></a>ReportGenerator概述：</h2><ul>\n<li>ReportGenerator用于将OpenCover，PartCover，Visual Studio或NCover生成的XML报告转换为各种格式的友好可读报告。</li>\n<li>主要就是配置xml文件的路径和输出html的路径, 执行命令后, ReportGenerator就会解析传入的参数, 然后输出报告<h3 id=\"常用的命令行参数：\"><a href=\"#常用的命令行参数：\" class=\"headerlink\" title=\"常用的命令行参数：\"></a>常用的命令行参数：</h3></li>\n<li>-reports： - 应该解析的覆盖率报告，分号分隔，允许使用通配符</li>\n<li>-targetdir： - 应保存生成的报告的目录</li>\n<li>-sourcedirs：[;] [;] - 包含相应源代码的目录，可选，分号分隔</li>\n<li>-classfilters：&lt;（+ | - ）filter&gt; [; &lt;（+ | - ）filter&gt;] [; &lt;（+ | - ）filter&gt;] - 报表中应包含或排除的类列表，可选，可用通配符。</li>\n<li>如果是测试Windows服务的覆盖率：<br>1）执行如下命令启动服务：<br>G:\\Opencover所在路径\\OpenCover.Console.exe -service:byname -target:安装好的服务名 -register:ym -output:H:\\白盒测试保存路径\\xxx\\xxx.xml<br>2）测试完毕后，正常关闭服务，则可收集覆盖数据。</li>\n</ul>\n<h3 id=\"报告部分截图\"><a href=\"#报告部分截图\" class=\"headerlink\" title=\"报告部分截图\"></a>报告部分截图</h3><ul>\n<li>包含语句覆盖和分支覆盖情况。点击相应的页面，会进入对应程序，可看到具体覆盖到哪一行代码。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac4ottr3j30s30hbaay.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h3 id=\"代码覆盖详情截图\"><a href=\"#代码覆盖详情截图\" class=\"headerlink\" title=\"代码覆盖详情截图\"></a>代码覆盖详情截图</h3><ul>\n<li>绿色表示完全覆盖，橙色表示该行代码还有分支未覆盖到，红色则未覆盖。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glac58dbfij30nf08qglt.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<p><a href=\"https://github.com/OpenCover/opencover/wiki/Service-Support\" target=\"_blank\" rel=\"noopener\">文档中的描述  </a><a href=\"https://www.cnblogs.com/tylerzhou/p/9076537.html\" target=\"_blank\" rel=\"noopener\">参考资料1  </a><a href=\"https://www.cnblogs.com/SivilTaram/p/vs_opencover_unit_coverage.html\" target=\"_blank\" rel=\"noopener\">参考资料2</a></p>\n<h2 id=\"关于IIS-Express：\"><a href=\"#关于IIS-Express：\" class=\"headerlink\" title=\"关于IIS Express：\"></a>关于IIS Express：</h2><ul>\n<li>一个兼具Visual Studio的ASP.NET开发服务器和Windows的IIS Web服务器功能的轻量级web服务器。<br><a href=\"https://stackify.com/what-is-iis-express/\" target=\"_blank\" rel=\"noopener\">具体描述   </a><a href=\"https://blog.csdn.net/zhangjk1993/article/details/36671105\" target=\"_blank\" rel=\"noopener\">配置</a></li>\n</ul>\n<h3 id=\"为什么用IIS-Express：\"><a href=\"#为什么用IIS-Express：\" class=\"headerlink\" title=\"为什么用IIS Express：\"></a>为什么用IIS Express：</h3><p>更轻便, 易于实现自动化. 而结合实际需求，虽然也可以直接往-target传参为IIS的启动程序来进行监控测试情况，但是IIS还部署了其他非测试站点，会相互影响。所以实际应用还是采用IIS Express，每个测试人员部署自己的IIS Express，而不会相互影响。</p>\n<h3 id=\"启动完整的IIS的操作：\"><a href=\"#启动完整的IIS的操作：\" class=\"headerlink\" title=\"启动完整的IIS的操作：\"></a>启动完整的IIS的操作：</h3><p>1）在调试模式下运行被测程序并启动OpenCover（将代码构建到调试模式获取PDB文件）<br>2）所有在站点下运行的应用程序都必须使用相同的应用程序池；否则，会报错<br>3）在调试模式下启动被测程序前，需要停止intserver（启动被测程序的服务）</p>\n<h3 id=\"原文描述：\"><a href=\"#原文描述：\" class=\"headerlink\" title=\"原文描述：\"></a>原文描述：</h3><figure class=\"highlight python\"><figcaption><span>Running against IIS</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Normally I’d suggest running against IISEXPPRESS <span class=\"keyword\">as</span> I think it <span class=\"keyword\">is</span> easier to automate. However <span class=\"keyword\">for</span> those who really want to run against a full blown IIS then the following instructions (supplied by a user) will hopefully suffice.</span><br><span class=\"line\">“The trick <span class=\"keyword\">is</span> to start OpenCover to run the w3wp.exe process <span class=\"keyword\">in</span> debug mode e.g.</span><br><span class=\"line\">OpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe -targetargs:-debug </span><br><span class=\"line\">-targetdir:C:\\Inetpub\\wwwwoot\\MyWebApp\\bin\\ -filter:+[*]* -register:user</span><br><span class=\"line\">There are some prerequisites though:</span><br><span class=\"line\"><span class=\"number\">1.</span>All applications running under the site must make use of the same app pool; yo<span class=\"string\">u'll get errors in the EventLog otherwise.</span></span><br><span class=\"line\"><span class=\"string\">2.inetserver needs to be stopped, before starting w3wp.exe in debug mode. You can use the following command:</span></span><br><span class=\"line\"><span class=\"string\">net stop w3svc /y</span></span><br><span class=\"line\"><span class=\"string\">After testing/code coverage completion you can close the w3wp.exe process and start the inetserver again:</span></span><br><span class=\"line\"><span class=\"string\">net start w3svc</span></span><br><span class=\"line\"><span class=\"string\">This procedure was tested on a Win2008 machine with IIS7.5”</span></span><br><span class=\"line\"><span class=\"string\">You can also run multiple OpenCover instances against separate IIS sites by using the –s option when running IIS to choose the siteid e.g.</span></span><br><span class=\"line\"><span class=\"string\">OpenCover.Console.exe -target:C:\\Windows\\System32\\inetsrv\\w3wp.exe </span></span><br><span class=\"line\"><span class=\"string\">    -targetargs:\"-debug -s 1\" </span></span><br><span class=\"line\"><span class=\"string\">    -targetdir:%WebSite_Path% </span></span><br><span class=\"line\"><span class=\"string\">    -filter:+[*]* </span></span><br><span class=\"line\"><span class=\"string\">    -register:user </span></span><br><span class=\"line\"><span class=\"string\">    -output:%CoverageResult_Path%</span></span><br><span class=\"line\"><span class=\"string\">Then you can use ReportGenerator to merge the coverage results.</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关于PDB文件：\"><a href=\"#关于PDB文件：\" class=\"headerlink\" title=\"关于PDB文件：\"></a>关于PDB文件：</h2><ul>\n<li>PDB是Program Data Base 的缩写, 程序数据库（.pdb）文件（也称为符号文件）。</li>\n<li>它将项目源代码中的标识符和语句映射为已编译应用程序中的相应标识符和指令。这些映射文件将调试器链接到您的源代码，从而可以进行调试, 跟踪到特定的函数和代码行。</li>\n<li>它包含调试代码时所需的许多重要相关信息（在Visual Studio中），例如，在您希望调试器在Visual Studio中中断的位置插入断点。</li>\n<li>当加载一个模块(dll文件), debugger找到对应的pdb(Program Debug Database)文件. 文件中记录了模块的变量、方法、类、源代码行数等信息, 包含类型和符号化调试信息编译和链接项目的过程中收集的二进制文件。<br><a href=\"https://blogs.msdn.microsoft.com/vcblog/2016/02/08/whats-inside-a-pdb-file/\" target=\"_blank\" rel=\"noopener\">参考1 </a><a href=\"https://tpodolak.com/blog/2017/10/12/net-core-calculating-code-coverage-opencover-windows/\" target=\"_blank\" rel=\"noopener\">参考2  </a><a href=\"http://www.cnblogs.com/itech/archive/2011/08/15/2136522.html\" target=\"_blank\" rel=\"noopener\">参考3  </a><a href=\"https://blog.csdn.net/feihe0755/article/details/54233714\" target=\"_blank\" rel=\"noopener\">参考4</a></li>\n</ul>\n<h2 id=\"FAQ\"><a href=\"#FAQ\" class=\"headerlink\" title=\"FAQ:\"></a>FAQ:</h2><h3 id=\"1）若提示\"><a href=\"#1）若提示\" class=\"headerlink\" title=\"1）若提示\"></a>1）若提示</h3><ul>\n<li><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/0081Kckwgy1glae8bzjk4j30hr02e0sn.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li>原因有三：　<br>（1）未走到相关代码<br>（2）缺少对应的pdb文件<br>（3）未正确注册Profiler，添加参数-register:账号名</li>\n</ul>"},{"title":"凤凰项目-三步工作法笔记","abbrlink":"d698d359","date":"2020-04-14T04:31:11.000Z","top":true,"_content":"## 前言:\n去年想了解DevOps的相关概念, 看了《凤凰项目》这本热荐的入门书. \n\n虽然看起来是一本技术相关的书, 其实以第一人称的视角来讲述, 一个IT运维经理临危受命, 推动项目转型的波折和故事, 特别生动有趣, 每个人物也个性鲜明, 搞得我明明在严肃认真的学习, 却常常像看了不正经的书似的哈哈大笑...\n\n书中还穿插各种吐槽, 有同感的是, 我也在公司年会节目上改编过一首歌词吐槽bug什么的, 不过好在大家都挺包容的... :smile: :sparkles:\n\n不过, 只看一遍过过瘾是不行的, 所以整理了下读书笔记. 下文中就包括《凤凰项目》的故事脉络、有趣段落摘抄、相关概念、个人感悟.\n\n## 故事脉络:\n主角比尔, 一家制造和零售企业的IT运维经理, 面临着被竞争对手不断超越的困境, 接任IT运维部的副总裁, 管理一个叫凤凰的电商系统项目, 以此招揽客户并拯救公司的经济危机.\n<!-- more -->\n### 可视化管理流程\n刚上任就发生工资核算故障, 起因是开发部为了修补一个审计发现, 没遵照规定的流程和测试, 直接部署了个有bug的标记化应用.\n* 暴露的问题: \n    * 1. 流程繁琐、响应慢, 所以申请测试环境的预算一直没审批, 而无法测试;\n    * 2. 各部门沟通、协调不到位;\n        * 业务市场部不断压缩IT部交付部署时间、迫切想先人一步抢夺市场;\n        * 运维部不能及时交付, 开发部申请的设备、环境;\n        * 关于项目完成的定义不统一, 开发部没有考虑运维部署的时间, 总是匆忙上线;\n        * 开发部没有提供清晰的部署文档, 使运维部无法顺利部署, 无法进行压力测试, 没有全面监控和备份;\n        * 运维的关键工程师总是要处理各种故障, 没办法参与开发部的计划会议;\n    * 3. 没人清楚公司整体业务架构, 都在瞎忙;\n\n为了解决以上问题, 采取以下措施:\n* 1. 列出工作任务清单, 了解工作需求、优先级、工作进度、可用资源(如人员职责, 所需时间), 预估工作量, 并合理调配资源;\n    * 识别变更冲突以及可用资源矛盾的风险, 做出相应调整;\n* 2. 设定变更流程, 稳定工作环境, 可视化管理IT运维部里的半成品;\n    * 在白板上, 列出所有的变更、相关人员. 所有人一起讨论变更的类型，然后对变更进行筛选和安排;\n    * 把一部分变更审核委派给代理人, 重点关注最有风险的变更;\n        * 预先定义好高风险变更目录, 列出十大最脆弱的服务、应用程序和基础架构列表, 对相关变更申请标上记号, 并详细审查;\n        * 围绕这些变更建立一些标准流程(如跟业务部门确认实施变更的时机), 相关人员关注变更、随时待命;\n    * 对于低风险变更(如增加Java应用程序服务器线程池容量), 仍需要提交, 但可以直接安排操作日程;\n    * 对于复杂的中等变更, 变更提交者获得可能受到影响的人员许可后, 再审核并安排操作日程;\n\n### 规范流程, 保护约束点\n在一次排查故障问题会议上, 各部门又开始推脱责任. 而由于没有相关解决问题的知识库, 很多问题只有高级工程师布伦特能解决, 布伦特成了项目的一个约束点, 虽然也解决了故障, 但是比尔认为这次故障可能是布伦特的某次不规范操作导致.\n* 于是, 采取以下措施:\n    * 记录所有的变更, 不准再出现未经授权或未公开的变更;\n    * 每两周组织一次排查故障的实战演练, 让每个人都养成运用合理的方式来解决问题的习惯;\n        * 如召开应急处置会议之前, 就要把相关时间线搞清楚;\n    * 减少需要布伦特的工作中心数量, 把布伦特的工作标准化，让其他人能够执行;\n        * 建立一个3级工程师的人力资源库, 由他们处理流转过来的工作;\n        * 记录整理故障解决方案到知识库里, 生成能让一些工作中心自动化运行的文档;\n        * 每周逐项检查工作, 不能让布伦特就同一个问题出手两次, 否则3级工程师和布伦特都要受罚;\n        * 提供相关福利, 鼓励布伦特和工程师遵守新的流程;\n    * 保护约束点, 让布伦特只做最重要的凤凰项目的工作;\n        * 任何占用布伦特时间的人都要解释说明, 否则上报;\n        * 过滤涌向布伦特的变更任务, 并在变更卡片上表示出来;\n        * 收集直接找布伦特的名单, 给他们的上司打电话, 让上层知道有人在干扰凤凰项目;\n\n### 问题频出, IT不受上层信任\n因为开发没告诉运维需要打开一个防火墙端口, 而前端程序与数据库服务器通信失败, 代码无法在测试环境中正常运行, 延误了凤凰项目的上线. 以及一些接口延时, 性能相关的bug, 导致所有店内POS系统都会宕机. \n* 暴露的问题:\n    * 部署运行测试的时间太长, 跟不上开发的节奏;\n    * 缺乏版本控制, 开发提供的是不完善的版本, 导致配置测试环境时, 浪费了不必要的时间;\n* 采取措施:\n    * 代码试运行每天只能进行两次, 并限制所有影响性能的代码变更;\n    * 开发人员, 提交的代码必须标注对应某个性能问题的缺陷编号;\n\n而这些问题使上层不信任IT部了, 要将IT部外包. 比尔和开发部老大克里斯因此进行了一次深入交流, 发现大家的压力一样大, 也为公司付出了不少. 克里斯说, 他们总要不断追赶新技术、新的项目管理方法, 一直疲于应付各种故障修复，无暇顾及功能开发, 业务部门还总是不跟IT部门商量可行性, 就直接下达任务.\n\n### 上下一心, 重建团队信任\n* 客户发票系统发生故障, 比尔团队通过一系列不间断的事后调查，搞清楚了故障的来龙去脉，采取了预防措施。同时开展了一系列全员参与的模拟事故呼叫，排演新的处理步骤, 一切都在有序的进行着. 但CEO史蒂夫认为IT部没有‘紧迫感’，要求所有相不相关的工程师都要‘手不离键盘，不能有闲人’, 比尔因此辞职了.\n* 与埃瑞克沟通并反思后, 史蒂夫明白了IT对公司日常运作起到关键作用, 必须重视IT, 所以召开IT领导外场会议, 重建团队信任. 他先自曝, 从刚进部队时不被人看好, 一路奋斗到CEO的经历。然后几个IT领导也各自分享自己的故事, 到比尔的时候, 比尔说因为有个不称职的父亲, 他离家出走, 加入海军陆战队后, 明白了一个人可以通过做正确的事, 而获得奖励, 所以他关心孩子, 要当个好父亲, 也让他形成了现在这种严遵规范的行事风格.\n* 然后大家也交流了一些现有问题, 并达成和解:\n    * 对‘已完成项目’的定义不统一. 开发团队没把运维部的工作列入考虑范畴;\n    * 运维部不能及时部署交付;\n\n### 冻结项目, 根除计划外的工作\n除了变更板上的任务外, 常常还有些计划外的救火工作, 而且随着时间推移, 还会不断增加, 约束点未被充分利用, 没向业务部门交付全部的可用资源. 董事会新成员埃瑞克启发, 类比工厂的库存堆积, 如果停止向车间发布工作和原材料, 工作以成品的形式离开工厂, 半成品数量下降, 交期性能会提升。在IT部, 也要考虑部门的实际工作能力和负荷量, 保证足够时间和精力开展制定计划，考虑清楚是否可以接受新的工作, 否则, 项目的可用工作周期变短，出现更多走捷径的技术债务, 更多脆弱的应用程序, 需要以计划外工作的形式来偿还那些技术债务的利息。\n* 采取的措施:\n    * 清楚约束点是布伦特, 采取措施保护布伦特不受计划外工作的影响, 确保约束点从不浪费时间, 建立起一个可信赖的系统用以管理通向约束点的工作流, 根据布伦特来设定工作节奏;\n    * 除了功能开发，还要关注稳定性、安全性、可扩展性、可维护性、可操作性、持续性以及其他诸如此类的性能;\n    * 确认最主要的技术债务，开发部会对其进行处理，以减少问题应用程序所产生的计划外工作量;\n    * 确认凤凰项目是优先级最高的事, 接下来两周, 冻结所有凤凰外的部署工作, 继续开展其他正在进行的项目，减少IT半成品数量;\n\n项目冻结行动让IT得以把力量聚焦到凤凰上，七天里完成的工作比以往整个月完成的工作还要多。但项目解冻后, 面临两个问题:\n* 1. 项目冻结解除后，发布哪些项目是安全的, 如何区分工作的轻重缓急.\n    * 在完成工作之前，要先分类列出工作所需的全部前提条件, 再加上工作订单和现有资源，理解生产能力和需求是什么, 进而可以判断是否可以接受一个新工作并对其作出实际安排。而布伦特是一个约束点, 支持了多个工作中心。假如25%的工作中心都只能由布伦特来操作，而布伦特在同一时间只能呆在一个工作中心, 工作将无法按时完成. 所以先了解工作如何流经某些工作中心, 根据对布伦特的依赖程度来决定能够安全重新启动的项目。\n\n* 2. 启动监控项目是否安全。\n    * 期间也发生了一次服务中断, 原因是一个网络服务供应商意外对系统作了一个变更. 而一个监控关键系统是否出现未经批准的变更的项目, 可以防止服务中断, 有助于进一步优化工作流转至约束点布伦特的流程, 让工作流服从于约束点, 尽量少依赖布伦特。\n\n### 围绕约束点改进, 减少等待\n* ‘第二工作法’的一个关键部分是让等待时间可视化，使没有完成的部件，或者需要返工的瓶颈点一目了然。要把注意力从工作中心转到工作中心之间的那些空间上, 管理好工作交接。如下图, 一个给定资源的等待时间，是那个资源忙碌时间的百分比除以空闲时间的百分比。如果一个资源使用了50%，等待时间就是50/50。如果这个资源使用了90%，那么等待时间就是90/10。当一个资源使用了99%，那么等待时间就是该资源使用50%时的99倍。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdvclwg6nij30q20indh5.jpg)\n在代码投产之前，还未产生任何价值，因为那只是困在系统里的半成品。要着眼于整个工作流，确认约束点的位置，并尽其所能地运用各种技术和流程知识来确保工作得到有效执行。 \n* 所以, 帕蒂参考工厂管理工作流中白板管理技术和迭代改进的方法, 找出最经常出现的任务，建立起工作中心和工作路径, 写下操作步骤以及执行这些步骤的人员，测定每个操作所需的时间, 找出可优化的步骤, 降低重复次数。把这样的日程安排表换成看板图，索引卡片的每一行写的是分配的任务, 每一行都划分成三列，标注着“待办”、“在办”、“已办”。而用不同的颜色区分不同种类的卡片, 确保大家都在做最重要的工作, 一眼就能确认工作中紫色和绿色卡片是否平衡。\n* 关键资源所从事的任何活动都必须通过看板, 让需求和半成品可视化，限定半成品, 制止工作缺陷交接至下游工作中心, 加快工作完成的速度。规范布伦特接手工作的方式，把他的工作标准化。从上下游两个方面弄清楚布伦特的工作来源, 阻挡那些想打布伦特主意的人。能预测工作的交货时间, 能让用户满意度上升, 让大家专注工作.\n* 管理工作流，运用约束点来控制节奏. 像工业生产控制部那样, 安排并监督所有的生产过程，确认每一个需要的工作中心都有足够的生产能力和必要的投入, 确保能够符合客户的需求。与业务项目关联的IT项目, 也根据业务价值, 安排工作. 根据全体项目主管的排序，确定了项目解冻时要发布的最重要的五大业务项目。对于内部项目, 则根据项目能否提高在约束点(布伦特)上的工作能力，只开展能减少他的工作量，或者可以让其他人接手的项目。无限期暂停对那些非脆弱系统进行基础架构更新的项目。\n* 凤凰项目的一个任务又延期了, 因为布伦特的‘任务’是涉及多个人员的多个任务，开发部和IT运维部两个部门之间的工作交接，也涉及多个人员之间多次交接的多个步骤, 而每一次工作交接都有损耗的时间。因此, 为需要跨部门交接的‘任务’都设置一条看板追踪路径, 把这些经常性工作记录在案，将其标准化，并且熟练掌握, 提高流量，最终就能达到产品配置的一致性。同时, 新增兼有项目经理和稽查员的职能的角色, 他们要提供每一分钟的控制。让所有已完成的工作都快速有效地交接到下一个工作中心。必要时，这个人要在工作中心等待，保证关键工作完成并快速运往下一个工作中心, 减少悬而未定的项目数量，让工作流转的通路保持通畅。\n\n### 从企业目标出发, 专注要事\n* 公司最大的风险是停业破产, 目标是提高整个系统的生产能力, 而之前一直死守的‘安全性’项目会降低凤凰的项目吞吐量, 凤凰项目吞吐量是整个公司的约束点. 所以安全部的约翰, 先找到财务部的经理迪克, 了解他在公司的确切职能, 远期目标、近期目标和评估指标.\n* 迪克认为最重要的公司远期目标, 应该从整个系统出发, 对公司系统具备根本性的认识, 始终确保在一个正确的市场里, 作出正确的产品策略, 让企业达成目标, 那样财务目标才能发挥作用.\n\n> 我们有竞争力吗？\n> 了解客户的需求和期望：我们知道要创建什么吗？\n> 产品系列：我们有正确的产品吗？\n> 研发效能：我们能有效地创建产品吗？\n> 上架时间：我们能尽快把产品推向市场并占有一席之地吗？\n> 销售机会渠道：我们的产品能带来感兴趣的潜在客户吗？\n> 我们的效率高吗？\n> 按时交货：我们遵守了对客户的承诺吗？\n> 客户保留：我们是在获得客户，还是在流失客户？\n> 销售预测准确率：我们可以把销售预测准确率纳入销售计划流程吗？\n\n* 比尔他们才意识到应该把迪克的重要评估指标作为IT任务的前提条件, 真正理解IT所参与的业务系统。于是决定, 去和业务流程负责人谈谈关于迪克说的公司的目标任务，弄清楚他们的确切职责是什么，哪些业务流程是支持其目标的. 找出对公司实现长期目标危害最大的几项内容, 弄清楚IT部门所负责帮助支撑及维护的公司业务.\n* 帕蒂和比尔将对业务流程负责人进行访谈，主题是“理解客户的需求与期望”、“产品系列”、“上市时间”以及“销售渠道”.\n    * 销售部总裁罗恩认为, 差劲的‘了解客户的需求和期望’影响了‘销售预测准确率’，需要知道门店里有哪些产品缺货，进而提升销售额.\n    * 关于销售渠道流程及其困难的问题:\n        * 销售经理们很难从客户关系管理系统（CRM）中拿到需要的报告.\n    * 糟糕的一天是什么样:\n        * 负责管理的物料需求计划(MRP)系统和电话系统都崩溃, 服务中断, 客户取消订单, 无法完成业绩指标. 比尔接着解释, 电话系统故障是因为供应商未经授权就对电话交换机更换, 等预算批下来, 就能通过监控来强制实行控制策略, 杜绝问题.\n    * 业务发起人玛姬说, 她对‘了解客户的需求和期望’的衡量标准是，客户是否会向朋友推荐我们, 但是订单输入系统和库存管理系统的数据总是错的, 导致不能通过销售数据知道客户想要什么.\n    * 假如能挥舞魔杖, 会怎么做:\n        * 她希望从门店和在线渠道, 有方便易用的功能, 得到准确及时的订单信息。运用那些数据来设计市场推广活动，不断推出“A或B”产品选择测试，以发现客户认可的报价, 并在全部客户中复制推广。就能为罗恩创建一个巨大的、可预测的销售漏斗。运用那些信息来推进生产计划，管理供求曲线。让正确的产品出现在正确的货架上，并一直备好库存。平均每客户销售额将会一路冲高，平均订单金额也会上升, 最终会提高市场份额，并再次打败竞争对手。\n    * 对于上市时间, 玛姬认为要控制在6个月内, 要不断降低周期时间, 不断整合来自市场的反馈, 增强回收成本的能力，最好从消费者那里直接回收成本.\n\n* 建立起价值链, 包括IT方面的所需的价值链，把迪克的目标任务与IT对这些目标任务的影响关联起来，收集以前IT问题如何影响那些目标的具体案例, 对业务绩效指标产生影响的IT风险，就要着手制定更好的业务决策。弄清楚达成迪克期望结果所需要的业务能力和流程；那些业务流程所依赖的IT系统；IT系统或数据可能会发生的故障；防范那些故障发生的应对措施，或者至少能够侦测并作出回应的措施。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdvfhql28lj30jj0bhwh0.jpg)\n* 通过与业务负责人的访谈, 理解了哪些是重要的工作, 让业务部门相信, IT的应对措施有助于他们达成目标, 和他们一起开展把IT融入其绩效指标的工作采取措施:\n    * 对于“客户的需求和期望”, 目标是数据的完整性, 凤凰修复了很多这方面的问题, 还需要控制由上游产生的问题; 预测评估指标包括遵守变更管理流程、监督审核生产变更、完成定期维护，以及排除所有已知单点故障; 创建一份完整的清单，把所有支持罗恩的应用程序和基础架构都列出来。只要其中有任何脆弱的应用程序或系统，就要把它们添加到替换清单里;\n    * 对于“市场营销的需求和期望”，评估指标包括凤凰支持每周报告并且最终支持每日报告的能力，市场营销部生成的有效SKU比例等;\n    * 把发布变小变短，减少半成品和功能, 更快地回笼资金，达到内部最低预期资本回收率;\n\n* 约翰研究业务部门的安全控制环境, 了解到一个拥有技术背景财务人员, 她分析一个财务方面的重要会计科目中的主要业务流程的端到端信息流, 发现, 在一个人工对账步骤中检测到重大错误，在这个步骤中，来自一个源头的账户余额和账户值要和来自其他源头的逐一比对，一般是每周一次。如此一来, 检测重大错误所依靠的控制手段是人工对账步骤，并非上游的IT系统, 所以审计师撤回他们的IT发现.\n* 针对调研, 知道了审计安全的关键落脚点是, 确保财务报告的可靠性，符合法律法规，以及运营的效率和效果, 并提出建议:\n    * 大幅度缩减安全合规项目的范围;\n    * 弄清楚生产薄弱点一开始是如何产生的，调整部署流程，杜绝此类情况再次发生;\n    * 在变更管理流程中，标记出所有列入合规审计范围的系统, 避免可能危及审计工作的变更, 创建持续记录文档;\n    * 通过清除所有存储或处理持卡人数据的东西，来缩减PCI合规项目规模;\n    * 用节省下来的时间，偿还凤凰的所有关于战略风险、运营风险、严重的安全与合规风险的技术债务, 关乎关键评估指标;\n\n### 形成反复实践和勇于尝试的团队文化\n* 对需要团队合作的事情，训练成习惯，不断重复可建立起信任感和透明度。定期回顾小结，对工作开展情况以及需要改进的方面进行自我评估, 同时邀请开发部的人参加服务中断根本原因分析会.\n* 类比跨国货运公司，要达成客户满意度和按时交货的目标。为降低更换机油会导致车辆故障, 而影响按时交货的风险，就要为车辆运营建立一个每行驶五千英里就要更换一次机油的协议, 还有已经按要求更换机油的车辆百分比, 因为如果只有50%的车辆遵守了必需的保养策略，卡车和包裹就可能会抛锚在路边，那么按时交货KPI就会大幅下跌。同样, 为了达到公司的按时交货的关键性绩效指标（KPI），也要建立一个新的前瞻性KPI，预防性供应商补丁程序以及变更管理政策就好比是预防性机油更换以及车辆保养策略。‘第三工作法’就是要让我们不断给系统施加压力，适当提高预防性工作, 从而不断强化习惯并加以改进, 形成不断改进的文化, 加强系统的健壮性. 所以, 安全部开发了一些工具, 在日常工作中, 对测试和生产环境持续不断的攻击和压力测试.\n* 虽然由于布伦特又一次没按流程, 部署了萨拉的一个供应商项目, 导致凤凰项目第二次部署遇到困难, 但最终还是完成了部署, 帕蒂发出部署是“成功”的通知, 并提醒需要提防的已知错误，提供一个可以获得凤凰最新状态的内部网页，以及如何报告新问题的指南, 全体人员随时待命，准备对业务提供支持. 这次部署失败证明, 批量规模还是太大了。要在IT部门创建一个单一向前的工作流, 让生产能力最大化，同时让变化幅度最小化。一旦看到工作向后移动，也许是由于不合格品、缺少规范，或者返工导致, 都得开展修复工作.\n\n### 让最小可行产品(MVP)加速接受市场的考验\n* 凤凰归根结底就是为了帮助客户快速、大批量地买走东西, 最近的两次发布也为此打下了基础, 但凤凰项目延误了太多真正提升销售的功能, 这个季度的盈利是不能指望凤凰了, 所以决定从凤凰主团队里分出一小队人，组建一支叫独角兽的特别行动队，聚焦于生成良好的客户推荐, 并让市场营销部门能够开展促销活动，把库存里现有的盈利产品卖掉, 尽快达到收入目标, 然后把探索出来的成功实践复制到凤凰中.\n\n### 建立反馈回路, 持续交付\n* 丰田公司有一个引擎盖冲压工序，最初转换时间约为三天, 仔细观察了换模所需的全部步骤后，提出了一系列预备和改进措施，把换模时间降至十分钟以内。相应的, 根据第二工作法，建立一条反馈环路，一直往回通向产品定义、设计及开发的最初环节, 延伸到产品生产流程的更早阶段, 在初始阶段就筹划产品的质量。开发部和运维部, QA和业务部门一起协同工作, 持续不断地降低批量规模, 对创建环境所需的每一样东西都进行版本控制, 从代码签入到投产的整个价值流, 创建‘部署管道’，在其中自动创建测试和生产环境，把基础架构当作代码一样对待, 构建一步到位的生产环境和部署流程, 缩短准备时间并排除故障, 更快的获取反馈, 才能跟上客户需求和开发部的各种工作节奏.\n\n* 业务敏捷度重点是捕捉和适应市场变化并为此承担更大风险的能力, 要持续不断的尝试，越快把那些功能推向市场接受考验，也能更快地为公司收回成本。要达到一天十个部署的目标, 那部署可包括故障修复, 让市场营销部修改他们自己的内容或业务规则，或者启用更快速的试验和A/B对比测试.\n\n* 为了找到可自动化的步骤, 分析从‘代码提交’开始，到部署成功的所有步骤, 和之前上线期间存在问题的步骤, 得出返工和准备时间过长问题的来源有两个：\n* 1. 环境: 在部署流程的每个阶段，部署环境总是没有就绪，即使已经准备就绪了，也需要大量返工才能让它们彼此同步\n* 2. 部署: 代码打包流程。尽管开发团队尽可能地记录代码和配置，但总是在IT运维部进行版本控制，然后生成部署包部署之后，代码无法在环境中运行, 才发现有遗漏东西。\n* 采取措施:\n    * 收集从错误中吸取的各种教训, 编一本关于部署运行的书\n    * 设置一个通用构建过程，每个人都使用自己的工具来创建自己的环境，开发人员能在一个与生产环境相似的环境下编写代码\n    * 运维直接拿到准备部署的打包好的代码, 一旦代码被标记为‘准备测试’，就生成并提交代码包，触发一个QA环境的自动部署, 及后续生产环境的自动部署。\n\n### 清除异党\n* 市场部莎拉急于讨好上层, 又因为以前IT经常不能完成并交付她所需要的东西, 找供应商开发第三方服务, 这些看起来是战略性, 但实际不遵守关于数据隐私的法律法规，订单输入和库存管理系统出现更多的数据完整性问题, 还得向供应商开放产品数据库，向他们解释这些数据库是如何构建的，开展众多防火墙变更，等大量额外的工作, 阻碍了聚焦凤凰项目, 这些都是对公司不利的。\n\n* 在独角兽项目的关键时刻, 迪克和财务团队要调走布伦特, 让他加入制定拆分公司方案的特别工作组。但只要完成季度指标, 保住凤凰项目, 就不需要拆分公司了. 了解客户的需求和期望，拥有正确的产品系列，保留客户，以及最终提高营业收入和市场份额，才是最重要的, 所以比尔把布伦特截回来, 在史蒂夫的帮助和众人的努力下, 独角兽项目上线后促销活动的客户转化率很高, 通过了市场的考验.\n\n* 理解技术能够做什么、不能做什么，是公司里每个部门必须具备的一种核心竞争力。最后, 不能融入公司新文化的莎拉离职了.\n--------------------------—_以上为暂时梳理的故事脉络, 笔记还会多次迭代_-------------------------------------\n\n## 有趣段落摘抄:\n> 俗话说得好, 如果你的同事主动告诉你他们要离职, 那多半是自愿的.但如果是其他人告诉你的, 那他们一定是被迫的. 所以说, 我的上司和上司的上司刚刚被炒了.\n\n> “比尔, 我知道你没有申请这个职位, 但公司已经命悬一线. 我需要你来帮助我拯救这家伟大的公司. 我能指望你吗?”\n> 啊, 我的天哪! 还没来得及礼貌地谢绝, 我突然听到自己说:“ 可以, 你可以指望我.”\n\n> 迪克打断了她: “这是IT部的比尔.他说他是被派来收拾这个这个烂摊子的, 或者准备在收拾的过程中壮烈牺牲, 我是这么理解的.”\n\n> “他摇摇头继续说：“要说服业务部门去做正确的事情越来越困难。他们就像走进糖果店的小孩子。他们在飞机杂志上读到，可以在云端管理整个供应链，每年只要499美元，然后这突然就成了公司的主要行动。当我们告诉他们，事实上没那么简单，并演示做好这个要花什么样的代价时，他们就不见了。他们去哪儿了？去和维尼表兄或者其他推销外包服务的家伙谈了，那些人许诺，能用十分之一的时间和价格做成这件事。”\n\n> “我脑海里立刻浮现出这样的景象，约翰问了一些愚蠢的问题，或者说了一些愚蠢的话，彻底激怒了迪克，迪克当场解雇了他，为绝后患，就把我也解雇了。\n> 然而，我发现自己说的是：“好的，我会去的。”\n\n> “他剃了头，看上去像瘦了十五磅。他穿着一件我只能描述为“欧洲式样”的衬衫和一件马甲。和他平常穿的略为宽松的衬衫不同，他身上那件粉色衬衫非常修身。再加上那件马甲，他看起来像是个……时尚模特？伦敦夜店男？拉斯维加斯赌场发牌员？”\n\n\n## 相关概念:\n### 精益理论\n* 包括: 1)降低批量规模; 2)减少半成品; 3)缩短并增强反馈回路\n\n### DevOps\n* what\n    * 也就是开发运维, 这个词最初是在2008年由帕特克里.德布瓦和安德鲁.谢弗提出, 脱胎于马克.伯吉斯博士发起的“基础设施即代码”的实践及有杰兹.亨伯尔和戴维.法利发起的持续集成和持续部署.\n    * 应用了精益理论, 来提高流经生产管理、开发、测试、IT运维及信息安全等部门的工作流的速度.\n* why\n    * 能使产品功能更快地进入市场, 创造价值. 在玩偶实验室2012年的“开发运维报告说明”中, 用基准问题测试4039家IT企业, 发现运用开发运维的高绩效公司比同行: 代码部署频率快30倍; 代码部署交付期快8000倍; 变更成功率高2倍; MTTR(Mean Time To Repair, 平均修复时间)快12倍. \n* how\n    * 三步工作法\n    * 持续交付就是三步工作法中到一种体现, 它强调小到批次规模(如每天检查主干), 在发生问题时停止生产(如一旦构建、测试或部署失败, 就不再允许开展新到工作; 将系统工作到完整性置于工作本身之上), 并必须频繁进行验证性测试, 以避免生产中到失误, 或至少能检测并修复故障.\n\n### 三步工作法\n* what\n    * 旨在阐明指导开发运维的流程与实践的价值观与理念.\n* 第一工作法\n    * what \n        * 关于从开发到IT运维再到客户的整个自左向右的工作流, 那是业务部门与客户之间的衔接.\n    * why\n        * 为了使流量最大化, 让批量规模和工作间隔尽量小, 不让缺陷流向下游工作中心, 并不断为整体目标(与之相对的局部目标就是开发功能完成率、测试发现/修复比率或运维有效性指标等)进行优化.\n    * how\n        * 必要做法包括: 持续构建、集成以及部署, 按需创建环境, 严控半成品, 以及构建起能顺利变更的安全系统和组织.\n        * 其中严控半成品就可以建立看板图, 列出: 待办、在办、已办 \n        * 根据瓶颈资源所能完成的工作速度来安排工作, 确保绝大多数受约束的人力资源都只能投放在整个系统的目标所服务的工作上, 而不只是为了一个部门的目标服务\n        * 确保形成一条迅速、可预测、持续不断的计划内工作流, 从而向业务部门交付工作价值, 同时尽可能降低计划外工作的影响和破坏, 提供稳定的、可预期的、安全的IT服务.\n* 第二工作法\n    * what\n        * 关于价值流各阶段中, 自右向左的快速持续反馈流, 缩短及放大反馈回路\n    * why\n        * 放大各阶段的效益以确保防止问题再次发生, 或更快地发现和修复问题, 从源头上保证质量, 避免返工.\n    * how\n        * 在部署管道中的构建和测试时, “停止生产线”;\n        * 日复一日地持续改进日常工作;\n        * 创建快速的自动化测试套装软件, 确保代码总是处于可部署状态;\n        * 在开发和IT运维之间建立共同的目标和共同解决问题的机制;\n        * 建立普遍的产品遥测技术;\n        * 让每个人都能知道, 代码和环境是否在按照设定的运行, 以及是否达到了客户的目标.\n* 第三工作法\n    * what\n        * 关于创造公司文化, 该文化可带动两种风气的形成: \n            * 不断尝试, 这需要承担风险并从成功和失败中吸取经验教训;\n            * 理解重复和练习是熟练掌握的前提.\n    * why\n        * 尝试和承担风险让我们能够不懈地改进工作系统;\n        * 不断重复的日常操练赋予我们的技能和经验, 一旦出了问题, 就可以撤回至安全区域并恢复正常运作.\n    * how\n        * 营造一种勇于创新、敢于冒险(相对于畏惧或盲目服从命令), 及高度信任(相对于低信任度和命令控制)的文化, 把至少20%开发和IT运维周期划拨给非功能性需求, 并不断鼓励进行改进\n\n### IT从事的四种工作类型\n* 业务项目\n* IT内部项目\n    * 包括业务项目衍生出的基础架构或IT运维项目, 及内部生成的改进项目(如创建新环境和部署自动化)\n* 变更\n    * 经常由业务项目和IT内部项目的工作引起, 往往在保修系统中被跟踪(如IT运维补救、JIRA或用于开发的敏捷计划工具)\n* 计划外工作或救火工作\n    * 包括操作事故和操作问题, 通常由上述类型的工作导致, 往往以牺牲其他计划内工作为代价\n\n### 约束理论5个方法步骤\n* 识别约束点;\n* 利用约束点;\n    * 确保不让约束点浪费任何时间。永远不要让约束点迁就别的资源而干等着，而是应该专注于IT运维部对当前所需完成工作中优先级最高的那一项。\n* 让所有其他活动都从属于约束;\n    * 根据约束点的工作效率来控制其他工作的速度。在约束理论中，一般是由名为‘限制驱导式排程法’（Drum-Buffer-Rope）的工具来实施的。《目标》中的主角亚历克斯，发现队伍里最慢的童子军赫比实际上决定了整支队伍的行军速度，后来亚历克斯把赫比调到队伍前头，防止孩子们超前太远.\n* 把约束点提升到新到水平;\n* 寻找下一个约束点;\n\n## 个人感悟:\n* 也许大家都想把工作做好, 也为此付诸行动, 但是有没有在做正确的事就是另外一回事了. 这就需要切入顶层的上下文中考虑, 因为公司的存在就是要产生商业价值, 大家的工作就是要为业务服务. 而工作的完成, 也是多方合作的结果, 任何一个职位都很重要, 而且协调沟通还会影响整体的效率. \n* 问题的存在不可怕, 当问题发生时, 要做的是找出应对的措施, 积极改进, 而不是推卸责任, 否则最终受累的也是自己.\n* 而理论再完美, 最终还是需要不断尝试, 找到适合自己的解决方案, 只有实践了才知道有哪些问题, 下一步要如何调整.\n* 将所有的工作分类, 不同的工作安排不同的优先级和处理方法.\n* 其实这本书除了能了解开发运维、管理相关价值观之外, 同时也能学到些为人处事的方法, 比如主角总会深呼吸或者倒数几秒, 让自己迅速冷静下来, 因为情绪会阻碍正确的决策, 使问题得不到解决.\n* 多看书太重要了, 因为当自己的视角不够高不够广, 而在一条错误的路渐行渐远时, 有人给予正确的提点自然是最好的, 但实际情况是, 那样的概率很小, 相当于两手一摊, 等着“神啊, 告诉我怎么做吧”, 所以就需要自己多主动吸收前人的优秀经验, 反思自己的行为, 不断调整, 或者以此理解自己领导作出的决策.\n* 说实话, 以自己现在的水平, 还不能很好的吸收书中的理念, 后续还得反复研读, 细细咀嚼书中的案例, 还有最重要的, 用到工作和生活中. \n* 最后, 作为一个学生时代就习惯性逃避写作文的人来说, 整理这篇笔记还挺不适应的, 不过, 不熟就多练嘛. If it hurts, do it more often.","source":"_posts/《凤凰项目》笔记.md","raw":"---\ntitle: 凤凰项目-三步工作法笔记\ntags: \n- 读书笔记\n- 敏捷\n- DevOps\ncategories: 读书笔记\nabbrlink: d698d359\ndate: 2020-04-14 12:31:11\ntop: true\n---\n## 前言:\n去年想了解DevOps的相关概念, 看了《凤凰项目》这本热荐的入门书. \n\n虽然看起来是一本技术相关的书, 其实以第一人称的视角来讲述, 一个IT运维经理临危受命, 推动项目转型的波折和故事, 特别生动有趣, 每个人物也个性鲜明, 搞得我明明在严肃认真的学习, 却常常像看了不正经的书似的哈哈大笑...\n\n书中还穿插各种吐槽, 有同感的是, 我也在公司年会节目上改编过一首歌词吐槽bug什么的, 不过好在大家都挺包容的... :smile: :sparkles:\n\n不过, 只看一遍过过瘾是不行的, 所以整理了下读书笔记. 下文中就包括《凤凰项目》的故事脉络、有趣段落摘抄、相关概念、个人感悟.\n\n## 故事脉络:\n主角比尔, 一家制造和零售企业的IT运维经理, 面临着被竞争对手不断超越的困境, 接任IT运维部的副总裁, 管理一个叫凤凰的电商系统项目, 以此招揽客户并拯救公司的经济危机.\n<!-- more -->\n### 可视化管理流程\n刚上任就发生工资核算故障, 起因是开发部为了修补一个审计发现, 没遵照规定的流程和测试, 直接部署了个有bug的标记化应用.\n* 暴露的问题: \n    * 1. 流程繁琐、响应慢, 所以申请测试环境的预算一直没审批, 而无法测试;\n    * 2. 各部门沟通、协调不到位;\n        * 业务市场部不断压缩IT部交付部署时间、迫切想先人一步抢夺市场;\n        * 运维部不能及时交付, 开发部申请的设备、环境;\n        * 关于项目完成的定义不统一, 开发部没有考虑运维部署的时间, 总是匆忙上线;\n        * 开发部没有提供清晰的部署文档, 使运维部无法顺利部署, 无法进行压力测试, 没有全面监控和备份;\n        * 运维的关键工程师总是要处理各种故障, 没办法参与开发部的计划会议;\n    * 3. 没人清楚公司整体业务架构, 都在瞎忙;\n\n为了解决以上问题, 采取以下措施:\n* 1. 列出工作任务清单, 了解工作需求、优先级、工作进度、可用资源(如人员职责, 所需时间), 预估工作量, 并合理调配资源;\n    * 识别变更冲突以及可用资源矛盾的风险, 做出相应调整;\n* 2. 设定变更流程, 稳定工作环境, 可视化管理IT运维部里的半成品;\n    * 在白板上, 列出所有的变更、相关人员. 所有人一起讨论变更的类型，然后对变更进行筛选和安排;\n    * 把一部分变更审核委派给代理人, 重点关注最有风险的变更;\n        * 预先定义好高风险变更目录, 列出十大最脆弱的服务、应用程序和基础架构列表, 对相关变更申请标上记号, 并详细审查;\n        * 围绕这些变更建立一些标准流程(如跟业务部门确认实施变更的时机), 相关人员关注变更、随时待命;\n    * 对于低风险变更(如增加Java应用程序服务器线程池容量), 仍需要提交, 但可以直接安排操作日程;\n    * 对于复杂的中等变更, 变更提交者获得可能受到影响的人员许可后, 再审核并安排操作日程;\n\n### 规范流程, 保护约束点\n在一次排查故障问题会议上, 各部门又开始推脱责任. 而由于没有相关解决问题的知识库, 很多问题只有高级工程师布伦特能解决, 布伦特成了项目的一个约束点, 虽然也解决了故障, 但是比尔认为这次故障可能是布伦特的某次不规范操作导致.\n* 于是, 采取以下措施:\n    * 记录所有的变更, 不准再出现未经授权或未公开的变更;\n    * 每两周组织一次排查故障的实战演练, 让每个人都养成运用合理的方式来解决问题的习惯;\n        * 如召开应急处置会议之前, 就要把相关时间线搞清楚;\n    * 减少需要布伦特的工作中心数量, 把布伦特的工作标准化，让其他人能够执行;\n        * 建立一个3级工程师的人力资源库, 由他们处理流转过来的工作;\n        * 记录整理故障解决方案到知识库里, 生成能让一些工作中心自动化运行的文档;\n        * 每周逐项检查工作, 不能让布伦特就同一个问题出手两次, 否则3级工程师和布伦特都要受罚;\n        * 提供相关福利, 鼓励布伦特和工程师遵守新的流程;\n    * 保护约束点, 让布伦特只做最重要的凤凰项目的工作;\n        * 任何占用布伦特时间的人都要解释说明, 否则上报;\n        * 过滤涌向布伦特的变更任务, 并在变更卡片上表示出来;\n        * 收集直接找布伦特的名单, 给他们的上司打电话, 让上层知道有人在干扰凤凰项目;\n\n### 问题频出, IT不受上层信任\n因为开发没告诉运维需要打开一个防火墙端口, 而前端程序与数据库服务器通信失败, 代码无法在测试环境中正常运行, 延误了凤凰项目的上线. 以及一些接口延时, 性能相关的bug, 导致所有店内POS系统都会宕机. \n* 暴露的问题:\n    * 部署运行测试的时间太长, 跟不上开发的节奏;\n    * 缺乏版本控制, 开发提供的是不完善的版本, 导致配置测试环境时, 浪费了不必要的时间;\n* 采取措施:\n    * 代码试运行每天只能进行两次, 并限制所有影响性能的代码变更;\n    * 开发人员, 提交的代码必须标注对应某个性能问题的缺陷编号;\n\n而这些问题使上层不信任IT部了, 要将IT部外包. 比尔和开发部老大克里斯因此进行了一次深入交流, 发现大家的压力一样大, 也为公司付出了不少. 克里斯说, 他们总要不断追赶新技术、新的项目管理方法, 一直疲于应付各种故障修复，无暇顾及功能开发, 业务部门还总是不跟IT部门商量可行性, 就直接下达任务.\n\n### 上下一心, 重建团队信任\n* 客户发票系统发生故障, 比尔团队通过一系列不间断的事后调查，搞清楚了故障的来龙去脉，采取了预防措施。同时开展了一系列全员参与的模拟事故呼叫，排演新的处理步骤, 一切都在有序的进行着. 但CEO史蒂夫认为IT部没有‘紧迫感’，要求所有相不相关的工程师都要‘手不离键盘，不能有闲人’, 比尔因此辞职了.\n* 与埃瑞克沟通并反思后, 史蒂夫明白了IT对公司日常运作起到关键作用, 必须重视IT, 所以召开IT领导外场会议, 重建团队信任. 他先自曝, 从刚进部队时不被人看好, 一路奋斗到CEO的经历。然后几个IT领导也各自分享自己的故事, 到比尔的时候, 比尔说因为有个不称职的父亲, 他离家出走, 加入海军陆战队后, 明白了一个人可以通过做正确的事, 而获得奖励, 所以他关心孩子, 要当个好父亲, 也让他形成了现在这种严遵规范的行事风格.\n* 然后大家也交流了一些现有问题, 并达成和解:\n    * 对‘已完成项目’的定义不统一. 开发团队没把运维部的工作列入考虑范畴;\n    * 运维部不能及时部署交付;\n\n### 冻结项目, 根除计划外的工作\n除了变更板上的任务外, 常常还有些计划外的救火工作, 而且随着时间推移, 还会不断增加, 约束点未被充分利用, 没向业务部门交付全部的可用资源. 董事会新成员埃瑞克启发, 类比工厂的库存堆积, 如果停止向车间发布工作和原材料, 工作以成品的形式离开工厂, 半成品数量下降, 交期性能会提升。在IT部, 也要考虑部门的实际工作能力和负荷量, 保证足够时间和精力开展制定计划，考虑清楚是否可以接受新的工作, 否则, 项目的可用工作周期变短，出现更多走捷径的技术债务, 更多脆弱的应用程序, 需要以计划外工作的形式来偿还那些技术债务的利息。\n* 采取的措施:\n    * 清楚约束点是布伦特, 采取措施保护布伦特不受计划外工作的影响, 确保约束点从不浪费时间, 建立起一个可信赖的系统用以管理通向约束点的工作流, 根据布伦特来设定工作节奏;\n    * 除了功能开发，还要关注稳定性、安全性、可扩展性、可维护性、可操作性、持续性以及其他诸如此类的性能;\n    * 确认最主要的技术债务，开发部会对其进行处理，以减少问题应用程序所产生的计划外工作量;\n    * 确认凤凰项目是优先级最高的事, 接下来两周, 冻结所有凤凰外的部署工作, 继续开展其他正在进行的项目，减少IT半成品数量;\n\n项目冻结行动让IT得以把力量聚焦到凤凰上，七天里完成的工作比以往整个月完成的工作还要多。但项目解冻后, 面临两个问题:\n* 1. 项目冻结解除后，发布哪些项目是安全的, 如何区分工作的轻重缓急.\n    * 在完成工作之前，要先分类列出工作所需的全部前提条件, 再加上工作订单和现有资源，理解生产能力和需求是什么, 进而可以判断是否可以接受一个新工作并对其作出实际安排。而布伦特是一个约束点, 支持了多个工作中心。假如25%的工作中心都只能由布伦特来操作，而布伦特在同一时间只能呆在一个工作中心, 工作将无法按时完成. 所以先了解工作如何流经某些工作中心, 根据对布伦特的依赖程度来决定能够安全重新启动的项目。\n\n* 2. 启动监控项目是否安全。\n    * 期间也发生了一次服务中断, 原因是一个网络服务供应商意外对系统作了一个变更. 而一个监控关键系统是否出现未经批准的变更的项目, 可以防止服务中断, 有助于进一步优化工作流转至约束点布伦特的流程, 让工作流服从于约束点, 尽量少依赖布伦特。\n\n### 围绕约束点改进, 减少等待\n* ‘第二工作法’的一个关键部分是让等待时间可视化，使没有完成的部件，或者需要返工的瓶颈点一目了然。要把注意力从工作中心转到工作中心之间的那些空间上, 管理好工作交接。如下图, 一个给定资源的等待时间，是那个资源忙碌时间的百分比除以空闲时间的百分比。如果一个资源使用了50%，等待时间就是50/50。如果这个资源使用了90%，那么等待时间就是90/10。当一个资源使用了99%，那么等待时间就是该资源使用50%时的99倍。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdvclwg6nij30q20indh5.jpg)\n在代码投产之前，还未产生任何价值，因为那只是困在系统里的半成品。要着眼于整个工作流，确认约束点的位置，并尽其所能地运用各种技术和流程知识来确保工作得到有效执行。 \n* 所以, 帕蒂参考工厂管理工作流中白板管理技术和迭代改进的方法, 找出最经常出现的任务，建立起工作中心和工作路径, 写下操作步骤以及执行这些步骤的人员，测定每个操作所需的时间, 找出可优化的步骤, 降低重复次数。把这样的日程安排表换成看板图，索引卡片的每一行写的是分配的任务, 每一行都划分成三列，标注着“待办”、“在办”、“已办”。而用不同的颜色区分不同种类的卡片, 确保大家都在做最重要的工作, 一眼就能确认工作中紫色和绿色卡片是否平衡。\n* 关键资源所从事的任何活动都必须通过看板, 让需求和半成品可视化，限定半成品, 制止工作缺陷交接至下游工作中心, 加快工作完成的速度。规范布伦特接手工作的方式，把他的工作标准化。从上下游两个方面弄清楚布伦特的工作来源, 阻挡那些想打布伦特主意的人。能预测工作的交货时间, 能让用户满意度上升, 让大家专注工作.\n* 管理工作流，运用约束点来控制节奏. 像工业生产控制部那样, 安排并监督所有的生产过程，确认每一个需要的工作中心都有足够的生产能力和必要的投入, 确保能够符合客户的需求。与业务项目关联的IT项目, 也根据业务价值, 安排工作. 根据全体项目主管的排序，确定了项目解冻时要发布的最重要的五大业务项目。对于内部项目, 则根据项目能否提高在约束点(布伦特)上的工作能力，只开展能减少他的工作量，或者可以让其他人接手的项目。无限期暂停对那些非脆弱系统进行基础架构更新的项目。\n* 凤凰项目的一个任务又延期了, 因为布伦特的‘任务’是涉及多个人员的多个任务，开发部和IT运维部两个部门之间的工作交接，也涉及多个人员之间多次交接的多个步骤, 而每一次工作交接都有损耗的时间。因此, 为需要跨部门交接的‘任务’都设置一条看板追踪路径, 把这些经常性工作记录在案，将其标准化，并且熟练掌握, 提高流量，最终就能达到产品配置的一致性。同时, 新增兼有项目经理和稽查员的职能的角色, 他们要提供每一分钟的控制。让所有已完成的工作都快速有效地交接到下一个工作中心。必要时，这个人要在工作中心等待，保证关键工作完成并快速运往下一个工作中心, 减少悬而未定的项目数量，让工作流转的通路保持通畅。\n\n### 从企业目标出发, 专注要事\n* 公司最大的风险是停业破产, 目标是提高整个系统的生产能力, 而之前一直死守的‘安全性’项目会降低凤凰的项目吞吐量, 凤凰项目吞吐量是整个公司的约束点. 所以安全部的约翰, 先找到财务部的经理迪克, 了解他在公司的确切职能, 远期目标、近期目标和评估指标.\n* 迪克认为最重要的公司远期目标, 应该从整个系统出发, 对公司系统具备根本性的认识, 始终确保在一个正确的市场里, 作出正确的产品策略, 让企业达成目标, 那样财务目标才能发挥作用.\n\n> 我们有竞争力吗？\n> 了解客户的需求和期望：我们知道要创建什么吗？\n> 产品系列：我们有正确的产品吗？\n> 研发效能：我们能有效地创建产品吗？\n> 上架时间：我们能尽快把产品推向市场并占有一席之地吗？\n> 销售机会渠道：我们的产品能带来感兴趣的潜在客户吗？\n> 我们的效率高吗？\n> 按时交货：我们遵守了对客户的承诺吗？\n> 客户保留：我们是在获得客户，还是在流失客户？\n> 销售预测准确率：我们可以把销售预测准确率纳入销售计划流程吗？\n\n* 比尔他们才意识到应该把迪克的重要评估指标作为IT任务的前提条件, 真正理解IT所参与的业务系统。于是决定, 去和业务流程负责人谈谈关于迪克说的公司的目标任务，弄清楚他们的确切职责是什么，哪些业务流程是支持其目标的. 找出对公司实现长期目标危害最大的几项内容, 弄清楚IT部门所负责帮助支撑及维护的公司业务.\n* 帕蒂和比尔将对业务流程负责人进行访谈，主题是“理解客户的需求与期望”、“产品系列”、“上市时间”以及“销售渠道”.\n    * 销售部总裁罗恩认为, 差劲的‘了解客户的需求和期望’影响了‘销售预测准确率’，需要知道门店里有哪些产品缺货，进而提升销售额.\n    * 关于销售渠道流程及其困难的问题:\n        * 销售经理们很难从客户关系管理系统（CRM）中拿到需要的报告.\n    * 糟糕的一天是什么样:\n        * 负责管理的物料需求计划(MRP)系统和电话系统都崩溃, 服务中断, 客户取消订单, 无法完成业绩指标. 比尔接着解释, 电话系统故障是因为供应商未经授权就对电话交换机更换, 等预算批下来, 就能通过监控来强制实行控制策略, 杜绝问题.\n    * 业务发起人玛姬说, 她对‘了解客户的需求和期望’的衡量标准是，客户是否会向朋友推荐我们, 但是订单输入系统和库存管理系统的数据总是错的, 导致不能通过销售数据知道客户想要什么.\n    * 假如能挥舞魔杖, 会怎么做:\n        * 她希望从门店和在线渠道, 有方便易用的功能, 得到准确及时的订单信息。运用那些数据来设计市场推广活动，不断推出“A或B”产品选择测试，以发现客户认可的报价, 并在全部客户中复制推广。就能为罗恩创建一个巨大的、可预测的销售漏斗。运用那些信息来推进生产计划，管理供求曲线。让正确的产品出现在正确的货架上，并一直备好库存。平均每客户销售额将会一路冲高，平均订单金额也会上升, 最终会提高市场份额，并再次打败竞争对手。\n    * 对于上市时间, 玛姬认为要控制在6个月内, 要不断降低周期时间, 不断整合来自市场的反馈, 增强回收成本的能力，最好从消费者那里直接回收成本.\n\n* 建立起价值链, 包括IT方面的所需的价值链，把迪克的目标任务与IT对这些目标任务的影响关联起来，收集以前IT问题如何影响那些目标的具体案例, 对业务绩效指标产生影响的IT风险，就要着手制定更好的业务决策。弄清楚达成迪克期望结果所需要的业务能力和流程；那些业务流程所依赖的IT系统；IT系统或数据可能会发生的故障；防范那些故障发生的应对措施，或者至少能够侦测并作出回应的措施。\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1gdvfhql28lj30jj0bhwh0.jpg)\n* 通过与业务负责人的访谈, 理解了哪些是重要的工作, 让业务部门相信, IT的应对措施有助于他们达成目标, 和他们一起开展把IT融入其绩效指标的工作采取措施:\n    * 对于“客户的需求和期望”, 目标是数据的完整性, 凤凰修复了很多这方面的问题, 还需要控制由上游产生的问题; 预测评估指标包括遵守变更管理流程、监督审核生产变更、完成定期维护，以及排除所有已知单点故障; 创建一份完整的清单，把所有支持罗恩的应用程序和基础架构都列出来。只要其中有任何脆弱的应用程序或系统，就要把它们添加到替换清单里;\n    * 对于“市场营销的需求和期望”，评估指标包括凤凰支持每周报告并且最终支持每日报告的能力，市场营销部生成的有效SKU比例等;\n    * 把发布变小变短，减少半成品和功能, 更快地回笼资金，达到内部最低预期资本回收率;\n\n* 约翰研究业务部门的安全控制环境, 了解到一个拥有技术背景财务人员, 她分析一个财务方面的重要会计科目中的主要业务流程的端到端信息流, 发现, 在一个人工对账步骤中检测到重大错误，在这个步骤中，来自一个源头的账户余额和账户值要和来自其他源头的逐一比对，一般是每周一次。如此一来, 检测重大错误所依靠的控制手段是人工对账步骤，并非上游的IT系统, 所以审计师撤回他们的IT发现.\n* 针对调研, 知道了审计安全的关键落脚点是, 确保财务报告的可靠性，符合法律法规，以及运营的效率和效果, 并提出建议:\n    * 大幅度缩减安全合规项目的范围;\n    * 弄清楚生产薄弱点一开始是如何产生的，调整部署流程，杜绝此类情况再次发生;\n    * 在变更管理流程中，标记出所有列入合规审计范围的系统, 避免可能危及审计工作的变更, 创建持续记录文档;\n    * 通过清除所有存储或处理持卡人数据的东西，来缩减PCI合规项目规模;\n    * 用节省下来的时间，偿还凤凰的所有关于战略风险、运营风险、严重的安全与合规风险的技术债务, 关乎关键评估指标;\n\n### 形成反复实践和勇于尝试的团队文化\n* 对需要团队合作的事情，训练成习惯，不断重复可建立起信任感和透明度。定期回顾小结，对工作开展情况以及需要改进的方面进行自我评估, 同时邀请开发部的人参加服务中断根本原因分析会.\n* 类比跨国货运公司，要达成客户满意度和按时交货的目标。为降低更换机油会导致车辆故障, 而影响按时交货的风险，就要为车辆运营建立一个每行驶五千英里就要更换一次机油的协议, 还有已经按要求更换机油的车辆百分比, 因为如果只有50%的车辆遵守了必需的保养策略，卡车和包裹就可能会抛锚在路边，那么按时交货KPI就会大幅下跌。同样, 为了达到公司的按时交货的关键性绩效指标（KPI），也要建立一个新的前瞻性KPI，预防性供应商补丁程序以及变更管理政策就好比是预防性机油更换以及车辆保养策略。‘第三工作法’就是要让我们不断给系统施加压力，适当提高预防性工作, 从而不断强化习惯并加以改进, 形成不断改进的文化, 加强系统的健壮性. 所以, 安全部开发了一些工具, 在日常工作中, 对测试和生产环境持续不断的攻击和压力测试.\n* 虽然由于布伦特又一次没按流程, 部署了萨拉的一个供应商项目, 导致凤凰项目第二次部署遇到困难, 但最终还是完成了部署, 帕蒂发出部署是“成功”的通知, 并提醒需要提防的已知错误，提供一个可以获得凤凰最新状态的内部网页，以及如何报告新问题的指南, 全体人员随时待命，准备对业务提供支持. 这次部署失败证明, 批量规模还是太大了。要在IT部门创建一个单一向前的工作流, 让生产能力最大化，同时让变化幅度最小化。一旦看到工作向后移动，也许是由于不合格品、缺少规范，或者返工导致, 都得开展修复工作.\n\n### 让最小可行产品(MVP)加速接受市场的考验\n* 凤凰归根结底就是为了帮助客户快速、大批量地买走东西, 最近的两次发布也为此打下了基础, 但凤凰项目延误了太多真正提升销售的功能, 这个季度的盈利是不能指望凤凰了, 所以决定从凤凰主团队里分出一小队人，组建一支叫独角兽的特别行动队，聚焦于生成良好的客户推荐, 并让市场营销部门能够开展促销活动，把库存里现有的盈利产品卖掉, 尽快达到收入目标, 然后把探索出来的成功实践复制到凤凰中.\n\n### 建立反馈回路, 持续交付\n* 丰田公司有一个引擎盖冲压工序，最初转换时间约为三天, 仔细观察了换模所需的全部步骤后，提出了一系列预备和改进措施，把换模时间降至十分钟以内。相应的, 根据第二工作法，建立一条反馈环路，一直往回通向产品定义、设计及开发的最初环节, 延伸到产品生产流程的更早阶段, 在初始阶段就筹划产品的质量。开发部和运维部, QA和业务部门一起协同工作, 持续不断地降低批量规模, 对创建环境所需的每一样东西都进行版本控制, 从代码签入到投产的整个价值流, 创建‘部署管道’，在其中自动创建测试和生产环境，把基础架构当作代码一样对待, 构建一步到位的生产环境和部署流程, 缩短准备时间并排除故障, 更快的获取反馈, 才能跟上客户需求和开发部的各种工作节奏.\n\n* 业务敏捷度重点是捕捉和适应市场变化并为此承担更大风险的能力, 要持续不断的尝试，越快把那些功能推向市场接受考验，也能更快地为公司收回成本。要达到一天十个部署的目标, 那部署可包括故障修复, 让市场营销部修改他们自己的内容或业务规则，或者启用更快速的试验和A/B对比测试.\n\n* 为了找到可自动化的步骤, 分析从‘代码提交’开始，到部署成功的所有步骤, 和之前上线期间存在问题的步骤, 得出返工和准备时间过长问题的来源有两个：\n* 1. 环境: 在部署流程的每个阶段，部署环境总是没有就绪，即使已经准备就绪了，也需要大量返工才能让它们彼此同步\n* 2. 部署: 代码打包流程。尽管开发团队尽可能地记录代码和配置，但总是在IT运维部进行版本控制，然后生成部署包部署之后，代码无法在环境中运行, 才发现有遗漏东西。\n* 采取措施:\n    * 收集从错误中吸取的各种教训, 编一本关于部署运行的书\n    * 设置一个通用构建过程，每个人都使用自己的工具来创建自己的环境，开发人员能在一个与生产环境相似的环境下编写代码\n    * 运维直接拿到准备部署的打包好的代码, 一旦代码被标记为‘准备测试’，就生成并提交代码包，触发一个QA环境的自动部署, 及后续生产环境的自动部署。\n\n### 清除异党\n* 市场部莎拉急于讨好上层, 又因为以前IT经常不能完成并交付她所需要的东西, 找供应商开发第三方服务, 这些看起来是战略性, 但实际不遵守关于数据隐私的法律法规，订单输入和库存管理系统出现更多的数据完整性问题, 还得向供应商开放产品数据库，向他们解释这些数据库是如何构建的，开展众多防火墙变更，等大量额外的工作, 阻碍了聚焦凤凰项目, 这些都是对公司不利的。\n\n* 在独角兽项目的关键时刻, 迪克和财务团队要调走布伦特, 让他加入制定拆分公司方案的特别工作组。但只要完成季度指标, 保住凤凰项目, 就不需要拆分公司了. 了解客户的需求和期望，拥有正确的产品系列，保留客户，以及最终提高营业收入和市场份额，才是最重要的, 所以比尔把布伦特截回来, 在史蒂夫的帮助和众人的努力下, 独角兽项目上线后促销活动的客户转化率很高, 通过了市场的考验.\n\n* 理解技术能够做什么、不能做什么，是公司里每个部门必须具备的一种核心竞争力。最后, 不能融入公司新文化的莎拉离职了.\n--------------------------—_以上为暂时梳理的故事脉络, 笔记还会多次迭代_-------------------------------------\n\n## 有趣段落摘抄:\n> 俗话说得好, 如果你的同事主动告诉你他们要离职, 那多半是自愿的.但如果是其他人告诉你的, 那他们一定是被迫的. 所以说, 我的上司和上司的上司刚刚被炒了.\n\n> “比尔, 我知道你没有申请这个职位, 但公司已经命悬一线. 我需要你来帮助我拯救这家伟大的公司. 我能指望你吗?”\n> 啊, 我的天哪! 还没来得及礼貌地谢绝, 我突然听到自己说:“ 可以, 你可以指望我.”\n\n> 迪克打断了她: “这是IT部的比尔.他说他是被派来收拾这个这个烂摊子的, 或者准备在收拾的过程中壮烈牺牲, 我是这么理解的.”\n\n> “他摇摇头继续说：“要说服业务部门去做正确的事情越来越困难。他们就像走进糖果店的小孩子。他们在飞机杂志上读到，可以在云端管理整个供应链，每年只要499美元，然后这突然就成了公司的主要行动。当我们告诉他们，事实上没那么简单，并演示做好这个要花什么样的代价时，他们就不见了。他们去哪儿了？去和维尼表兄或者其他推销外包服务的家伙谈了，那些人许诺，能用十分之一的时间和价格做成这件事。”\n\n> “我脑海里立刻浮现出这样的景象，约翰问了一些愚蠢的问题，或者说了一些愚蠢的话，彻底激怒了迪克，迪克当场解雇了他，为绝后患，就把我也解雇了。\n> 然而，我发现自己说的是：“好的，我会去的。”\n\n> “他剃了头，看上去像瘦了十五磅。他穿着一件我只能描述为“欧洲式样”的衬衫和一件马甲。和他平常穿的略为宽松的衬衫不同，他身上那件粉色衬衫非常修身。再加上那件马甲，他看起来像是个……时尚模特？伦敦夜店男？拉斯维加斯赌场发牌员？”\n\n\n## 相关概念:\n### 精益理论\n* 包括: 1)降低批量规模; 2)减少半成品; 3)缩短并增强反馈回路\n\n### DevOps\n* what\n    * 也就是开发运维, 这个词最初是在2008年由帕特克里.德布瓦和安德鲁.谢弗提出, 脱胎于马克.伯吉斯博士发起的“基础设施即代码”的实践及有杰兹.亨伯尔和戴维.法利发起的持续集成和持续部署.\n    * 应用了精益理论, 来提高流经生产管理、开发、测试、IT运维及信息安全等部门的工作流的速度.\n* why\n    * 能使产品功能更快地进入市场, 创造价值. 在玩偶实验室2012年的“开发运维报告说明”中, 用基准问题测试4039家IT企业, 发现运用开发运维的高绩效公司比同行: 代码部署频率快30倍; 代码部署交付期快8000倍; 变更成功率高2倍; MTTR(Mean Time To Repair, 平均修复时间)快12倍. \n* how\n    * 三步工作法\n    * 持续交付就是三步工作法中到一种体现, 它强调小到批次规模(如每天检查主干), 在发生问题时停止生产(如一旦构建、测试或部署失败, 就不再允许开展新到工作; 将系统工作到完整性置于工作本身之上), 并必须频繁进行验证性测试, 以避免生产中到失误, 或至少能检测并修复故障.\n\n### 三步工作法\n* what\n    * 旨在阐明指导开发运维的流程与实践的价值观与理念.\n* 第一工作法\n    * what \n        * 关于从开发到IT运维再到客户的整个自左向右的工作流, 那是业务部门与客户之间的衔接.\n    * why\n        * 为了使流量最大化, 让批量规模和工作间隔尽量小, 不让缺陷流向下游工作中心, 并不断为整体目标(与之相对的局部目标就是开发功能完成率、测试发现/修复比率或运维有效性指标等)进行优化.\n    * how\n        * 必要做法包括: 持续构建、集成以及部署, 按需创建环境, 严控半成品, 以及构建起能顺利变更的安全系统和组织.\n        * 其中严控半成品就可以建立看板图, 列出: 待办、在办、已办 \n        * 根据瓶颈资源所能完成的工作速度来安排工作, 确保绝大多数受约束的人力资源都只能投放在整个系统的目标所服务的工作上, 而不只是为了一个部门的目标服务\n        * 确保形成一条迅速、可预测、持续不断的计划内工作流, 从而向业务部门交付工作价值, 同时尽可能降低计划外工作的影响和破坏, 提供稳定的、可预期的、安全的IT服务.\n* 第二工作法\n    * what\n        * 关于价值流各阶段中, 自右向左的快速持续反馈流, 缩短及放大反馈回路\n    * why\n        * 放大各阶段的效益以确保防止问题再次发生, 或更快地发现和修复问题, 从源头上保证质量, 避免返工.\n    * how\n        * 在部署管道中的构建和测试时, “停止生产线”;\n        * 日复一日地持续改进日常工作;\n        * 创建快速的自动化测试套装软件, 确保代码总是处于可部署状态;\n        * 在开发和IT运维之间建立共同的目标和共同解决问题的机制;\n        * 建立普遍的产品遥测技术;\n        * 让每个人都能知道, 代码和环境是否在按照设定的运行, 以及是否达到了客户的目标.\n* 第三工作法\n    * what\n        * 关于创造公司文化, 该文化可带动两种风气的形成: \n            * 不断尝试, 这需要承担风险并从成功和失败中吸取经验教训;\n            * 理解重复和练习是熟练掌握的前提.\n    * why\n        * 尝试和承担风险让我们能够不懈地改进工作系统;\n        * 不断重复的日常操练赋予我们的技能和经验, 一旦出了问题, 就可以撤回至安全区域并恢复正常运作.\n    * how\n        * 营造一种勇于创新、敢于冒险(相对于畏惧或盲目服从命令), 及高度信任(相对于低信任度和命令控制)的文化, 把至少20%开发和IT运维周期划拨给非功能性需求, 并不断鼓励进行改进\n\n### IT从事的四种工作类型\n* 业务项目\n* IT内部项目\n    * 包括业务项目衍生出的基础架构或IT运维项目, 及内部生成的改进项目(如创建新环境和部署自动化)\n* 变更\n    * 经常由业务项目和IT内部项目的工作引起, 往往在保修系统中被跟踪(如IT运维补救、JIRA或用于开发的敏捷计划工具)\n* 计划外工作或救火工作\n    * 包括操作事故和操作问题, 通常由上述类型的工作导致, 往往以牺牲其他计划内工作为代价\n\n### 约束理论5个方法步骤\n* 识别约束点;\n* 利用约束点;\n    * 确保不让约束点浪费任何时间。永远不要让约束点迁就别的资源而干等着，而是应该专注于IT运维部对当前所需完成工作中优先级最高的那一项。\n* 让所有其他活动都从属于约束;\n    * 根据约束点的工作效率来控制其他工作的速度。在约束理论中，一般是由名为‘限制驱导式排程法’（Drum-Buffer-Rope）的工具来实施的。《目标》中的主角亚历克斯，发现队伍里最慢的童子军赫比实际上决定了整支队伍的行军速度，后来亚历克斯把赫比调到队伍前头，防止孩子们超前太远.\n* 把约束点提升到新到水平;\n* 寻找下一个约束点;\n\n## 个人感悟:\n* 也许大家都想把工作做好, 也为此付诸行动, 但是有没有在做正确的事就是另外一回事了. 这就需要切入顶层的上下文中考虑, 因为公司的存在就是要产生商业价值, 大家的工作就是要为业务服务. 而工作的完成, 也是多方合作的结果, 任何一个职位都很重要, 而且协调沟通还会影响整体的效率. \n* 问题的存在不可怕, 当问题发生时, 要做的是找出应对的措施, 积极改进, 而不是推卸责任, 否则最终受累的也是自己.\n* 而理论再完美, 最终还是需要不断尝试, 找到适合自己的解决方案, 只有实践了才知道有哪些问题, 下一步要如何调整.\n* 将所有的工作分类, 不同的工作安排不同的优先级和处理方法.\n* 其实这本书除了能了解开发运维、管理相关价值观之外, 同时也能学到些为人处事的方法, 比如主角总会深呼吸或者倒数几秒, 让自己迅速冷静下来, 因为情绪会阻碍正确的决策, 使问题得不到解决.\n* 多看书太重要了, 因为当自己的视角不够高不够广, 而在一条错误的路渐行渐远时, 有人给予正确的提点自然是最好的, 但实际情况是, 那样的概率很小, 相当于两手一摊, 等着“神啊, 告诉我怎么做吧”, 所以就需要自己多主动吸收前人的优秀经验, 反思自己的行为, 不断调整, 或者以此理解自己领导作出的决策.\n* 说实话, 以自己现在的水平, 还不能很好的吸收书中的理念, 后续还得反复研读, 细细咀嚼书中的案例, 还有最重要的, 用到工作和生活中. \n* 最后, 作为一个学生时代就习惯性逃避写作文的人来说, 整理这篇笔记还挺不适应的, 不过, 不熟就多练嘛. If it hurts, do it more often.","slug":"《凤凰项目》笔记","published":1,"updated":"2021-02-04T02:38:05.402Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai12a000runrafpuv4og9","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言:\"></a>前言:</h2><p>去年想了解DevOps的相关概念, 看了《凤凰项目》这本热荐的入门书. </p>\n<p>虽然看起来是一本技术相关的书, 其实以第一人称的视角来讲述, 一个IT运维经理临危受命, 推动项目转型的波折和故事, 特别生动有趣, 每个人物也个性鲜明, 搞得我明明在严肃认真的学习, 却常常像看了不正经的书似的哈哈大笑…</p>\n<p>书中还穿插各种吐槽, 有同感的是, 我也在公司年会节目上改编过一首歌词吐槽bug什么的, 不过好在大家都挺包容的… <span class=\"emoji\" alias=\"smile\" style=\"\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8\">😄</span> <span class=\"emoji\" alias=\"sparkles\" style=\"\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/2728.png?v8\">✨</span></p>\n<p>不过, 只看一遍过过瘾是不行的, 所以整理了下读书笔记. 下文中就包括《凤凰项目》的故事脉络、有趣段落摘抄、相关概念、个人感悟.</p>\n<h2 id=\"故事脉络\"><a href=\"#故事脉络\" class=\"headerlink\" title=\"故事脉络:\"></a>故事脉络:</h2><p>主角比尔, 一家制造和零售企业的IT运维经理, 面临着被竞争对手不断超越的困境, 接任IT运维部的副总裁, 管理一个叫凤凰的电商系统项目, 以此招揽客户并拯救公司的经济危机.</p>\n<a id=\"more\"></a>\n<h3 id=\"可视化管理流程\"><a href=\"#可视化管理流程\" class=\"headerlink\" title=\"可视化管理流程\"></a>可视化管理流程</h3><p>刚上任就发生工资核算故障, 起因是开发部为了修补一个审计发现, 没遵照规定的流程和测试, 直接部署了个有bug的标记化应用.</p>\n<ul>\n<li>暴露的问题: <ul>\n<li><ol>\n<li>流程繁琐、响应慢, 所以申请测试环境的预算一直没审批, 而无法测试;</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>各部门沟通、协调不到位;<ul>\n<li>业务市场部不断压缩IT部交付部署时间、迫切想先人一步抢夺市场;</li>\n<li>运维部不能及时交付, 开发部申请的设备、环境;</li>\n<li>关于项目完成的定义不统一, 开发部没有考虑运维部署的时间, 总是匆忙上线;</li>\n<li>开发部没有提供清晰的部署文档, 使运维部无法顺利部署, 无法进行压力测试, 没有全面监控和备份;</li>\n<li>运维的关键工程师总是要处理各种故障, 没办法参与开发部的计划会议;</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>没人清楚公司整体业务架构, 都在瞎忙;</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<p>为了解决以上问题, 采取以下措施:</p>\n<ul>\n<li><ol>\n<li>列出工作任务清单, 了解工作需求、优先级、工作进度、可用资源(如人员职责, 所需时间), 预估工作量, 并合理调配资源;<ul>\n<li>识别变更冲突以及可用资源矛盾的风险, 做出相应调整;</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>设定变更流程, 稳定工作环境, 可视化管理IT运维部里的半成品;<ul>\n<li>在白板上, 列出所有的变更、相关人员. 所有人一起讨论变更的类型，然后对变更进行筛选和安排;</li>\n<li>把一部分变更审核委派给代理人, 重点关注最有风险的变更;<ul>\n<li>预先定义好高风险变更目录, 列出十大最脆弱的服务、应用程序和基础架构列表, 对相关变更申请标上记号, 并详细审查;</li>\n<li>围绕这些变更建立一些标准流程(如跟业务部门确认实施变更的时机), 相关人员关注变更、随时待命;</li>\n</ul>\n</li>\n<li>对于低风险变更(如增加Java应用程序服务器线程池容量), 仍需要提交, 但可以直接安排操作日程;</li>\n<li>对于复杂的中等变更, 变更提交者获得可能受到影响的人员许可后, 再审核并安排操作日程;</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"规范流程-保护约束点\"><a href=\"#规范流程-保护约束点\" class=\"headerlink\" title=\"规范流程, 保护约束点\"></a>规范流程, 保护约束点</h3><p>在一次排查故障问题会议上, 各部门又开始推脱责任. 而由于没有相关解决问题的知识库, 很多问题只有高级工程师布伦特能解决, 布伦特成了项目的一个约束点, 虽然也解决了故障, 但是比尔认为这次故障可能是布伦特的某次不规范操作导致.</p>\n<ul>\n<li>于是, 采取以下措施:<ul>\n<li>记录所有的变更, 不准再出现未经授权或未公开的变更;</li>\n<li>每两周组织一次排查故障的实战演练, 让每个人都养成运用合理的方式来解决问题的习惯;<ul>\n<li>如召开应急处置会议之前, 就要把相关时间线搞清楚;</li>\n</ul>\n</li>\n<li>减少需要布伦特的工作中心数量, 把布伦特的工作标准化，让其他人能够执行;<ul>\n<li>建立一个3级工程师的人力资源库, 由他们处理流转过来的工作;</li>\n<li>记录整理故障解决方案到知识库里, 生成能让一些工作中心自动化运行的文档;</li>\n<li>每周逐项检查工作, 不能让布伦特就同一个问题出手两次, 否则3级工程师和布伦特都要受罚;</li>\n<li>提供相关福利, 鼓励布伦特和工程师遵守新的流程;</li>\n</ul>\n</li>\n<li>保护约束点, 让布伦特只做最重要的凤凰项目的工作;<ul>\n<li>任何占用布伦特时间的人都要解释说明, 否则上报;</li>\n<li>过滤涌向布伦特的变更任务, 并在变更卡片上表示出来;</li>\n<li>收集直接找布伦特的名单, 给他们的上司打电话, 让上层知道有人在干扰凤凰项目;</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"问题频出-IT不受上层信任\"><a href=\"#问题频出-IT不受上层信任\" class=\"headerlink\" title=\"问题频出, IT不受上层信任\"></a>问题频出, IT不受上层信任</h3><p>因为开发没告诉运维需要打开一个防火墙端口, 而前端程序与数据库服务器通信失败, 代码无法在测试环境中正常运行, 延误了凤凰项目的上线. 以及一些接口延时, 性能相关的bug, 导致所有店内POS系统都会宕机. </p>\n<ul>\n<li>暴露的问题:<ul>\n<li>部署运行测试的时间太长, 跟不上开发的节奏;</li>\n<li>缺乏版本控制, 开发提供的是不完善的版本, 导致配置测试环境时, 浪费了不必要的时间;</li>\n</ul>\n</li>\n<li>采取措施:<ul>\n<li>代码试运行每天只能进行两次, 并限制所有影响性能的代码变更;</li>\n<li>开发人员, 提交的代码必须标注对应某个性能问题的缺陷编号;</li>\n</ul>\n</li>\n</ul>\n<p>而这些问题使上层不信任IT部了, 要将IT部外包. 比尔和开发部老大克里斯因此进行了一次深入交流, 发现大家的压力一样大, 也为公司付出了不少. 克里斯说, 他们总要不断追赶新技术、新的项目管理方法, 一直疲于应付各种故障修复，无暇顾及功能开发, 业务部门还总是不跟IT部门商量可行性, 就直接下达任务.</p>\n<h3 id=\"上下一心-重建团队信任\"><a href=\"#上下一心-重建团队信任\" class=\"headerlink\" title=\"上下一心, 重建团队信任\"></a>上下一心, 重建团队信任</h3><ul>\n<li>客户发票系统发生故障, 比尔团队通过一系列不间断的事后调查，搞清楚了故障的来龙去脉，采取了预防措施。同时开展了一系列全员参与的模拟事故呼叫，排演新的处理步骤, 一切都在有序的进行着. 但CEO史蒂夫认为IT部没有‘紧迫感’，要求所有相不相关的工程师都要‘手不离键盘，不能有闲人’, 比尔因此辞职了.</li>\n<li>与埃瑞克沟通并反思后, 史蒂夫明白了IT对公司日常运作起到关键作用, 必须重视IT, 所以召开IT领导外场会议, 重建团队信任. 他先自曝, 从刚进部队时不被人看好, 一路奋斗到CEO的经历。然后几个IT领导也各自分享自己的故事, 到比尔的时候, 比尔说因为有个不称职的父亲, 他离家出走, 加入海军陆战队后, 明白了一个人可以通过做正确的事, 而获得奖励, 所以他关心孩子, 要当个好父亲, 也让他形成了现在这种严遵规范的行事风格.</li>\n<li>然后大家也交流了一些现有问题, 并达成和解:<ul>\n<li>对‘已完成项目’的定义不统一. 开发团队没把运维部的工作列入考虑范畴;</li>\n<li>运维部不能及时部署交付;</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"冻结项目-根除计划外的工作\"><a href=\"#冻结项目-根除计划外的工作\" class=\"headerlink\" title=\"冻结项目, 根除计划外的工作\"></a>冻结项目, 根除计划外的工作</h3><p>除了变更板上的任务外, 常常还有些计划外的救火工作, 而且随着时间推移, 还会不断增加, 约束点未被充分利用, 没向业务部门交付全部的可用资源. 董事会新成员埃瑞克启发, 类比工厂的库存堆积, 如果停止向车间发布工作和原材料, 工作以成品的形式离开工厂, 半成品数量下降, 交期性能会提升。在IT部, 也要考虑部门的实际工作能力和负荷量, 保证足够时间和精力开展制定计划，考虑清楚是否可以接受新的工作, 否则, 项目的可用工作周期变短，出现更多走捷径的技术债务, 更多脆弱的应用程序, 需要以计划外工作的形式来偿还那些技术债务的利息。</p>\n<ul>\n<li>采取的措施:<ul>\n<li>清楚约束点是布伦特, 采取措施保护布伦特不受计划外工作的影响, 确保约束点从不浪费时间, 建立起一个可信赖的系统用以管理通向约束点的工作流, 根据布伦特来设定工作节奏;</li>\n<li>除了功能开发，还要关注稳定性、安全性、可扩展性、可维护性、可操作性、持续性以及其他诸如此类的性能;</li>\n<li>确认最主要的技术债务，开发部会对其进行处理，以减少问题应用程序所产生的计划外工作量;</li>\n<li>确认凤凰项目是优先级最高的事, 接下来两周, 冻结所有凤凰外的部署工作, 继续开展其他正在进行的项目，减少IT半成品数量;</li>\n</ul>\n</li>\n</ul>\n<p>项目冻结行动让IT得以把力量聚焦到凤凰上，七天里完成的工作比以往整个月完成的工作还要多。但项目解冻后, 面临两个问题:</p>\n<ul>\n<li><ol>\n<li>项目冻结解除后，发布哪些项目是安全的, 如何区分工作的轻重缓急.<ul>\n<li>在完成工作之前，要先分类列出工作所需的全部前提条件, 再加上工作订单和现有资源，理解生产能力和需求是什么, 进而可以判断是否可以接受一个新工作并对其作出实际安排。而布伦特是一个约束点, 支持了多个工作中心。假如25%的工作中心都只能由布伦特来操作，而布伦特在同一时间只能呆在一个工作中心, 工作将无法按时完成. 所以先了解工作如何流经某些工作中心, 根据对布伦特的依赖程度来决定能够安全重新启动的项目。</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>启动监控项目是否安全。<ul>\n<li>期间也发生了一次服务中断, 原因是一个网络服务供应商意外对系统作了一个变更. 而一个监控关键系统是否出现未经批准的变更的项目, 可以防止服务中断, 有助于进一步优化工作流转至约束点布伦特的流程, 让工作流服从于约束点, 尽量少依赖布伦特。</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"围绕约束点改进-减少等待\"><a href=\"#围绕约束点改进-减少等待\" class=\"headerlink\" title=\"围绕约束点改进, 减少等待\"></a>围绕约束点改进, 减少等待</h3><ul>\n<li>‘第二工作法’的一个关键部分是让等待时间可视化，使没有完成的部件，或者需要返工的瓶颈点一目了然。要把注意力从工作中心转到工作中心之间的那些空间上, 管理好工作交接。如下图, 一个给定资源的等待时间，是那个资源忙碌时间的百分比除以空闲时间的百分比。如果一个资源使用了50%，等待时间就是50/50。如果这个资源使用了90%，那么等待时间就是90/10。当一个资源使用了99%，那么等待时间就是该资源使用50%时的99倍。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdvclwg6nij30q20indh5.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n在代码投产之前，还未产生任何价值，因为那只是困在系统里的半成品。要着眼于整个工作流，确认约束点的位置，并尽其所能地运用各种技术和流程知识来确保工作得到有效执行。 </li>\n<li>所以, 帕蒂参考工厂管理工作流中白板管理技术和迭代改进的方法, 找出最经常出现的任务，建立起工作中心和工作路径, 写下操作步骤以及执行这些步骤的人员，测定每个操作所需的时间, 找出可优化的步骤, 降低重复次数。把这样的日程安排表换成看板图，索引卡片的每一行写的是分配的任务, 每一行都划分成三列，标注着“待办”、“在办”、“已办”。而用不同的颜色区分不同种类的卡片, 确保大家都在做最重要的工作, 一眼就能确认工作中紫色和绿色卡片是否平衡。</li>\n<li>关键资源所从事的任何活动都必须通过看板, 让需求和半成品可视化，限定半成品, 制止工作缺陷交接至下游工作中心, 加快工作完成的速度。规范布伦特接手工作的方式，把他的工作标准化。从上下游两个方面弄清楚布伦特的工作来源, 阻挡那些想打布伦特主意的人。能预测工作的交货时间, 能让用户满意度上升, 让大家专注工作.</li>\n<li>管理工作流，运用约束点来控制节奏. 像工业生产控制部那样, 安排并监督所有的生产过程，确认每一个需要的工作中心都有足够的生产能力和必要的投入, 确保能够符合客户的需求。与业务项目关联的IT项目, 也根据业务价值, 安排工作. 根据全体项目主管的排序，确定了项目解冻时要发布的最重要的五大业务项目。对于内部项目, 则根据项目能否提高在约束点(布伦特)上的工作能力，只开展能减少他的工作量，或者可以让其他人接手的项目。无限期暂停对那些非脆弱系统进行基础架构更新的项目。</li>\n<li>凤凰项目的一个任务又延期了, 因为布伦特的‘任务’是涉及多个人员的多个任务，开发部和IT运维部两个部门之间的工作交接，也涉及多个人员之间多次交接的多个步骤, 而每一次工作交接都有损耗的时间。因此, 为需要跨部门交接的‘任务’都设置一条看板追踪路径, 把这些经常性工作记录在案，将其标准化，并且熟练掌握, 提高流量，最终就能达到产品配置的一致性。同时, 新增兼有项目经理和稽查员的职能的角色, 他们要提供每一分钟的控制。让所有已完成的工作都快速有效地交接到下一个工作中心。必要时，这个人要在工作中心等待，保证关键工作完成并快速运往下一个工作中心, 减少悬而未定的项目数量，让工作流转的通路保持通畅。</li>\n</ul>\n<h3 id=\"从企业目标出发-专注要事\"><a href=\"#从企业目标出发-专注要事\" class=\"headerlink\" title=\"从企业目标出发, 专注要事\"></a>从企业目标出发, 专注要事</h3><ul>\n<li>公司最大的风险是停业破产, 目标是提高整个系统的生产能力, 而之前一直死守的‘安全性’项目会降低凤凰的项目吞吐量, 凤凰项目吞吐量是整个公司的约束点. 所以安全部的约翰, 先找到财务部的经理迪克, 了解他在公司的确切职能, 远期目标、近期目标和评估指标.</li>\n<li>迪克认为最重要的公司远期目标, 应该从整个系统出发, 对公司系统具备根本性的认识, 始终确保在一个正确的市场里, 作出正确的产品策略, 让企业达成目标, 那样财务目标才能发挥作用.</li>\n</ul>\n<blockquote>\n<p>我们有竞争力吗？<br>了解客户的需求和期望：我们知道要创建什么吗？<br>产品系列：我们有正确的产品吗？<br>研发效能：我们能有效地创建产品吗？<br>上架时间：我们能尽快把产品推向市场并占有一席之地吗？<br>销售机会渠道：我们的产品能带来感兴趣的潜在客户吗？<br>我们的效率高吗？<br>按时交货：我们遵守了对客户的承诺吗？<br>客户保留：我们是在获得客户，还是在流失客户？<br>销售预测准确率：我们可以把销售预测准确率纳入销售计划流程吗？</p>\n</blockquote>\n<ul>\n<li><p>比尔他们才意识到应该把迪克的重要评估指标作为IT任务的前提条件, 真正理解IT所参与的业务系统。于是决定, 去和业务流程负责人谈谈关于迪克说的公司的目标任务，弄清楚他们的确切职责是什么，哪些业务流程是支持其目标的. 找出对公司实现长期目标危害最大的几项内容, 弄清楚IT部门所负责帮助支撑及维护的公司业务.</p>\n</li>\n<li><p>帕蒂和比尔将对业务流程负责人进行访谈，主题是“理解客户的需求与期望”、“产品系列”、“上市时间”以及“销售渠道”.</p>\n<ul>\n<li>销售部总裁罗恩认为, 差劲的‘了解客户的需求和期望’影响了‘销售预测准确率’，需要知道门店里有哪些产品缺货，进而提升销售额.</li>\n<li>关于销售渠道流程及其困难的问题:<ul>\n<li>销售经理们很难从客户关系管理系统（CRM）中拿到需要的报告.</li>\n</ul>\n</li>\n<li>糟糕的一天是什么样:<ul>\n<li>负责管理的物料需求计划(MRP)系统和电话系统都崩溃, 服务中断, 客户取消订单, 无法完成业绩指标. 比尔接着解释, 电话系统故障是因为供应商未经授权就对电话交换机更换, 等预算批下来, 就能通过监控来强制实行控制策略, 杜绝问题.</li>\n</ul>\n</li>\n<li>业务发起人玛姬说, 她对‘了解客户的需求和期望’的衡量标准是，客户是否会向朋友推荐我们, 但是订单输入系统和库存管理系统的数据总是错的, 导致不能通过销售数据知道客户想要什么.</li>\n<li>假如能挥舞魔杖, 会怎么做:<ul>\n<li>她希望从门店和在线渠道, 有方便易用的功能, 得到准确及时的订单信息。运用那些数据来设计市场推广活动，不断推出“A或B”产品选择测试，以发现客户认可的报价, 并在全部客户中复制推广。就能为罗恩创建一个巨大的、可预测的销售漏斗。运用那些信息来推进生产计划，管理供求曲线。让正确的产品出现在正确的货架上，并一直备好库存。平均每客户销售额将会一路冲高，平均订单金额也会上升, 最终会提高市场份额，并再次打败竞争对手。</li>\n</ul>\n</li>\n<li>对于上市时间, 玛姬认为要控制在6个月内, 要不断降低周期时间, 不断整合来自市场的反馈, 增强回收成本的能力，最好从消费者那里直接回收成本.</li>\n</ul>\n</li>\n<li><p>建立起价值链, 包括IT方面的所需的价值链，把迪克的目标任务与IT对这些目标任务的影响关联起来，收集以前IT问题如何影响那些目标的具体案例, 对业务绩效指标产生影响的IT风险，就要着手制定更好的业务决策。弄清楚达成迪克期望结果所需要的业务能力和流程；那些业务流程所依赖的IT系统；IT系统或数据可能会发生的故障；防范那些故障发生的应对措施，或者至少能够侦测并作出回应的措施。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdvfhql28lj30jj0bhwh0.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><p>通过与业务负责人的访谈, 理解了哪些是重要的工作, 让业务部门相信, IT的应对措施有助于他们达成目标, 和他们一起开展把IT融入其绩效指标的工作采取措施:</p>\n<ul>\n<li>对于“客户的需求和期望”, 目标是数据的完整性, 凤凰修复了很多这方面的问题, 还需要控制由上游产生的问题; 预测评估指标包括遵守变更管理流程、监督审核生产变更、完成定期维护，以及排除所有已知单点故障; 创建一份完整的清单，把所有支持罗恩的应用程序和基础架构都列出来。只要其中有任何脆弱的应用程序或系统，就要把它们添加到替换清单里;</li>\n<li>对于“市场营销的需求和期望”，评估指标包括凤凰支持每周报告并且最终支持每日报告的能力，市场营销部生成的有效SKU比例等;</li>\n<li>把发布变小变短，减少半成品和功能, 更快地回笼资金，达到内部最低预期资本回收率;</li>\n</ul>\n</li>\n<li><p>约翰研究业务部门的安全控制环境, 了解到一个拥有技术背景财务人员, 她分析一个财务方面的重要会计科目中的主要业务流程的端到端信息流, 发现, 在一个人工对账步骤中检测到重大错误，在这个步骤中，来自一个源头的账户余额和账户值要和来自其他源头的逐一比对，一般是每周一次。如此一来, 检测重大错误所依靠的控制手段是人工对账步骤，并非上游的IT系统, 所以审计师撤回他们的IT发现.</p>\n</li>\n<li><p>针对调研, 知道了审计安全的关键落脚点是, 确保财务报告的可靠性，符合法律法规，以及运营的效率和效果, 并提出建议:</p>\n<ul>\n<li>大幅度缩减安全合规项目的范围;</li>\n<li>弄清楚生产薄弱点一开始是如何产生的，调整部署流程，杜绝此类情况再次发生;</li>\n<li>在变更管理流程中，标记出所有列入合规审计范围的系统, 避免可能危及审计工作的变更, 创建持续记录文档;</li>\n<li>通过清除所有存储或处理持卡人数据的东西，来缩减PCI合规项目规模;</li>\n<li>用节省下来的时间，偿还凤凰的所有关于战略风险、运营风险、严重的安全与合规风险的技术债务, 关乎关键评估指标;</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"形成反复实践和勇于尝试的团队文化\"><a href=\"#形成反复实践和勇于尝试的团队文化\" class=\"headerlink\" title=\"形成反复实践和勇于尝试的团队文化\"></a>形成反复实践和勇于尝试的团队文化</h3><ul>\n<li>对需要团队合作的事情，训练成习惯，不断重复可建立起信任感和透明度。定期回顾小结，对工作开展情况以及需要改进的方面进行自我评估, 同时邀请开发部的人参加服务中断根本原因分析会.</li>\n<li>类比跨国货运公司，要达成客户满意度和按时交货的目标。为降低更换机油会导致车辆故障, 而影响按时交货的风险，就要为车辆运营建立一个每行驶五千英里就要更换一次机油的协议, 还有已经按要求更换机油的车辆百分比, 因为如果只有50%的车辆遵守了必需的保养策略，卡车和包裹就可能会抛锚在路边，那么按时交货KPI就会大幅下跌。同样, 为了达到公司的按时交货的关键性绩效指标（KPI），也要建立一个新的前瞻性KPI，预防性供应商补丁程序以及变更管理政策就好比是预防性机油更换以及车辆保养策略。‘第三工作法’就是要让我们不断给系统施加压力，适当提高预防性工作, 从而不断强化习惯并加以改进, 形成不断改进的文化, 加强系统的健壮性. 所以, 安全部开发了一些工具, 在日常工作中, 对测试和生产环境持续不断的攻击和压力测试.</li>\n<li>虽然由于布伦特又一次没按流程, 部署了萨拉的一个供应商项目, 导致凤凰项目第二次部署遇到困难, 但最终还是完成了部署, 帕蒂发出部署是“成功”的通知, 并提醒需要提防的已知错误，提供一个可以获得凤凰最新状态的内部网页，以及如何报告新问题的指南, 全体人员随时待命，准备对业务提供支持. 这次部署失败证明, 批量规模还是太大了。要在IT部门创建一个单一向前的工作流, 让生产能力最大化，同时让变化幅度最小化。一旦看到工作向后移动，也许是由于不合格品、缺少规范，或者返工导致, 都得开展修复工作.</li>\n</ul>\n<h3 id=\"让最小可行产品-MVP-加速接受市场的考验\"><a href=\"#让最小可行产品-MVP-加速接受市场的考验\" class=\"headerlink\" title=\"让最小可行产品(MVP)加速接受市场的考验\"></a>让最小可行产品(MVP)加速接受市场的考验</h3><ul>\n<li>凤凰归根结底就是为了帮助客户快速、大批量地买走东西, 最近的两次发布也为此打下了基础, 但凤凰项目延误了太多真正提升销售的功能, 这个季度的盈利是不能指望凤凰了, 所以决定从凤凰主团队里分出一小队人，组建一支叫独角兽的特别行动队，聚焦于生成良好的客户推荐, 并让市场营销部门能够开展促销活动，把库存里现有的盈利产品卖掉, 尽快达到收入目标, 然后把探索出来的成功实践复制到凤凰中.</li>\n</ul>\n<h3 id=\"建立反馈回路-持续交付\"><a href=\"#建立反馈回路-持续交付\" class=\"headerlink\" title=\"建立反馈回路, 持续交付\"></a>建立反馈回路, 持续交付</h3><ul>\n<li><p>丰田公司有一个引擎盖冲压工序，最初转换时间约为三天, 仔细观察了换模所需的全部步骤后，提出了一系列预备和改进措施，把换模时间降至十分钟以内。相应的, 根据第二工作法，建立一条反馈环路，一直往回通向产品定义、设计及开发的最初环节, 延伸到产品生产流程的更早阶段, 在初始阶段就筹划产品的质量。开发部和运维部, QA和业务部门一起协同工作, 持续不断地降低批量规模, 对创建环境所需的每一样东西都进行版本控制, 从代码签入到投产的整个价值流, 创建‘部署管道’，在其中自动创建测试和生产环境，把基础架构当作代码一样对待, 构建一步到位的生产环境和部署流程, 缩短准备时间并排除故障, 更快的获取反馈, 才能跟上客户需求和开发部的各种工作节奏.</p>\n</li>\n<li><p>业务敏捷度重点是捕捉和适应市场变化并为此承担更大风险的能力, 要持续不断的尝试，越快把那些功能推向市场接受考验，也能更快地为公司收回成本。要达到一天十个部署的目标, 那部署可包括故障修复, 让市场营销部修改他们自己的内容或业务规则，或者启用更快速的试验和A/B对比测试.</p>\n</li>\n<li><p>为了找到可自动化的步骤, 分析从‘代码提交’开始，到部署成功的所有步骤, 和之前上线期间存在问题的步骤, 得出返工和准备时间过长问题的来源有两个：</p>\n</li>\n<li><ol>\n<li>环境: 在部署流程的每个阶段，部署环境总是没有就绪，即使已经准备就绪了，也需要大量返工才能让它们彼此同步</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>部署: 代码打包流程。尽管开发团队尽可能地记录代码和配置，但总是在IT运维部进行版本控制，然后生成部署包部署之后，代码无法在环境中运行, 才发现有遗漏东西。</li>\n</ol>\n</li>\n<li><p>采取措施:</p>\n<ul>\n<li>收集从错误中吸取的各种教训, 编一本关于部署运行的书</li>\n<li>设置一个通用构建过程，每个人都使用自己的工具来创建自己的环境，开发人员能在一个与生产环境相似的环境下编写代码</li>\n<li>运维直接拿到准备部署的打包好的代码, 一旦代码被标记为‘准备测试’，就生成并提交代码包，触发一个QA环境的自动部署, 及后续生产环境的自动部署。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"清除异党\"><a href=\"#清除异党\" class=\"headerlink\" title=\"清除异党\"></a>清除异党</h3><ul>\n<li><p>市场部莎拉急于讨好上层, 又因为以前IT经常不能完成并交付她所需要的东西, 找供应商开发第三方服务, 这些看起来是战略性, 但实际不遵守关于数据隐私的法律法规，订单输入和库存管理系统出现更多的数据完整性问题, 还得向供应商开放产品数据库，向他们解释这些数据库是如何构建的，开展众多防火墙变更，等大量额外的工作, 阻碍了聚焦凤凰项目, 这些都是对公司不利的。</p>\n</li>\n<li><p>在独角兽项目的关键时刻, 迪克和财务团队要调走布伦特, 让他加入制定拆分公司方案的特别工作组。但只要完成季度指标, 保住凤凰项目, 就不需要拆分公司了. 了解客户的需求和期望，拥有正确的产品系列，保留客户，以及最终提高营业收入和市场份额，才是最重要的, 所以比尔把布伦特截回来, 在史蒂夫的帮助和众人的努力下, 独角兽项目上线后促销活动的客户转化率很高, 通过了市场的考验.</p>\n</li>\n<li><p>理解技术能够做什么、不能做什么，是公司里每个部门必须具备的一种核心竞争力。最后, 不能融入公司新文化的莎拉离职了.</p>\n</li>\n</ul>\n<p>————————–—<em>以上为暂时梳理的故事脉络, 笔记还会多次迭代</em>————————————-</p>\n<h2 id=\"有趣段落摘抄\"><a href=\"#有趣段落摘抄\" class=\"headerlink\" title=\"有趣段落摘抄:\"></a>有趣段落摘抄:</h2><blockquote>\n<p>俗话说得好, 如果你的同事主动告诉你他们要离职, 那多半是自愿的.但如果是其他人告诉你的, 那他们一定是被迫的. 所以说, 我的上司和上司的上司刚刚被炒了.</p>\n</blockquote>\n<blockquote>\n<p>“比尔, 我知道你没有申请这个职位, 但公司已经命悬一线. 我需要你来帮助我拯救这家伟大的公司. 我能指望你吗?”<br>啊, 我的天哪! 还没来得及礼貌地谢绝, 我突然听到自己说:“ 可以, 你可以指望我.”</p>\n</blockquote>\n<blockquote>\n<p>迪克打断了她: “这是IT部的比尔.他说他是被派来收拾这个这个烂摊子的, 或者准备在收拾的过程中壮烈牺牲, 我是这么理解的.”</p>\n</blockquote>\n<blockquote>\n<p>“他摇摇头继续说：“要说服业务部门去做正确的事情越来越困难。他们就像走进糖果店的小孩子。他们在飞机杂志上读到，可以在云端管理整个供应链，每年只要499美元，然后这突然就成了公司的主要行动。当我们告诉他们，事实上没那么简单，并演示做好这个要花什么样的代价时，他们就不见了。他们去哪儿了？去和维尼表兄或者其他推销外包服务的家伙谈了，那些人许诺，能用十分之一的时间和价格做成这件事。”</p>\n</blockquote>\n<blockquote>\n<p>“我脑海里立刻浮现出这样的景象，约翰问了一些愚蠢的问题，或者说了一些愚蠢的话，彻底激怒了迪克，迪克当场解雇了他，为绝后患，就把我也解雇了。<br>然而，我发现自己说的是：“好的，我会去的。”</p>\n</blockquote>\n<blockquote>\n<p>“他剃了头，看上去像瘦了十五磅。他穿着一件我只能描述为“欧洲式样”的衬衫和一件马甲。和他平常穿的略为宽松的衬衫不同，他身上那件粉色衬衫非常修身。再加上那件马甲，他看起来像是个……时尚模特？伦敦夜店男？拉斯维加斯赌场发牌员？”</p>\n</blockquote>\n<h2 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念:\"></a>相关概念:</h2><h3 id=\"精益理论\"><a href=\"#精益理论\" class=\"headerlink\" title=\"精益理论\"></a>精益理论</h3><ul>\n<li>包括: 1)降低批量规模; 2)减少半成品; 3)缩短并增强反馈回路</li>\n</ul>\n<h3 id=\"DevOps\"><a href=\"#DevOps\" class=\"headerlink\" title=\"DevOps\"></a>DevOps</h3><ul>\n<li>what<ul>\n<li>也就是开发运维, 这个词最初是在2008年由帕特克里.德布瓦和安德鲁.谢弗提出, 脱胎于马克.伯吉斯博士发起的“基础设施即代码”的实践及有杰兹.亨伯尔和戴维.法利发起的持续集成和持续部署.</li>\n<li>应用了精益理论, 来提高流经生产管理、开发、测试、IT运维及信息安全等部门的工作流的速度.</li>\n</ul>\n</li>\n<li>why<ul>\n<li>能使产品功能更快地进入市场, 创造价值. 在玩偶实验室2012年的“开发运维报告说明”中, 用基准问题测试4039家IT企业, 发现运用开发运维的高绩效公司比同行: 代码部署频率快30倍; 代码部署交付期快8000倍; 变更成功率高2倍; MTTR(Mean Time To Repair, 平均修复时间)快12倍. </li>\n</ul>\n</li>\n<li>how<ul>\n<li>三步工作法</li>\n<li>持续交付就是三步工作法中到一种体现, 它强调小到批次规模(如每天检查主干), 在发生问题时停止生产(如一旦构建、测试或部署失败, 就不再允许开展新到工作; 将系统工作到完整性置于工作本身之上), 并必须频繁进行验证性测试, 以避免生产中到失误, 或至少能检测并修复故障.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"三步工作法\"><a href=\"#三步工作法\" class=\"headerlink\" title=\"三步工作法\"></a>三步工作法</h3><ul>\n<li>what<ul>\n<li>旨在阐明指导开发运维的流程与实践的价值观与理念.</li>\n</ul>\n</li>\n<li>第一工作法<ul>\n<li>what <ul>\n<li>关于从开发到IT运维再到客户的整个自左向右的工作流, 那是业务部门与客户之间的衔接.</li>\n</ul>\n</li>\n<li>why<ul>\n<li>为了使流量最大化, 让批量规模和工作间隔尽量小, 不让缺陷流向下游工作中心, 并不断为整体目标(与之相对的局部目标就是开发功能完成率、测试发现/修复比率或运维有效性指标等)进行优化.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>必要做法包括: 持续构建、集成以及部署, 按需创建环境, 严控半成品, 以及构建起能顺利变更的安全系统和组织.</li>\n<li>其中严控半成品就可以建立看板图, 列出: 待办、在办、已办 </li>\n<li>根据瓶颈资源所能完成的工作速度来安排工作, 确保绝大多数受约束的人力资源都只能投放在整个系统的目标所服务的工作上, 而不只是为了一个部门的目标服务</li>\n<li>确保形成一条迅速、可预测、持续不断的计划内工作流, 从而向业务部门交付工作价值, 同时尽可能降低计划外工作的影响和破坏, 提供稳定的、可预期的、安全的IT服务.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>第二工作法<ul>\n<li>what<ul>\n<li>关于价值流各阶段中, 自右向左的快速持续反馈流, 缩短及放大反馈回路</li>\n</ul>\n</li>\n<li>why<ul>\n<li>放大各阶段的效益以确保防止问题再次发生, 或更快地发现和修复问题, 从源头上保证质量, 避免返工.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>在部署管道中的构建和测试时, “停止生产线”;</li>\n<li>日复一日地持续改进日常工作;</li>\n<li>创建快速的自动化测试套装软件, 确保代码总是处于可部署状态;</li>\n<li>在开发和IT运维之间建立共同的目标和共同解决问题的机制;</li>\n<li>建立普遍的产品遥测技术;</li>\n<li>让每个人都能知道, 代码和环境是否在按照设定的运行, 以及是否达到了客户的目标.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>第三工作法<ul>\n<li>what<ul>\n<li>关于创造公司文化, 该文化可带动两种风气的形成: <ul>\n<li>不断尝试, 这需要承担风险并从成功和失败中吸取经验教训;</li>\n<li>理解重复和练习是熟练掌握的前提.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>why<ul>\n<li>尝试和承担风险让我们能够不懈地改进工作系统;</li>\n<li>不断重复的日常操练赋予我们的技能和经验, 一旦出了问题, 就可以撤回至安全区域并恢复正常运作.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>营造一种勇于创新、敢于冒险(相对于畏惧或盲目服从命令), 及高度信任(相对于低信任度和命令控制)的文化, 把至少20%开发和IT运维周期划拨给非功能性需求, 并不断鼓励进行改进</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"IT从事的四种工作类型\"><a href=\"#IT从事的四种工作类型\" class=\"headerlink\" title=\"IT从事的四种工作类型\"></a>IT从事的四种工作类型</h3><ul>\n<li>业务项目</li>\n<li>IT内部项目<ul>\n<li>包括业务项目衍生出的基础架构或IT运维项目, 及内部生成的改进项目(如创建新环境和部署自动化)</li>\n</ul>\n</li>\n<li>变更<ul>\n<li>经常由业务项目和IT内部项目的工作引起, 往往在保修系统中被跟踪(如IT运维补救、JIRA或用于开发的敏捷计划工具)</li>\n</ul>\n</li>\n<li>计划外工作或救火工作<ul>\n<li>包括操作事故和操作问题, 通常由上述类型的工作导致, 往往以牺牲其他计划内工作为代价</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"约束理论5个方法步骤\"><a href=\"#约束理论5个方法步骤\" class=\"headerlink\" title=\"约束理论5个方法步骤\"></a>约束理论5个方法步骤</h3><ul>\n<li>识别约束点;</li>\n<li>利用约束点;<ul>\n<li>确保不让约束点浪费任何时间。永远不要让约束点迁就别的资源而干等着，而是应该专注于IT运维部对当前所需完成工作中优先级最高的那一项。</li>\n</ul>\n</li>\n<li>让所有其他活动都从属于约束;<ul>\n<li>根据约束点的工作效率来控制其他工作的速度。在约束理论中，一般是由名为‘限制驱导式排程法’（Drum-Buffer-Rope）的工具来实施的。《目标》中的主角亚历克斯，发现队伍里最慢的童子军赫比实际上决定了整支队伍的行军速度，后来亚历克斯把赫比调到队伍前头，防止孩子们超前太远.</li>\n</ul>\n</li>\n<li>把约束点提升到新到水平;</li>\n<li>寻找下一个约束点;</li>\n</ul>\n<h2 id=\"个人感悟\"><a href=\"#个人感悟\" class=\"headerlink\" title=\"个人感悟:\"></a>个人感悟:</h2><ul>\n<li>也许大家都想把工作做好, 也为此付诸行动, 但是有没有在做正确的事就是另外一回事了. 这就需要切入顶层的上下文中考虑, 因为公司的存在就是要产生商业价值, 大家的工作就是要为业务服务. 而工作的完成, 也是多方合作的结果, 任何一个职位都很重要, 而且协调沟通还会影响整体的效率. </li>\n<li>问题的存在不可怕, 当问题发生时, 要做的是找出应对的措施, 积极改进, 而不是推卸责任, 否则最终受累的也是自己.</li>\n<li>而理论再完美, 最终还是需要不断尝试, 找到适合自己的解决方案, 只有实践了才知道有哪些问题, 下一步要如何调整.</li>\n<li>将所有的工作分类, 不同的工作安排不同的优先级和处理方法.</li>\n<li>其实这本书除了能了解开发运维、管理相关价值观之外, 同时也能学到些为人处事的方法, 比如主角总会深呼吸或者倒数几秒, 让自己迅速冷静下来, 因为情绪会阻碍正确的决策, 使问题得不到解决.</li>\n<li>多看书太重要了, 因为当自己的视角不够高不够广, 而在一条错误的路渐行渐远时, 有人给予正确的提点自然是最好的, 但实际情况是, 那样的概率很小, 相当于两手一摊, 等着“神啊, 告诉我怎么做吧”, 所以就需要自己多主动吸收前人的优秀经验, 反思自己的行为, 不断调整, 或者以此理解自己领导作出的决策.</li>\n<li>说实话, 以自己现在的水平, 还不能很好的吸收书中的理念, 后续还得反复研读, 细细咀嚼书中的案例, 还有最重要的, 用到工作和生活中. </li>\n<li>最后, 作为一个学生时代就习惯性逃避写作文的人来说, 整理这篇笔记还挺不适应的, 不过, 不熟就多练嘛. If it hurts, do it more often.</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言:\"></a>前言:</h2><p>去年想了解DevOps的相关概念, 看了《凤凰项目》这本热荐的入门书. </p>\n<p>虽然看起来是一本技术相关的书, 其实以第一人称的视角来讲述, 一个IT运维经理临危受命, 推动项目转型的波折和故事, 特别生动有趣, 每个人物也个性鲜明, 搞得我明明在严肃认真的学习, 却常常像看了不正经的书似的哈哈大笑…</p>\n<p>书中还穿插各种吐槽, 有同感的是, 我也在公司年会节目上改编过一首歌词吐槽bug什么的, 不过好在大家都挺包容的… <span class=\"emoji\" alias=\"smile\" style=\"\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8\">😄</span> <span class=\"emoji\" alias=\"sparkles\" style=\"\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/2728.png?v8\">✨</span></p>\n<p>不过, 只看一遍过过瘾是不行的, 所以整理了下读书笔记. 下文中就包括《凤凰项目》的故事脉络、有趣段落摘抄、相关概念、个人感悟.</p>\n<h2 id=\"故事脉络\"><a href=\"#故事脉络\" class=\"headerlink\" title=\"故事脉络:\"></a>故事脉络:</h2><p>主角比尔, 一家制造和零售企业的IT运维经理, 面临着被竞争对手不断超越的困境, 接任IT运维部的副总裁, 管理一个叫凤凰的电商系统项目, 以此招揽客户并拯救公司的经济危机.</p>","more":"<h3 id=\"可视化管理流程\"><a href=\"#可视化管理流程\" class=\"headerlink\" title=\"可视化管理流程\"></a>可视化管理流程</h3><p>刚上任就发生工资核算故障, 起因是开发部为了修补一个审计发现, 没遵照规定的流程和测试, 直接部署了个有bug的标记化应用.</p>\n<ul>\n<li>暴露的问题: <ul>\n<li><ol>\n<li>流程繁琐、响应慢, 所以申请测试环境的预算一直没审批, 而无法测试;</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>各部门沟通、协调不到位;<ul>\n<li>业务市场部不断压缩IT部交付部署时间、迫切想先人一步抢夺市场;</li>\n<li>运维部不能及时交付, 开发部申请的设备、环境;</li>\n<li>关于项目完成的定义不统一, 开发部没有考虑运维部署的时间, 总是匆忙上线;</li>\n<li>开发部没有提供清晰的部署文档, 使运维部无法顺利部署, 无法进行压力测试, 没有全面监控和备份;</li>\n<li>运维的关键工程师总是要处理各种故障, 没办法参与开发部的计划会议;</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>没人清楚公司整体业务架构, 都在瞎忙;</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<p>为了解决以上问题, 采取以下措施:</p>\n<ul>\n<li><ol>\n<li>列出工作任务清单, 了解工作需求、优先级、工作进度、可用资源(如人员职责, 所需时间), 预估工作量, 并合理调配资源;<ul>\n<li>识别变更冲突以及可用资源矛盾的风险, 做出相应调整;</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>设定变更流程, 稳定工作环境, 可视化管理IT运维部里的半成品;<ul>\n<li>在白板上, 列出所有的变更、相关人员. 所有人一起讨论变更的类型，然后对变更进行筛选和安排;</li>\n<li>把一部分变更审核委派给代理人, 重点关注最有风险的变更;<ul>\n<li>预先定义好高风险变更目录, 列出十大最脆弱的服务、应用程序和基础架构列表, 对相关变更申请标上记号, 并详细审查;</li>\n<li>围绕这些变更建立一些标准流程(如跟业务部门确认实施变更的时机), 相关人员关注变更、随时待命;</li>\n</ul>\n</li>\n<li>对于低风险变更(如增加Java应用程序服务器线程池容量), 仍需要提交, 但可以直接安排操作日程;</li>\n<li>对于复杂的中等变更, 变更提交者获得可能受到影响的人员许可后, 再审核并安排操作日程;</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"规范流程-保护约束点\"><a href=\"#规范流程-保护约束点\" class=\"headerlink\" title=\"规范流程, 保护约束点\"></a>规范流程, 保护约束点</h3><p>在一次排查故障问题会议上, 各部门又开始推脱责任. 而由于没有相关解决问题的知识库, 很多问题只有高级工程师布伦特能解决, 布伦特成了项目的一个约束点, 虽然也解决了故障, 但是比尔认为这次故障可能是布伦特的某次不规范操作导致.</p>\n<ul>\n<li>于是, 采取以下措施:<ul>\n<li>记录所有的变更, 不准再出现未经授权或未公开的变更;</li>\n<li>每两周组织一次排查故障的实战演练, 让每个人都养成运用合理的方式来解决问题的习惯;<ul>\n<li>如召开应急处置会议之前, 就要把相关时间线搞清楚;</li>\n</ul>\n</li>\n<li>减少需要布伦特的工作中心数量, 把布伦特的工作标准化，让其他人能够执行;<ul>\n<li>建立一个3级工程师的人力资源库, 由他们处理流转过来的工作;</li>\n<li>记录整理故障解决方案到知识库里, 生成能让一些工作中心自动化运行的文档;</li>\n<li>每周逐项检查工作, 不能让布伦特就同一个问题出手两次, 否则3级工程师和布伦特都要受罚;</li>\n<li>提供相关福利, 鼓励布伦特和工程师遵守新的流程;</li>\n</ul>\n</li>\n<li>保护约束点, 让布伦特只做最重要的凤凰项目的工作;<ul>\n<li>任何占用布伦特时间的人都要解释说明, 否则上报;</li>\n<li>过滤涌向布伦特的变更任务, 并在变更卡片上表示出来;</li>\n<li>收集直接找布伦特的名单, 给他们的上司打电话, 让上层知道有人在干扰凤凰项目;</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"问题频出-IT不受上层信任\"><a href=\"#问题频出-IT不受上层信任\" class=\"headerlink\" title=\"问题频出, IT不受上层信任\"></a>问题频出, IT不受上层信任</h3><p>因为开发没告诉运维需要打开一个防火墙端口, 而前端程序与数据库服务器通信失败, 代码无法在测试环境中正常运行, 延误了凤凰项目的上线. 以及一些接口延时, 性能相关的bug, 导致所有店内POS系统都会宕机. </p>\n<ul>\n<li>暴露的问题:<ul>\n<li>部署运行测试的时间太长, 跟不上开发的节奏;</li>\n<li>缺乏版本控制, 开发提供的是不完善的版本, 导致配置测试环境时, 浪费了不必要的时间;</li>\n</ul>\n</li>\n<li>采取措施:<ul>\n<li>代码试运行每天只能进行两次, 并限制所有影响性能的代码变更;</li>\n<li>开发人员, 提交的代码必须标注对应某个性能问题的缺陷编号;</li>\n</ul>\n</li>\n</ul>\n<p>而这些问题使上层不信任IT部了, 要将IT部外包. 比尔和开发部老大克里斯因此进行了一次深入交流, 发现大家的压力一样大, 也为公司付出了不少. 克里斯说, 他们总要不断追赶新技术、新的项目管理方法, 一直疲于应付各种故障修复，无暇顾及功能开发, 业务部门还总是不跟IT部门商量可行性, 就直接下达任务.</p>\n<h3 id=\"上下一心-重建团队信任\"><a href=\"#上下一心-重建团队信任\" class=\"headerlink\" title=\"上下一心, 重建团队信任\"></a>上下一心, 重建团队信任</h3><ul>\n<li>客户发票系统发生故障, 比尔团队通过一系列不间断的事后调查，搞清楚了故障的来龙去脉，采取了预防措施。同时开展了一系列全员参与的模拟事故呼叫，排演新的处理步骤, 一切都在有序的进行着. 但CEO史蒂夫认为IT部没有‘紧迫感’，要求所有相不相关的工程师都要‘手不离键盘，不能有闲人’, 比尔因此辞职了.</li>\n<li>与埃瑞克沟通并反思后, 史蒂夫明白了IT对公司日常运作起到关键作用, 必须重视IT, 所以召开IT领导外场会议, 重建团队信任. 他先自曝, 从刚进部队时不被人看好, 一路奋斗到CEO的经历。然后几个IT领导也各自分享自己的故事, 到比尔的时候, 比尔说因为有个不称职的父亲, 他离家出走, 加入海军陆战队后, 明白了一个人可以通过做正确的事, 而获得奖励, 所以他关心孩子, 要当个好父亲, 也让他形成了现在这种严遵规范的行事风格.</li>\n<li>然后大家也交流了一些现有问题, 并达成和解:<ul>\n<li>对‘已完成项目’的定义不统一. 开发团队没把运维部的工作列入考虑范畴;</li>\n<li>运维部不能及时部署交付;</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"冻结项目-根除计划外的工作\"><a href=\"#冻结项目-根除计划外的工作\" class=\"headerlink\" title=\"冻结项目, 根除计划外的工作\"></a>冻结项目, 根除计划外的工作</h3><p>除了变更板上的任务外, 常常还有些计划外的救火工作, 而且随着时间推移, 还会不断增加, 约束点未被充分利用, 没向业务部门交付全部的可用资源. 董事会新成员埃瑞克启发, 类比工厂的库存堆积, 如果停止向车间发布工作和原材料, 工作以成品的形式离开工厂, 半成品数量下降, 交期性能会提升。在IT部, 也要考虑部门的实际工作能力和负荷量, 保证足够时间和精力开展制定计划，考虑清楚是否可以接受新的工作, 否则, 项目的可用工作周期变短，出现更多走捷径的技术债务, 更多脆弱的应用程序, 需要以计划外工作的形式来偿还那些技术债务的利息。</p>\n<ul>\n<li>采取的措施:<ul>\n<li>清楚约束点是布伦特, 采取措施保护布伦特不受计划外工作的影响, 确保约束点从不浪费时间, 建立起一个可信赖的系统用以管理通向约束点的工作流, 根据布伦特来设定工作节奏;</li>\n<li>除了功能开发，还要关注稳定性、安全性、可扩展性、可维护性、可操作性、持续性以及其他诸如此类的性能;</li>\n<li>确认最主要的技术债务，开发部会对其进行处理，以减少问题应用程序所产生的计划外工作量;</li>\n<li>确认凤凰项目是优先级最高的事, 接下来两周, 冻结所有凤凰外的部署工作, 继续开展其他正在进行的项目，减少IT半成品数量;</li>\n</ul>\n</li>\n</ul>\n<p>项目冻结行动让IT得以把力量聚焦到凤凰上，七天里完成的工作比以往整个月完成的工作还要多。但项目解冻后, 面临两个问题:</p>\n<ul>\n<li><ol>\n<li>项目冻结解除后，发布哪些项目是安全的, 如何区分工作的轻重缓急.<ul>\n<li>在完成工作之前，要先分类列出工作所需的全部前提条件, 再加上工作订单和现有资源，理解生产能力和需求是什么, 进而可以判断是否可以接受一个新工作并对其作出实际安排。而布伦特是一个约束点, 支持了多个工作中心。假如25%的工作中心都只能由布伦特来操作，而布伦特在同一时间只能呆在一个工作中心, 工作将无法按时完成. 所以先了解工作如何流经某些工作中心, 根据对布伦特的依赖程度来决定能够安全重新启动的项目。</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>启动监控项目是否安全。<ul>\n<li>期间也发生了一次服务中断, 原因是一个网络服务供应商意外对系统作了一个变更. 而一个监控关键系统是否出现未经批准的变更的项目, 可以防止服务中断, 有助于进一步优化工作流转至约束点布伦特的流程, 让工作流服从于约束点, 尽量少依赖布伦特。</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"围绕约束点改进-减少等待\"><a href=\"#围绕约束点改进-减少等待\" class=\"headerlink\" title=\"围绕约束点改进, 减少等待\"></a>围绕约束点改进, 减少等待</h3><ul>\n<li>‘第二工作法’的一个关键部分是让等待时间可视化，使没有完成的部件，或者需要返工的瓶颈点一目了然。要把注意力从工作中心转到工作中心之间的那些空间上, 管理好工作交接。如下图, 一个给定资源的等待时间，是那个资源忙碌时间的百分比除以空闲时间的百分比。如果一个资源使用了50%，等待时间就是50/50。如果这个资源使用了90%，那么等待时间就是90/10。当一个资源使用了99%，那么等待时间就是该资源使用50%时的99倍。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdvclwg6nij30q20indh5.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n在代码投产之前，还未产生任何价值，因为那只是困在系统里的半成品。要着眼于整个工作流，确认约束点的位置，并尽其所能地运用各种技术和流程知识来确保工作得到有效执行。 </li>\n<li>所以, 帕蒂参考工厂管理工作流中白板管理技术和迭代改进的方法, 找出最经常出现的任务，建立起工作中心和工作路径, 写下操作步骤以及执行这些步骤的人员，测定每个操作所需的时间, 找出可优化的步骤, 降低重复次数。把这样的日程安排表换成看板图，索引卡片的每一行写的是分配的任务, 每一行都划分成三列，标注着“待办”、“在办”、“已办”。而用不同的颜色区分不同种类的卡片, 确保大家都在做最重要的工作, 一眼就能确认工作中紫色和绿色卡片是否平衡。</li>\n<li>关键资源所从事的任何活动都必须通过看板, 让需求和半成品可视化，限定半成品, 制止工作缺陷交接至下游工作中心, 加快工作完成的速度。规范布伦特接手工作的方式，把他的工作标准化。从上下游两个方面弄清楚布伦特的工作来源, 阻挡那些想打布伦特主意的人。能预测工作的交货时间, 能让用户满意度上升, 让大家专注工作.</li>\n<li>管理工作流，运用约束点来控制节奏. 像工业生产控制部那样, 安排并监督所有的生产过程，确认每一个需要的工作中心都有足够的生产能力和必要的投入, 确保能够符合客户的需求。与业务项目关联的IT项目, 也根据业务价值, 安排工作. 根据全体项目主管的排序，确定了项目解冻时要发布的最重要的五大业务项目。对于内部项目, 则根据项目能否提高在约束点(布伦特)上的工作能力，只开展能减少他的工作量，或者可以让其他人接手的项目。无限期暂停对那些非脆弱系统进行基础架构更新的项目。</li>\n<li>凤凰项目的一个任务又延期了, 因为布伦特的‘任务’是涉及多个人员的多个任务，开发部和IT运维部两个部门之间的工作交接，也涉及多个人员之间多次交接的多个步骤, 而每一次工作交接都有损耗的时间。因此, 为需要跨部门交接的‘任务’都设置一条看板追踪路径, 把这些经常性工作记录在案，将其标准化，并且熟练掌握, 提高流量，最终就能达到产品配置的一致性。同时, 新增兼有项目经理和稽查员的职能的角色, 他们要提供每一分钟的控制。让所有已完成的工作都快速有效地交接到下一个工作中心。必要时，这个人要在工作中心等待，保证关键工作完成并快速运往下一个工作中心, 减少悬而未定的项目数量，让工作流转的通路保持通畅。</li>\n</ul>\n<h3 id=\"从企业目标出发-专注要事\"><a href=\"#从企业目标出发-专注要事\" class=\"headerlink\" title=\"从企业目标出发, 专注要事\"></a>从企业目标出发, 专注要事</h3><ul>\n<li>公司最大的风险是停业破产, 目标是提高整个系统的生产能力, 而之前一直死守的‘安全性’项目会降低凤凰的项目吞吐量, 凤凰项目吞吐量是整个公司的约束点. 所以安全部的约翰, 先找到财务部的经理迪克, 了解他在公司的确切职能, 远期目标、近期目标和评估指标.</li>\n<li>迪克认为最重要的公司远期目标, 应该从整个系统出发, 对公司系统具备根本性的认识, 始终确保在一个正确的市场里, 作出正确的产品策略, 让企业达成目标, 那样财务目标才能发挥作用.</li>\n</ul>\n<blockquote>\n<p>我们有竞争力吗？<br>了解客户的需求和期望：我们知道要创建什么吗？<br>产品系列：我们有正确的产品吗？<br>研发效能：我们能有效地创建产品吗？<br>上架时间：我们能尽快把产品推向市场并占有一席之地吗？<br>销售机会渠道：我们的产品能带来感兴趣的潜在客户吗？<br>我们的效率高吗？<br>按时交货：我们遵守了对客户的承诺吗？<br>客户保留：我们是在获得客户，还是在流失客户？<br>销售预测准确率：我们可以把销售预测准确率纳入销售计划流程吗？</p>\n</blockquote>\n<ul>\n<li><p>比尔他们才意识到应该把迪克的重要评估指标作为IT任务的前提条件, 真正理解IT所参与的业务系统。于是决定, 去和业务流程负责人谈谈关于迪克说的公司的目标任务，弄清楚他们的确切职责是什么，哪些业务流程是支持其目标的. 找出对公司实现长期目标危害最大的几项内容, 弄清楚IT部门所负责帮助支撑及维护的公司业务.</p>\n</li>\n<li><p>帕蒂和比尔将对业务流程负责人进行访谈，主题是“理解客户的需求与期望”、“产品系列”、“上市时间”以及“销售渠道”.</p>\n<ul>\n<li>销售部总裁罗恩认为, 差劲的‘了解客户的需求和期望’影响了‘销售预测准确率’，需要知道门店里有哪些产品缺货，进而提升销售额.</li>\n<li>关于销售渠道流程及其困难的问题:<ul>\n<li>销售经理们很难从客户关系管理系统（CRM）中拿到需要的报告.</li>\n</ul>\n</li>\n<li>糟糕的一天是什么样:<ul>\n<li>负责管理的物料需求计划(MRP)系统和电话系统都崩溃, 服务中断, 客户取消订单, 无法完成业绩指标. 比尔接着解释, 电话系统故障是因为供应商未经授权就对电话交换机更换, 等预算批下来, 就能通过监控来强制实行控制策略, 杜绝问题.</li>\n</ul>\n</li>\n<li>业务发起人玛姬说, 她对‘了解客户的需求和期望’的衡量标准是，客户是否会向朋友推荐我们, 但是订单输入系统和库存管理系统的数据总是错的, 导致不能通过销售数据知道客户想要什么.</li>\n<li>假如能挥舞魔杖, 会怎么做:<ul>\n<li>她希望从门店和在线渠道, 有方便易用的功能, 得到准确及时的订单信息。运用那些数据来设计市场推广活动，不断推出“A或B”产品选择测试，以发现客户认可的报价, 并在全部客户中复制推广。就能为罗恩创建一个巨大的、可预测的销售漏斗。运用那些信息来推进生产计划，管理供求曲线。让正确的产品出现在正确的货架上，并一直备好库存。平均每客户销售额将会一路冲高，平均订单金额也会上升, 最终会提高市场份额，并再次打败竞争对手。</li>\n</ul>\n</li>\n<li>对于上市时间, 玛姬认为要控制在6个月内, 要不断降低周期时间, 不断整合来自市场的反馈, 增强回收成本的能力，最好从消费者那里直接回收成本.</li>\n</ul>\n</li>\n<li><p>建立起价值链, 包括IT方面的所需的价值链，把迪克的目标任务与IT对这些目标任务的影响关联起来，收集以前IT问题如何影响那些目标的具体案例, 对业务绩效指标产生影响的IT风险，就要着手制定更好的业务决策。弄清楚达成迪克期望结果所需要的业务能力和流程；那些业务流程所依赖的IT系统；IT系统或数据可能会发生的故障；防范那些故障发生的应对措施，或者至少能够侦测并作出回应的措施。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gdvfhql28lj30jj0bhwh0.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n<li><p>通过与业务负责人的访谈, 理解了哪些是重要的工作, 让业务部门相信, IT的应对措施有助于他们达成目标, 和他们一起开展把IT融入其绩效指标的工作采取措施:</p>\n<ul>\n<li>对于“客户的需求和期望”, 目标是数据的完整性, 凤凰修复了很多这方面的问题, 还需要控制由上游产生的问题; 预测评估指标包括遵守变更管理流程、监督审核生产变更、完成定期维护，以及排除所有已知单点故障; 创建一份完整的清单，把所有支持罗恩的应用程序和基础架构都列出来。只要其中有任何脆弱的应用程序或系统，就要把它们添加到替换清单里;</li>\n<li>对于“市场营销的需求和期望”，评估指标包括凤凰支持每周报告并且最终支持每日报告的能力，市场营销部生成的有效SKU比例等;</li>\n<li>把发布变小变短，减少半成品和功能, 更快地回笼资金，达到内部最低预期资本回收率;</li>\n</ul>\n</li>\n<li><p>约翰研究业务部门的安全控制环境, 了解到一个拥有技术背景财务人员, 她分析一个财务方面的重要会计科目中的主要业务流程的端到端信息流, 发现, 在一个人工对账步骤中检测到重大错误，在这个步骤中，来自一个源头的账户余额和账户值要和来自其他源头的逐一比对，一般是每周一次。如此一来, 检测重大错误所依靠的控制手段是人工对账步骤，并非上游的IT系统, 所以审计师撤回他们的IT发现.</p>\n</li>\n<li><p>针对调研, 知道了审计安全的关键落脚点是, 确保财务报告的可靠性，符合法律法规，以及运营的效率和效果, 并提出建议:</p>\n<ul>\n<li>大幅度缩减安全合规项目的范围;</li>\n<li>弄清楚生产薄弱点一开始是如何产生的，调整部署流程，杜绝此类情况再次发生;</li>\n<li>在变更管理流程中，标记出所有列入合规审计范围的系统, 避免可能危及审计工作的变更, 创建持续记录文档;</li>\n<li>通过清除所有存储或处理持卡人数据的东西，来缩减PCI合规项目规模;</li>\n<li>用节省下来的时间，偿还凤凰的所有关于战略风险、运营风险、严重的安全与合规风险的技术债务, 关乎关键评估指标;</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"形成反复实践和勇于尝试的团队文化\"><a href=\"#形成反复实践和勇于尝试的团队文化\" class=\"headerlink\" title=\"形成反复实践和勇于尝试的团队文化\"></a>形成反复实践和勇于尝试的团队文化</h3><ul>\n<li>对需要团队合作的事情，训练成习惯，不断重复可建立起信任感和透明度。定期回顾小结，对工作开展情况以及需要改进的方面进行自我评估, 同时邀请开发部的人参加服务中断根本原因分析会.</li>\n<li>类比跨国货运公司，要达成客户满意度和按时交货的目标。为降低更换机油会导致车辆故障, 而影响按时交货的风险，就要为车辆运营建立一个每行驶五千英里就要更换一次机油的协议, 还有已经按要求更换机油的车辆百分比, 因为如果只有50%的车辆遵守了必需的保养策略，卡车和包裹就可能会抛锚在路边，那么按时交货KPI就会大幅下跌。同样, 为了达到公司的按时交货的关键性绩效指标（KPI），也要建立一个新的前瞻性KPI，预防性供应商补丁程序以及变更管理政策就好比是预防性机油更换以及车辆保养策略。‘第三工作法’就是要让我们不断给系统施加压力，适当提高预防性工作, 从而不断强化习惯并加以改进, 形成不断改进的文化, 加强系统的健壮性. 所以, 安全部开发了一些工具, 在日常工作中, 对测试和生产环境持续不断的攻击和压力测试.</li>\n<li>虽然由于布伦特又一次没按流程, 部署了萨拉的一个供应商项目, 导致凤凰项目第二次部署遇到困难, 但最终还是完成了部署, 帕蒂发出部署是“成功”的通知, 并提醒需要提防的已知错误，提供一个可以获得凤凰最新状态的内部网页，以及如何报告新问题的指南, 全体人员随时待命，准备对业务提供支持. 这次部署失败证明, 批量规模还是太大了。要在IT部门创建一个单一向前的工作流, 让生产能力最大化，同时让变化幅度最小化。一旦看到工作向后移动，也许是由于不合格品、缺少规范，或者返工导致, 都得开展修复工作.</li>\n</ul>\n<h3 id=\"让最小可行产品-MVP-加速接受市场的考验\"><a href=\"#让最小可行产品-MVP-加速接受市场的考验\" class=\"headerlink\" title=\"让最小可行产品(MVP)加速接受市场的考验\"></a>让最小可行产品(MVP)加速接受市场的考验</h3><ul>\n<li>凤凰归根结底就是为了帮助客户快速、大批量地买走东西, 最近的两次发布也为此打下了基础, 但凤凰项目延误了太多真正提升销售的功能, 这个季度的盈利是不能指望凤凰了, 所以决定从凤凰主团队里分出一小队人，组建一支叫独角兽的特别行动队，聚焦于生成良好的客户推荐, 并让市场营销部门能够开展促销活动，把库存里现有的盈利产品卖掉, 尽快达到收入目标, 然后把探索出来的成功实践复制到凤凰中.</li>\n</ul>\n<h3 id=\"建立反馈回路-持续交付\"><a href=\"#建立反馈回路-持续交付\" class=\"headerlink\" title=\"建立反馈回路, 持续交付\"></a>建立反馈回路, 持续交付</h3><ul>\n<li><p>丰田公司有一个引擎盖冲压工序，最初转换时间约为三天, 仔细观察了换模所需的全部步骤后，提出了一系列预备和改进措施，把换模时间降至十分钟以内。相应的, 根据第二工作法，建立一条反馈环路，一直往回通向产品定义、设计及开发的最初环节, 延伸到产品生产流程的更早阶段, 在初始阶段就筹划产品的质量。开发部和运维部, QA和业务部门一起协同工作, 持续不断地降低批量规模, 对创建环境所需的每一样东西都进行版本控制, 从代码签入到投产的整个价值流, 创建‘部署管道’，在其中自动创建测试和生产环境，把基础架构当作代码一样对待, 构建一步到位的生产环境和部署流程, 缩短准备时间并排除故障, 更快的获取反馈, 才能跟上客户需求和开发部的各种工作节奏.</p>\n</li>\n<li><p>业务敏捷度重点是捕捉和适应市场变化并为此承担更大风险的能力, 要持续不断的尝试，越快把那些功能推向市场接受考验，也能更快地为公司收回成本。要达到一天十个部署的目标, 那部署可包括故障修复, 让市场营销部修改他们自己的内容或业务规则，或者启用更快速的试验和A/B对比测试.</p>\n</li>\n<li><p>为了找到可自动化的步骤, 分析从‘代码提交’开始，到部署成功的所有步骤, 和之前上线期间存在问题的步骤, 得出返工和准备时间过长问题的来源有两个：</p>\n</li>\n<li><ol>\n<li>环境: 在部署流程的每个阶段，部署环境总是没有就绪，即使已经准备就绪了，也需要大量返工才能让它们彼此同步</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>部署: 代码打包流程。尽管开发团队尽可能地记录代码和配置，但总是在IT运维部进行版本控制，然后生成部署包部署之后，代码无法在环境中运行, 才发现有遗漏东西。</li>\n</ol>\n</li>\n<li><p>采取措施:</p>\n<ul>\n<li>收集从错误中吸取的各种教训, 编一本关于部署运行的书</li>\n<li>设置一个通用构建过程，每个人都使用自己的工具来创建自己的环境，开发人员能在一个与生产环境相似的环境下编写代码</li>\n<li>运维直接拿到准备部署的打包好的代码, 一旦代码被标记为‘准备测试’，就生成并提交代码包，触发一个QA环境的自动部署, 及后续生产环境的自动部署。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"清除异党\"><a href=\"#清除异党\" class=\"headerlink\" title=\"清除异党\"></a>清除异党</h3><ul>\n<li><p>市场部莎拉急于讨好上层, 又因为以前IT经常不能完成并交付她所需要的东西, 找供应商开发第三方服务, 这些看起来是战略性, 但实际不遵守关于数据隐私的法律法规，订单输入和库存管理系统出现更多的数据完整性问题, 还得向供应商开放产品数据库，向他们解释这些数据库是如何构建的，开展众多防火墙变更，等大量额外的工作, 阻碍了聚焦凤凰项目, 这些都是对公司不利的。</p>\n</li>\n<li><p>在独角兽项目的关键时刻, 迪克和财务团队要调走布伦特, 让他加入制定拆分公司方案的特别工作组。但只要完成季度指标, 保住凤凰项目, 就不需要拆分公司了. 了解客户的需求和期望，拥有正确的产品系列，保留客户，以及最终提高营业收入和市场份额，才是最重要的, 所以比尔把布伦特截回来, 在史蒂夫的帮助和众人的努力下, 独角兽项目上线后促销活动的客户转化率很高, 通过了市场的考验.</p>\n</li>\n<li><p>理解技术能够做什么、不能做什么，是公司里每个部门必须具备的一种核心竞争力。最后, 不能融入公司新文化的莎拉离职了.</p>\n</li>\n</ul>\n<p>————————–—<em>以上为暂时梳理的故事脉络, 笔记还会多次迭代</em>————————————-</p>\n<h2 id=\"有趣段落摘抄\"><a href=\"#有趣段落摘抄\" class=\"headerlink\" title=\"有趣段落摘抄:\"></a>有趣段落摘抄:</h2><blockquote>\n<p>俗话说得好, 如果你的同事主动告诉你他们要离职, 那多半是自愿的.但如果是其他人告诉你的, 那他们一定是被迫的. 所以说, 我的上司和上司的上司刚刚被炒了.</p>\n</blockquote>\n<blockquote>\n<p>“比尔, 我知道你没有申请这个职位, 但公司已经命悬一线. 我需要你来帮助我拯救这家伟大的公司. 我能指望你吗?”<br>啊, 我的天哪! 还没来得及礼貌地谢绝, 我突然听到自己说:“ 可以, 你可以指望我.”</p>\n</blockquote>\n<blockquote>\n<p>迪克打断了她: “这是IT部的比尔.他说他是被派来收拾这个这个烂摊子的, 或者准备在收拾的过程中壮烈牺牲, 我是这么理解的.”</p>\n</blockquote>\n<blockquote>\n<p>“他摇摇头继续说：“要说服业务部门去做正确的事情越来越困难。他们就像走进糖果店的小孩子。他们在飞机杂志上读到，可以在云端管理整个供应链，每年只要499美元，然后这突然就成了公司的主要行动。当我们告诉他们，事实上没那么简单，并演示做好这个要花什么样的代价时，他们就不见了。他们去哪儿了？去和维尼表兄或者其他推销外包服务的家伙谈了，那些人许诺，能用十分之一的时间和价格做成这件事。”</p>\n</blockquote>\n<blockquote>\n<p>“我脑海里立刻浮现出这样的景象，约翰问了一些愚蠢的问题，或者说了一些愚蠢的话，彻底激怒了迪克，迪克当场解雇了他，为绝后患，就把我也解雇了。<br>然而，我发现自己说的是：“好的，我会去的。”</p>\n</blockquote>\n<blockquote>\n<p>“他剃了头，看上去像瘦了十五磅。他穿着一件我只能描述为“欧洲式样”的衬衫和一件马甲。和他平常穿的略为宽松的衬衫不同，他身上那件粉色衬衫非常修身。再加上那件马甲，他看起来像是个……时尚模特？伦敦夜店男？拉斯维加斯赌场发牌员？”</p>\n</blockquote>\n<h2 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念:\"></a>相关概念:</h2><h3 id=\"精益理论\"><a href=\"#精益理论\" class=\"headerlink\" title=\"精益理论\"></a>精益理论</h3><ul>\n<li>包括: 1)降低批量规模; 2)减少半成品; 3)缩短并增强反馈回路</li>\n</ul>\n<h3 id=\"DevOps\"><a href=\"#DevOps\" class=\"headerlink\" title=\"DevOps\"></a>DevOps</h3><ul>\n<li>what<ul>\n<li>也就是开发运维, 这个词最初是在2008年由帕特克里.德布瓦和安德鲁.谢弗提出, 脱胎于马克.伯吉斯博士发起的“基础设施即代码”的实践及有杰兹.亨伯尔和戴维.法利发起的持续集成和持续部署.</li>\n<li>应用了精益理论, 来提高流经生产管理、开发、测试、IT运维及信息安全等部门的工作流的速度.</li>\n</ul>\n</li>\n<li>why<ul>\n<li>能使产品功能更快地进入市场, 创造价值. 在玩偶实验室2012年的“开发运维报告说明”中, 用基准问题测试4039家IT企业, 发现运用开发运维的高绩效公司比同行: 代码部署频率快30倍; 代码部署交付期快8000倍; 变更成功率高2倍; MTTR(Mean Time To Repair, 平均修复时间)快12倍. </li>\n</ul>\n</li>\n<li>how<ul>\n<li>三步工作法</li>\n<li>持续交付就是三步工作法中到一种体现, 它强调小到批次规模(如每天检查主干), 在发生问题时停止生产(如一旦构建、测试或部署失败, 就不再允许开展新到工作; 将系统工作到完整性置于工作本身之上), 并必须频繁进行验证性测试, 以避免生产中到失误, 或至少能检测并修复故障.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"三步工作法\"><a href=\"#三步工作法\" class=\"headerlink\" title=\"三步工作法\"></a>三步工作法</h3><ul>\n<li>what<ul>\n<li>旨在阐明指导开发运维的流程与实践的价值观与理念.</li>\n</ul>\n</li>\n<li>第一工作法<ul>\n<li>what <ul>\n<li>关于从开发到IT运维再到客户的整个自左向右的工作流, 那是业务部门与客户之间的衔接.</li>\n</ul>\n</li>\n<li>why<ul>\n<li>为了使流量最大化, 让批量规模和工作间隔尽量小, 不让缺陷流向下游工作中心, 并不断为整体目标(与之相对的局部目标就是开发功能完成率、测试发现/修复比率或运维有效性指标等)进行优化.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>必要做法包括: 持续构建、集成以及部署, 按需创建环境, 严控半成品, 以及构建起能顺利变更的安全系统和组织.</li>\n<li>其中严控半成品就可以建立看板图, 列出: 待办、在办、已办 </li>\n<li>根据瓶颈资源所能完成的工作速度来安排工作, 确保绝大多数受约束的人力资源都只能投放在整个系统的目标所服务的工作上, 而不只是为了一个部门的目标服务</li>\n<li>确保形成一条迅速、可预测、持续不断的计划内工作流, 从而向业务部门交付工作价值, 同时尽可能降低计划外工作的影响和破坏, 提供稳定的、可预期的、安全的IT服务.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>第二工作法<ul>\n<li>what<ul>\n<li>关于价值流各阶段中, 自右向左的快速持续反馈流, 缩短及放大反馈回路</li>\n</ul>\n</li>\n<li>why<ul>\n<li>放大各阶段的效益以确保防止问题再次发生, 或更快地发现和修复问题, 从源头上保证质量, 避免返工.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>在部署管道中的构建和测试时, “停止生产线”;</li>\n<li>日复一日地持续改进日常工作;</li>\n<li>创建快速的自动化测试套装软件, 确保代码总是处于可部署状态;</li>\n<li>在开发和IT运维之间建立共同的目标和共同解决问题的机制;</li>\n<li>建立普遍的产品遥测技术;</li>\n<li>让每个人都能知道, 代码和环境是否在按照设定的运行, 以及是否达到了客户的目标.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>第三工作法<ul>\n<li>what<ul>\n<li>关于创造公司文化, 该文化可带动两种风气的形成: <ul>\n<li>不断尝试, 这需要承担风险并从成功和失败中吸取经验教训;</li>\n<li>理解重复和练习是熟练掌握的前提.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>why<ul>\n<li>尝试和承担风险让我们能够不懈地改进工作系统;</li>\n<li>不断重复的日常操练赋予我们的技能和经验, 一旦出了问题, 就可以撤回至安全区域并恢复正常运作.</li>\n</ul>\n</li>\n<li>how<ul>\n<li>营造一种勇于创新、敢于冒险(相对于畏惧或盲目服从命令), 及高度信任(相对于低信任度和命令控制)的文化, 把至少20%开发和IT运维周期划拨给非功能性需求, 并不断鼓励进行改进</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"IT从事的四种工作类型\"><a href=\"#IT从事的四种工作类型\" class=\"headerlink\" title=\"IT从事的四种工作类型\"></a>IT从事的四种工作类型</h3><ul>\n<li>业务项目</li>\n<li>IT内部项目<ul>\n<li>包括业务项目衍生出的基础架构或IT运维项目, 及内部生成的改进项目(如创建新环境和部署自动化)</li>\n</ul>\n</li>\n<li>变更<ul>\n<li>经常由业务项目和IT内部项目的工作引起, 往往在保修系统中被跟踪(如IT运维补救、JIRA或用于开发的敏捷计划工具)</li>\n</ul>\n</li>\n<li>计划外工作或救火工作<ul>\n<li>包括操作事故和操作问题, 通常由上述类型的工作导致, 往往以牺牲其他计划内工作为代价</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"约束理论5个方法步骤\"><a href=\"#约束理论5个方法步骤\" class=\"headerlink\" title=\"约束理论5个方法步骤\"></a>约束理论5个方法步骤</h3><ul>\n<li>识别约束点;</li>\n<li>利用约束点;<ul>\n<li>确保不让约束点浪费任何时间。永远不要让约束点迁就别的资源而干等着，而是应该专注于IT运维部对当前所需完成工作中优先级最高的那一项。</li>\n</ul>\n</li>\n<li>让所有其他活动都从属于约束;<ul>\n<li>根据约束点的工作效率来控制其他工作的速度。在约束理论中，一般是由名为‘限制驱导式排程法’（Drum-Buffer-Rope）的工具来实施的。《目标》中的主角亚历克斯，发现队伍里最慢的童子军赫比实际上决定了整支队伍的行军速度，后来亚历克斯把赫比调到队伍前头，防止孩子们超前太远.</li>\n</ul>\n</li>\n<li>把约束点提升到新到水平;</li>\n<li>寻找下一个约束点;</li>\n</ul>\n<h2 id=\"个人感悟\"><a href=\"#个人感悟\" class=\"headerlink\" title=\"个人感悟:\"></a>个人感悟:</h2><ul>\n<li>也许大家都想把工作做好, 也为此付诸行动, 但是有没有在做正确的事就是另外一回事了. 这就需要切入顶层的上下文中考虑, 因为公司的存在就是要产生商业价值, 大家的工作就是要为业务服务. 而工作的完成, 也是多方合作的结果, 任何一个职位都很重要, 而且协调沟通还会影响整体的效率. </li>\n<li>问题的存在不可怕, 当问题发生时, 要做的是找出应对的措施, 积极改进, 而不是推卸责任, 否则最终受累的也是自己.</li>\n<li>而理论再完美, 最终还是需要不断尝试, 找到适合自己的解决方案, 只有实践了才知道有哪些问题, 下一步要如何调整.</li>\n<li>将所有的工作分类, 不同的工作安排不同的优先级和处理方法.</li>\n<li>其实这本书除了能了解开发运维、管理相关价值观之外, 同时也能学到些为人处事的方法, 比如主角总会深呼吸或者倒数几秒, 让自己迅速冷静下来, 因为情绪会阻碍正确的决策, 使问题得不到解决.</li>\n<li>多看书太重要了, 因为当自己的视角不够高不够广, 而在一条错误的路渐行渐远时, 有人给予正确的提点自然是最好的, 但实际情况是, 那样的概率很小, 相当于两手一摊, 等着“神啊, 告诉我怎么做吧”, 所以就需要自己多主动吸收前人的优秀经验, 反思自己的行为, 不断调整, 或者以此理解自己领导作出的决策.</li>\n<li>说实话, 以自己现在的水平, 还不能很好的吸收书中的理念, 后续还得反复研读, 细细咀嚼书中的案例, 还有最重要的, 用到工作和生活中. </li>\n<li>最后, 作为一个学生时代就习惯性逃避写作文的人来说, 整理这篇笔记还挺不适应的, 不过, 不熟就多练嘛. If it hurts, do it more often.</li>\n</ul>"},{"title":"《猎豹行动》笔记","abbrlink":"5e8f1732","date":"2020-04-20T02:10:11.000Z","_content":"## 前言\n去年为了了解敏捷开发流程和DevOps, 也看了《猎豹行动》这本书. 同样按照, 故事脉络、相关概念、个人感悟这几个模块来整理笔记.\n\n## 故事脉络\n<!-- more -->\n一家金融服务公司, 为了更快地响应业务部门的请求, 更好地交付业务价值, 启动名为“猎豹行动”的行动计划, 落实敏捷转型. \n### 要解决的问题:\n* 开发模式依然以瀑布模型为主, 交付慢且昂贵, 业务部门对此不满\n* 业务部门架构复杂, 各自的利益与兴趣点不同, 难以形成统一的优先级和需求意见, 对IT部门有不同的请求\n* IT部门由于预算问题, 人员编制不足\n* 流程烦琐、基础设施落后、自动化程度不足\n* PMO部门承担所有项目的甲方, 为了维护部门利益, 在所有项目中做中间人角色, 不愿IT部门直接解除其他业务部门(最终用户), 但又不愿承担PO的角色\n\n### 猎豹行动启动方案:\n1. 组织全覆盖的敏捷扫盲班, 让所有IT同事对敏捷开发有基本的了解, 审视当前的交付模式并找出改进点.\n* 分析当前的瀑布模型开发:\n    * 痛点\n        * 业务部门\n            * 逾期交付、超支、缺乏透明度，不知道具体进度、很难变更需求、看到成品时项目已接近尾声、最终发现开发出来的产品不是他们想要的、殆误战机，丢失市场机会\n        * IT部门\n            * 过度承诺、难以一次性消化所有需求、惧怕需求变更、不断重做、后期压力巨大、加班\n    * 导致痛点的原因\n        * 只有预算和目标交付时间是确定的\n        * 不确定因素\n            * 范围和具体需求、可能的需求变更、人员（放假离职）、估算的准确性、对现有系统的影响、服务器环境的搭建\n    * 存在的问题\n        * 需求分析花的时间多，开发时间被压缩\n        * 变更成本高\n        * 业务要在用户验收测试阶段才能看到成品，临近目标交付日期, 才发现产品不合要求\n* 介绍敏捷开发模式:\n    * 迭代开发就是敏捷开发最重要的特点. 软件开发最重要的是搞清楚用户到底想要什么. 以两组蒙娜丽莎的完成过程图为例, 如果客户任务蒙娜丽莎的头最重要, 那上面那组的第二幅图就可以交付. \n![](https://tva1.sinaimg.cn/large/007S8ZIlgy1geys7hwr3bj30vy0nmwpg.jpg)\n2. 跟每个团队进行交谈, 了解团队痛点, 探讨具体改进方案.\n* 总结敏捷开发给业务部门和IT部门带来的好处, 并给出敏捷启动建议:\n    * 围绕已知的范围和需求定义用户故事和建立Product Backlog\n    * 为用户故事排优先级\n    * 商定Sprint的长度\n    * 商定Sprint计划会议和评审会议的日程\n    * 商定发布计划\n    * 准备相应的辅助工具\n3. 组织针对业务部门的敏捷基础培训, 配合落实敏捷转型.\n* 通过“棉花糖挑战”和“传硬币”两个游戏, 分别领悟简单设计、提早测试、快速反馈、减少批量, 提高交付速度的重要性. 把项目需求条目化, 定期排序, 确保有限的资源和时间用在最有价值的事情上.\n4. 从工具开始落地敏捷, 提升效率. \n* 利用开源软件的优势, 站在巨人的肩膀上开发. 采用了以下工具, 如项目管理工具JIRA、知识管理工具Confluence、代码托管平台GitHub、代码缓存及管理仓库工具Nexus、持续继承工具Jenkins、代码静态审查工具SonarQube、自动化部署工具Ansible\n* 针对人手不够, 而阻碍工具落地的情况, 采取以下措施:\n    * 通过工作坊和团队一起找出痛点, 列出所有改进点并进行优先级排序\n    * 每个团队每天划出一个固定时段, 半小时到1小时, 这段时间内, 所有团队成员放下手头的交付工作, 自行或组队摘取改进点进行实施, 并建立激励机制鼓励大家积极参与.\n\n### 以团队共创形式开展工作坊:\n* what\n    * 和团队一起找出痛点, 列出所有改进点并进行优先级排序\n* how\n    * 主题介绍. \n        * 主要是确立目标.\n    * 头脑风暴. \n        * 每个人先列出实现目标的障碍和对应想法, 然后分成几个小组, 每个组把组员的想法, 都进一步提炼成几个想法.\n    * 排列组合. \n        * 对每个组提炼出来的想法, 再进一步归类.\n    * 提炼中心词. \n        * 对每类想法, 提炼中心词.\n    * 模型图. \n        * 思考中心词之间的逻辑关系, 通过关系摆放形成图形, 解读图形, 制定行动方案.\n\n* 通过工作坊, 发现以下问题: \n    * 1)业务请求跟踪性差\n    * 2)缺乏回归测试\n    * 3)手工部署\n        \n* 针对以上问题, 采取相应措施:\n    * 1)-1 JIRA记录所有的请求和需求, 建立可视板使进度可视化.\n    * 1)-2 每日站会围绕JIRA可视板进行,确认每天的优先级、进度、阻碍.\n    * 1)-3 通过Confluence建立项目文档和知识库. 使所有知识和信息透明化, 提升沟通和学习效率\n    * 2) 找出合适的自动化测试方案, 通过Jenkins每天自动执行全部自动化测试并发布测试结果, 结合SonarQube观测测试代码覆盖率是否处于上升趋势\n    * 3) 通过Ansible编写部署脚本, 实现部署自动化.\n\n* 实施过程的阻碍:\n    * 遗留代码耦合度高, 可测试性低, 导致自动化回归测试落地缓慢.\n    * 上线流程烦琐, 倾向延迟修复版本的上线而造成更大的业务影响.\n        * 不管付出多少努力, 零缺陷和零风险都是不可实现的, 很多问题只有在生产环境才会出现. 做到真正的持续交付、频繁上线, 每次上线所涉及的变更范围缩到最小, 当问题出现的时候, 能更快地修复问题并把业务影响降到最低.\n\n### 项目试点实践经验:\n* 采用新交付方式, 规范并简化流程:\n    * 拥抱变化\n        * 适应任何需求变化以满足业务部门的最终需求. 拆分原始需求并快速交付其中最重要的部分获取反馈并及时修改\n    * 拆分\n        * 把大的需求拆分成最小可交付需求来缩短交付时间和实现持续交付\n    * 简化流程\n        * 最终用户与IT工程师直接沟通, 减少交接与签署, 不再依赖繁文缛节的文档. 业务部门可通过JIRA Service Desk直接提交需求, 规范交付文档, 使业务部门和IT部门对验收条件达成共识.\n        * PS: 以前老大也经常这么说，产品提的需求只是个解决方案，还需要跟业务沟通，把握真正的需求\n    * 透明可视化\n        * 需求与细节都记录在JIRA上. 通过看板可视化进度与阻碍. 定期汇报\n    * 改进服务\n        * 上线后业务人员可为每个交付评分和反馈意见\n![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbfgdmvfdj30v8082gqm.jpg) \n\n* 基于产品的持续改进:\n    * 建立CI/CD流水线, 加快暴露集成问题\n    * 实现基于主干开发, 避免上线代码非测试过的版本等问题\n    * 特性开关控制新功能\n* 采用敏捷估算预测交付时间, 迭代进行过程中, 通过燃尽图持续观察团队的交付速率, 并及时调整预测.\n* 从满足对方要求的定制化接口到通过API开放数据:\n    * 采用演进式的设计方法和微服务架构.\n    * 先搞清楚对家需要哪些数据(可根据对家系统所要求的接口文件规格文档), 然后为此设计Process API, 满足对家直接访问的需求. 在底层, 对数据按照领域进行归类, 设计相应的Domain API, 从Domain API获取元数据整合出Process API所需要的数据.\n    * 实施部分, 每个API都是一个独立的微服务应用, 基于Spring Boot开发. 借助Spring Cloud来搭建整个微服务框架.\n    * 通过Spring Cloud Contract框架实现契约测试.\n* 从“预算驱动交付”到“价值驱动交付”\n    * 引入服务等级, 统一确定请求优先级来安排产能:\n        * 延迟成本，cost of delay，计算每个请求如果逾期的话造成的损失，将其折算成金钱，来量化所有请求的优先级\n        * 服务等级，class of service，对于不同的请求类型，赋予不同的服务等级，区别处理\n            * 加急类(Expedite), 常见于一些时效性特别强的需求, 或者对产品重大缺陷的修复. 这一类请求将被视为最高优先级, 可以无视最大在制品(WIP)的限制而直接进行作业. 然而这样的请求, 很容易对看板的正常工作造成冲击, 因此加急类的任务个数, 通常仅设置为1.\n            * 固定交付日期类(Fixed Delivery Date), 推荐安排一定的产能来处理一些固定交付日期的请求. 对于这一类请求, 需要交付团队在开发之前对请求的工作量进行估算, 并在开发过程中定期地确认进度. 一旦发现进度落后到有可能无法完成的地步, 则需要交付团队对请求重新进行评估. 如有必要, 这类请求可以升级为加急类.\n            * 标准类(Standard), 最普通的请求. 推荐大部分的产能都归类到此类请求. 交付团队无需对请求的工作量进行估算, 直接按照先进先出的顺序进行处理即可. 但对于超过两周工作量的请求, 建议先进行拆分.\n            * 无形类(Intangible), 主要针对一些用户价值有限的附加功能, 推荐安排此类任务上的产能应该低于标准类的产能.\n\n* 采用关键链方法, 把约束理论运用到项目管理中, 解决依赖冲突, 突破项目管理的瓶颈\n    * 新项目由于资源冲突, 计划时间超出规定的交付时间. 同时考虑到原来的计划是有安全时间的, 于是调整计划, 把所有任务的时间减半, 而这些被扣除的安全时间放在最后一个任务后作为项目缓冲时间\n    \n* 对于IT部门, 致力于培养能做到端到端交付的T型人才\n    * 模糊原来诸如BA、开发工程师、测试工程师、运维工程师等的明确的职能分工, 尽可能做到负责一个用户故事或需求的端到端交付, 包括分析、开发、测试、运维等\n\n## 相关概念\n### 敏捷方法论\n#### Scrum\n* 方法选择: 有专属团队的纯开发项目，需要稳定的交付节奏的项目，适用Scrum。需要跨项目、跨团队合作的，一人分饰多角的，维护类型的项目，适用看板\n* 相关概念\n    * Product Owner（PO），用户/客户/业务代言人，即可以做出业务决策（需求和优先级）的人\n    * Scrum Master，熟悉Scrum流程的人，指导和确保团队以Scrum的方式进行交付\n    * Sprint，对迭代的说法。一个项目或产品的交付就是由一个又一个的Sprint构成的\n    * User Story，用户故事。具有业务价值的交付单位，一个项目或产品由很多用户故事构成\n    * Product Backlog，可理解为项目的代办列表，由用户故事构成\n    * Sprint Backlog，一个Sprint的代办列表，确定Sprint里有哪些用户故事，框定Sprint的开发范围\n* 过程\n    * 每个项目或产品的交付由若干个Sprint构成。Sprint的周期是固定的，以保持节奏。通常是2-4个星期，不建议超过4个星期\n    * 1. 每个Sprint开始时，PO和IT团队一起开Sprint计划会议，PO对Product Backlog中的用户故事进行排序，选出最重要的用户故事\n    * 2. IT团队对这些用户故事进行估算。Sprint的周期和团队成员数量的确定，也确定了团队的大概交付能力\n    * 3. 确定哪些用户故事会放到这个Sprint的Backlog里，作为Sprint的开发范围\n    * 4. 围绕用户故事开发，每天一次站会，汇报昨天做了什么，今天会做什么，昨天遇到什么问题, 而且控制会议时长和参会人数以提高效率\n    * 5. Sprint结束的时候，开评审会议，展示交付，PO的反馈，包括需求变更都可定义成新的用户故事放到Product Backlog里重新排队\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlgy1geyscva072j30r20gqwix.jpg)\n* 敏捷的所有改变都是为了快速反馈\n    * 短迭代开发，让PO更快、更早地看到成品，给予反馈\n    * 每日站会，每天都能看到进度和阻碍\n    * 回顾会议，每个迭代都反思改进点，形成持续改善的机制\n\n#### 极限编程\n* 12个实践\n    * 确保开发可更早开始和迭代式的持续交付\n        * 计划游戏，planning game，\n            * 把整个项目拆分成从几天到几个星期的若干个迭代，把需求拆分成一个独立的用户故事，放在Backlog里——》每个迭代开始时，用户对用户故事进行排序——》通过估算确定哪些用户故事可在整个迭代里开发。且只对当前迭代进行计划，新需求产生的用户故事要放到后面的迭代中\n        * 小型发布，small release，\n            * 每个迭代后，所开发的用户故事都可发布或展示给用户，获取反馈，新的用户故事放到后面的迭代中\n    * 确保客户和交付团队都明白在做什么\n        * 现场客户，onsite customer，\n            * 用户应该和交付团队始终在一起，持续参与到项目中，阐明用户故事的具体需求和用户故事优先级，给交付团队及时的反馈\n        * 系统隐喻，system metaphor，\n            * 记录用户故事需求时，用交付团队和客户都能理解的语言编写\n    * 编码规范，code standards，\n        * 有一套整个团队都认可的规范\n    * 结对编程，pair Programming，\n        * 两个人结对在同一台计算机前来完成编程，一次性完成编程与评审, 共同讨论设计、测试、编程. 解决传统事后代码review, 需要重写单元测试及review参与度和质量的问题\n    * 测试驱动开发，test driven development，\n        * 在编程前就根据用户故事的需求写好测试（自动化测试），通过测试来验证编程代码是否满足需求\n    * 持续集成，continuous integration，\n        * 每天或每次有代码提交时就集成一次（编译、运行所有自动化测试、打包）, 尽早暴露问题并及时修复\n    * 重构，refactoring，\n        * 不改变功能和外部行为而优化代码的可读性、质量、性能，有了自动化测试和持续集成，可保证重构后出现测试失败，立即回滚代码\n    * 简单设计，simple design，\n        * 只为当前要做的需求进行最简单的设计, 因为越简单的东西, 越不容易出错, 越复杂的东西, 越容易出错. 而如果设计不能满足需要时, 在自动化测试和持续集成的保障下, 通过重构来解决.\n    * 代码集体所有权，collective code ownership，\n        * 在自动化测试和持续集成的保障下，任何人都可以对代码重构\n    * 每周只工作40个小时，40-hour week, \n        * 保障每天足够的时间恢复精力, 避免提前透支精力\n    \n* 5个核心价值\n    * 沟通，communication、简单，simplicity、反馈，feedback、勇气，courage、谦逊modesty\n\n#### 看板（另外一种敏捷、精益的方法）\n* 原则\n    * 进度可视化\n        * 识别整个交付从左到右的各道工序哪里是瓶颈\n        * 根据约束理论，一切瓶颈以外的改善都是徒劳的. 约束理论Theory of Constraint，TOC，帮助企业识别出在实现目标的过程中存在着哪些制约因素，并进一步指出如何实施必要的改进措施\n    * 限制在制品（WIP，Work-in-progress）\n        * 一个请求，只有所有工序都完成并交付到客户那里，其价值才能得到体现\n        * 大量在制品堆积会导致优先级迷失和任务切换，任务切换又会导致效率低下，降低交付速度\n        * 只有下游有闲置产能才从上游拉入新的请求，避免在制品堆积\n        * Scrum限制在制品的方式是, 通过Sprint计划会议限制每个Sprint放入的用户故事\n        * 看板则是在每道交付工序中限制并行任务数量, 随时都可以把新的请求放入Backlog中并排序, 只要有闲置产能时就把优先级高的请求拉入进程![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggan5rl1udj30vm0letf2.jpg)\n    * 观察和改善流动\n* 与Scrum相通的地方\n    * 都基于敏捷与精益的原则，追求价值，消除浪费\n    * 都是基于拉动的计划系统\n    * 都限制在制品\n    * 都通过透明化来获取快速反馈\n    * 都聚焦于更早和更频繁地交付软件\n    * 都需要把大需求拆分成小故事\n* how\n    * 可利用JIRA，按需定义看板的范围、外观、限制在制品数量、泳道、卡片的外观等。每天对着JIRA看板来开每日例会，业务也可通过看板的情况来判断团队分配是否合理，及整个交付过程的瓶颈在哪\n    * 观察看板时，要关注的是有没有空闲的任务，而不是有没有空闲的人员\n    * 从右往左看, 先聚焦在制品, 尽快把在制品完成\n    * 看累积流图，一个面积图，强调用户故事或是需求数随时间而变化的程度，直观显示整体趋势走向。x时间，y需求数量, 不同颜色的面积区分如待处理、处理中、已完成状态的需求。![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbgu9da63j30v20guwqi.jpg)\n\n### 用户故事地图\n* why\n    * 真正的敏捷开发必须是基于用户故事的开发过程\n        * 如按报表来拆成若干个用户故事，选最常用的报表（对业务有价值的最小单位）先开发给业务测试，更快的获得反馈, 使大部分问题能更早地暴露, 为其他用户故事打下基础，通过早交付、早测试、早验收把产品的方向确定。\n        * 如果只是按功能点拆分，单个功能点的完成没有什么业务价值，无法测试\n* how\n    * 从左到右按时间顺序罗列用户行为（流程的每一步）——》在每个用户行为从上至下地罗列相应的细节（包括所需的开发点）。基于这张地图，还可对每个开发点的业务价值进行审视，找出最小可用产品（MVP，Minimal Viable Product）并制订发布计划. 制定发布计划时，遵循刚刚好good enough、更好better、最好best的演进原则\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge0103m24lj30wi0m27eb.jpg)\n    * 记录家里所有物品的APP，每购入新物品就记录\n        * 用户故事地图\n        ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge011rwdwlj30nc092q6m.jpg)\n        * 回顾地图，梳理每个用户故事的优先级，设想如果我们要在一周内做出MVP，会做哪些用户故事\n        ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge0125wyyuj30n809eacx.jpg)\n        * 定义MVP的必要性:\n            * 开发一个功能所需要的时间与成本总是超出预期的\n            * 需求是需要验证的假设，通过MVP可以快速试验，通过最小成本验证需求假设是否成立\n            * MVP是从整个业务角度来找出一个既能实现相同业务目标、IT成本最小的方法来快速启动新业务\n                * 如，要开一家提供网上订餐外送服务的餐厅，半个月内做出一个静态网站，展示菜式和订餐热线，生意就可在半个月之内运作起来。审视的是整个商业模式，不光是IT功能，更重要的是这样的外送服务模式是否可行和菜品是否受欢迎\n        * 用户故事拆分, 使故事最小化\n* 3C原则\n    * Card（地图）\n    * Conversation，确定发布计划后，要和PO围绕当前发布计划中的每一张Card聊具体需求\n    * Confirmation，确定验收条件\n* 敏捷落地比较图\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge013ieznhj30ua0iy0yo.jpg)\n\n### DevOps\n* 敏捷打通了业务、开发、测试之间的墙, 通过更紧密的沟通与交互实现更频繁的交付. 而开发与运维之间还有一堵墙, 运维也需要稳定的部署、监控支持持续交付. DevOps就实现开发与运维一体化和端到端的持续交付，融合了敏捷与精益的精神, 涉及自动化、精益思想、量度和分享.\n* 精益是从丰田生产系统移植到软件开发的方法, 看板方法就是其中一种精益方法.\n\n### 交付文档模版:\n* 需求描述\n    * 作为（谁），我想要（做什么），为了（为什么）。\n    * 行为驱动开发: 业务人员确定对系统的期望行为，采用业务部门和IT部门双方都能看懂的统一语言Gherkin的given when then的语言格式, 编写验收实例, 再通过自动化测试框架cucumber执行实例，实现验收测试自动化，并纳入持续集成\n        * cucumber，一个用普通语言描述测试用例的、支持行为驱动开发BDD的自动化工具，由Ruby编写，支持Java、.NET等多种开发语言。\n* 确认理解\n    * 复述对需求的理解\n* 问为什么\n    * 在什么场景下需要这个需求，包括谁用、什么时候用和使用条件、要解决什么问题、使用频次、怎么发生等（挖掘真实用意，因为有些需求是解决方案）\n* 验收条件\n    * “完成定义”, Definition of Done\n    * 实例化需求, 验收测试用例的具体例子. 避免误读, 让抽象的需求变得具体和可测试.\n    * 以终为始，一开始明确要做成什么样，指导行动并确保结果正确。包括happy path和exceptional scenario\n* 详细设计与实现\n* 集成测试结果\n* 用户验收测试\n* 上线备忘\n    * 上线所需要的额外步骤\n\n### 敏捷估算\n* 敏捷采用的估算单位是故事点, 一个和复杂度或规模有关的相对数, 而用户故事的复杂度或规模, 是一个相对时间更稳定的常量, 因为时间是不可控因素, 同样的需求不同人做的耗时差异性很大.\n* 扑克牌游戏方法\n    * 团队每个成员都有一副扑克牌, 每副扑克牌包含一个不同的数字, 如斐波那契数列, 然后对应故事点分别为1, 2, 4, 6, 10等. 当大家都消化完一个用户时, 同时通过出牌的方式来展示每个人的估算结果. 给出最高和最低估算的两人要解释和辩论. 最后团队得出一个大家都认同的估算值.\n    * 该方法的原理就是利用人群中涌出的群体智慧远远超过个人智慧. \n* 估算时间\n    * 首先测试交付速度. 观察团队在头一两个迭代中可以实际交付多少个故事点来预测团队的交付速率, 从而计算完成所有故事点需要多少个迭代. 而在Scrum, 迭代的周期是固定的, 知道有多少个迭代就能知道需要多长时间\n    * 在迭代进行过程中, 通过燃尽图来持续观察团队的交付速率是在提升还是下降, 随时作出调整\n\n### 关键链\n* 关键路径是项目活动及其逻辑关系图中最长的路径, 通常决定项目工期\n* 而关键链是决定项目长度的全部关键因素的关键路径和其他一些需要关键资源的任务\n* 把关键链上所有任务被扣除的安全时间放在最后要给任务后作为项目缓冲，保护项目不受关键链任务延迟的影响。所有非关键路径上的任务被扣减的安全时间也集中在一起作为接入关键链的接驳缓冲，保护关键链不受这些任务延迟的影响\n* 如果按非关键链的做法, 为所有的任务都加入安全时间, 会被学生症侯群、多任务和延迟的累计浪费掉所有的安全时间, 从而导致项目延迟\n    * 学生症候群指通常人们会先极力争取安全时间, 得到安全时间后, 就不着急, 真正开始往往在最后一刻, 造成安全时间被浪费. 所以在任务阶段剥夺安全时间可以迫使相应的资源在任务开始的时候就全力以赴地执行任务\n    * 估算通常被视作承诺, 考虑到今后的估算被压榨, 人们通常不会呈报提前完工, 这部分的延迟会转嫁到下一个任务, 而最终导致项目延迟. 而关键链方法, 任何任务提前完成都增加到缓冲区\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge01fmm6trj31cy0kqk7v.jpg)\n* 关键链区别于关键路径主要是,\n    * 关键链考虑了资源冲突. 把安全时间从每个任务中转移出来的前提是, 每个任务所需要的资源都能聚焦在当前任务上\n* 约束理论五步法\n    * 定义系统限制（瓶颈）\n    * 决定如何充分利用限制\n    * 让非限制资源充分配合\n    * 打破系统限制\n    * 若限制已打破，回到步骤一\n\n### 其他相关思维:\n* 真正的持续交付需要从左端的业务需求到右端的上线全流程配合\n* 计划不是为了执行, 而是提前做好各种情况的预案, 集结资源, 以应对将来可能的各种变化\n* 敏捷开发提倡信任、自治及通过技术手段如自动化测试来取代繁文缛节的文档.变革需要整个公司文化和价值观上的改变与配合以及人力、工具的投入, 只有管理层的支持才能使变革遍地开花.\n\n## 个人感悟\n* 上一篇《凤凰项目-三步工作法笔记》中, 提到多读书真的很重要, 因为虽然知识不能改变命运, 但是能改变思维. \n\n* 后来我想了下, 应该是”意识到必须做出改变“更重要. 那样看了书之后, 不是只有“哦, 我知道了”, 而是会想办法把书里面的内容吸收用起来. \n\n* 比如说, 把迭代思维融入到日常生活中, 其实是一种解决拖延症的好办法, 把要完成的事情拆分到足够小, 小到不用犹豫就能做的, 同时把这些任务可视化, 持续监控并调整自己的行为, 直到完成. \n\n* 而“限制在制品”的应用, 就是把任务拆分到足够小之后, 排好优先级, 一件一件的完成, 减少不必要的任务切换, 专注于尽快消除未完成的任务. \n* ps: 尝试了一段时间后, 还是有些问题, 最重要的原因, 应该是缺少反馈, 多去接受外界的反馈才是真正的走出舒适圈...","source":"_posts/猎豹行动笔记.md","raw":"---\ntitle: 《猎豹行动》笔记\ntags:\n  - 读书笔记\n  - 敏捷\n  - DevOps\ncategories: 读书笔记\nabbrlink: 5e8f1732\ndate: 2020-04-20 10:10:11\n---\n## 前言\n去年为了了解敏捷开发流程和DevOps, 也看了《猎豹行动》这本书. 同样按照, 故事脉络、相关概念、个人感悟这几个模块来整理笔记.\n\n## 故事脉络\n<!-- more -->\n一家金融服务公司, 为了更快地响应业务部门的请求, 更好地交付业务价值, 启动名为“猎豹行动”的行动计划, 落实敏捷转型. \n### 要解决的问题:\n* 开发模式依然以瀑布模型为主, 交付慢且昂贵, 业务部门对此不满\n* 业务部门架构复杂, 各自的利益与兴趣点不同, 难以形成统一的优先级和需求意见, 对IT部门有不同的请求\n* IT部门由于预算问题, 人员编制不足\n* 流程烦琐、基础设施落后、自动化程度不足\n* PMO部门承担所有项目的甲方, 为了维护部门利益, 在所有项目中做中间人角色, 不愿IT部门直接解除其他业务部门(最终用户), 但又不愿承担PO的角色\n\n### 猎豹行动启动方案:\n1. 组织全覆盖的敏捷扫盲班, 让所有IT同事对敏捷开发有基本的了解, 审视当前的交付模式并找出改进点.\n* 分析当前的瀑布模型开发:\n    * 痛点\n        * 业务部门\n            * 逾期交付、超支、缺乏透明度，不知道具体进度、很难变更需求、看到成品时项目已接近尾声、最终发现开发出来的产品不是他们想要的、殆误战机，丢失市场机会\n        * IT部门\n            * 过度承诺、难以一次性消化所有需求、惧怕需求变更、不断重做、后期压力巨大、加班\n    * 导致痛点的原因\n        * 只有预算和目标交付时间是确定的\n        * 不确定因素\n            * 范围和具体需求、可能的需求变更、人员（放假离职）、估算的准确性、对现有系统的影响、服务器环境的搭建\n    * 存在的问题\n        * 需求分析花的时间多，开发时间被压缩\n        * 变更成本高\n        * 业务要在用户验收测试阶段才能看到成品，临近目标交付日期, 才发现产品不合要求\n* 介绍敏捷开发模式:\n    * 迭代开发就是敏捷开发最重要的特点. 软件开发最重要的是搞清楚用户到底想要什么. 以两组蒙娜丽莎的完成过程图为例, 如果客户任务蒙娜丽莎的头最重要, 那上面那组的第二幅图就可以交付. \n![](https://tva1.sinaimg.cn/large/007S8ZIlgy1geys7hwr3bj30vy0nmwpg.jpg)\n2. 跟每个团队进行交谈, 了解团队痛点, 探讨具体改进方案.\n* 总结敏捷开发给业务部门和IT部门带来的好处, 并给出敏捷启动建议:\n    * 围绕已知的范围和需求定义用户故事和建立Product Backlog\n    * 为用户故事排优先级\n    * 商定Sprint的长度\n    * 商定Sprint计划会议和评审会议的日程\n    * 商定发布计划\n    * 准备相应的辅助工具\n3. 组织针对业务部门的敏捷基础培训, 配合落实敏捷转型.\n* 通过“棉花糖挑战”和“传硬币”两个游戏, 分别领悟简单设计、提早测试、快速反馈、减少批量, 提高交付速度的重要性. 把项目需求条目化, 定期排序, 确保有限的资源和时间用在最有价值的事情上.\n4. 从工具开始落地敏捷, 提升效率. \n* 利用开源软件的优势, 站在巨人的肩膀上开发. 采用了以下工具, 如项目管理工具JIRA、知识管理工具Confluence、代码托管平台GitHub、代码缓存及管理仓库工具Nexus、持续继承工具Jenkins、代码静态审查工具SonarQube、自动化部署工具Ansible\n* 针对人手不够, 而阻碍工具落地的情况, 采取以下措施:\n    * 通过工作坊和团队一起找出痛点, 列出所有改进点并进行优先级排序\n    * 每个团队每天划出一个固定时段, 半小时到1小时, 这段时间内, 所有团队成员放下手头的交付工作, 自行或组队摘取改进点进行实施, 并建立激励机制鼓励大家积极参与.\n\n### 以团队共创形式开展工作坊:\n* what\n    * 和团队一起找出痛点, 列出所有改进点并进行优先级排序\n* how\n    * 主题介绍. \n        * 主要是确立目标.\n    * 头脑风暴. \n        * 每个人先列出实现目标的障碍和对应想法, 然后分成几个小组, 每个组把组员的想法, 都进一步提炼成几个想法.\n    * 排列组合. \n        * 对每个组提炼出来的想法, 再进一步归类.\n    * 提炼中心词. \n        * 对每类想法, 提炼中心词.\n    * 模型图. \n        * 思考中心词之间的逻辑关系, 通过关系摆放形成图形, 解读图形, 制定行动方案.\n\n* 通过工作坊, 发现以下问题: \n    * 1)业务请求跟踪性差\n    * 2)缺乏回归测试\n    * 3)手工部署\n        \n* 针对以上问题, 采取相应措施:\n    * 1)-1 JIRA记录所有的请求和需求, 建立可视板使进度可视化.\n    * 1)-2 每日站会围绕JIRA可视板进行,确认每天的优先级、进度、阻碍.\n    * 1)-3 通过Confluence建立项目文档和知识库. 使所有知识和信息透明化, 提升沟通和学习效率\n    * 2) 找出合适的自动化测试方案, 通过Jenkins每天自动执行全部自动化测试并发布测试结果, 结合SonarQube观测测试代码覆盖率是否处于上升趋势\n    * 3) 通过Ansible编写部署脚本, 实现部署自动化.\n\n* 实施过程的阻碍:\n    * 遗留代码耦合度高, 可测试性低, 导致自动化回归测试落地缓慢.\n    * 上线流程烦琐, 倾向延迟修复版本的上线而造成更大的业务影响.\n        * 不管付出多少努力, 零缺陷和零风险都是不可实现的, 很多问题只有在生产环境才会出现. 做到真正的持续交付、频繁上线, 每次上线所涉及的变更范围缩到最小, 当问题出现的时候, 能更快地修复问题并把业务影响降到最低.\n\n### 项目试点实践经验:\n* 采用新交付方式, 规范并简化流程:\n    * 拥抱变化\n        * 适应任何需求变化以满足业务部门的最终需求. 拆分原始需求并快速交付其中最重要的部分获取反馈并及时修改\n    * 拆分\n        * 把大的需求拆分成最小可交付需求来缩短交付时间和实现持续交付\n    * 简化流程\n        * 最终用户与IT工程师直接沟通, 减少交接与签署, 不再依赖繁文缛节的文档. 业务部门可通过JIRA Service Desk直接提交需求, 规范交付文档, 使业务部门和IT部门对验收条件达成共识.\n        * PS: 以前老大也经常这么说，产品提的需求只是个解决方案，还需要跟业务沟通，把握真正的需求\n    * 透明可视化\n        * 需求与细节都记录在JIRA上. 通过看板可视化进度与阻碍. 定期汇报\n    * 改进服务\n        * 上线后业务人员可为每个交付评分和反馈意见\n![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbfgdmvfdj30v8082gqm.jpg) \n\n* 基于产品的持续改进:\n    * 建立CI/CD流水线, 加快暴露集成问题\n    * 实现基于主干开发, 避免上线代码非测试过的版本等问题\n    * 特性开关控制新功能\n* 采用敏捷估算预测交付时间, 迭代进行过程中, 通过燃尽图持续观察团队的交付速率, 并及时调整预测.\n* 从满足对方要求的定制化接口到通过API开放数据:\n    * 采用演进式的设计方法和微服务架构.\n    * 先搞清楚对家需要哪些数据(可根据对家系统所要求的接口文件规格文档), 然后为此设计Process API, 满足对家直接访问的需求. 在底层, 对数据按照领域进行归类, 设计相应的Domain API, 从Domain API获取元数据整合出Process API所需要的数据.\n    * 实施部分, 每个API都是一个独立的微服务应用, 基于Spring Boot开发. 借助Spring Cloud来搭建整个微服务框架.\n    * 通过Spring Cloud Contract框架实现契约测试.\n* 从“预算驱动交付”到“价值驱动交付”\n    * 引入服务等级, 统一确定请求优先级来安排产能:\n        * 延迟成本，cost of delay，计算每个请求如果逾期的话造成的损失，将其折算成金钱，来量化所有请求的优先级\n        * 服务等级，class of service，对于不同的请求类型，赋予不同的服务等级，区别处理\n            * 加急类(Expedite), 常见于一些时效性特别强的需求, 或者对产品重大缺陷的修复. 这一类请求将被视为最高优先级, 可以无视最大在制品(WIP)的限制而直接进行作业. 然而这样的请求, 很容易对看板的正常工作造成冲击, 因此加急类的任务个数, 通常仅设置为1.\n            * 固定交付日期类(Fixed Delivery Date), 推荐安排一定的产能来处理一些固定交付日期的请求. 对于这一类请求, 需要交付团队在开发之前对请求的工作量进行估算, 并在开发过程中定期地确认进度. 一旦发现进度落后到有可能无法完成的地步, 则需要交付团队对请求重新进行评估. 如有必要, 这类请求可以升级为加急类.\n            * 标准类(Standard), 最普通的请求. 推荐大部分的产能都归类到此类请求. 交付团队无需对请求的工作量进行估算, 直接按照先进先出的顺序进行处理即可. 但对于超过两周工作量的请求, 建议先进行拆分.\n            * 无形类(Intangible), 主要针对一些用户价值有限的附加功能, 推荐安排此类任务上的产能应该低于标准类的产能.\n\n* 采用关键链方法, 把约束理论运用到项目管理中, 解决依赖冲突, 突破项目管理的瓶颈\n    * 新项目由于资源冲突, 计划时间超出规定的交付时间. 同时考虑到原来的计划是有安全时间的, 于是调整计划, 把所有任务的时间减半, 而这些被扣除的安全时间放在最后一个任务后作为项目缓冲时间\n    \n* 对于IT部门, 致力于培养能做到端到端交付的T型人才\n    * 模糊原来诸如BA、开发工程师、测试工程师、运维工程师等的明确的职能分工, 尽可能做到负责一个用户故事或需求的端到端交付, 包括分析、开发、测试、运维等\n\n## 相关概念\n### 敏捷方法论\n#### Scrum\n* 方法选择: 有专属团队的纯开发项目，需要稳定的交付节奏的项目，适用Scrum。需要跨项目、跨团队合作的，一人分饰多角的，维护类型的项目，适用看板\n* 相关概念\n    * Product Owner（PO），用户/客户/业务代言人，即可以做出业务决策（需求和优先级）的人\n    * Scrum Master，熟悉Scrum流程的人，指导和确保团队以Scrum的方式进行交付\n    * Sprint，对迭代的说法。一个项目或产品的交付就是由一个又一个的Sprint构成的\n    * User Story，用户故事。具有业务价值的交付单位，一个项目或产品由很多用户故事构成\n    * Product Backlog，可理解为项目的代办列表，由用户故事构成\n    * Sprint Backlog，一个Sprint的代办列表，确定Sprint里有哪些用户故事，框定Sprint的开发范围\n* 过程\n    * 每个项目或产品的交付由若干个Sprint构成。Sprint的周期是固定的，以保持节奏。通常是2-4个星期，不建议超过4个星期\n    * 1. 每个Sprint开始时，PO和IT团队一起开Sprint计划会议，PO对Product Backlog中的用户故事进行排序，选出最重要的用户故事\n    * 2. IT团队对这些用户故事进行估算。Sprint的周期和团队成员数量的确定，也确定了团队的大概交付能力\n    * 3. 确定哪些用户故事会放到这个Sprint的Backlog里，作为Sprint的开发范围\n    * 4. 围绕用户故事开发，每天一次站会，汇报昨天做了什么，今天会做什么，昨天遇到什么问题, 而且控制会议时长和参会人数以提高效率\n    * 5. Sprint结束的时候，开评审会议，展示交付，PO的反馈，包括需求变更都可定义成新的用户故事放到Product Backlog里重新排队\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlgy1geyscva072j30r20gqwix.jpg)\n* 敏捷的所有改变都是为了快速反馈\n    * 短迭代开发，让PO更快、更早地看到成品，给予反馈\n    * 每日站会，每天都能看到进度和阻碍\n    * 回顾会议，每个迭代都反思改进点，形成持续改善的机制\n\n#### 极限编程\n* 12个实践\n    * 确保开发可更早开始和迭代式的持续交付\n        * 计划游戏，planning game，\n            * 把整个项目拆分成从几天到几个星期的若干个迭代，把需求拆分成一个独立的用户故事，放在Backlog里——》每个迭代开始时，用户对用户故事进行排序——》通过估算确定哪些用户故事可在整个迭代里开发。且只对当前迭代进行计划，新需求产生的用户故事要放到后面的迭代中\n        * 小型发布，small release，\n            * 每个迭代后，所开发的用户故事都可发布或展示给用户，获取反馈，新的用户故事放到后面的迭代中\n    * 确保客户和交付团队都明白在做什么\n        * 现场客户，onsite customer，\n            * 用户应该和交付团队始终在一起，持续参与到项目中，阐明用户故事的具体需求和用户故事优先级，给交付团队及时的反馈\n        * 系统隐喻，system metaphor，\n            * 记录用户故事需求时，用交付团队和客户都能理解的语言编写\n    * 编码规范，code standards，\n        * 有一套整个团队都认可的规范\n    * 结对编程，pair Programming，\n        * 两个人结对在同一台计算机前来完成编程，一次性完成编程与评审, 共同讨论设计、测试、编程. 解决传统事后代码review, 需要重写单元测试及review参与度和质量的问题\n    * 测试驱动开发，test driven development，\n        * 在编程前就根据用户故事的需求写好测试（自动化测试），通过测试来验证编程代码是否满足需求\n    * 持续集成，continuous integration，\n        * 每天或每次有代码提交时就集成一次（编译、运行所有自动化测试、打包）, 尽早暴露问题并及时修复\n    * 重构，refactoring，\n        * 不改变功能和外部行为而优化代码的可读性、质量、性能，有了自动化测试和持续集成，可保证重构后出现测试失败，立即回滚代码\n    * 简单设计，simple design，\n        * 只为当前要做的需求进行最简单的设计, 因为越简单的东西, 越不容易出错, 越复杂的东西, 越容易出错. 而如果设计不能满足需要时, 在自动化测试和持续集成的保障下, 通过重构来解决.\n    * 代码集体所有权，collective code ownership，\n        * 在自动化测试和持续集成的保障下，任何人都可以对代码重构\n    * 每周只工作40个小时，40-hour week, \n        * 保障每天足够的时间恢复精力, 避免提前透支精力\n    \n* 5个核心价值\n    * 沟通，communication、简单，simplicity、反馈，feedback、勇气，courage、谦逊modesty\n\n#### 看板（另外一种敏捷、精益的方法）\n* 原则\n    * 进度可视化\n        * 识别整个交付从左到右的各道工序哪里是瓶颈\n        * 根据约束理论，一切瓶颈以外的改善都是徒劳的. 约束理论Theory of Constraint，TOC，帮助企业识别出在实现目标的过程中存在着哪些制约因素，并进一步指出如何实施必要的改进措施\n    * 限制在制品（WIP，Work-in-progress）\n        * 一个请求，只有所有工序都完成并交付到客户那里，其价值才能得到体现\n        * 大量在制品堆积会导致优先级迷失和任务切换，任务切换又会导致效率低下，降低交付速度\n        * 只有下游有闲置产能才从上游拉入新的请求，避免在制品堆积\n        * Scrum限制在制品的方式是, 通过Sprint计划会议限制每个Sprint放入的用户故事\n        * 看板则是在每道交付工序中限制并行任务数量, 随时都可以把新的请求放入Backlog中并排序, 只要有闲置产能时就把优先级高的请求拉入进程![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggan5rl1udj30vm0letf2.jpg)\n    * 观察和改善流动\n* 与Scrum相通的地方\n    * 都基于敏捷与精益的原则，追求价值，消除浪费\n    * 都是基于拉动的计划系统\n    * 都限制在制品\n    * 都通过透明化来获取快速反馈\n    * 都聚焦于更早和更频繁地交付软件\n    * 都需要把大需求拆分成小故事\n* how\n    * 可利用JIRA，按需定义看板的范围、外观、限制在制品数量、泳道、卡片的外观等。每天对着JIRA看板来开每日例会，业务也可通过看板的情况来判断团队分配是否合理，及整个交付过程的瓶颈在哪\n    * 观察看板时，要关注的是有没有空闲的任务，而不是有没有空闲的人员\n    * 从右往左看, 先聚焦在制品, 尽快把在制品完成\n    * 看累积流图，一个面积图，强调用户故事或是需求数随时间而变化的程度，直观显示整体趋势走向。x时间，y需求数量, 不同颜色的面积区分如待处理、处理中、已完成状态的需求。![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbgu9da63j30v20guwqi.jpg)\n\n### 用户故事地图\n* why\n    * 真正的敏捷开发必须是基于用户故事的开发过程\n        * 如按报表来拆成若干个用户故事，选最常用的报表（对业务有价值的最小单位）先开发给业务测试，更快的获得反馈, 使大部分问题能更早地暴露, 为其他用户故事打下基础，通过早交付、早测试、早验收把产品的方向确定。\n        * 如果只是按功能点拆分，单个功能点的完成没有什么业务价值，无法测试\n* how\n    * 从左到右按时间顺序罗列用户行为（流程的每一步）——》在每个用户行为从上至下地罗列相应的细节（包括所需的开发点）。基于这张地图，还可对每个开发点的业务价值进行审视，找出最小可用产品（MVP，Minimal Viable Product）并制订发布计划. 制定发布计划时，遵循刚刚好good enough、更好better、最好best的演进原则\n    ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge0103m24lj30wi0m27eb.jpg)\n    * 记录家里所有物品的APP，每购入新物品就记录\n        * 用户故事地图\n        ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge011rwdwlj30nc092q6m.jpg)\n        * 回顾地图，梳理每个用户故事的优先级，设想如果我们要在一周内做出MVP，会做哪些用户故事\n        ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge0125wyyuj30n809eacx.jpg)\n        * 定义MVP的必要性:\n            * 开发一个功能所需要的时间与成本总是超出预期的\n            * 需求是需要验证的假设，通过MVP可以快速试验，通过最小成本验证需求假设是否成立\n            * MVP是从整个业务角度来找出一个既能实现相同业务目标、IT成本最小的方法来快速启动新业务\n                * 如，要开一家提供网上订餐外送服务的餐厅，半个月内做出一个静态网站，展示菜式和订餐热线，生意就可在半个月之内运作起来。审视的是整个商业模式，不光是IT功能，更重要的是这样的外送服务模式是否可行和菜品是否受欢迎\n        * 用户故事拆分, 使故事最小化\n* 3C原则\n    * Card（地图）\n    * Conversation，确定发布计划后，要和PO围绕当前发布计划中的每一张Card聊具体需求\n    * Confirmation，确定验收条件\n* 敏捷落地比较图\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge013ieznhj30ua0iy0yo.jpg)\n\n### DevOps\n* 敏捷打通了业务、开发、测试之间的墙, 通过更紧密的沟通与交互实现更频繁的交付. 而开发与运维之间还有一堵墙, 运维也需要稳定的部署、监控支持持续交付. DevOps就实现开发与运维一体化和端到端的持续交付，融合了敏捷与精益的精神, 涉及自动化、精益思想、量度和分享.\n* 精益是从丰田生产系统移植到软件开发的方法, 看板方法就是其中一种精益方法.\n\n### 交付文档模版:\n* 需求描述\n    * 作为（谁），我想要（做什么），为了（为什么）。\n    * 行为驱动开发: 业务人员确定对系统的期望行为，采用业务部门和IT部门双方都能看懂的统一语言Gherkin的given when then的语言格式, 编写验收实例, 再通过自动化测试框架cucumber执行实例，实现验收测试自动化，并纳入持续集成\n        * cucumber，一个用普通语言描述测试用例的、支持行为驱动开发BDD的自动化工具，由Ruby编写，支持Java、.NET等多种开发语言。\n* 确认理解\n    * 复述对需求的理解\n* 问为什么\n    * 在什么场景下需要这个需求，包括谁用、什么时候用和使用条件、要解决什么问题、使用频次、怎么发生等（挖掘真实用意，因为有些需求是解决方案）\n* 验收条件\n    * “完成定义”, Definition of Done\n    * 实例化需求, 验收测试用例的具体例子. 避免误读, 让抽象的需求变得具体和可测试.\n    * 以终为始，一开始明确要做成什么样，指导行动并确保结果正确。包括happy path和exceptional scenario\n* 详细设计与实现\n* 集成测试结果\n* 用户验收测试\n* 上线备忘\n    * 上线所需要的额外步骤\n\n### 敏捷估算\n* 敏捷采用的估算单位是故事点, 一个和复杂度或规模有关的相对数, 而用户故事的复杂度或规模, 是一个相对时间更稳定的常量, 因为时间是不可控因素, 同样的需求不同人做的耗时差异性很大.\n* 扑克牌游戏方法\n    * 团队每个成员都有一副扑克牌, 每副扑克牌包含一个不同的数字, 如斐波那契数列, 然后对应故事点分别为1, 2, 4, 6, 10等. 当大家都消化完一个用户时, 同时通过出牌的方式来展示每个人的估算结果. 给出最高和最低估算的两人要解释和辩论. 最后团队得出一个大家都认同的估算值.\n    * 该方法的原理就是利用人群中涌出的群体智慧远远超过个人智慧. \n* 估算时间\n    * 首先测试交付速度. 观察团队在头一两个迭代中可以实际交付多少个故事点来预测团队的交付速率, 从而计算完成所有故事点需要多少个迭代. 而在Scrum, 迭代的周期是固定的, 知道有多少个迭代就能知道需要多长时间\n    * 在迭代进行过程中, 通过燃尽图来持续观察团队的交付速率是在提升还是下降, 随时作出调整\n\n### 关键链\n* 关键路径是项目活动及其逻辑关系图中最长的路径, 通常决定项目工期\n* 而关键链是决定项目长度的全部关键因素的关键路径和其他一些需要关键资源的任务\n* 把关键链上所有任务被扣除的安全时间放在最后要给任务后作为项目缓冲，保护项目不受关键链任务延迟的影响。所有非关键路径上的任务被扣减的安全时间也集中在一起作为接入关键链的接驳缓冲，保护关键链不受这些任务延迟的影响\n* 如果按非关键链的做法, 为所有的任务都加入安全时间, 会被学生症侯群、多任务和延迟的累计浪费掉所有的安全时间, 从而导致项目延迟\n    * 学生症候群指通常人们会先极力争取安全时间, 得到安全时间后, 就不着急, 真正开始往往在最后一刻, 造成安全时间被浪费. 所以在任务阶段剥夺安全时间可以迫使相应的资源在任务开始的时候就全力以赴地执行任务\n    * 估算通常被视作承诺, 考虑到今后的估算被压榨, 人们通常不会呈报提前完工, 这部分的延迟会转嫁到下一个任务, 而最终导致项目延迟. 而关键链方法, 任何任务提前完成都增加到缓冲区\n![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge01fmm6trj31cy0kqk7v.jpg)\n* 关键链区别于关键路径主要是,\n    * 关键链考虑了资源冲突. 把安全时间从每个任务中转移出来的前提是, 每个任务所需要的资源都能聚焦在当前任务上\n* 约束理论五步法\n    * 定义系统限制（瓶颈）\n    * 决定如何充分利用限制\n    * 让非限制资源充分配合\n    * 打破系统限制\n    * 若限制已打破，回到步骤一\n\n### 其他相关思维:\n* 真正的持续交付需要从左端的业务需求到右端的上线全流程配合\n* 计划不是为了执行, 而是提前做好各种情况的预案, 集结资源, 以应对将来可能的各种变化\n* 敏捷开发提倡信任、自治及通过技术手段如自动化测试来取代繁文缛节的文档.变革需要整个公司文化和价值观上的改变与配合以及人力、工具的投入, 只有管理层的支持才能使变革遍地开花.\n\n## 个人感悟\n* 上一篇《凤凰项目-三步工作法笔记》中, 提到多读书真的很重要, 因为虽然知识不能改变命运, 但是能改变思维. \n\n* 后来我想了下, 应该是”意识到必须做出改变“更重要. 那样看了书之后, 不是只有“哦, 我知道了”, 而是会想办法把书里面的内容吸收用起来. \n\n* 比如说, 把迭代思维融入到日常生活中, 其实是一种解决拖延症的好办法, 把要完成的事情拆分到足够小, 小到不用犹豫就能做的, 同时把这些任务可视化, 持续监控并调整自己的行为, 直到完成. \n\n* 而“限制在制品”的应用, 就是把任务拆分到足够小之后, 排好优先级, 一件一件的完成, 减少不必要的任务切换, 专注于尽快消除未完成的任务. \n* ps: 尝试了一段时间后, 还是有些问题, 最重要的原因, 应该是缺少反馈, 多去接受外界的反馈才是真正的走出舒适圈...","slug":"猎豹行动笔记","published":1,"updated":"2021-02-07T02:59:54.506Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklrai12c000uunra2dz2839o","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/blog/assets/css/APlayer.min.css\"><script src=\"/blog/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>去年为了了解敏捷开发流程和DevOps, 也看了《猎豹行动》这本书. 同样按照, 故事脉络、相关概念、个人感悟这几个模块来整理笔记.</p>\n<h2 id=\"故事脉络\"><a href=\"#故事脉络\" class=\"headerlink\" title=\"故事脉络\"></a>故事脉络</h2><a id=\"more\"></a>\n<p>一家金融服务公司, 为了更快地响应业务部门的请求, 更好地交付业务价值, 启动名为“猎豹行动”的行动计划, 落实敏捷转型. </p>\n<h3 id=\"要解决的问题\"><a href=\"#要解决的问题\" class=\"headerlink\" title=\"要解决的问题:\"></a>要解决的问题:</h3><ul>\n<li>开发模式依然以瀑布模型为主, 交付慢且昂贵, 业务部门对此不满</li>\n<li>业务部门架构复杂, 各自的利益与兴趣点不同, 难以形成统一的优先级和需求意见, 对IT部门有不同的请求</li>\n<li>IT部门由于预算问题, 人员编制不足</li>\n<li>流程烦琐、基础设施落后、自动化程度不足</li>\n<li>PMO部门承担所有项目的甲方, 为了维护部门利益, 在所有项目中做中间人角色, 不愿IT部门直接解除其他业务部门(最终用户), 但又不愿承担PO的角色</li>\n</ul>\n<h3 id=\"猎豹行动启动方案\"><a href=\"#猎豹行动启动方案\" class=\"headerlink\" title=\"猎豹行动启动方案:\"></a>猎豹行动启动方案:</h3><ol>\n<li>组织全覆盖的敏捷扫盲班, 让所有IT同事对敏捷开发有基本的了解, 审视当前的交付模式并找出改进点.</li>\n</ol>\n<ul>\n<li>分析当前的瀑布模型开发:<ul>\n<li>痛点<ul>\n<li>业务部门<ul>\n<li>逾期交付、超支、缺乏透明度，不知道具体进度、很难变更需求、看到成品时项目已接近尾声、最终发现开发出来的产品不是他们想要的、殆误战机，丢失市场机会</li>\n</ul>\n</li>\n<li>IT部门<ul>\n<li>过度承诺、难以一次性消化所有需求、惧怕需求变更、不断重做、后期压力巨大、加班</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>导致痛点的原因<ul>\n<li>只有预算和目标交付时间是确定的</li>\n<li>不确定因素<ul>\n<li>范围和具体需求、可能的需求变更、人员（放假离职）、估算的准确性、对现有系统的影响、服务器环境的搭建</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>存在的问题<ul>\n<li>需求分析花的时间多，开发时间被压缩</li>\n<li>变更成本高</li>\n<li>业务要在用户验收测试阶段才能看到成品，临近目标交付日期, 才发现产品不合要求</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>介绍敏捷开发模式:<ul>\n<li>迭代开发就是敏捷开发最重要的特点. 软件开发最重要的是搞清楚用户到底想要什么. 以两组蒙娜丽莎的完成过程图为例, 如果客户任务蒙娜丽莎的头最重要, 那上面那组的第二幅图就可以交付. <figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1geys7hwr3bj30vy0nmwpg.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>跟每个团队进行交谈, 了解团队痛点, 探讨具体改进方案.</li>\n</ol>\n<ul>\n<li>总结敏捷开发给业务部门和IT部门带来的好处, 并给出敏捷启动建议:<ul>\n<li>围绕已知的范围和需求定义用户故事和建立Product Backlog</li>\n<li>为用户故事排优先级</li>\n<li>商定Sprint的长度</li>\n<li>商定Sprint计划会议和评审会议的日程</li>\n<li>商定发布计划</li>\n<li>准备相应的辅助工具</li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>组织针对业务部门的敏捷基础培训, 配合落实敏捷转型.</li>\n</ol>\n<ul>\n<li>通过“棉花糖挑战”和“传硬币”两个游戏, 分别领悟简单设计、提早测试、快速反馈、减少批量, 提高交付速度的重要性. 把项目需求条目化, 定期排序, 确保有限的资源和时间用在最有价值的事情上.</li>\n</ul>\n<ol start=\"4\">\n<li>从工具开始落地敏捷, 提升效率. </li>\n</ol>\n<ul>\n<li>利用开源软件的优势, 站在巨人的肩膀上开发. 采用了以下工具, 如项目管理工具JIRA、知识管理工具Confluence、代码托管平台GitHub、代码缓存及管理仓库工具Nexus、持续继承工具Jenkins、代码静态审查工具SonarQube、自动化部署工具Ansible</li>\n<li>针对人手不够, 而阻碍工具落地的情况, 采取以下措施:<ul>\n<li>通过工作坊和团队一起找出痛点, 列出所有改进点并进行优先级排序</li>\n<li>每个团队每天划出一个固定时段, 半小时到1小时, 这段时间内, 所有团队成员放下手头的交付工作, 自行或组队摘取改进点进行实施, 并建立激励机制鼓励大家积极参与.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"以团队共创形式开展工作坊\"><a href=\"#以团队共创形式开展工作坊\" class=\"headerlink\" title=\"以团队共创形式开展工作坊:\"></a>以团队共创形式开展工作坊:</h3><ul>\n<li><p>what</p>\n<ul>\n<li>和团队一起找出痛点, 列出所有改进点并进行优先级排序</li>\n</ul>\n</li>\n<li><p>how</p>\n<ul>\n<li>主题介绍. <ul>\n<li>主要是确立目标.</li>\n</ul>\n</li>\n<li>头脑风暴. <ul>\n<li>每个人先列出实现目标的障碍和对应想法, 然后分成几个小组, 每个组把组员的想法, 都进一步提炼成几个想法.</li>\n</ul>\n</li>\n<li>排列组合. <ul>\n<li>对每个组提炼出来的想法, 再进一步归类.</li>\n</ul>\n</li>\n<li>提炼中心词. <ul>\n<li>对每类想法, 提炼中心词.</li>\n</ul>\n</li>\n<li>模型图. <ul>\n<li>思考中心词之间的逻辑关系, 通过关系摆放形成图形, 解读图形, 制定行动方案.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>通过工作坊, 发现以下问题: </p>\n<ul>\n<li>1)业务请求跟踪性差</li>\n<li>2)缺乏回归测试</li>\n<li>3)手工部署</li>\n</ul>\n</li>\n<li><p>针对以上问题, 采取相应措施:</p>\n<ul>\n<li>1)-1 JIRA记录所有的请求和需求, 建立可视板使进度可视化.</li>\n<li>1)-2 每日站会围绕JIRA可视板进行,确认每天的优先级、进度、阻碍.</li>\n<li>1)-3 通过Confluence建立项目文档和知识库. 使所有知识和信息透明化, 提升沟通和学习效率</li>\n<li>2) 找出合适的自动化测试方案, 通过Jenkins每天自动执行全部自动化测试并发布测试结果, 结合SonarQube观测测试代码覆盖率是否处于上升趋势</li>\n<li>3) 通过Ansible编写部署脚本, 实现部署自动化.</li>\n</ul>\n</li>\n<li><p>实施过程的阻碍:</p>\n<ul>\n<li>遗留代码耦合度高, 可测试性低, 导致自动化回归测试落地缓慢.</li>\n<li>上线流程烦琐, 倾向延迟修复版本的上线而造成更大的业务影响.<ul>\n<li>不管付出多少努力, 零缺陷和零风险都是不可实现的, 很多问题只有在生产环境才会出现. 做到真正的持续交付、频繁上线, 每次上线所涉及的变更范围缩到最小, 当问题出现的时候, 能更快地修复问题并把业务影响降到最低.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"项目试点实践经验\"><a href=\"#项目试点实践经验\" class=\"headerlink\" title=\"项目试点实践经验:\"></a>项目试点实践经验:</h3><ul>\n<li><p>采用新交付方式, 规范并简化流程:</p>\n<ul>\n<li>拥抱变化<ul>\n<li>适应任何需求变化以满足业务部门的最终需求. 拆分原始需求并快速交付其中最重要的部分获取反馈并及时修改</li>\n</ul>\n</li>\n<li>拆分<ul>\n<li>把大的需求拆分成最小可交付需求来缩短交付时间和实现持续交付</li>\n</ul>\n</li>\n<li>简化流程<ul>\n<li>最终用户与IT工程师直接沟通, 减少交接与签署, 不再依赖繁文缛节的文档. 业务部门可通过JIRA Service Desk直接提交需求, 规范交付文档, 使业务部门和IT部门对验收条件达成共识.</li>\n<li>PS: 以前老大也经常这么说，产品提的需求只是个解决方案，还需要跟业务沟通，把握真正的需求</li>\n</ul>\n</li>\n<li>透明可视化<ul>\n<li>需求与细节都记录在JIRA上. 通过看板可视化进度与阻碍. 定期汇报</li>\n</ul>\n</li>\n<li>改进服务<ul>\n<li>上线后业务人员可为每个交付评分和反馈意见<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbfgdmvfdj30v8082gqm.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure> \n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>基于产品的持续改进:</p>\n<ul>\n<li>建立CI/CD流水线, 加快暴露集成问题</li>\n<li>实现基于主干开发, 避免上线代码非测试过的版本等问题</li>\n<li>特性开关控制新功能</li>\n</ul>\n</li>\n<li><p>采用敏捷估算预测交付时间, 迭代进行过程中, 通过燃尽图持续观察团队的交付速率, 并及时调整预测.</p>\n</li>\n<li><p>从满足对方要求的定制化接口到通过API开放数据:</p>\n<ul>\n<li>采用演进式的设计方法和微服务架构.</li>\n<li>先搞清楚对家需要哪些数据(可根据对家系统所要求的接口文件规格文档), 然后为此设计Process API, 满足对家直接访问的需求. 在底层, 对数据按照领域进行归类, 设计相应的Domain API, 从Domain API获取元数据整合出Process API所需要的数据.</li>\n<li>实施部分, 每个API都是一个独立的微服务应用, 基于Spring Boot开发. 借助Spring Cloud来搭建整个微服务框架.</li>\n<li>通过Spring Cloud Contract框架实现契约测试.</li>\n</ul>\n</li>\n<li><p>从“预算驱动交付”到“价值驱动交付”</p>\n<ul>\n<li>引入服务等级, 统一确定请求优先级来安排产能:<ul>\n<li>延迟成本，cost of delay，计算每个请求如果逾期的话造成的损失，将其折算成金钱，来量化所有请求的优先级</li>\n<li>服务等级，class of service，对于不同的请求类型，赋予不同的服务等级，区别处理<ul>\n<li>加急类(Expedite), 常见于一些时效性特别强的需求, 或者对产品重大缺陷的修复. 这一类请求将被视为最高优先级, 可以无视最大在制品(WIP)的限制而直接进行作业. 然而这样的请求, 很容易对看板的正常工作造成冲击, 因此加急类的任务个数, 通常仅设置为1.</li>\n<li>固定交付日期类(Fixed Delivery Date), 推荐安排一定的产能来处理一些固定交付日期的请求. 对于这一类请求, 需要交付团队在开发之前对请求的工作量进行估算, 并在开发过程中定期地确认进度. 一旦发现进度落后到有可能无法完成的地步, 则需要交付团队对请求重新进行评估. 如有必要, 这类请求可以升级为加急类.</li>\n<li>标准类(Standard), 最普通的请求. 推荐大部分的产能都归类到此类请求. 交付团队无需对请求的工作量进行估算, 直接按照先进先出的顺序进行处理即可. 但对于超过两周工作量的请求, 建议先进行拆分.</li>\n<li>无形类(Intangible), 主要针对一些用户价值有限的附加功能, 推荐安排此类任务上的产能应该低于标准类的产能.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>采用关键链方法, 把约束理论运用到项目管理中, 解决依赖冲突, 突破项目管理的瓶颈</p>\n<ul>\n<li>新项目由于资源冲突, 计划时间超出规定的交付时间. 同时考虑到原来的计划是有安全时间的, 于是调整计划, 把所有任务的时间减半, 而这些被扣除的安全时间放在最后一个任务后作为项目缓冲时间</li>\n</ul>\n</li>\n<li><p>对于IT部门, 致力于培养能做到端到端交付的T型人才</p>\n<ul>\n<li>模糊原来诸如BA、开发工程师、测试工程师、运维工程师等的明确的职能分工, 尽可能做到负责一个用户故事或需求的端到端交付, 包括分析、开发、测试、运维等</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念\"></a>相关概念</h2><h3 id=\"敏捷方法论\"><a href=\"#敏捷方法论\" class=\"headerlink\" title=\"敏捷方法论\"></a>敏捷方法论</h3><h4 id=\"Scrum\"><a href=\"#Scrum\" class=\"headerlink\" title=\"Scrum\"></a>Scrum</h4><ul>\n<li>方法选择: 有专属团队的纯开发项目，需要稳定的交付节奏的项目，适用Scrum。需要跨项目、跨团队合作的，一人分饰多角的，维护类型的项目，适用看板</li>\n<li>相关概念<ul>\n<li>Product Owner（PO），用户/客户/业务代言人，即可以做出业务决策（需求和优先级）的人</li>\n<li>Scrum Master，熟悉Scrum流程的人，指导和确保团队以Scrum的方式进行交付</li>\n<li>Sprint，对迭代的说法。一个项目或产品的交付就是由一个又一个的Sprint构成的</li>\n<li>User Story，用户故事。具有业务价值的交付单位，一个项目或产品由很多用户故事构成</li>\n<li>Product Backlog，可理解为项目的代办列表，由用户故事构成</li>\n<li>Sprint Backlog，一个Sprint的代办列表，确定Sprint里有哪些用户故事，框定Sprint的开发范围</li>\n</ul>\n</li>\n<li>过程<ul>\n<li>每个项目或产品的交付由若干个Sprint构成。Sprint的周期是固定的，以保持节奏。通常是2-4个星期，不建议超过4个星期</li>\n<li><ol>\n<li>每个Sprint开始时，PO和IT团队一起开Sprint计划会议，PO对Product Backlog中的用户故事进行排序，选出最重要的用户故事</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>IT团队对这些用户故事进行估算。Sprint的周期和团队成员数量的确定，也确定了团队的大概交付能力</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>确定哪些用户故事会放到这个Sprint的Backlog里，作为Sprint的开发范围</li>\n</ol>\n</li>\n<li><ol start=\"4\">\n<li>围绕用户故事开发，每天一次站会，汇报昨天做了什么，今天会做什么，昨天遇到什么问题, 而且控制会议时长和参会人数以提高效率</li>\n</ol>\n</li>\n<li><ol start=\"5\">\n<li>Sprint结束的时候，开评审会议，展示交付，PO的反馈，包括需求变更都可定义成新的用户故事放到Product Backlog里重新排队<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1geyscva072j30r20gqwix.jpg\" alt=\"\"></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>敏捷的所有改变都是为了快速反馈<ul>\n<li>短迭代开发，让PO更快、更早地看到成品，给予反馈</li>\n<li>每日站会，每天都能看到进度和阻碍</li>\n<li>回顾会议，每个迭代都反思改进点，形成持续改善的机制</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"极限编程\"><a href=\"#极限编程\" class=\"headerlink\" title=\"极限编程\"></a>极限编程</h4><ul>\n<li><p>12个实践</p>\n<ul>\n<li>确保开发可更早开始和迭代式的持续交付<ul>\n<li>计划游戏，planning game，<ul>\n<li>把整个项目拆分成从几天到几个星期的若干个迭代，把需求拆分成一个独立的用户故事，放在Backlog里——》每个迭代开始时，用户对用户故事进行排序——》通过估算确定哪些用户故事可在整个迭代里开发。且只对当前迭代进行计划，新需求产生的用户故事要放到后面的迭代中</li>\n</ul>\n</li>\n<li>小型发布，small release，<ul>\n<li>每个迭代后，所开发的用户故事都可发布或展示给用户，获取反馈，新的用户故事放到后面的迭代中</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>确保客户和交付团队都明白在做什么<ul>\n<li>现场客户，onsite customer，<ul>\n<li>用户应该和交付团队始终在一起，持续参与到项目中，阐明用户故事的具体需求和用户故事优先级，给交付团队及时的反馈</li>\n</ul>\n</li>\n<li>系统隐喻，system metaphor，<ul>\n<li>记录用户故事需求时，用交付团队和客户都能理解的语言编写</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>编码规范，code standards，<ul>\n<li>有一套整个团队都认可的规范</li>\n</ul>\n</li>\n<li>结对编程，pair Programming，<ul>\n<li>两个人结对在同一台计算机前来完成编程，一次性完成编程与评审, 共同讨论设计、测试、编程. 解决传统事后代码review, 需要重写单元测试及review参与度和质量的问题</li>\n</ul>\n</li>\n<li>测试驱动开发，test driven development，<ul>\n<li>在编程前就根据用户故事的需求写好测试（自动化测试），通过测试来验证编程代码是否满足需求</li>\n</ul>\n</li>\n<li>持续集成，continuous integration，<ul>\n<li>每天或每次有代码提交时就集成一次（编译、运行所有自动化测试、打包）, 尽早暴露问题并及时修复</li>\n</ul>\n</li>\n<li>重构，refactoring，<ul>\n<li>不改变功能和外部行为而优化代码的可读性、质量、性能，有了自动化测试和持续集成，可保证重构后出现测试失败，立即回滚代码</li>\n</ul>\n</li>\n<li>简单设计，simple design，<ul>\n<li>只为当前要做的需求进行最简单的设计, 因为越简单的东西, 越不容易出错, 越复杂的东西, 越容易出错. 而如果设计不能满足需要时, 在自动化测试和持续集成的保障下, 通过重构来解决.</li>\n</ul>\n</li>\n<li>代码集体所有权，collective code ownership，<ul>\n<li>在自动化测试和持续集成的保障下，任何人都可以对代码重构</li>\n</ul>\n</li>\n<li>每周只工作40个小时，40-hour week, <ul>\n<li>保障每天足够的时间恢复精力, 避免提前透支精力</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>5个核心价值</p>\n<ul>\n<li>沟通，communication、简单，simplicity、反馈，feedback、勇气，courage、谦逊modesty</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"看板（另外一种敏捷、精益的方法）\"><a href=\"#看板（另外一种敏捷、精益的方法）\" class=\"headerlink\" title=\"看板（另外一种敏捷、精益的方法）\"></a>看板（另外一种敏捷、精益的方法）</h4><ul>\n<li>原则<ul>\n<li>进度可视化<ul>\n<li>识别整个交付从左到右的各道工序哪里是瓶颈</li>\n<li>根据约束理论，一切瓶颈以外的改善都是徒劳的. 约束理论Theory of Constraint，TOC，帮助企业识别出在实现目标的过程中存在着哪些制约因素，并进一步指出如何实施必要的改进措施</li>\n</ul>\n</li>\n<li>限制在制品（WIP，Work-in-progress）<ul>\n<li>一个请求，只有所有工序都完成并交付到客户那里，其价值才能得到体现</li>\n<li>大量在制品堆积会导致优先级迷失和任务切换，任务切换又会导致效率低下，降低交付速度</li>\n<li>只有下游有闲置产能才从上游拉入新的请求，避免在制品堆积</li>\n<li>Scrum限制在制品的方式是, 通过Sprint计划会议限制每个Sprint放入的用户故事</li>\n<li>看板则是在每道交付工序中限制并行任务数量, 随时都可以把新的请求放入Backlog中并排序, 只要有闲置产能时就把优先级高的请求拉入进程<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggan5rl1udj30vm0letf2.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>观察和改善流动</li>\n</ul>\n</li>\n<li>与Scrum相通的地方<ul>\n<li>都基于敏捷与精益的原则，追求价值，消除浪费</li>\n<li>都是基于拉动的计划系统</li>\n<li>都限制在制品</li>\n<li>都通过透明化来获取快速反馈</li>\n<li>都聚焦于更早和更频繁地交付软件</li>\n<li>都需要把大需求拆分成小故事</li>\n</ul>\n</li>\n<li>how<ul>\n<li>可利用JIRA，按需定义看板的范围、外观、限制在制品数量、泳道、卡片的外观等。每天对着JIRA看板来开每日例会，业务也可通过看板的情况来判断团队分配是否合理，及整个交付过程的瓶颈在哪</li>\n<li>观察看板时，要关注的是有没有空闲的任务，而不是有没有空闲的人员</li>\n<li>从右往左看, 先聚焦在制品, 尽快把在制品完成</li>\n<li>看累积流图，一个面积图，强调用户故事或是需求数随时间而变化的程度，直观显示整体趋势走向。x时间，y需求数量, 不同颜色的面积区分如待处理、处理中、已完成状态的需求。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbgu9da63j30v20guwqi.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"用户故事地图\"><a href=\"#用户故事地图\" class=\"headerlink\" title=\"用户故事地图\"></a>用户故事地图</h3><ul>\n<li>why<ul>\n<li>真正的敏捷开发必须是基于用户故事的开发过程<ul>\n<li>如按报表来拆成若干个用户故事，选最常用的报表（对业务有价值的最小单位）先开发给业务测试，更快的获得反馈, 使大部分问题能更早地暴露, 为其他用户故事打下基础，通过早交付、早测试、早验收把产品的方向确定。</li>\n<li>如果只是按功能点拆分，单个功能点的完成没有什么业务价值，无法测试</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>how<ul>\n<li>从左到右按时间顺序罗列用户行为（流程的每一步）——》在每个用户行为从上至下地罗列相应的细节（包括所需的开发点）。基于这张地图，还可对每个开发点的业务价值进行审视，找出最小可用产品（MVP，Minimal Viable Product）并制订发布计划. 制定发布计划时，遵循刚刚好good enough、更好better、最好best的演进原则<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge0103m24lj30wi0m27eb.jpg\" alt=\"\"></li>\n<li>记录家里所有物品的APP，每购入新物品就记录<ul>\n<li>用户故事地图<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge011rwdwlj30nc092q6m.jpg\" alt=\"\"></li>\n<li>回顾地图，梳理每个用户故事的优先级，设想如果我们要在一周内做出MVP，会做哪些用户故事<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge0125wyyuj30n809eacx.jpg\" alt=\"\"></li>\n<li>定义MVP的必要性:<ul>\n<li>开发一个功能所需要的时间与成本总是超出预期的</li>\n<li>需求是需要验证的假设，通过MVP可以快速试验，通过最小成本验证需求假设是否成立</li>\n<li>MVP是从整个业务角度来找出一个既能实现相同业务目标、IT成本最小的方法来快速启动新业务<ul>\n<li>如，要开一家提供网上订餐外送服务的餐厅，半个月内做出一个静态网站，展示菜式和订餐热线，生意就可在半个月之内运作起来。审视的是整个商业模式，不光是IT功能，更重要的是这样的外送服务模式是否可行和菜品是否受欢迎</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>用户故事拆分, 使故事最小化</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>3C原则<ul>\n<li>Card（地图）</li>\n<li>Conversation，确定发布计划后，要和PO围绕当前发布计划中的每一张Card聊具体需求</li>\n<li>Confirmation，确定验收条件</li>\n</ul>\n</li>\n<li>敏捷落地比较图<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge013ieznhj30ua0iy0yo.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h3 id=\"DevOps\"><a href=\"#DevOps\" class=\"headerlink\" title=\"DevOps\"></a>DevOps</h3><ul>\n<li>敏捷打通了业务、开发、测试之间的墙, 通过更紧密的沟通与交互实现更频繁的交付. 而开发与运维之间还有一堵墙, 运维也需要稳定的部署、监控支持持续交付. DevOps就实现开发与运维一体化和端到端的持续交付，融合了敏捷与精益的精神, 涉及自动化、精益思想、量度和分享.</li>\n<li>精益是从丰田生产系统移植到软件开发的方法, 看板方法就是其中一种精益方法.</li>\n</ul>\n<h3 id=\"交付文档模版\"><a href=\"#交付文档模版\" class=\"headerlink\" title=\"交付文档模版:\"></a>交付文档模版:</h3><ul>\n<li>需求描述<ul>\n<li>作为（谁），我想要（做什么），为了（为什么）。</li>\n<li>行为驱动开发: 业务人员确定对系统的期望行为，采用业务部门和IT部门双方都能看懂的统一语言Gherkin的given when then的语言格式, 编写验收实例, 再通过自动化测试框架cucumber执行实例，实现验收测试自动化，并纳入持续集成<ul>\n<li>cucumber，一个用普通语言描述测试用例的、支持行为驱动开发BDD的自动化工具，由Ruby编写，支持Java、.NET等多种开发语言。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>确认理解<ul>\n<li>复述对需求的理解</li>\n</ul>\n</li>\n<li>问为什么<ul>\n<li>在什么场景下需要这个需求，包括谁用、什么时候用和使用条件、要解决什么问题、使用频次、怎么发生等（挖掘真实用意，因为有些需求是解决方案）</li>\n</ul>\n</li>\n<li>验收条件<ul>\n<li>“完成定义”, Definition of Done</li>\n<li>实例化需求, 验收测试用例的具体例子. 避免误读, 让抽象的需求变得具体和可测试.</li>\n<li>以终为始，一开始明确要做成什么样，指导行动并确保结果正确。包括happy path和exceptional scenario</li>\n</ul>\n</li>\n<li>详细设计与实现</li>\n<li>集成测试结果</li>\n<li>用户验收测试</li>\n<li>上线备忘<ul>\n<li>上线所需要的额外步骤</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"敏捷估算\"><a href=\"#敏捷估算\" class=\"headerlink\" title=\"敏捷估算\"></a>敏捷估算</h3><ul>\n<li>敏捷采用的估算单位是故事点, 一个和复杂度或规模有关的相对数, 而用户故事的复杂度或规模, 是一个相对时间更稳定的常量, 因为时间是不可控因素, 同样的需求不同人做的耗时差异性很大.</li>\n<li>扑克牌游戏方法<ul>\n<li>团队每个成员都有一副扑克牌, 每副扑克牌包含一个不同的数字, 如斐波那契数列, 然后对应故事点分别为1, 2, 4, 6, 10等. 当大家都消化完一个用户时, 同时通过出牌的方式来展示每个人的估算结果. 给出最高和最低估算的两人要解释和辩论. 最后团队得出一个大家都认同的估算值.</li>\n<li>该方法的原理就是利用人群中涌出的群体智慧远远超过个人智慧. </li>\n</ul>\n</li>\n<li>估算时间<ul>\n<li>首先测试交付速度. 观察团队在头一两个迭代中可以实际交付多少个故事点来预测团队的交付速率, 从而计算完成所有故事点需要多少个迭代. 而在Scrum, 迭代的周期是固定的, 知道有多少个迭代就能知道需要多长时间</li>\n<li>在迭代进行过程中, 通过燃尽图来持续观察团队的交付速率是在提升还是下降, 随时作出调整</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"关键链\"><a href=\"#关键链\" class=\"headerlink\" title=\"关键链\"></a>关键链</h3><ul>\n<li>关键路径是项目活动及其逻辑关系图中最长的路径, 通常决定项目工期</li>\n<li>而关键链是决定项目长度的全部关键因素的关键路径和其他一些需要关键资源的任务</li>\n<li>把关键链上所有任务被扣除的安全时间放在最后要给任务后作为项目缓冲，保护项目不受关键链任务延迟的影响。所有非关键路径上的任务被扣减的安全时间也集中在一起作为接入关键链的接驳缓冲，保护关键链不受这些任务延迟的影响</li>\n<li>如果按非关键链的做法, 为所有的任务都加入安全时间, 会被学生症侯群、多任务和延迟的累计浪费掉所有的安全时间, 从而导致项目延迟<ul>\n<li>学生症候群指通常人们会先极力争取安全时间, 得到安全时间后, 就不着急, 真正开始往往在最后一刻, 造成安全时间被浪费. 所以在任务阶段剥夺安全时间可以迫使相应的资源在任务开始的时候就全力以赴地执行任务</li>\n<li>估算通常被视作承诺, 考虑到今后的估算被压榨, 人们通常不会呈报提前完工, 这部分的延迟会转嫁到下一个任务, 而最终导致项目延迟. 而关键链方法, 任何任务提前完成都增加到缓冲区<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge01fmm6trj31cy0kqk7v.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>关键链区别于关键路径主要是,<ul>\n<li>关键链考虑了资源冲突. 把安全时间从每个任务中转移出来的前提是, 每个任务所需要的资源都能聚焦在当前任务上</li>\n</ul>\n</li>\n<li>约束理论五步法<ul>\n<li>定义系统限制（瓶颈）</li>\n<li>决定如何充分利用限制</li>\n<li>让非限制资源充分配合</li>\n<li>打破系统限制</li>\n<li>若限制已打破，回到步骤一</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"其他相关思维\"><a href=\"#其他相关思维\" class=\"headerlink\" title=\"其他相关思维:\"></a>其他相关思维:</h3><ul>\n<li>真正的持续交付需要从左端的业务需求到右端的上线全流程配合</li>\n<li>计划不是为了执行, 而是提前做好各种情况的预案, 集结资源, 以应对将来可能的各种变化</li>\n<li>敏捷开发提倡信任、自治及通过技术手段如自动化测试来取代繁文缛节的文档.变革需要整个公司文化和价值观上的改变与配合以及人力、工具的投入, 只有管理层的支持才能使变革遍地开花.</li>\n</ul>\n<h2 id=\"个人感悟\"><a href=\"#个人感悟\" class=\"headerlink\" title=\"个人感悟\"></a>个人感悟</h2><ul>\n<li><p>上一篇《凤凰项目-三步工作法笔记》中, 提到多读书真的很重要, 因为虽然知识不能改变命运, 但是能改变思维. </p>\n</li>\n<li><p>后来我想了下, 应该是”意识到必须做出改变“更重要. 那样看了书之后, 不是只有“哦, 我知道了”, 而是会想办法把书里面的内容吸收用起来. </p>\n</li>\n<li><p>比如说, 把迭代思维融入到日常生活中, 其实是一种解决拖延症的好办法, 把要完成的事情拆分到足够小, 小到不用犹豫就能做的, 同时把这些任务可视化, 持续监控并调整自己的行为, 直到完成. </p>\n</li>\n<li><p>而“限制在制品”的应用, 就是把任务拆分到足够小之后, 排好优先级, 一件一件的完成, 减少不必要的任务切换, 专注于尽快消除未完成的任务. </p>\n</li>\n<li><p>ps: 尝试了一段时间后, 还是有些问题, 最重要的原因, 应该是缺少反馈, 多去接受外界的反馈才是真正的走出舒适圈…</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>去年为了了解敏捷开发流程和DevOps, 也看了《猎豹行动》这本书. 同样按照, 故事脉络、相关概念、个人感悟这几个模块来整理笔记.</p>\n<h2 id=\"故事脉络\"><a href=\"#故事脉络\" class=\"headerlink\" title=\"故事脉络\"></a>故事脉络</h2>","more":"<p>一家金融服务公司, 为了更快地响应业务部门的请求, 更好地交付业务价值, 启动名为“猎豹行动”的行动计划, 落实敏捷转型. </p>\n<h3 id=\"要解决的问题\"><a href=\"#要解决的问题\" class=\"headerlink\" title=\"要解决的问题:\"></a>要解决的问题:</h3><ul>\n<li>开发模式依然以瀑布模型为主, 交付慢且昂贵, 业务部门对此不满</li>\n<li>业务部门架构复杂, 各自的利益与兴趣点不同, 难以形成统一的优先级和需求意见, 对IT部门有不同的请求</li>\n<li>IT部门由于预算问题, 人员编制不足</li>\n<li>流程烦琐、基础设施落后、自动化程度不足</li>\n<li>PMO部门承担所有项目的甲方, 为了维护部门利益, 在所有项目中做中间人角色, 不愿IT部门直接解除其他业务部门(最终用户), 但又不愿承担PO的角色</li>\n</ul>\n<h3 id=\"猎豹行动启动方案\"><a href=\"#猎豹行动启动方案\" class=\"headerlink\" title=\"猎豹行动启动方案:\"></a>猎豹行动启动方案:</h3><ol>\n<li>组织全覆盖的敏捷扫盲班, 让所有IT同事对敏捷开发有基本的了解, 审视当前的交付模式并找出改进点.</li>\n</ol>\n<ul>\n<li>分析当前的瀑布模型开发:<ul>\n<li>痛点<ul>\n<li>业务部门<ul>\n<li>逾期交付、超支、缺乏透明度，不知道具体进度、很难变更需求、看到成品时项目已接近尾声、最终发现开发出来的产品不是他们想要的、殆误战机，丢失市场机会</li>\n</ul>\n</li>\n<li>IT部门<ul>\n<li>过度承诺、难以一次性消化所有需求、惧怕需求变更、不断重做、后期压力巨大、加班</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>导致痛点的原因<ul>\n<li>只有预算和目标交付时间是确定的</li>\n<li>不确定因素<ul>\n<li>范围和具体需求、可能的需求变更、人员（放假离职）、估算的准确性、对现有系统的影响、服务器环境的搭建</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>存在的问题<ul>\n<li>需求分析花的时间多，开发时间被压缩</li>\n<li>变更成本高</li>\n<li>业务要在用户验收测试阶段才能看到成品，临近目标交付日期, 才发现产品不合要求</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>介绍敏捷开发模式:<ul>\n<li>迭代开发就是敏捷开发最重要的特点. 软件开发最重要的是搞清楚用户到底想要什么. 以两组蒙娜丽莎的完成过程图为例, 如果客户任务蒙娜丽莎的头最重要, 那上面那组的第二幅图就可以交付. <figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1geys7hwr3bj30vy0nmwpg.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>跟每个团队进行交谈, 了解团队痛点, 探讨具体改进方案.</li>\n</ol>\n<ul>\n<li>总结敏捷开发给业务部门和IT部门带来的好处, 并给出敏捷启动建议:<ul>\n<li>围绕已知的范围和需求定义用户故事和建立Product Backlog</li>\n<li>为用户故事排优先级</li>\n<li>商定Sprint的长度</li>\n<li>商定Sprint计划会议和评审会议的日程</li>\n<li>商定发布计划</li>\n<li>准备相应的辅助工具</li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>组织针对业务部门的敏捷基础培训, 配合落实敏捷转型.</li>\n</ol>\n<ul>\n<li>通过“棉花糖挑战”和“传硬币”两个游戏, 分别领悟简单设计、提早测试、快速反馈、减少批量, 提高交付速度的重要性. 把项目需求条目化, 定期排序, 确保有限的资源和时间用在最有价值的事情上.</li>\n</ul>\n<ol start=\"4\">\n<li>从工具开始落地敏捷, 提升效率. </li>\n</ol>\n<ul>\n<li>利用开源软件的优势, 站在巨人的肩膀上开发. 采用了以下工具, 如项目管理工具JIRA、知识管理工具Confluence、代码托管平台GitHub、代码缓存及管理仓库工具Nexus、持续继承工具Jenkins、代码静态审查工具SonarQube、自动化部署工具Ansible</li>\n<li>针对人手不够, 而阻碍工具落地的情况, 采取以下措施:<ul>\n<li>通过工作坊和团队一起找出痛点, 列出所有改进点并进行优先级排序</li>\n<li>每个团队每天划出一个固定时段, 半小时到1小时, 这段时间内, 所有团队成员放下手头的交付工作, 自行或组队摘取改进点进行实施, 并建立激励机制鼓励大家积极参与.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"以团队共创形式开展工作坊\"><a href=\"#以团队共创形式开展工作坊\" class=\"headerlink\" title=\"以团队共创形式开展工作坊:\"></a>以团队共创形式开展工作坊:</h3><ul>\n<li><p>what</p>\n<ul>\n<li>和团队一起找出痛点, 列出所有改进点并进行优先级排序</li>\n</ul>\n</li>\n<li><p>how</p>\n<ul>\n<li>主题介绍. <ul>\n<li>主要是确立目标.</li>\n</ul>\n</li>\n<li>头脑风暴. <ul>\n<li>每个人先列出实现目标的障碍和对应想法, 然后分成几个小组, 每个组把组员的想法, 都进一步提炼成几个想法.</li>\n</ul>\n</li>\n<li>排列组合. <ul>\n<li>对每个组提炼出来的想法, 再进一步归类.</li>\n</ul>\n</li>\n<li>提炼中心词. <ul>\n<li>对每类想法, 提炼中心词.</li>\n</ul>\n</li>\n<li>模型图. <ul>\n<li>思考中心词之间的逻辑关系, 通过关系摆放形成图形, 解读图形, 制定行动方案.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>通过工作坊, 发现以下问题: </p>\n<ul>\n<li>1)业务请求跟踪性差</li>\n<li>2)缺乏回归测试</li>\n<li>3)手工部署</li>\n</ul>\n</li>\n<li><p>针对以上问题, 采取相应措施:</p>\n<ul>\n<li>1)-1 JIRA记录所有的请求和需求, 建立可视板使进度可视化.</li>\n<li>1)-2 每日站会围绕JIRA可视板进行,确认每天的优先级、进度、阻碍.</li>\n<li>1)-3 通过Confluence建立项目文档和知识库. 使所有知识和信息透明化, 提升沟通和学习效率</li>\n<li>2) 找出合适的自动化测试方案, 通过Jenkins每天自动执行全部自动化测试并发布测试结果, 结合SonarQube观测测试代码覆盖率是否处于上升趋势</li>\n<li>3) 通过Ansible编写部署脚本, 实现部署自动化.</li>\n</ul>\n</li>\n<li><p>实施过程的阻碍:</p>\n<ul>\n<li>遗留代码耦合度高, 可测试性低, 导致自动化回归测试落地缓慢.</li>\n<li>上线流程烦琐, 倾向延迟修复版本的上线而造成更大的业务影响.<ul>\n<li>不管付出多少努力, 零缺陷和零风险都是不可实现的, 很多问题只有在生产环境才会出现. 做到真正的持续交付、频繁上线, 每次上线所涉及的变更范围缩到最小, 当问题出现的时候, 能更快地修复问题并把业务影响降到最低.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"项目试点实践经验\"><a href=\"#项目试点实践经验\" class=\"headerlink\" title=\"项目试点实践经验:\"></a>项目试点实践经验:</h3><ul>\n<li><p>采用新交付方式, 规范并简化流程:</p>\n<ul>\n<li>拥抱变化<ul>\n<li>适应任何需求变化以满足业务部门的最终需求. 拆分原始需求并快速交付其中最重要的部分获取反馈并及时修改</li>\n</ul>\n</li>\n<li>拆分<ul>\n<li>把大的需求拆分成最小可交付需求来缩短交付时间和实现持续交付</li>\n</ul>\n</li>\n<li>简化流程<ul>\n<li>最终用户与IT工程师直接沟通, 减少交接与签署, 不再依赖繁文缛节的文档. 业务部门可通过JIRA Service Desk直接提交需求, 规范交付文档, 使业务部门和IT部门对验收条件达成共识.</li>\n<li>PS: 以前老大也经常这么说，产品提的需求只是个解决方案，还需要跟业务沟通，把握真正的需求</li>\n</ul>\n</li>\n<li>透明可视化<ul>\n<li>需求与细节都记录在JIRA上. 通过看板可视化进度与阻碍. 定期汇报</li>\n</ul>\n</li>\n<li>改进服务<ul>\n<li>上线后业务人员可为每个交付评分和反馈意见<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbfgdmvfdj30v8082gqm.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure> \n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>基于产品的持续改进:</p>\n<ul>\n<li>建立CI/CD流水线, 加快暴露集成问题</li>\n<li>实现基于主干开发, 避免上线代码非测试过的版本等问题</li>\n<li>特性开关控制新功能</li>\n</ul>\n</li>\n<li><p>采用敏捷估算预测交付时间, 迭代进行过程中, 通过燃尽图持续观察团队的交付速率, 并及时调整预测.</p>\n</li>\n<li><p>从满足对方要求的定制化接口到通过API开放数据:</p>\n<ul>\n<li>采用演进式的设计方法和微服务架构.</li>\n<li>先搞清楚对家需要哪些数据(可根据对家系统所要求的接口文件规格文档), 然后为此设计Process API, 满足对家直接访问的需求. 在底层, 对数据按照领域进行归类, 设计相应的Domain API, 从Domain API获取元数据整合出Process API所需要的数据.</li>\n<li>实施部分, 每个API都是一个独立的微服务应用, 基于Spring Boot开发. 借助Spring Cloud来搭建整个微服务框架.</li>\n<li>通过Spring Cloud Contract框架实现契约测试.</li>\n</ul>\n</li>\n<li><p>从“预算驱动交付”到“价值驱动交付”</p>\n<ul>\n<li>引入服务等级, 统一确定请求优先级来安排产能:<ul>\n<li>延迟成本，cost of delay，计算每个请求如果逾期的话造成的损失，将其折算成金钱，来量化所有请求的优先级</li>\n<li>服务等级，class of service，对于不同的请求类型，赋予不同的服务等级，区别处理<ul>\n<li>加急类(Expedite), 常见于一些时效性特别强的需求, 或者对产品重大缺陷的修复. 这一类请求将被视为最高优先级, 可以无视最大在制品(WIP)的限制而直接进行作业. 然而这样的请求, 很容易对看板的正常工作造成冲击, 因此加急类的任务个数, 通常仅设置为1.</li>\n<li>固定交付日期类(Fixed Delivery Date), 推荐安排一定的产能来处理一些固定交付日期的请求. 对于这一类请求, 需要交付团队在开发之前对请求的工作量进行估算, 并在开发过程中定期地确认进度. 一旦发现进度落后到有可能无法完成的地步, 则需要交付团队对请求重新进行评估. 如有必要, 这类请求可以升级为加急类.</li>\n<li>标准类(Standard), 最普通的请求. 推荐大部分的产能都归类到此类请求. 交付团队无需对请求的工作量进行估算, 直接按照先进先出的顺序进行处理即可. 但对于超过两周工作量的请求, 建议先进行拆分.</li>\n<li>无形类(Intangible), 主要针对一些用户价值有限的附加功能, 推荐安排此类任务上的产能应该低于标准类的产能.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>采用关键链方法, 把约束理论运用到项目管理中, 解决依赖冲突, 突破项目管理的瓶颈</p>\n<ul>\n<li>新项目由于资源冲突, 计划时间超出规定的交付时间. 同时考虑到原来的计划是有安全时间的, 于是调整计划, 把所有任务的时间减半, 而这些被扣除的安全时间放在最后一个任务后作为项目缓冲时间</li>\n</ul>\n</li>\n<li><p>对于IT部门, 致力于培养能做到端到端交付的T型人才</p>\n<ul>\n<li>模糊原来诸如BA、开发工程师、测试工程师、运维工程师等的明确的职能分工, 尽可能做到负责一个用户故事或需求的端到端交付, 包括分析、开发、测试、运维等</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"相关概念\"><a href=\"#相关概念\" class=\"headerlink\" title=\"相关概念\"></a>相关概念</h2><h3 id=\"敏捷方法论\"><a href=\"#敏捷方法论\" class=\"headerlink\" title=\"敏捷方法论\"></a>敏捷方法论</h3><h4 id=\"Scrum\"><a href=\"#Scrum\" class=\"headerlink\" title=\"Scrum\"></a>Scrum</h4><ul>\n<li>方法选择: 有专属团队的纯开发项目，需要稳定的交付节奏的项目，适用Scrum。需要跨项目、跨团队合作的，一人分饰多角的，维护类型的项目，适用看板</li>\n<li>相关概念<ul>\n<li>Product Owner（PO），用户/客户/业务代言人，即可以做出业务决策（需求和优先级）的人</li>\n<li>Scrum Master，熟悉Scrum流程的人，指导和确保团队以Scrum的方式进行交付</li>\n<li>Sprint，对迭代的说法。一个项目或产品的交付就是由一个又一个的Sprint构成的</li>\n<li>User Story，用户故事。具有业务价值的交付单位，一个项目或产品由很多用户故事构成</li>\n<li>Product Backlog，可理解为项目的代办列表，由用户故事构成</li>\n<li>Sprint Backlog，一个Sprint的代办列表，确定Sprint里有哪些用户故事，框定Sprint的开发范围</li>\n</ul>\n</li>\n<li>过程<ul>\n<li>每个项目或产品的交付由若干个Sprint构成。Sprint的周期是固定的，以保持节奏。通常是2-4个星期，不建议超过4个星期</li>\n<li><ol>\n<li>每个Sprint开始时，PO和IT团队一起开Sprint计划会议，PO对Product Backlog中的用户故事进行排序，选出最重要的用户故事</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>IT团队对这些用户故事进行估算。Sprint的周期和团队成员数量的确定，也确定了团队的大概交付能力</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>确定哪些用户故事会放到这个Sprint的Backlog里，作为Sprint的开发范围</li>\n</ol>\n</li>\n<li><ol start=\"4\">\n<li>围绕用户故事开发，每天一次站会，汇报昨天做了什么，今天会做什么，昨天遇到什么问题, 而且控制会议时长和参会人数以提高效率</li>\n</ol>\n</li>\n<li><ol start=\"5\">\n<li>Sprint结束的时候，开评审会议，展示交付，PO的反馈，包括需求变更都可定义成新的用户故事放到Product Backlog里重新排队<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1geyscva072j30r20gqwix.jpg\" alt=\"\"></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>敏捷的所有改变都是为了快速反馈<ul>\n<li>短迭代开发，让PO更快、更早地看到成品，给予反馈</li>\n<li>每日站会，每天都能看到进度和阻碍</li>\n<li>回顾会议，每个迭代都反思改进点，形成持续改善的机制</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"极限编程\"><a href=\"#极限编程\" class=\"headerlink\" title=\"极限编程\"></a>极限编程</h4><ul>\n<li><p>12个实践</p>\n<ul>\n<li>确保开发可更早开始和迭代式的持续交付<ul>\n<li>计划游戏，planning game，<ul>\n<li>把整个项目拆分成从几天到几个星期的若干个迭代，把需求拆分成一个独立的用户故事，放在Backlog里——》每个迭代开始时，用户对用户故事进行排序——》通过估算确定哪些用户故事可在整个迭代里开发。且只对当前迭代进行计划，新需求产生的用户故事要放到后面的迭代中</li>\n</ul>\n</li>\n<li>小型发布，small release，<ul>\n<li>每个迭代后，所开发的用户故事都可发布或展示给用户，获取反馈，新的用户故事放到后面的迭代中</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>确保客户和交付团队都明白在做什么<ul>\n<li>现场客户，onsite customer，<ul>\n<li>用户应该和交付团队始终在一起，持续参与到项目中，阐明用户故事的具体需求和用户故事优先级，给交付团队及时的反馈</li>\n</ul>\n</li>\n<li>系统隐喻，system metaphor，<ul>\n<li>记录用户故事需求时，用交付团队和客户都能理解的语言编写</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>编码规范，code standards，<ul>\n<li>有一套整个团队都认可的规范</li>\n</ul>\n</li>\n<li>结对编程，pair Programming，<ul>\n<li>两个人结对在同一台计算机前来完成编程，一次性完成编程与评审, 共同讨论设计、测试、编程. 解决传统事后代码review, 需要重写单元测试及review参与度和质量的问题</li>\n</ul>\n</li>\n<li>测试驱动开发，test driven development，<ul>\n<li>在编程前就根据用户故事的需求写好测试（自动化测试），通过测试来验证编程代码是否满足需求</li>\n</ul>\n</li>\n<li>持续集成，continuous integration，<ul>\n<li>每天或每次有代码提交时就集成一次（编译、运行所有自动化测试、打包）, 尽早暴露问题并及时修复</li>\n</ul>\n</li>\n<li>重构，refactoring，<ul>\n<li>不改变功能和外部行为而优化代码的可读性、质量、性能，有了自动化测试和持续集成，可保证重构后出现测试失败，立即回滚代码</li>\n</ul>\n</li>\n<li>简单设计，simple design，<ul>\n<li>只为当前要做的需求进行最简单的设计, 因为越简单的东西, 越不容易出错, 越复杂的东西, 越容易出错. 而如果设计不能满足需要时, 在自动化测试和持续集成的保障下, 通过重构来解决.</li>\n</ul>\n</li>\n<li>代码集体所有权，collective code ownership，<ul>\n<li>在自动化测试和持续集成的保障下，任何人都可以对代码重构</li>\n</ul>\n</li>\n<li>每周只工作40个小时，40-hour week, <ul>\n<li>保障每天足够的时间恢复精力, 避免提前透支精力</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>5个核心价值</p>\n<ul>\n<li>沟通，communication、简单，simplicity、反馈，feedback、勇气，courage、谦逊modesty</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"看板（另外一种敏捷、精益的方法）\"><a href=\"#看板（另外一种敏捷、精益的方法）\" class=\"headerlink\" title=\"看板（另外一种敏捷、精益的方法）\"></a>看板（另外一种敏捷、精益的方法）</h4><ul>\n<li>原则<ul>\n<li>进度可视化<ul>\n<li>识别整个交付从左到右的各道工序哪里是瓶颈</li>\n<li>根据约束理论，一切瓶颈以外的改善都是徒劳的. 约束理论Theory of Constraint，TOC，帮助企业识别出在实现目标的过程中存在着哪些制约因素，并进一步指出如何实施必要的改进措施</li>\n</ul>\n</li>\n<li>限制在制品（WIP，Work-in-progress）<ul>\n<li>一个请求，只有所有工序都完成并交付到客户那里，其价值才能得到体现</li>\n<li>大量在制品堆积会导致优先级迷失和任务切换，任务切换又会导致效率低下，降低交付速度</li>\n<li>只有下游有闲置产能才从上游拉入新的请求，避免在制品堆积</li>\n<li>Scrum限制在制品的方式是, 通过Sprint计划会议限制每个Sprint放入的用户故事</li>\n<li>看板则是在每道交付工序中限制并行任务数量, 随时都可以把新的请求放入Backlog中并排序, 只要有闲置产能时就把优先级高的请求拉入进程<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggan5rl1udj30vm0letf2.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>观察和改善流动</li>\n</ul>\n</li>\n<li>与Scrum相通的地方<ul>\n<li>都基于敏捷与精益的原则，追求价值，消除浪费</li>\n<li>都是基于拉动的计划系统</li>\n<li>都限制在制品</li>\n<li>都通过透明化来获取快速反馈</li>\n<li>都聚焦于更早和更频繁地交付软件</li>\n<li>都需要把大需求拆分成小故事</li>\n</ul>\n</li>\n<li>how<ul>\n<li>可利用JIRA，按需定义看板的范围、外观、限制在制品数量、泳道、卡片的外观等。每天对着JIRA看板来开每日例会，业务也可通过看板的情况来判断团队分配是否合理，及整个交付过程的瓶颈在哪</li>\n<li>观察看板时，要关注的是有没有空闲的任务，而不是有没有空闲的人员</li>\n<li>从右往左看, 先聚焦在制品, 尽快把在制品完成</li>\n<li>看累积流图，一个面积图，强调用户故事或是需求数随时间而变化的程度，直观显示整体趋势走向。x时间，y需求数量, 不同颜色的面积区分如待处理、处理中、已完成状态的需求。<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbgu9da63j30v20guwqi.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"用户故事地图\"><a href=\"#用户故事地图\" class=\"headerlink\" title=\"用户故事地图\"></a>用户故事地图</h3><ul>\n<li>why<ul>\n<li>真正的敏捷开发必须是基于用户故事的开发过程<ul>\n<li>如按报表来拆成若干个用户故事，选最常用的报表（对业务有价值的最小单位）先开发给业务测试，更快的获得反馈, 使大部分问题能更早地暴露, 为其他用户故事打下基础，通过早交付、早测试、早验收把产品的方向确定。</li>\n<li>如果只是按功能点拆分，单个功能点的完成没有什么业务价值，无法测试</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>how<ul>\n<li>从左到右按时间顺序罗列用户行为（流程的每一步）——》在每个用户行为从上至下地罗列相应的细节（包括所需的开发点）。基于这张地图，还可对每个开发点的业务价值进行审视，找出最小可用产品（MVP，Minimal Viable Product）并制订发布计划. 制定发布计划时，遵循刚刚好good enough、更好better、最好best的演进原则<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge0103m24lj30wi0m27eb.jpg\" alt=\"\"></li>\n<li>记录家里所有物品的APP，每购入新物品就记录<ul>\n<li>用户故事地图<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge011rwdwlj30nc092q6m.jpg\" alt=\"\"></li>\n<li>回顾地图，梳理每个用户故事的优先级，设想如果我们要在一周内做出MVP，会做哪些用户故事<br><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge0125wyyuj30n809eacx.jpg\" alt=\"\"></li>\n<li>定义MVP的必要性:<ul>\n<li>开发一个功能所需要的时间与成本总是超出预期的</li>\n<li>需求是需要验证的假设，通过MVP可以快速试验，通过最小成本验证需求假设是否成立</li>\n<li>MVP是从整个业务角度来找出一个既能实现相同业务目标、IT成本最小的方法来快速启动新业务<ul>\n<li>如，要开一家提供网上订餐外送服务的餐厅，半个月内做出一个静态网站，展示菜式和订餐热线，生意就可在半个月之内运作起来。审视的是整个商业模式，不光是IT功能，更重要的是这样的外送服务模式是否可行和菜品是否受欢迎</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>用户故事拆分, 使故事最小化</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>3C原则<ul>\n<li>Card（地图）</li>\n<li>Conversation，确定发布计划后，要和PO围绕当前发布计划中的每一张Card聊具体需求</li>\n<li>Confirmation，确定验收条件</li>\n</ul>\n</li>\n<li>敏捷落地比较图<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge013ieznhj30ua0iy0yo.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure>\n\n</li>\n</ul>\n<h3 id=\"DevOps\"><a href=\"#DevOps\" class=\"headerlink\" title=\"DevOps\"></a>DevOps</h3><ul>\n<li>敏捷打通了业务、开发、测试之间的墙, 通过更紧密的沟通与交互实现更频繁的交付. 而开发与运维之间还有一堵墙, 运维也需要稳定的部署、监控支持持续交付. DevOps就实现开发与运维一体化和端到端的持续交付，融合了敏捷与精益的精神, 涉及自动化、精益思想、量度和分享.</li>\n<li>精益是从丰田生产系统移植到软件开发的方法, 看板方法就是其中一种精益方法.</li>\n</ul>\n<h3 id=\"交付文档模版\"><a href=\"#交付文档模版\" class=\"headerlink\" title=\"交付文档模版:\"></a>交付文档模版:</h3><ul>\n<li>需求描述<ul>\n<li>作为（谁），我想要（做什么），为了（为什么）。</li>\n<li>行为驱动开发: 业务人员确定对系统的期望行为，采用业务部门和IT部门双方都能看懂的统一语言Gherkin的given when then的语言格式, 编写验收实例, 再通过自动化测试框架cucumber执行实例，实现验收测试自动化，并纳入持续集成<ul>\n<li>cucumber，一个用普通语言描述测试用例的、支持行为驱动开发BDD的自动化工具，由Ruby编写，支持Java、.NET等多种开发语言。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>确认理解<ul>\n<li>复述对需求的理解</li>\n</ul>\n</li>\n<li>问为什么<ul>\n<li>在什么场景下需要这个需求，包括谁用、什么时候用和使用条件、要解决什么问题、使用频次、怎么发生等（挖掘真实用意，因为有些需求是解决方案）</li>\n</ul>\n</li>\n<li>验收条件<ul>\n<li>“完成定义”, Definition of Done</li>\n<li>实例化需求, 验收测试用例的具体例子. 避免误读, 让抽象的需求变得具体和可测试.</li>\n<li>以终为始，一开始明确要做成什么样，指导行动并确保结果正确。包括happy path和exceptional scenario</li>\n</ul>\n</li>\n<li>详细设计与实现</li>\n<li>集成测试结果</li>\n<li>用户验收测试</li>\n<li>上线备忘<ul>\n<li>上线所需要的额外步骤</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"敏捷估算\"><a href=\"#敏捷估算\" class=\"headerlink\" title=\"敏捷估算\"></a>敏捷估算</h3><ul>\n<li>敏捷采用的估算单位是故事点, 一个和复杂度或规模有关的相对数, 而用户故事的复杂度或规模, 是一个相对时间更稳定的常量, 因为时间是不可控因素, 同样的需求不同人做的耗时差异性很大.</li>\n<li>扑克牌游戏方法<ul>\n<li>团队每个成员都有一副扑克牌, 每副扑克牌包含一个不同的数字, 如斐波那契数列, 然后对应故事点分别为1, 2, 4, 6, 10等. 当大家都消化完一个用户时, 同时通过出牌的方式来展示每个人的估算结果. 给出最高和最低估算的两人要解释和辩论. 最后团队得出一个大家都认同的估算值.</li>\n<li>该方法的原理就是利用人群中涌出的群体智慧远远超过个人智慧. </li>\n</ul>\n</li>\n<li>估算时间<ul>\n<li>首先测试交付速度. 观察团队在头一两个迭代中可以实际交付多少个故事点来预测团队的交付速率, 从而计算完成所有故事点需要多少个迭代. 而在Scrum, 迭代的周期是固定的, 知道有多少个迭代就能知道需要多长时间</li>\n<li>在迭代进行过程中, 通过燃尽图来持续观察团队的交付速率是在提升还是下降, 随时作出调整</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"关键链\"><a href=\"#关键链\" class=\"headerlink\" title=\"关键链\"></a>关键链</h3><ul>\n<li>关键路径是项目活动及其逻辑关系图中最长的路径, 通常决定项目工期</li>\n<li>而关键链是决定项目长度的全部关键因素的关键路径和其他一些需要关键资源的任务</li>\n<li>把关键链上所有任务被扣除的安全时间放在最后要给任务后作为项目缓冲，保护项目不受关键链任务延迟的影响。所有非关键路径上的任务被扣减的安全时间也集中在一起作为接入关键链的接驳缓冲，保护关键链不受这些任务延迟的影响</li>\n<li>如果按非关键链的做法, 为所有的任务都加入安全时间, 会被学生症侯群、多任务和延迟的累计浪费掉所有的安全时间, 从而导致项目延迟<ul>\n<li>学生症候群指通常人们会先极力争取安全时间, 得到安全时间后, 就不着急, 真正开始往往在最后一刻, 造成安全时间被浪费. 所以在任务阶段剥夺安全时间可以迫使相应的资源在任务开始的时候就全力以赴地执行任务</li>\n<li>估算通常被视作承诺, 考虑到今后的估算被压榨, 人们通常不会呈报提前完工, 这部分的延迟会转嫁到下一个任务, 而最终导致项目延迟. 而关键链方法, 任何任务提前完成都增加到缓冲区<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge01fmm6trj31cy0kqk7v.jpg\" alt=\"\" title=\"\">\n                </div>\n                <div class=\"image-caption\"></div>\n            </figure></li>\n</ul>\n</li>\n<li>关键链区别于关键路径主要是,<ul>\n<li>关键链考虑了资源冲突. 把安全时间从每个任务中转移出来的前提是, 每个任务所需要的资源都能聚焦在当前任务上</li>\n</ul>\n</li>\n<li>约束理论五步法<ul>\n<li>定义系统限制（瓶颈）</li>\n<li>决定如何充分利用限制</li>\n<li>让非限制资源充分配合</li>\n<li>打破系统限制</li>\n<li>若限制已打破，回到步骤一</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"其他相关思维\"><a href=\"#其他相关思维\" class=\"headerlink\" title=\"其他相关思维:\"></a>其他相关思维:</h3><ul>\n<li>真正的持续交付需要从左端的业务需求到右端的上线全流程配合</li>\n<li>计划不是为了执行, 而是提前做好各种情况的预案, 集结资源, 以应对将来可能的各种变化</li>\n<li>敏捷开发提倡信任、自治及通过技术手段如自动化测试来取代繁文缛节的文档.变革需要整个公司文化和价值观上的改变与配合以及人力、工具的投入, 只有管理层的支持才能使变革遍地开花.</li>\n</ul>\n<h2 id=\"个人感悟\"><a href=\"#个人感悟\" class=\"headerlink\" title=\"个人感悟\"></a>个人感悟</h2><ul>\n<li><p>上一篇《凤凰项目-三步工作法笔记》中, 提到多读书真的很重要, 因为虽然知识不能改变命运, 但是能改变思维. </p>\n</li>\n<li><p>后来我想了下, 应该是”意识到必须做出改变“更重要. 那样看了书之后, 不是只有“哦, 我知道了”, 而是会想办法把书里面的内容吸收用起来. </p>\n</li>\n<li><p>比如说, 把迭代思维融入到日常生活中, 其实是一种解决拖延症的好办法, 把要完成的事情拆分到足够小, 小到不用犹豫就能做的, 同时把这些任务可视化, 持续监控并调整自己的行为, 直到完成. </p>\n</li>\n<li><p>而“限制在制品”的应用, 就是把任务拆分到足够小之后, 排好优先级, 一件一件的完成, 减少不必要的任务切换, 专注于尽快消除未完成的任务. </p>\n</li>\n<li><p>ps: 尝试了一段时间后, 还是有些问题, 最重要的原因, 应该是缺少反馈, 多去接受外界的反馈才是真正的走出舒适圈…</p>\n</li>\n</ul>"}],"PostAsset":[],"PostCategory":[{"post_id":"cklrai11l0001unrad5jq5wj0","category_id":"cklrai11m0002unrafoch4jzv","_id":"cklrai11p0005unra1iq23ycr"},{"post_id":"cklrai124000dunra4uzdfljb","category_id":"cklrai127000junra47pyhkbt","_id":"cklrai12c000vunra06jqb3ep"},{"post_id":"cklrai127000kunra9x4nd7ck","category_id":"cklrai12a000punraeup41tqq","_id":"cklrai12d000yunraf3z7akz5"},{"post_id":"cklrai128000lunraho0805vz","category_id":"cklrai12c000wunraasfggp6l","_id":"cklrai12e0011unra6p4zcocb"},{"post_id":"cklrai12a000runrafpuv4og9","category_id":"cklrai12d000zunra8d2t5tx8","_id":"cklrai12g0017unrabbgh82ni"},{"post_id":"cklrai12c000uunra2dz2839o","category_id":"cklrai12d000zunra8d2t5tx8","_id":"cklrai12i001aunra9gry3dst"}],"PostTag":[{"post_id":"cklrai11l0001unrad5jq5wj0","tag_id":"cklrai11n0003unragtte9efz","_id":"cklrai11p0006unra5d4p5yao"},{"post_id":"cklrai11l0001unrad5jq5wj0","tag_id":"cklrai11o0004unrae0p90648","_id":"cklrai11p0007unra54y3g60o"},{"post_id":"cklrai1210008unra1os2gs5y","tag_id":"cklrai11n0003unragtte9efz","_id":"cklrai124000cunradtpbf08s"},{"post_id":"cklrai1210008unra1os2gs5y","tag_id":"cklrai11o0004unrae0p90648","_id":"cklrai125000gunra5l9w6de2"},{"post_id":"cklrai127000kunra9x4nd7ck","tag_id":"cklrai125000funrag96m18r4","_id":"cklrai129000nunra72f95mtb"},{"post_id":"cklrai122000aunra2nr8c8rh","tag_id":"cklrai11n0003unragtte9efz","_id":"cklrai12a000qunrafqeveuol"},{"post_id":"cklrai122000aunra2nr8c8rh","tag_id":"cklrai125000funrag96m18r4","_id":"cklrai12c000tunra0yvy3kxk"},{"post_id":"cklrai124000dunra4uzdfljb","tag_id":"cklrai128000munracm5j8114","_id":"cklrai12e0012unra3p5q8yas"},{"post_id":"cklrai124000dunra4uzdfljb","tag_id":"cklrai12b000sunradtcb4625","_id":"cklrai12f0014unra6jqu1umd"},{"post_id":"cklrai124000dunra4uzdfljb","tag_id":"cklrai12d000xunracvvbh8v3","_id":"cklrai12g0016unra2wx84bvf"},{"post_id":"cklrai128000lunraho0805vz","tag_id":"cklrai12e0010unradffq052j","_id":"cklrai12g0018unra61dgcrdi"},{"post_id":"cklrai129000ounrahsoqaokp","tag_id":"cklrai12g0015unra720m25cl","_id":"cklrai12i001bunra4n3g8vhh"},{"post_id":"cklrai129000ounrahsoqaokp","tag_id":"cklrai11n0003unragtte9efz","_id":"cklrai12j001cunra2ri46zje"},{"post_id":"cklrai12a000runrafpuv4og9","tag_id":"cklrai12h0019unrahugj1uz0","_id":"cklrai12k001gunra9vjpanmh"},{"post_id":"cklrai12a000runrafpuv4og9","tag_id":"cklrai12j001dunra8tfea6u0","_id":"cklrai12l001hunra8u9e7t57"},{"post_id":"cklrai12a000runrafpuv4og9","tag_id":"cklrai12j001eunrahp0l3dxk","_id":"cklrai12l001junra83bygw06"},{"post_id":"cklrai12c000uunra2dz2839o","tag_id":"cklrai12h0019unrahugj1uz0","_id":"cklrai12m001lunrachp37k6l"},{"post_id":"cklrai12c000uunra2dz2839o","tag_id":"cklrai12j001dunra8tfea6u0","_id":"cklrai12m001munraewu5efom"},{"post_id":"cklrai12c000uunra2dz2839o","tag_id":"cklrai12j001eunrahp0l3dxk","_id":"cklrai12m001nunra7dpa0dam"}],"Tag":[{"name":"测试","_id":"cklrai11n0003unragtte9efz"},{"name":"接口测试","_id":"cklrai11o0004unrae0p90648"},{"name":"性能测试","_id":"cklrai125000funrag96m18r4"},{"name":"协议","_id":"cklrai128000munracm5j8114"},{"name":"python","_id":"cklrai12b000sunradtcb4625"},{"name":"socket","_id":"cklrai12d000xunracvvbh8v3"},{"name":"观后感","_id":"cklrai12e0010unradffq052j"},{"name":"覆盖率测试","_id":"cklrai12g0015unra720m25cl"},{"name":"读书笔记","_id":"cklrai12h0019unrahugj1uz0"},{"name":"敏捷","_id":"cklrai12j001dunra8tfea6u0"},{"name":"DevOps","_id":"cklrai12j001eunrahp0l3dxk"}]}}